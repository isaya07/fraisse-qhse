import{T as I}from"./index-CrhbiAe9.js";import{d as M,G as q,f as z,g as G,h as y,i as m,q as O,j as F,c as Q,a as i,b as t,w as a,u as s,s as _,r as H,t as p,e as f,l as P,m as k,y as J,o as h}from"./index-d7axL_xv.js";import{u as K}from"./users-CbvhcKd8.js";import{s as W,a as l}from"./index-C0aPiIhq.js";import{s as X}from"./index-DZQqA5uS.js";import{s as Y,a as Z}from"./index-D_33rlMc.js";import{s as C}from"./index-Dw7kVe-F.js";import"./index-C45h_JBJ.js";import"./index-C4Jjik4c.js";import"./index-xoP2DrFw.js";import"./index-DbX5rEQv.js";import"./index-rhSU9nKe.js";import"./index-BixvgfbH.js";import"./index-Cx-_v3H7.js";const ee={class:"p-4"},te={class:"card surface-card p-4 border-round shadow-2"},se={class:"flex flex-col md:flex-row md:items-center md:justify-between mb-6 gap-4"},re={class:"flex gap-2"},ae={class:"flex flex-wrap gap-2 items-center justify-between"},oe={class:"font-medium"},ie={class:"flex gap-2"},xe=M({__name:"UserIndex",setup(le){const b=J(),n=K(),U=q(),R=z(),w=G(),c=y(""),v=y(15),g=y(0),S=m(()=>n.users),L=m(()=>n.loading),$=m(()=>n.pagination.total),N=m(()=>U.currentUser),u=async()=>{const r={search:c.value};await n.fetchUsers(g.value+1,v.value,r)},A=r=>{g.value=r.page,v.value=r.rows,u()},V=r=>({admin:"Administrateur",manager:"Manager",user:"Utilisateur",viewer:"Observateur"})[r]||r,T=r=>({admin:"danger",manager:"warn",user:"info",viewer:"secondary"})[r]||"info",j=()=>{b.push("/users/create")},B=r=>{b.push(`/users/${r}/edit`)},D=r=>{R.require({message:`Voulez-vous vraiment supprimer l'utilisateur "${r.username}" ?`,header:"Confirmation de suppression",icon:"exclamation-triangle",rejectLabel:"Annuler",acceptLabel:"Supprimer",rejectClass:"p-button-secondary p-button-outlined",acceptClass:"p-button-danger",accept:async()=>{try{await n.deleteUser(r.id),w.add({severity:"success",summary:"Succès",detail:"Utilisateur supprimé",life:3e3,icon:"check"}),u()}catch{w.add({severity:"error",summary:"Erreur",detail:"Impossible de supprimer l'utilisateur",life:3e3,icon:"times"})}}})};return O(c,()=>{g.value=0,u()}),F(()=>{u()}),(r,o)=>{const d=H("font-awesome-icon"),x=I;return h(),Q("div",ee,[i("div",te,[i("div",se,[o[1]||(o[1]=i("h1",{class:"text-2xl font-bold text-color"},"Gestion des Utilisateurs",-1)),i("div",re,[t(s(_),{label:"Nouvel utilisateur",onClick:j,severity:"primary"},{icon:a(()=>[t(d,{icon:"plus",class:"mr-2"})]),_:1})])]),t(s(W),{ref:"dt",value:S.value,lazy:"",paginator:!0,rows:v.value,totalRecords:$.value,loading:L.value,onPage:A,paginatorTemplate:"FirstPageLink PrevPageLink PageLinks NextPageLink LastPageLink CurrentPageReport RowsPerPageDropdown",rowsPerPageOptions:[5,10,15,25,50],currentPageReportTemplate:"Affichage de {first} à {last} sur {totalRecords} utilisateurs",tableStyle:"min-width: 50rem",class:"p-datatable-sm"},{header:a(()=>[i("div",ae,[o[2]||(o[2]=i("h4",{class:"m-0"},"Liste des utilisateurs",-1)),t(s(Y),{iconPosition:"left"},{default:a(()=>[t(s(Z),null,{default:a(()=>[t(d,{icon:"magnifying-glass"})]),_:1}),t(s(X),{modelValue:c.value,"onUpdate:modelValue":o[0]||(o[0]=e=>c.value=e),placeholder:"Rechercher..."},null,8,["modelValue"])]),_:1})])]),empty:a(()=>[...o[3]||(o[3]=[f(" Aucun utilisateur trouvé. ",-1)])]),default:a(()=>[t(s(l),{field:"username",header:"Nom d'utilisateur",sortable:"",style:{"min-width":"10rem"}},{body:a(({data:e})=>[i("div",oe,p(e.username),1)]),_:1}),t(s(l),{field:"email",header:"Email",sortable:"",style:{"min-width":"14rem"}},{body:a(({data:e})=>[f(p(e.email),1)]),_:1}),t(s(l),{field:"first_name",header:"Prénom",sortable:"",style:{"min-width":"10rem"}},{body:a(({data:e})=>[f(p(e.first_name),1)]),_:1}),t(s(l),{field:"last_name",header:"Nom",sortable:"",style:{"min-width":"10rem"}},{body:a(({data:e})=>[f(p(e.last_name),1)]),_:1}),t(s(l),{field:"role",header:"Rôle",sortable:"",style:{"min-width":"8rem"}},{body:a(({data:e})=>[t(s(C),{value:V(e.role),severity:T(e.role)},null,8,["value","severity"])]),_:1}),t(s(l),{field:"is_active",header:"Statut",sortable:"",style:{"min-width":"8rem"}},{body:a(({data:e})=>[t(s(C),{value:e.is_active?"Actif":"Inactif",severity:e.is_active?"success":"danger"},null,8,["value","severity"])]),_:1}),t(s(l),{header:"Actions",exportable:!1,style:{"min-width":"8rem"}},{body:a(({data:e})=>[i("div",ie,[P((h(),k(s(_),{text:"",rounded:"",severity:"success",onClick:E=>B(e.id)},{default:a(()=>[t(d,{icon:"pencil"})]),_:1},8,["onClick"])),[[x,"Modifier",void 0,{top:!0}]]),P((h(),k(s(_),{text:"",rounded:"",severity:"danger",onClick:E=>D(e),disabled:e.id===N.value?.id},{default:a(()=>[t(d,{icon:"trash"})]),_:1},8,["onClick","disabled"])),[[x,"Supprimer",void 0,{top:!0}]])])]),_:1})]),_:1},8,["value","rows","totalRecords","loading"])])])}}});export{xe as default};
