import{r as h,d as R,o as M,b as k,f as b,i as s,l as c,u as a,s as D,j as $,k as w,t as T,h as j,g as q,m as v}from"./vendor-vue-7xZ5dmFb.js";import{d as B}from"./vendor-pinia--L0FGc_G.js";import{c as O}from"./app-actions-MIoyI-E5.js";import{a as x,q as V,r as g,h as L}from"./vendor-primevue-_kQtzldN.js";import{f as H,a as I}from"./vendor-utils-CgaVvxla.js";const P=B("notification",()=>{const f=h([]),l=h(0),r=h(null),m=h(!1),{get:p,put:y,post:_}=O();async function i(e=!1){m.value=!0;try{let t="/notifications";e&&(t+="?unread=true");const d=await p(t);d.success&&d.data&&(f.value=d.data.data||[])}catch(t){console.error("Error fetching notifications:",t)}finally{m.value=!1}}async function n(){try{const e=await p("/notifications/unread-count");e.success&&e.data&&(l.value=e.data.count)}catch(e){console.error("Error fetching unread count:",e)}}async function u(e){try{if((await y(`/notifications/${e}/read`,{})).success){const d=f.value.find(E=>E.id===e);d&&!d.read_at&&(d.read_at=new Date().toISOString(),l.value=Math.max(0,l.value-1))}}catch(t){console.error("Error marking notification as read:",t)}}async function o(){try{(await y("/notifications/read-all",{})).success&&(f.value.forEach(t=>t.read_at=new Date().toISOString()),l.value=0)}catch(e){console.error("Error marking all as read:",e)}}async function S(){try{const e=await p("/notifications/settings");e.success&&e.data&&(r.value=e.data)}catch(e){console.error("Error fetching settings:",e)}}async function A(e){try{const t=await y("/notifications/settings",e);t.success&&t.data&&(r.value=t.data)}catch(t){console.error("Error updating settings:",t)}}async function N(){try{return(await _("/notifications/generate-alerts",{})).success}catch(e){return console.error("Error generating alerts:",e),!1}}async function C(){try{return(await _("/notifications/send-emails",{})).success}catch(e){return console.error("Error sending emails:",e),!1}}return{notifications:f,unreadCount:l,settings:r,loading:m,fetchNotifications:i,fetchUnreadCount:n,markAsRead:u,markAllAsRead:o,fetchSettings:S,updateSettings:A,generateAlerts:N,sendEmails:C}}),z={class:"card"},U={class:"flex justify-between items-center mb-6"},F={class:"flex gap-2"},G={key:0,class:"text-green-600 text-sm flex items-center gap-1"},J={key:1,class:"text-blue-600 text-sm font-semibold flex items-center gap-1"},K=R({__name:"NotificationList",setup(f){const l=D(),r=P();M(()=>{r.fetchNotifications(!1)});const m=i=>{r.markAsRead(i)},p=()=>{r.markAllAsRead()},y=i=>H(new Date(i),"dd/MM/yyyy HH:mm",{locale:I}),_=i=>{switch(i){case"action":return"warning";case"equipment":return"info";case"visit":return"success";case"talk":return"primary";default:return"secondary"}};return(i,n)=>{const u=$("font-awesome-icon");return v(),k("div",z,[b("div",U,[n[1]||(n[1]=b("h1",{class:"text-2xl font-bold text-gray-800"},"Notifications",-1)),b("div",F,[s(a(x),{label:"Tout marquer comme lu",icon:"check",onClick:p,disabled:a(r).unreadCount===0},{icon:c(()=>[s(u,{icon:"check-double",class:"mr-2"})]),_:1},8,["disabled"]),s(a(x),{label:"ParamÃ¨tres",severity:"secondary",onClick:n[0]||(n[0]=o=>a(l).push("/settings?tab=2"))},{icon:c(()=>[s(u,{icon:"cog",class:"mr-2"})]),_:1})])]),s(a(V),{value:a(r).notifications,loading:a(r).loading,paginator:"",rows:10,stripedRows:""},{default:c(()=>[s(a(g),{field:"type",header:"Type",sortable:""},{body:c(({data:o})=>[s(a(L),{value:o.type,severity:_(o.type)},null,8,["value","severity"])]),_:1}),s(a(g),{field:"message",header:"Message",sortable:""}),s(a(g),{field:"created_at",header:"Date",sortable:""},{body:c(({data:o})=>[w(T(y(o.created_at)),1)]),_:1}),s(a(g),{header:"Statut",sortable:"",field:"read_at"},{body:c(({data:o})=>[o.read_at?(v(),k("span",G,[s(u,{icon:"check"}),n[2]||(n[2]=w(" Lu ",-1))])):(v(),k("span",J,[s(u,{icon:"circle",class:"text-[8px]"}),n[3]||(n[3]=w(" Non lu ",-1))]))]),_:1}),s(a(g),{header:"Actions",style:{width:"100px"}},{body:c(({data:o})=>[o.read_at?q("",!0):(v(),j(a(x),{key:0,icon:"check",text:"",rounded:"",severity:"success",onClick:S=>m(o.id),title:"Marquer comme lu"},{icon:c(()=>[s(u,{icon:"check"})]),_:1},8,["onClick"]))]),_:1})]),_:1},8,["value","loading"])])}}}),ee=Object.freeze(Object.defineProperty({__proto__:null,default:K},Symbol.toStringTag,{value:"Module"}));export{ee as N,P as u};
