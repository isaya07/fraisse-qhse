import{c as K,d as Q}from"./app-actions-MIoyI-E5.js";import{a as V,g as x,h as W,G as X}from"./vendor-primevue-_kQtzldN.js";import{_ as Y}from"./app-equipment-DpsUI1Di.js";import{f as z,a as N}from"./vendor-utils-CgaVvxla.js";import{d as Z,r as u,c as b,o as ee,b as a,f as o,t as r,i as c,l as d,u as _,j as te,F as f,q as h,h as P,g as y,k,n as F,m as i}from"./vendor-vue-7xZ5dmFb.js";import"./vendor-pinia--L0FGc_G.js";import"./vendor-other-akJw3aOu.js";import"./vendor-icons-Bx-8nqXz.js";const se={class:"dashboard p-4"},oe={class:"flex flex-col md:flex-row justify-between items-start md:items-center mb-6 gap-4"},ne={class:"text-color-secondary"},ie={class:"flex gap-2"},ae={class:"flex gap-2"},le={key:0,class:"flex justify-center items-center py-20"},re={key:1,class:"grid grid-cols-12 gap-6"},ce={class:"col-span-12 lg:col-span-4 space-y-6"},ue={class:"flex justify-between items-center"},de={key:0,class:"text-center py-8 text-color-secondary"},pe={key:1,class:"space-y-4"},ve=["onClick"],_e={class:"flex items-center gap-3"},me={class:"flex flex-col"},fe={class:"font-medium truncate max-w-xs"},he={class:"text-xs text-color-secondary"},ye={key:0,class:"text-sm text-color-secondary"},ge={key:1,class:"space-y-3"},xe=["onClick"],be={class:"w-10 h-10 bg-surface-100 rounded flex items-center justify-center text-surface-500"},ke={class:"flex-1 overflow-hidden"},we={class:"font-medium truncate"},De={class:"text-xs text-color-secondary truncate"},Ce={class:"col-span-12 lg:col-span-4 space-y-6"},$e={class:"h-64 flex justify-center"},qe={class:"space-y-3"},Ee=["onClick"],Me={class:"text-xs text-color-secondary"},Ae={key:0,class:"text-sm text-color-secondary"},je={class:"col-span-12 lg:col-span-4 space-y-6"},Be={class:"flex items-center gap-2"},Fe={key:0,class:"text-sm text-color-secondary"},Se={key:1,class:"space-y-4"},Te={key:0},Ve={class:"space-y-2"},ze=["onClick"],Ne={class:"flex items-center gap-3"},Pe={class:"flex flex-col"},Ge={class:"text-sm font-medium text-surface-900"},He={class:"text-xs text-color-secondary"},Ue={key:1},Le={class:"space-y-2"},Oe=["onClick"],Re={class:"flex items-center gap-3"},Ie={class:"flex flex-col"},Je={class:"text-sm font-medium text-surface-900"},Ke={class:"text-xs text-color-secondary"},Qe={key:2},We={class:"space-y-2"},Xe=["onClick"],Ye={class:"flex items-center gap-3"},Ze={class:"flex flex-col"},et={class:"text-sm font-medium text-surface-900"},tt={class:"text-xs text-color-secondary"},dt=Z({__name:"DashboardPage",setup(st){const{get:G}=K(),H=Q(),w=u(!0),E=u({}),m=u({}),D=u([]),C=u([]),$=u([]),M=u([]),A=u([]),j=u([]),B=u([]),q=u({actions:[],equipment:[]}),S=b(()=>H.user),U=b(()=>z(new Date,"EEEE d MMMM yyyy",{locale:N}).replace(/^\w/,e=>e.toUpperCase())),L=b(()=>{const e=E.value||{},n=S.value?.role,l=[];return n==="admin"||n==="manager"?(l.push({title:"Actions Ouvertes",value:e.total_actions_open||0,color:"orange",icon:"list-check"}),l.push({title:"Documents à Valider",value:e.documents_pending||0,color:"yellow",icon:"file-signature"})):l.push({title:"Mes Actions",value:e.my_actions_pending||0,color:"blue",icon:"tasks"}),l.push({title:"Équipements (Moi)",value:e.my_equipment_count||0,color:"cyan",icon:"tools"}),e.compliance_rate!==void 0&&l.push({title:"Conformité Globale",value:e.compliance_rate+"%",color:"green",icon:"check-circle"}),l}),T=b(()=>m.value?.actions_by_status?{labels:m.value.actions_by_status.labels,datasets:[{data:m.value.actions_by_status.data,backgroundColor:["#3B82F6","#F59E0B","#10B981","#EF4444"],hoverBackgroundColor:["#2563EB","#D97706","#059669","#DC2626"]}]}:null),O={plugins:{legend:{position:"right"}},cutout:"60%"},p=b(()=>{const e=[];q.value.actions.forEach(s=>{e.push({type:"action",title:s.title,date:new Date(s.due_date),label:"Action",icon:"tasks",color:"text-blue-500",id:s.id,link:`/actions/${s.id}`})}),q.value.equipment.forEach(s=>{s.expiration_date&&e.push({type:"equipment",title:s.name,date:new Date(s.expiration_date),label:"Contrôle / Expiration",icon:"tools",color:"text-cyan-500",id:s.id,link:`/equipment/${s.id}`})}),A.value.forEach(s=>{e.push({type:"certification",title:s.session?.training?.title||"Formation",date:new Date(s.expiration_date),label:"Expire bientôt",icon:"certificate",color:"text-orange-500",id:null,link:null})}),M.value.forEach(s=>{e.push({type:"training",title:s.training?.title||"Formation",date:new Date(s.start_date),label:"Session",icon:"graduation-cap",color:"text-purple-500",id:null,link:null})}),j.value.forEach(s=>{s.expires_date&&e.push({type:"document",title:s.title,date:new Date(s.expires_date),label:"Document à renouveler",icon:"file-alt",color:"text-yellow-500",id:s.id,link:`/documents/${s.id}`})}),B.value.forEach(s=>{s.next_maintenance_date&&e.push({type:"maintenance",title:`Maintenance - ${s.equipment?.name||"Équipement"}`,date:new Date(s.next_maintenance_date),label:"Maintenance préventive",icon:"wrench",color:"text-red-500",id:s.equipment?.id,link:s.equipment?.id?`/equipment/${s.equipment.id}`:null})}),e.sort((s,v)=>s.date.getTime()-v.date.getTime());const n={overdue:[],today:[],upcoming:[]},l=new Date;l.setHours(0,0,0,0);const t=new Date(l);return t.setDate(t.getDate()+1),e.forEach(s=>{const v=new Date(s.date);v.setHours(0,0,0,0),v<l?n.overdue.push(s):v.getTime()===l.getTime()||v.getTime()===t.getTime()?n.today.push(s):n.upcoming.push(s)}),n}),R=async()=>{w.value=!0;try{const e=await G("/dashboard/stats");if(e&&e.success&&e.data){const n=e.data;E.value=n.stats||{},m.value=n.charts||{},D.value=n.my_actions||[],C.value=n.my_equipment||[],$.value=n.recent_documents||[],M.value=n.upcoming_sessions||[],A.value=n.expiring_certifications||[],j.value=n.expiring_documents||[],B.value=n.upcoming_maintenance||[],q.value=n.deadlines||{actions:[],equipment:[]}}else e&&e.stats&&(E.value=e.stats||{},m.value=e.charts||{},D.value=e.my_actions||[],C.value=e.my_equipment||[],$.value=e.recent_documents||[],M.value=e.upcoming_sessions||[],A.value=e.expiring_certifications||[],j.value=e.expiring_documents||[],B.value=e.upcoming_maintenance||[],q.value=e.deadlines||{actions:[],equipment:[]})}catch(e){console.error("Failed to load dashboard data",e)}finally{w.value=!1}},g=e=>e?z(new Date(e),"dd MMM yyyy",{locale:N}):"-",I=e=>({low:"Basse",medium:"Moyenne",high:"Haute",critical:"Critique"})[e]||e,J=e=>({low:"success",medium:"info",high:"warning",critical:"danger"})[e]||"info";return ee(()=>{R()}),(e,n)=>{const l=te("font-awesome-icon");return i(),a("div",se,[o("div",oe,[o("div",null,[o("h2",null,"Bonjour, "+r(S.value?.first_name||"Utilisateur"),1),o("p",ne,r(U.value),1)]),o("div",ie,[o("div",ae,[c(_(V),{size:"small",onClick:n[0]||(n[0]=t=>e.$router.push("/actions/create"))},{default:d(()=>[c(l,{icon:"plus"}),n[2]||(n[2]=k(" Nouvelle Action ",-1))]),_:1})])])]),w.value?(i(),a("div",le,[c(l,{icon:"spinner",spin:"",size:"3x",class:"text-primary"})])):(i(),a("div",re,[(i(!0),a(f,null,h(L.value,(t,s)=>(i(),a("div",{key:s,class:"col-span-12 md:col-span-6 lg:col-span-3"},[c(Y,{title:t.title,value:t.value,icon:t.icon,color:t.color,loading:w.value},null,8,["title","value","icon","color","loading"])]))),128)),o("div",ce,[c(_(x),null,{title:d(()=>[o("div",ue,[n[3]||(n[3]=o("span",null,"Mes Actions Prioritaires",-1)),c(_(V),{label:"Voir tout",link:"",size:"small",onClick:n[1]||(n[1]=t=>e.$router.push("/actions"))})])]),content:d(()=>[D.value.length===0?(i(),a("div",de,[c(l,{icon:"check-circle",size:"2x",class:"mb-2 text-green-500"}),n[4]||(n[4]=o("p",null,"Aucune action prioritaire en attente !",-1))])):(i(),a("div",pe,[(i(!0),a(f,null,h(D.value,t=>(i(),a("div",{key:t.id,class:"flex items-center justify-between p-3 border-b border-surface-border last:border-0 hover:bg-surface-50 cursor-pointer transition-colors rounded",onClick:s=>e.$router.push(`/actions/${t.id}`)},[o("div",_e,[o("div",me,[o("span",fe,r(t.title),1),o("span",he," Échéance : "+r(g(t.due_date)),1)])]),c(_(W),{value:I(t.priority),severity:J(t.priority)},null,8,["value","severity"])],8,ve))),128))]))]),_:1}),c(_(x),null,{title:d(()=>[...n[5]||(n[5]=[k("Mon Équipement",-1)])]),content:d(()=>[C.value.length===0?(i(),a("div",ye," Aucun équipement assigné. ")):(i(),a("div",ge,[(i(!0),a(f,null,h(C.value,t=>(i(),a("div",{key:t.id,class:"flex items-center gap-3 p-2 border rounded hover:bg-surface-50 cursor-pointer",onClick:s=>e.$router.push(`/equipment/${t.id}`)},[o("div",be,[c(l,{icon:"tools"})]),o("div",ke,[o("div",we,r(t.name),1),o("div",De,r(t.internal_ref),1)])],8,xe))),128))]))]),_:1})]),o("div",Ce,[m.value&&m.value.actions_by_status?(i(),P(_(x),{key:0},{title:d(()=>[...n[6]||(n[6]=[k("Répartition des Actions",-1)])]),content:d(()=>[o("div",$e,[T.value?(i(),P(_(X),{key:0,type:"doughnut",data:T.value,options:O,class:"h-full"},null,8,["data"])):y("",!0)])]),_:1})):y("",!0),c(_(x),null,{title:d(()=>[...n[7]||(n[7]=[k("Derniers Documents",-1)])]),content:d(()=>[o("div",qe,[(i(!0),a(f,null,h($.value,t=>(i(),a("div",{key:t.id,class:"flex gap-2 items-start"},[c(l,{icon:["fas","file"],class:"mt-1 text-primary"}),o("div",null,[o("div",{class:"text-sm font-medium hover:text-primary cursor-pointer transition-colors",onClick:s=>e.$router.push(`/documents/${t.id}`)},r(t.title),9,Ee),o("div",Me,r(g(t.published_date)),1)])]))),128)),$.value.length===0?(i(),a("div",Ae," Aucun document récent. ")):y("",!0)])]),_:1})]),o("div",je,[c(_(x),null,{title:d(()=>[o("div",Be,[c(l,{icon:"calendar-check"}),n[8]||(n[8]=k(" Agenda des Échéances ",-1))])]),content:d(()=>[p.value.overdue.length===0&&p.value.today.length===0&&p.value.upcoming.length===0?(i(),a("div",Fe," Aucune échéance à venir. ")):(i(),a("div",Se,[p.value.overdue.length>0?(i(),a("div",Te,[n[9]||(n[9]=o("div",{class:"text-xs font-bold text-red-500 uppercase mb-2 tracking-wider"}," En Retard / Urgent ",-1)),o("div",Ve,[(i(!0),a(f,null,h(p.value.overdue,(t,s)=>(i(),a("div",{key:"overdue-"+s,class:"flex items-center justify-between p-2 rounded bg-red-50 border border-red-100 hover:bg-red-100 cursor-pointer transition-colors",onClick:v=>t.link?e.$router.push(t.link):null},[o("div",Ne,[o("span",{class:F(t.color)},[c(l,{icon:t.icon},null,8,["icon"])],2),o("div",Pe,[o("span",Ge,r(t.title),1),o("span",He,r(t.label)+" - "+r(g(t.date)),1)])])],8,ze))),128))])])):y("",!0),p.value.today.length>0?(i(),a("div",Ue,[n[10]||(n[10]=o("div",{class:"text-xs font-bold text-orange-500 uppercase mb-2 tracking-wider"}," Cette Semaine ",-1)),o("div",Le,[(i(!0),a(f,null,h(p.value.today,(t,s)=>(i(),a("div",{key:"today-"+s,class:"flex items-center justify-between p-2 rounded bg-orange-50 border border-orange-100 hover:bg-orange-100 cursor-pointer transition-colors",onClick:v=>t.link?e.$router.push(t.link):null},[o("div",Re,[o("span",{class:F(t.color)},[c(l,{icon:t.icon},null,8,["icon"])],2),o("div",Ie,[o("span",Je,r(t.title),1),o("span",Ke,r(t.label)+" - "+r(g(t.date)),1)])])],8,Oe))),128))])])):y("",!0),p.value.upcoming.length>0?(i(),a("div",Qe,[n[11]||(n[11]=o("div",{class:"text-xs font-bold text-blue-500 uppercase mb-2 tracking-wider"}," À Venir ",-1)),o("div",We,[(i(!0),a(f,null,h(p.value.upcoming,(t,s)=>(i(),a("div",{key:"upcoming-"+s,class:"flex items-center justify-between p-2 rounded hover:bg-surface-50 border border-surface-border cursor-pointer transition-colors",onClick:v=>t.link?e.$router.push(t.link):null},[o("div",Ye,[o("span",{class:F(t.color)},[c(l,{icon:t.icon},null,8,["icon"])],2),o("div",Ze,[o("span",et,r(t.title),1),o("span",tt,r(t.label)+" - "+r(g(t.date)),1)])])],8,Xe))),128))])])):y("",!0)]))]),_:1})])]))])}}});export{dt as default};
