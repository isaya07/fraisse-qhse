import{s as N}from"./index-DK5WICtn.js";import{d as R,i as w,m as j,w as m,a as e,v as S,b as o,x as P,r as F,t as b,u as i,p as O,o as c,f as Q,g as H,h,q as J,j as K,c as y,s as T,F as W,I as X,y as Y}from"./index-d7axL_xv.js";import{s as Z,u as ee}from"./index-BjfdDptO.js";import{u as te}from"./actionTypes-DJoqH7I9.js";import{s as se}from"./index-Dw7kVe-F.js";import{s as oe}from"./index-DZQqA5uS.js";import{s as ae,a as ne}from"./index-D_33rlMc.js";import{s as z}from"./index-C4Jjik4c.js";import{s as le}from"./index-C45h_JBJ.js";import"./index-xoP2DrFw.js";import"./index-DbX5rEQv.js";const ie={class:"flex-1 flex flex-col gap-4"},ce={class:"flex items-center justify-between"},re={class:"flex items-center gap-2 text-sm text-color-secondary"},ue={class:"text-xl font-medium"},de={class:"flex items-center gap-2"},me={class:"font-bold text-color text-lg leading-snug"},pe={class:"mt-auto"},fe={class:"flex justify-between text-xs text-color-secondary mb-1"},ve={class:"font-medium"},ge={class:"w-full bg-surface-100 dark:bg-surface-800 rounded-full h-4"},xe={class:"flex items-center justify-between pt-4 border-t border-surface-border mt-2"},ye={class:"flex items-center gap-2"},be={class:"flex flex-col"},he={class:"text-sm font-medium text-color truncate max-w-[120px]"},we={class:"flex flex-col items-end"},_e=R({__name:"ActionCard",props:{action:{type:Object,required:!0}},emits:["view","edit","delete"],setup(s){const r=s,p=t=>({open:"Ouvert",in_progress:"En cours",completed:"Terminé",cancelled:"Annulé"})[t]||t,_=t=>({open:"info",in_progress:"warn",completed:"success",cancelled:"secondary"})[t]||"info",k=t=>({low:"bg-green-500",medium:"bg-yellow-500",high:"bg-orange-500",critical:"bg-red-600"})[t]||"bg-gray-300",$=t=>t>=100?"bg-green-500":t>60?"bg-blue-500":t>30?"bg-yellow-500":"bg-gray-400",f=t=>{if(!t)return"-";const a=new Date(t);return new Intl.DateTimeFormat("fr-FR",{day:"numeric",month:"short",year:"numeric"}).format(a)},v=w(()=>!r.action.due_date||["completed","cancelled"].includes(r.action.status)?!1:new Date(r.action.due_date)<new Date),g=t=>`${t.first_name.charAt(0)}${t.last_name.charAt(0)}`.toUpperCase();return(t,a)=>{const x=F("font-awesome-icon"),A=N;return c(),j(A,{class:"hover:shadow-md transition-all duration-200 cursor-pointer h-full flex flex-col relative overflow-hidden group",onClick:a[0]||(a[0]=V=>t.$emit("view",s.action.id))},{content:m(()=>[e("div",ie,[e("div",ce,[e("div",re,[o(x,{icon:["fas",s.action.action_type?.icon||"tasks"],style:P({color:s.action.action_type?.color}),size:"xl"},null,8,["icon","style"]),e("span",ue,b(s.action.action_type?.name),1)]),e("div",de,[o(i(se),{value:p(s.action.status),severity:_(s.action.status),class:"text-xs px-2 py-0.5"},null,8,["value","severity"])])]),e("h3",me,b(s.action.title),1),e("div",pe,[e("div",fe,[a[1]||(a[1]=e("span",null,"Progression",-1)),e("span",ve,b(s.action.progress)+"%",1)]),e("div",ge,[e("div",{class:S(["h-4 rounded-full transition-all duration-300",$(s.action.progress)]),style:P({width:`${s.action.progress}%`})},null,6)])]),e("div",xe,[e("div",ye,[s.action.assignee?(c(),j(i(Z),{key:0,label:g(s.action.assignee),shape:"circle",size:"small",class:"w-8 h-8 text-xs bg-surface-200 dark:bg-surface-700 text-color-secondary"},null,8,["label"])):O("",!0),e("div",be,[a[2]||(a[2]=e("span",{class:"text-xs text-color-secondary"},"Responsable",-1)),e("span",he,b(s.action.assignee?`${s.action.assignee.first_name} ${s.action.assignee.last_name}`:"Non assigné"),1)])]),e("div",we,[a[3]||(a[3]=e("span",{class:"text-xs text-color-secondary"},"Échéance",-1)),e("div",{class:S(["flex items-center gap-1.5 text-sm font-medium",v.value?"text-red-500":"text-color"])},[o(x,{icon:"calendar",class:"text-xs"}),e("span",null,b(f(s.action.due_date)),1)],2)])])])]),default:m(()=>[e("div",{class:S(`absolute left-0 top-0 bottom-0 w-1.5 ${k(s.action.priority)}`)},null,2)]),_:1})}}}),$e={class:"p-4"},Ce={class:"flex flex-col md:flex-row md:items-center md:justify-between mb-6 gap-4"},ke={class:"flex gap-2"},Ae={class:"flex flex-wrap gap-4"},Ve={class:"flex-1 min-w-[200px]"},Se={key:0,class:"flex justify-center py-12"},Te={key:1,class:"text-center py-12 bg-surface-50 dark:bg-surface-800 rounded-lg border-2 border-dashed border-surface-border"},je={key:2,class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"},De={key:3,class:"mt-6"},qe=R({__name:"ActionIndex",setup(s){const r=Y(),p=ee(),_=te(),k=Q(),$=H(),f=h(""),v=h(null),g=h(null),t=h(9),a=h(0),x=w(()=>p.actions),A=w(()=>p.loading),V=w(()=>p.pagination.total),B=w(()=>(_.types||[]).map(l=>({label:l.name,value:l.id}))),E=[{label:"Ouvert",value:"open"},{label:"En cours",value:"in_progress"},{label:"Terminé",value:"completed"},{label:"Annulé",value:"cancelled"}],C=async()=>{const l={search:f.value,action_type_id:v.value,status:g.value};await p.fetchActions(a.value+1,t.value,l)},I=l=>{a.value=l.page,C()},D=()=>{r.push("/actions/create")},L=()=>{r.push("/actions/config")},U=l=>{r.push(`/actions/${l}`)},q=l=>{r.push(`/actions/${l}/edit`)},G=l=>{const n=x.value.find(u=>u.id===l);n&&k.require({message:`Voulez-vous vraiment supprimer l'action "${n.title}" ?`,header:"Confirmation de suppression",icon:"pi pi-exclamation-triangle",rejectLabel:"Annuler",acceptLabel:"Supprimer",rejectClass:"p-button-secondary p-button-outlined",acceptClass:"p-button-danger",accept:async()=>{try{await p.deleteAction(n.id),$.add({severity:"success",summary:"Succès",detail:"Action supprimée",life:3e3}),C()}catch{$.add({severity:"error",summary:"Erreur",detail:"Impossible de supprimer l'action",life:3e3})}}})};return J([f,v,g],()=>{a.value=0,C()}),K(()=>{_.fetchTypes(),C()}),(l,n)=>{const u=F("font-awesome-icon"),M=N;return c(),y("div",$e,[e("div",Ce,[n[3]||(n[3]=e("h2",null,"Tableau de bord Actions",-1)),e("div",ke,[o(i(T),{label:"Gérer les actions",onClick:L,severity:"secondary",outlined:""},{icon:m(()=>[o(u,{icon:"cog",class:"mr-2"})]),_:1}),o(i(T),{label:"Nouvelle action",onClick:D,severity:"primary"},{icon:m(()=>[o(u,{icon:"plus",class:"mr-2"})]),_:1})])]),o(M,{class:"mb-6"},{content:m(()=>[e("div",Ae,[e("div",Ve,[o(i(ae),{iconPosition:"left"},{default:m(()=>[o(i(ne),null,{default:m(()=>[o(u,{icon:"magnifying-glass"})]),_:1}),o(i(oe),{modelValue:f.value,"onUpdate:modelValue":n[0]||(n[0]=d=>f.value=d),placeholder:"Rechercher...",class:"w-full"},null,8,["modelValue"])]),_:1})]),o(i(z),{modelValue:v.value,"onUpdate:modelValue":n[1]||(n[1]=d=>v.value=d),options:B.value,optionLabel:"label",optionValue:"value",placeholder:"Type",class:"w-full md:w-40",showClear:""},null,8,["modelValue","options"]),o(i(z),{modelValue:g.value,"onUpdate:modelValue":n[2]||(n[2]=d=>g.value=d),options:E,optionLabel:"label",optionValue:"value",placeholder:"Statut",class:"w-full md:w-40",showClear:""},null,8,["modelValue"])])]),_:1}),A.value?(c(),y("div",Se,[o(u,{icon:["fas","spinner"],spin:"",size:"2x",class:"text-color-secondary"})])):x.value.length===0?(c(),y("div",Te,[o(u,{icon:"tasks",class:"text-color-secondary text-5xl mb-4"}),n[4]||(n[4]=e("h3",{class:"text-lg font-medium text-color"},"Aucune action trouvée",-1)),n[5]||(n[5]=e("p",{class:"text-color-secondary mt-1"},"Commencez par créer une nouvelle action.",-1)),o(i(T),{label:"Nouvelle action",onClick:D,severity:"primary",class:"mt-4"},{icon:m(()=>[o(u,{icon:"plus",class:"mr-2"})]),_:1})])):(c(),y("div",je,[(c(!0),y(W,null,X(x.value,d=>(c(),j(_e,{key:d.id,action:d,onView:U,onEdit:q,onDelete:G},null,8,["action"]))),128))])),V.value>t.value?(c(),y("div",De,[o(i(le),{rows:t.value,totalRecords:V.value,first:a.value*t.value,onPage:I},null,8,["rows","totalRecords","first"])])):O("",!0)])}}});export{qe as default};
