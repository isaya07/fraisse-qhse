import{T as O}from"./index-CrhbiAe9.js";import{d as H,f as Q,g as G,h as C,i as j,j as J,c as q,F as ae,b as t,u as s,w as l,k as ne,a,r as W,t as $,l as D,m as x,n as B,s as y,p as X,o as m,_ as Y,q as re,v as ie,x as ce,e as de,y as ue}from"./index-d7axL_xv.js";import{u as me}from"./documents-4g-8ZjXh.js";import{u as Z,s as pe,a as ve}from"./index-D1KtGaLO.js";import{s as fe,a as S}from"./index-C0aPiIhq.js";import{s as ee}from"./index-DZQqA5uS.js";import{s as ye,a as _e}from"./index-D_33rlMc.js";import{s as K}from"./index-Dw7kVe-F.js";import{s as te}from"./index-DK5WICtn.js";import"./index-C4Jjik4c.js";import"./index-xoP2DrFw.js";import"./index-BDoF1CiN.js";import"./index-rhSU9nKe.js";import"./index-BixvgfbH.js";import"./index-C45h_JBJ.js";import"./index-DbX5rEQv.js";import"./index-Cx-_v3H7.js";const xe={class:"flex justify-between items-center px-4 py-2"},ge={class:"flex gap-1"},he={class:"overflow-y-auto h-[calc(100vh-16rem)]"},we={class:"flex items-center justify-between w-full group"},be={class:"flex items-center gap-2"},ke={class:"text-color"},Ce={class:"hidden group-hover:flex gap-1"},De={class:"field"},Se={class:"field mt-4"},$e=H({__name:"DocumentFolderSidebar",emits:["select","unselect"],setup(oe,{emit:F}){const v=F,g=Z(),P=Q(),_=G(),c=C(null),h=C(!1),u=C(null),i=C({name:"",parent_id:null}),T=j(()=>{const n=e=>({key:e.id.toString(),label:e.name,data:e,children:e.children&&e.children.length>0?e.children.map(n):void 0,leaf:!e.children||e.children.length===0});return g.folders.map(e=>n(e))}),L=j(()=>{const n=e=>{if(u.value&&e.id===u.value.id)return null;const f=e.children?e.children.map(n).filter(b=>b!==null):[];return{key:e.id.toString(),label:e.name,data:e.id,children:f,selectable:!0}};return g.folders.map(n).filter(e=>e!==null)}),R=n=>{v("select",n.data)},w=()=>{v("unselect")},I=()=>{c.value=null,v("unselect")},N=n=>{n?(u.value=n,i.value={name:n.name,parent_id:n.parent_id?{[n.parent_id.toString()]:!0}:null}):(u.value=null,i.value={name:"",parent_id:c.value&&Object.keys(c.value).length>0?{[Object.keys(c.value)[0]]:!0}:null}),h.value=!0},V=()=>{h.value=!1,u.value=null},U=async()=>{try{let n=null;if(i.value.parent_id){const e=Object.keys(i.value.parent_id);e.length>0&&(n=parseInt(e[0]))}u.value?(await g.updateFolder(u.value.id,{name:i.value.name,parent_id:n}),_.add({severity:"success",summary:"Succès",detail:"Dossier mis à jour",life:3e3})):(await g.createFolder({name:i.value.name,parent_id:n}),_.add({severity:"success",summary:"Succès",detail:"Dossier créé",life:3e3})),V()}catch(n){console.log(n),_.add({severity:"error",summary:"Erreur",detail:"Une erreur est survenue",life:3e3})}},E=n=>{P.require({message:`Voulez-vous vraiment supprimer le dossier "${n.name}" ?`,header:"Confirmation",icon:"exclamation-triangle",accept:async()=>{try{await g.deleteFolder(n.id),_.add({severity:"success",summary:"Succès",detail:"Dossier supprimé",life:3e3,icon:"check"}),c.value&&c.value[n.id.toString()]&&(c.value=null,v("unselect"))}catch(e){console.log(e),_.add({severity:"error",summary:"Erreur",detail:"Impossible de supprimer le dossier",life:3e3,icon:"times"})}}})};return J(()=>{g.fetchFolders()}),(n,e)=>{const f=W("font-awesome-icon"),b=O;return m(),q(ae,null,[t(s(te),{class:"h-full"},{title:l(()=>[a("div",xe,[e[6]||(e[6]=a("h4",{class:"text-color m-0"},"Dossiers",-1)),a("div",ge,[c.value?D((m(),x(s(y),{key:0,text:"",rounded:"",size:"small",onClick:e[0]||(e[0]=d=>I())},{icon:l(()=>[t(f,{icon:"rotate-left"})]),_:1})),[[b,"Tout afficher"]]):X("",!0),D((m(),x(s(y),{text:"",rounded:"",size:"small",onClick:e[1]||(e[1]=d=>N())},{icon:l(()=>[t(f,{icon:"plus"})]),_:1})),[[b,"Nouveau dossier"]])])])]),content:l(()=>[a("div",he,[t(s(pe),{value:T.value,selectionMode:"single",selectionKeys:c.value,"onUpdate:selectionKeys":e[2]||(e[2]=d=>c.value=d),onNodeSelect:R,onNodeUnselect:w,class:"w-full border-none p-0"},{default:l(d=>[a("div",we,[a("span",be,[t(f,{icon:"folder",class:"text-primary-500 dark:text-primary-400"}),a("span",ke,$(d.node.label),1)]),a("div",Ce,[D((m(),x(s(y),{text:"",rounded:"",severity:"secondary",size:"small",class:"w-6 h-6",onClick:B(M=>N(d.node.data),["stop"])},{icon:l(()=>[t(f,{icon:"pen",class:"text-xs"})]),_:1},8,["onClick"])),[[b,"Modifier le dossier",void 0,{top:!0}]]),D((m(),x(s(y),{text:"",rounded:"",severity:"danger",size:"small",class:"w-6 h-6",onClick:B(M=>E(d.node.data),["stop"])},{icon:l(()=>[t(f,{icon:"trash",class:"text-xs"})]),_:1},8,["onClick"])),[[b,"Supprimer le dossier",void 0,{top:!0}]])])])]),_:1},8,["value","selectionKeys"])])]),_:1}),t(s(ne),{visible:h.value,"onUpdate:visible":e[5]||(e[5]=d=>h.value=d),header:u.value?"Modifier le dossier":"Nouveau dossier",modal:!0,class:"p-fluid"},{footer:l(()=>[t(s(y),{label:"Annuler",text:"",severity:"secondary",onClick:V},{icon:l(()=>[t(f,{icon:"times",class:"mr-2"})]),_:1}),t(s(y),{label:"Enregistrer",onClick:U},{icon:l(()=>[t(f,{icon:"check",class:"mr-2"})]),_:1})]),default:l(()=>[a("div",De,[e[7]||(e[7]=a("label",{for:"folderName"},"Nom",-1)),t(s(ee),{id:"folderName",modelValue:i.value.name,"onUpdate:modelValue":e[3]||(e[3]=d=>i.value.name=d),required:"",autofocus:""},null,8,["modelValue"])]),a("div",Se,[e[8]||(e[8]=a("label",{for:"parentFolder"},"Dossier parent",-1)),t(s(ve),{modelValue:i.value.parent_id,"onUpdate:modelValue":e[4]||(e[4]=d=>i.value.parent_id=d),options:L.value,showClear:"",placeholder:"Sélectionnez un parent (ou laisser vide pour la racine)"},null,8,["modelValue","options"])])]),_:1},8,["visible","header"])],64)}}}),Fe=Y($e,[["__scopeId","data-v-65881118"]]),je={class:"p-4 h-[calc(100vh-6rem)] flex flex-col"},Ne={class:"flex justify-between items-center mb-2"},Ve={class:"flex gap-2"},ze={class:"flex flex-1 gap-4 overflow-hidden"},Pe={class:"w-1/4 flex flex-col"},Te={class:"flex-1 flex flex-col overflow-hidden"},Le={class:"flex flex-wrap gap-2 items-center justify-between px-4 py-2"},Re={class:"flex items-center gap-2"},Ie={class:"flex flex-col"},Ue={class:"font-medium text-color"},Ee={class:"text-xs text-color-secondary"},Me={key:1,class:"text-color-secondary"},Ae={class:"bg-surface-100 dark:bg-surface-700 text-color-secondary px-2 py-1 rounded text-xs"},qe={class:"text-color-secondary"},Be={class:"flex gap-1"},Ke=H({__name:"DocumentIndex",setup(oe){const F=ue(),v=me(),g=Z(),P=Q(),_=G(),c=C(""),h=C(10),u=C(0),i=C(null),T=j(()=>v.documents),L=j(()=>v.loading||g.loading),R=j(()=>v.pagination.total),w=async()=>{const o={search:c.value};i.value&&(o.document_folder_id=i.value.id),await v.fetchDocuments(u.value+1,h.value,o)},I=o=>{u.value=o.page,h.value=o.rows,w()},N=o=>{i.value=o,u.value=0,w()},V=()=>{i.value=null,u.value=0,w()},U=()=>{F.push({path:"/documents/create",query:i.value?{document_folder_id:i.value.id}:{}})},E=o=>{F.push(`/documents/${o}`)},n=o=>{F.push(`/documents/${o}/edit`)},e=o=>{P.require({message:`Voulez-vous vraiment supprimer le document "${o.title}" ?`,header:"Confirmation de suppression",icon:"exclamation-triangle",rejectLabel:"Annuler",acceptLabel:"Supprimer",acceptClass:"p-button-danger",rejectClass:"p-button-secondary",accept:async()=>{try{await v.deleteDocument(o.id),_.add({severity:"success",summary:"Succès",detail:"Document supprimé",life:3e3,icon:"check"}),w()}catch{_.add({severity:"error",summary:"Erreur",detail:"Impossible de supprimer le document",life:3e3,icon:"times"})}}})},f=async o=>{try{_.add({severity:"info",summary:"Téléchargement",detail:"Le téléchargement a commencé...",life:3e3}),await v.downloadDocument(o.id,o.filename)}catch{_.add({severity:"error",summary:"Erreur",detail:"Erreur lors du téléchargement",life:3e3})}},b=o=>{if(!o)return"file";switch((o||"").split(".").pop()?.toLowerCase()){case"pdf":return"file-pdf";case"doc":case"docx":return"file-word";case"xls":case"xlsx":return"file-excel";case"jpg":case"png":case"jpeg":return"image";default:return"file"}},d=o=>{if(!o)return"text-color-secondary";switch((o||"").split(".").pop()?.toLowerCase()){case"pdf":return"text-red-500";case"doc":case"docx":return"text-blue-500";case"xls":case"xlsx":return"text-green-500";case"jpg":case"png":case"jpeg":return"text-primary";default:return"text-color-secondary"}},M=o=>({draft:"Brouillon",pending_approval:"En attente",approved:"Approuvé",rejected:"Rejeté",archived:"Archivé"})[o]||o,se=o=>({draft:"secondary",pending_approval:"warn",approved:"success",rejected:"danger",archived:"contrast"})[o]||"secondary",le=o=>o?new Date(o).toLocaleDateString("fr-FR",{day:"2-digit",month:"2-digit",year:"numeric"}):"-";return re(c,()=>{u.value=0,w()}),J(async()=>{await w()}),(o,p)=>{const k=W("font-awesome-icon"),z=O;return m(),q("div",je,[a("div",Ne,[p[1]||(p[1]=a("h2",null,"Documents QHSE",-1)),a("div",Ve,[t(s(y),{label:"Nouveau document",onClick:U,severity:"primary"},{icon:l(()=>[t(k,{icon:"plus",class:"mr-2"})]),_:1})])]),a("div",ze,[a("div",Pe,[t(Fe,{onSelect:N,onUnselect:V})]),a("div",Te,[t(s(te),{class:"h-full flex flex-col"},{title:l(()=>[a("div",Le,[a("h4",null,$(i.value?i.value.name:"Tous les documents"),1),t(s(ye),{iconPosition:"left"},{default:l(()=>[t(s(_e),null,{default:l(()=>[t(k,{icon:"magnifying-glass"})]),_:1}),t(s(ee),{modelValue:c.value,"onUpdate:modelValue":p[0]||(p[0]=r=>c.value=r),placeholder:"Rechercher...",size:"small"},null,8,["modelValue"])]),_:1})])]),content:l(()=>[t(s(fe),{ref:"dt",value:T.value,lazy:"",paginator:!0,rows:h.value,totalRecords:R.value,loading:L.value,onPage:I,paginatorTemplate:"FirstPageLink PrevPageLink PageLinks NextPageLink LastPageLink CurrentPageReport RowsPerPageDropdown",rowsPerPageOptions:[10,25,50],currentPageReportTemplate:"{first} - {last} / {totalRecords}",class:"p-datatable-sm",scrollable:"",scrollHeight:"flex"},{empty:l(()=>[...p[2]||(p[2]=[de(" Aucun document trouvé. ",-1)])]),default:l(()=>[t(s(S),{field:"title",header:"Nom",sortable:"",style:{"min-width":"200px"}},{body:l(({data:r})=>[a("div",Re,[t(k,{icon:b(r.filename),class:ie(["text-xl",d(r.filename)])},null,8,["icon","class"]),a("div",Ie,[a("span",Ue,$(r.title),1),a("span",Ee,$(r.filename),1)])])]),_:1}),t(s(S),{field:"category",header:"Type",sortable:"",style:{width:"120px"}},{body:l(({data:r})=>[r.category?(m(),x(s(K),{key:0,value:r.category.name,style:ce({backgroundColor:r.category.color||"var(--surface-500)",color:"#fff"})},{icon:l(()=>[r.category.icon?(m(),x(k,{key:0,icon:["fas",r.category.icon],class:"mr-1"},null,8,["icon"])):X("",!0)]),_:2},1032,["value","style"])):(m(),q("span",Me,"Non défini"))]),_:1}),t(s(S),{field:"version",header:"Ver.",style:{width:"80px"}},{body:l(({data:r})=>[a("span",Ae,$(r.version),1)]),_:1}),t(s(S),{field:"status",header:"Statut",style:{width:"100px"}},{body:l(({data:r})=>[t(s(K),{value:M(r.status),severity:se(r.status)},null,8,["value","severity"])]),_:1}),t(s(S),{field:"updated_at",header:"Modifié le",style:{width:"120px"}},{body:l(({data:r})=>[a("span",qe,$(le(r.updated_at)),1)]),_:1}),t(s(S),{header:"Actions",exportable:!1,style:{width:"100px"}},{body:l(({data:r})=>[a("div",Be,[D((m(),x(s(y),{text:"",rounded:"",severity:"secondary",size:"small",onClick:A=>f(r)},{icon:l(()=>[t(k,{icon:"download"})]),_:1},8,["onClick"])),[[z,"Télécharger",void 0,{top:!0}]]),D((m(),x(s(y),{text:"",rounded:"",severity:"info",size:"small",onClick:A=>E(r.id)},{icon:l(()=>[t(k,{icon:"eye"})]),_:1},8,["onClick"])),[[z,"Voir",void 0,{top:!0}]]),D((m(),x(s(y),{text:"",rounded:"",severity:"success",size:"small",onClick:A=>n(r.id)},{icon:l(()=>[t(k,{icon:"pen"})]),_:1},8,["onClick"])),[[z,"Modifier",void 0,{top:!0}]]),D((m(),x(s(y),{text:"",rounded:"",severity:"danger",size:"small",onClick:A=>e(r)},{icon:l(()=>[t(k,{icon:"trash"})]),_:1},8,["onClick"])),[[z,"Supprimer",void 0,{top:!0}]])])]),_:1})]),_:1},8,["value","rows","totalRecords","loading"])]),_:1})])])])}}}),it=Y(Ke,[["__scopeId","data-v-58bbdf5e"]]);export{it as default};
