import{d as S,g as b,h as i,j,i as B,c,a as s,m as E,b as a,w as v,u as y,s as C,r as I,t as T,H as M,y as F,o as n}from"./index-d7axL_xv.js";import{u as N}from"./documents-4g-8ZjXh.js";import{_ as R}from"./DocumentForm.vue_vue_type_script_setup_true_lang-DUMFUDnN.js";import{s as V}from"./index-DK5WICtn.js";import"./index-DZQqA5uS.js";import"./index-C4Jjik4c.js";import"./index-xoP2DrFw.js";import"./index-D_33rlMc.js";import"./index-BrM16FOF.js";import"./index-tDP5wU1d.js";import"./index-Cx-_v3H7.js";import"./index-B5RzIAVk.js";import"./index-4XjGuRCe.js";import"./index-D1KtGaLO.js";import"./index-BDoF1CiN.js";import"./index-rhSU9nKe.js";import"./index-BixvgfbH.js";import"./index-BJVb_8vX.js";import"./category-C-6GQ9A7.js";import"./schemas-C8kxHR-7.js";const $={class:"p-4"},z={class:"flex flex-col md:flex-row md:items-center md:justify-between mb-2 gap-4"},H={class:"flex items-center gap-4"},L={key:0,class:"flex justify-center items-center py-12"},O={key:1,class:"flex justify-center items-center py-12"},P={key:2,class:"flex justify-center items-center py-12"},U={class:"text-lg text-red-600"},de=S({__name:"DocumentEdit",setup(q){const l=F(),p=M(),r=N(),f=b(),_=i({title:"",description:"",document_folder_id:null,category_id:null,version:"",status:"draft"}),u=i(!1),d=i(!1),o=i(""),g=async()=>{u.value=!0,o.value="";try{if(await r.fetchDocumentById(parseInt(p.params.id)),r.currentDocument){const e=r.currentDocument;_.value={title:e.title,description:e.description||"",document_folder_id:e.document_folder_id||null,category_id:e.category?.id||null,version:e.version,status:e.status}}else o.value="Document non trouvé"}catch(e){o.value="Erreur lors du chargement du document",console.error(e)}finally{u.value=!1}},x=async e=>{d.value=!0,o.value="";try{const t=new FormData;if(t.append("_method","PUT"),t.append("title",e.title),t.append("description",e.description??""),e.document_folder_id&&t.append("document_folder_id",e.document_folder_id.toString()),e.category_id&&t.append("category_id",e.category_id.toString()),t.append("version",e.version),t.append("status",e.status),e.expires_date){const w=new Date(e.expires_date).toISOString().split("T")[0];t.append("expires_date",w??"")}e.file&&t.append("file",e.file),await r.updateDocument(parseInt(p.params.id),t),f.add({severity:"success",summary:"Succès",detail:"Document mis à jour avec succès",life:3e3,icon:"check"}),l.push("/documents")}catch(t){f.add({severity:"error",summary:"Erreur",detail:"Impossible de mettre à jour le document",life:3e3}),console.error(t)}finally{d.value=!1}},D=()=>{l.push("/documents")};j(()=>{g()});const h=()=>{l.back()},k=B(()=>r.currentDocument);return(e,t)=>{const m=I("font-awesome-icon");return n(),c("div",$,[s("div",z,[s("div",H,[a(y(C),{text:"",rounded:"",severity:"secondary",onClick:h},{icon:v(()=>[a(m,{icon:"arrow-left"})]),_:1}),t[0]||(t[0]=s("div",null,[s("div",{class:"flex items-center gap-3"},[s("h2",{class:"text-color"},"Modifier le document")])],-1))])]),u.value?(n(),c("div",L,[a(m,{icon:["fas","spinner"],spin:"",size:"2x",class:"text-color-secondary"})])):!k.value&&!o.value?(n(),c("div",O,[...t[1]||(t[1]=[s("p",{class:"text-lg text-color-secondary"},"Document non trouvé",-1)])])):o.value?(n(),c("div",P,[s("p",U,T(o.value),1)])):(n(),E(y(V),{key:3},{content:v(()=>[a(R,{initialData:_.value,submitButtonText:"Enregistrer",loading:d.value,isEditMode:!0,onSubmit:x,onCancel:D},null,8,["initialData","loading"])]),_:1}))])}}});export{de as default};
