import{d as D,g as E,h as V,i as N,j as q,c as u,a as o,b as l,p as m,v,t as p,s as A,w as x,r as M,o as r}from"./index-d7axL_xv.js";import{s as P}from"./index-DbX5rEQv.js";import{s as F}from"./index-C4Jjik4c.js";import{s as I}from"./index-DZQqA5uS.js";import{s as O}from"./index-BJVb_8vX.js";import{u as T}from"./planning-DnUkG1g2.js";import{u as z}from"./users-CbvhcKd8.js";import{f as R}from"./format-hKf1W1ky.js";const G={class:"grid grid-cols-1 gap-4"},H={class:"field"},J={key:0,class:"text-red-500"},K={class:"field"},Q={key:0,class:"text-red-500"},W={class:"field"},X={key:0,class:"text-red-500"},Y={class:"field"},Z={class:"field"},h={class:"flex justify-end gap-2 mt-4"},ue=D({__name:"VisitForm",props:{visit:{}},emits:["save","cancel"],setup(k,{emit:w}){const i=k,g=w,f=T(),d=z(),c=E(),t=V({date:null,location:"",auditor_id:null,status:"planned",score:null}),s=V({}),S=[{label:"Planifiée",value:"planned"},{label:"Réalisée",value:"completed"},{label:"Annulée",value:"cancelled"}],$=N(()=>d.users.map(n=>({...n,fullname:`${n.first_name} ${n.last_name}`})));q(async()=>{d.users.length===0&&await d.fetchUsers(),i.visit&&(t.value={date:new Date(i.visit.date),location:i.visit.location,auditor_id:i.visit.auditor_id,status:i.visit.status,score:i.visit.score})});const C=()=>(s.value={},t.value.date||(s.value.date="La date est requise"),t.value.location||(s.value.location="Le lieu est requis"),t.value.auditor_id||(s.value.auditor_id="L'auditeur est requis"),Object.keys(s.value).length===0),U=async()=>{if(!C())return;const n={...t.value,date:R(t.value.date,"yyyy-MM-dd"),auditor_id:t.value.auditor_id||void 0,score:t.value.score||void 0,status:t.value.status};try{i.visit?(await f.updateVisit(i.visit.id,n),c.add({severity:"success",summary:"Succès",detail:"Visite mise à jour",life:3e3})):(await f.createVisit(n),c.add({severity:"success",summary:"Succès",detail:"Visite créée",life:3e3})),g("save")}catch(e){console.error(e),c.add({severity:"error",summary:"Erreur",detail:"Erreur lors de l'enregistrement",life:3e3})}};return(n,e)=>{const L=O,j=I,_=F,B=P,b=M("font-awesome-icon"),y=A;return r(),u("div",G,[o("div",H,[e[6]||(e[6]=o("label",{for:"date",class:"block text-sm font-medium text-color-secondary mb-1"},"Date *",-1)),l(L,{id:"date",modelValue:t.value.date,"onUpdate:modelValue":e[0]||(e[0]=a=>t.value.date=a),dateFormat:"dd/mm/yy",class:v(["w-full",{"p-invalid":s.value.date}])},null,8,["modelValue","class"]),s.value.date?(r(),u("small",J,p(s.value.date),1)):m("",!0)]),o("div",K,[e[7]||(e[7]=o("label",{for:"location",class:"block text-sm font-medium text-color-secondary mb-1"},"Lieu *",-1)),l(j,{id:"location",modelValue:t.value.location,"onUpdate:modelValue":e[1]||(e[1]=a=>t.value.location=a),class:v(["w-full",{"p-invalid":s.value.location}])},null,8,["modelValue","class"]),s.value.location?(r(),u("small",Q,p(s.value.location),1)):m("",!0)]),o("div",W,[e[8]||(e[8]=o("label",{for:"auditor",class:"block text-sm font-medium text-color-secondary mb-1"},"Auditeur *",-1)),l(_,{id:"auditor",modelValue:t.value.auditor_id,"onUpdate:modelValue":e[2]||(e[2]=a=>t.value.auditor_id=a),options:$.value,optionLabel:"fullname",optionValue:"id",placeholder:"Sélectionner un auditeur",class:v(["w-full",{"p-invalid":s.value.auditor_id}]),filter:""},null,8,["modelValue","options","class"]),s.value.auditor_id?(r(),u("small",X,p(s.value.auditor_id),1)):m("",!0)]),o("div",Y,[e[9]||(e[9]=o("label",{for:"status",class:"block text-sm font-medium text-color-secondary mb-1"},"Statut *",-1)),l(_,{id:"status",modelValue:t.value.status,"onUpdate:modelValue":e[3]||(e[3]=a=>t.value.status=a),options:S,optionLabel:"label",optionValue:"value",class:"w-full"},null,8,["modelValue"])]),o("div",Z,[e[10]||(e[10]=o("label",{for:"score",class:"block text-sm font-medium text-color-secondary mb-1"},"Score (/100)",-1)),l(B,{id:"score",modelValue:t.value.score,"onUpdate:modelValue":e[4]||(e[4]=a=>t.value.score=a),min:0,max:100,class:"w-full"},null,8,["modelValue"])]),o("div",h,[l(y,{label:"Annuler",text:"",onClick:e[5]||(e[5]=a=>n.$emit("cancel"))},{icon:x(()=>[l(b,{icon:"times"})]),_:1}),l(y,{label:"Enregistrer",onClick:U},{icon:x(()=>[l(b,{icon:"check"})]),_:1})])])}}});export{ue as _};
