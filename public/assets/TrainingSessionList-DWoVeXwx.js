import{d as $,g as F,i as E,h as p,q as L,j as O,c as v,a as i,b as l,w as c,u as s,s as f,r as j,k as M,y as N,o as g}from"./index-d7axL_xv.js";import{u as P}from"./training-as_QKjE7.js";import{_ as R}from"./SessionList.vue_vue_type_script_setup_true_lang-BA5RpajE.js";import{s as _}from"./index-C_qVgU7t.js";import{s as b}from"./index-DZQqA5uS.js";import{s as y}from"./index-DbX5rEQv.js";import{s as w}from"./index-BJVb_8vX.js";import"./index-CrhbiAe9.js";import"./index-DK5WICtn.js";import"./index-C0aPiIhq.js";import"./index-C45h_JBJ.js";import"./index-C4Jjik4c.js";import"./index-xoP2DrFw.js";import"./index-D_33rlMc.js";import"./index-rhSU9nKe.js";import"./index-BixvgfbH.js";import"./index-Cx-_v3H7.js";import"./index-Dw7kVe-F.js";const A={class:"p-4"},B={class:"flex flex-col md:flex-row md:items-center md:justify-between mb-6"},I={key:0,class:"flex justify-center py-12"},q={key:1},G={class:"field"},H={class:"field mt-4"},J={class:"grid grid-cols-2 gap-4 mt-4"},K={class:"field"},Q={class:"field"},W={class:"field mt-4"},X={class:"field mt-4"},Y={class:"grid grid-cols-2 gap-4 mt-4"},Z={class:"field"},h={class:"field"},ee={class:"field mt-4"},ye=$({__name:"TrainingSessionList",setup(te){const x=N(),n=P(),m=F(),S=E(()=>n.loading),z=[{label:"Planifiée",value:"planned"},{label:"Réalisée",value:"completed"},{label:"Annulée",value:"cancelled"}],u=p(!1),r=p(null),t=p({training_id:null,training_organization_id:null,start_date:null,end_date:null,location:"",instructor:"",max_participants:null,cost:null,status:"planned"});L([()=>t.value.training_id,()=>t.value.start_date],([o,e])=>{if(!r.value&&o&&e){const d=n.trainings.find(a=>a.id===o);if(d&&d.duration_hours){const a=new Date(e),T=d.duration_hours*60*60*1e3;a.setTime(a.getTime()+T),t.value.end_date=a}}});const D=o=>{x.push(`/trainings/sessions/${o.id}`)},U=()=>{r.value=null,t.value={training_id:null,training_organization_id:null,start_date:new Date,end_date:new Date,location:"",instructor:"",max_participants:null,cost:null,status:"planned"},u.value=!0},k=o=>{r.value=o,t.value={training_id:o.training_id,training_organization_id:o.training_organization_id,start_date:new Date(o.start_date),end_date:new Date(o.end_date),location:o.location,instructor:o.instructor||"",max_participants:o.max_participants,cost:o.cost,status:o.status},u.value=!0},V=()=>{u.value=!1,r.value=null},C=async()=>{if(!t.value.training_id||!t.value.start_date||!t.value.end_date||!t.value.location){m.add({severity:"warn",summary:"Attention",detail:"Veuillez remplir les champs obligatoires",life:3e3});return}const o={...t.value,start_date:t.value.start_date.toISOString(),end_date:t.value.end_date.toISOString()};try{r.value?(await n.updateSession(r.value.id,o),m.add({severity:"success",summary:"Succès",detail:"Session mise à jour",life:3e3})):(await n.createSession(o),m.add({severity:"success",summary:"Succès",detail:"Session créée",life:3e3})),V()}catch(e){console.log(e),m.add({severity:"error",summary:"Erreur",detail:"Une erreur est survenue",life:3e3})}};return O(async()=>{await Promise.all([n.fetchSessions(),n.fetchTrainings(),n.fetchOrganizations()])}),(o,e)=>{const d=j("font-awesome-icon");return g(),v("div",A,[i("div",B,[e[10]||(e[10]=i("h1",{class:"text-2xl font-bold text-gray-800 mb-4 md:mb-0"},"Sessions de formation",-1)),l(s(f),{label:"Nouvelle session",onClick:U},{icon:c(()=>[l(d,{icon:"plus",class:"mr-2"})]),_:1})]),S.value?(g(),v("div",I,[l(d,{icon:["fas","spinner"],spin:"",size:"2x",class:"text-gray-500"})])):(g(),v("div",q,[l(R,{sessions:s(n).sessions,onView:D,onEdit:k},null,8,["sessions"])])),l(s(M),{visible:u.value,"onUpdate:visible":e[9]||(e[9]=a=>u.value=a),header:r.value?"Modifier la session":"Nouvelle session",modal:!0,class:"p-fluid w-full max-w-lg"},{footer:c(()=>[l(s(f),{label:"Annuler",text:"",severity:"secondary",onClick:V}),l(s(f),{label:"Enregistrer",onClick:C})]),default:c(()=>[i("div",G,[e[11]||(e[11]=i("label",{for:"training"},"Formation",-1)),l(s(_),{id:"training",modelValue:t.value.training_id,"onUpdate:modelValue":e[0]||(e[0]=a=>t.value.training_id=a),options:s(n).trainings,optionLabel:"title",optionValue:"id",placeholder:"Sélectionnez une formation",filter:""},null,8,["modelValue","options"])]),i("div",H,[e[12]||(e[12]=i("label",{for:"organization"},"Organisme",-1)),l(s(_),{id:"organization",modelValue:t.value.training_organization_id,"onUpdate:modelValue":e[1]||(e[1]=a=>t.value.training_organization_id=a),options:s(n).organizations,optionLabel:"name",optionValue:"id",placeholder:"Sélectionnez un organisme",filter:"",showClear:""},null,8,["modelValue","options"])]),i("div",J,[i("div",K,[e[13]||(e[13]=i("label",{for:"startDate"},"Date de début",-1)),l(s(w),{id:"startDate",modelValue:t.value.start_date,"onUpdate:modelValue":e[2]||(e[2]=a=>t.value.start_date=a),showIcon:"",showTime:"",hourFormat:"24"},null,8,["modelValue"])]),i("div",Q,[e[14]||(e[14]=i("label",{for:"endDate"},"Date de fin",-1)),l(s(w),{id:"endDate",modelValue:t.value.end_date,"onUpdate:modelValue":e[3]||(e[3]=a=>t.value.end_date=a),showIcon:"",showTime:"",hourFormat:"24"},null,8,["modelValue"])])]),i("div",W,[e[15]||(e[15]=i("label",{for:"location"},"Lieu",-1)),l(s(b),{id:"location",modelValue:t.value.location,"onUpdate:modelValue":e[4]||(e[4]=a=>t.value.location=a)},null,8,["modelValue"])]),i("div",X,[e[16]||(e[16]=i("label",{for:"instructor"},"Formateur",-1)),l(s(b),{id:"instructor",modelValue:t.value.instructor,"onUpdate:modelValue":e[5]||(e[5]=a=>t.value.instructor=a)},null,8,["modelValue"])]),i("div",Y,[i("div",Z,[e[17]||(e[17]=i("label",{for:"maxParticipants"},"Max participants",-1)),l(s(y),{id:"maxParticipants",modelValue:t.value.max_participants,"onUpdate:modelValue":e[6]||(e[6]=a=>t.value.max_participants=a),min:1},null,8,["modelValue"])]),i("div",h,[e[18]||(e[18]=i("label",{for:"cost"},"Coût (€)",-1)),l(s(y),{id:"cost",modelValue:t.value.cost,"onUpdate:modelValue":e[7]||(e[7]=a=>t.value.cost=a),mode:"currency",currency:"EUR",locale:"fr-FR"},null,8,["modelValue"])])]),i("div",ee,[e[19]||(e[19]=i("label",{for:"status"},"Statut",-1)),l(s(_),{id:"status",modelValue:t.value.status,"onUpdate:modelValue":e[8]||(e[8]=a=>t.value.status=a),options:z,optionLabel:"label",optionValue:"value"},null,8,["modelValue"])])]),_:1},8,["visible","header"])])}}});export{ye as default};
