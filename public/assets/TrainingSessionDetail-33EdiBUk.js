import{T as M}from"./index-C9vCuLi4.js";import{d as N,f as q,h as D,c as _,a as e,b as i,u as n,s as p,w as r,k as O,r as T,e as h,t as d,l as R,m as U,p as H,o as m,g as G,i as I,H as J,j as K,F as Q,I as W,x as X,y as Y}from"./index-oOuEsLBu.js";import{u as Z}from"./training-DGriRGlx.js";import{u as ee}from"./users-CY6PsBvV.js";import{s as te,a as E}from"./index-obDBiGqA.js";import{s as B}from"./index-B3ik4ugR.js";import{s as F}from"./index-DHIZNu1f.js";import{s as z}from"./index-CO5Pw-j-.js";import"./index-DXuF__Dl.js";import"./index-CFLhIysZ.js";import"./index-B0RCps1L.js";import"./index-kYhIjE44.js";import"./index-IzGGsCUm.js";import"./index-D4NNOuL2.js";import"./index-D2qS9a38.js";import"./index-C1JXx-aU.js";import"./index-Bsb9bHmP.js";const se={class:"card"},ae={class:"flex justify-between items-center mb-4"},ie={key:0,class:"field"},oe={class:"field mt-4"},ne=N({__name:"ParticipantManager",props:{participations:{},users:{}},emits:["add","update","remove"],setup(k,{emit:g}){const y=g,v=q(),f=D(!1),c=D(null),t=D({user_id:null,status:"registered"}),x=[{label:"Inscrit",value:"registered"},{label:"Présent",value:"attended"},{label:"Validé",value:"validated"},{label:"Échoué",value:"failed"},{label:"Annulé",value:"cancelled"}],b=u=>{const l=x.find(s=>s.value===u);return l?l.label:u},S=u=>({registered:"info",attended:"warning",validated:"success",failed:"danger",cancelled:"secondary"})[u]||"info",C=u=>u?`${u.last_name} ${u.first_name}`:"",P=()=>{c.value=null,t.value={user_id:null,status:"registered"},f.value=!0},V=u=>{c.value=u,t.value={user_id:u.user_id,status:u.status},f.value=!0},w=()=>{f.value=!1,c.value=null},$=()=>{c.value?y("update",{...c.value,status:t.value.status}):y("add",{user_id:t.value.user_id,status:t.value.status}),w()},j=u=>{v.require({message:"Voulez-vous vraiment retirer ce participant ?",header:"Confirmation",icon:"fas fa-exclamation-triangle",accept:()=>{y("remove",u.id)}})};return(u,l)=>{const s=T("font-awesome-icon"),a=M;return m(),_("div",se,[e("div",ae,[l[3]||(l[3]=e("h3",{class:"text-lg font-medium"},"Participants",-1)),i(n(p),{label:"Ajouter",size:"small",onClick:P},{icon:r(()=>[i(s,{icon:"plus",class:"mr-2"})]),_:1})]),i(n(te),{value:k.participations,stripedRows:"",size:"small"},{empty:r(()=>[...l[4]||(l[4]=[h(" Aucun participant inscrit. ",-1)])]),default:r(()=>[i(n(E),{field:"user.last_name",header:"Nom"},{body:r(o=>[h(d(o.data.user?.last_name)+" "+d(o.data.user?.first_name),1)]),_:1}),i(n(E),{field:"status",header:"Statut"},{body:r(o=>[i(n(B),{value:b(o.data.status),severity:S(o.data.status)},null,8,["value","severity"])]),_:1}),i(n(E),{header:"Actions",exportable:!1,style:{"min-width":"8rem"}},{body:r(o=>[R((m(),U(n(p),{text:"",rounded:"",severity:"info",class:"mr-2",onClick:A=>V(o.data)},{icon:r(()=>[i(s,{icon:"pencil"})]),_:1},8,["onClick"])),[[a,"Modifier le statut"]]),R((m(),U(n(p),{text:"",rounded:"",severity:"danger",onClick:A=>j(o.data)},{icon:r(()=>[i(s,{icon:"trash"})]),_:1},8,["onClick"])),[[a,"Retirer"]])]),_:1})]),_:1},8,["value"]),i(n(O),{visible:f.value,"onUpdate:visible":l[2]||(l[2]=o=>f.value=o),header:c.value?"Modifier la participation":"Ajouter un participant",modal:!0,class:"p-fluid w-full max-w-md"},{footer:r(()=>[i(n(p),{label:"Annuler",text:"",severity:"secondary",onClick:w}),i(n(p),{label:"Enregistrer",onClick:$})]),default:r(()=>[c.value?H("",!0):(m(),_("div",ie,[l[5]||(l[5]=e("label",{for:"user"},"Utilisateur",-1)),i(n(F),{id:"user",modelValue:t.value.user_id,"onUpdate:modelValue":l[0]||(l[0]=o=>t.value.user_id=o),options:k.users,optionLabel:C,optionValue:"id",placeholder:"Sélectionnez un utilisateur",filter:"",class:"w-full"},null,8,["modelValue","options"])])),e("div",oe,[l[6]||(l[6]=e("label",{for:"status"},"Statut",-1)),i(n(F),{id:"status",modelValue:t.value.status,"onUpdate:modelValue":l[1]||(l[1]=o=>t.value.status=o),options:x,optionLabel:"label",optionValue:"value",class:"w-full"},null,8,["modelValue"])])]),_:1},8,["visible","header"])])}}}),le={key:0,class:"p-4"},re={class:"flex flex-col md:flex-row md:items-center md:justify-between mb-6"},ue={class:"flex items-center gap-4"},ce={class:"flex items-center gap-2 text-sm text-color-secondary"},de={class:"grid grid-cols-1 lg:grid-cols-3 gap-6"},me={class:"lg:col-span-2 flex flex-col gap-6"},pe={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},ve={class:"font-medium"},fe={class:"font-medium"},_e={class:"font-medium"},ye={class:"font-medium"},ge={class:"flex flex-col gap-6"},xe={class:"flex justify-between items-center"},be={key:0,class:"flex flex-col gap-2"},we={class:"flex items-center gap-2 overflow-hidden"},he={class:"truncate text-sm"},ke={key:1,class:"text-center py-4 text-color-secondary text-sm"},Se={class:"flex flex-col gap-3"},Ce={class:"flex justify-between items-center"},Pe={class:"font-medium"},Ve={class:"w-full bg-surface-100 dark:bg-surface-700 rounded-full h-2"},$e={key:1,class:"flex justify-center py-12"},Ge=N({__name:"TrainingSessionDetail",setup(k){const g=J(),y=Y(),v=Z(),f=ee(),c=G(),t=I(()=>v.sessions.find(s=>s.id===parseInt(g.params.id))),x=I(()=>f.users),b=s=>s?new Date(s).toLocaleDateString("fr-FR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}):"-",S=s=>new Intl.NumberFormat("fr-FR",{style:"currency",currency:"EUR"}).format(s),C=s=>({planned:"Planifiée",completed:"Réalisée",cancelled:"Annulée"})[s]||s,P=s=>({planned:"info",completed:"success",cancelled:"danger"})[s]||"info",V=()=>{if(!t.value||!t.value.max_participants)return 0;const s=t.value.participations?.length||0;return Math.min(100,s/t.value.max_participants*100)},w=()=>{y.back()},$=()=>{console.log("Edit session")},j=async s=>{try{await v.addParticipant({training_session_id:t.value?.id,user_id:s.user_id,status:s.status}),c.add({severity:"success",summary:"Succès",detail:"Participant ajouté",life:3e3})}catch(a){console.log(a),c.add({severity:"error",summary:"Erreur",detail:"Erreur lors de l'ajout",life:3e3})}},u=async s=>{try{await v.updateParticipant(s.id,{status:s.status,obtained_date:s.obtained_date,expiration_date:s.expiration_date}),c.add({severity:"success",summary:"Succès",detail:"Participant mis à jour",life:3e3})}catch(a){console.log(a),c.add({severity:"error",summary:"Erreur",detail:"Erreur lors de la mise à jour",life:3e3})}},l=async s=>{if(t.value)try{await v.removeParticipant(s,t.value.id),c.add({severity:"success",summary:"Succès",detail:"Participant retiré",life:3e3})}catch(a){console.log(a),c.add({severity:"error",summary:"Erreur",detail:"Erreur lors de la suppression",life:3e3})}};return K(async()=>{parseInt(g.params.id)&&(v.sessions.length===0&&await v.fetchSessions(),await f.fetchUsers())}),(s,a)=>{const o=T("font-awesome-icon"),A=M;return t.value?(m(),_("div",le,[e("div",re,[e("div",ue,[i(n(p),{text:"",rounded:"",severity:"secondary",onClick:w},{icon:r(()=>[i(o,{icon:"arrow-left"})]),_:1}),e("div",null,[e("h2",null,d(t.value.training?.title),1),e("div",ce,[i(o,{icon:"calendar"}),e("span",null,d(b(t.value.start_date))+" - "+d(b(t.value.end_date)),1),a[0]||(a[0]=e("span",{class:"mx-2"},"|",-1)),i(n(B),{value:C(t.value.status),severity:P(t.value.status)},null,8,["value","severity"])])])]),i(n(p),{label:"Modifier",severity:"secondary",outlined:"",onClick:$},{icon:r(()=>[i(o,{icon:"pencil",class:"mr-2"})]),_:1})]),e("div",de,[e("div",me,[i(n(z),null,{title:r(()=>[...a[1]||(a[1]=[h("Informations",-1)])]),content:r(()=>[e("div",pe,[e("div",null,[a[2]||(a[2]=e("span",{class:"block text-sm text-color-secondary"},"Organisme",-1)),e("span",ve,d(t.value.organization?.name||"-"),1)]),e("div",null,[a[3]||(a[3]=e("span",{class:"block text-sm text-color-secondary"},"Lieu",-1)),e("span",fe,d(t.value.location),1)]),e("div",null,[a[4]||(a[4]=e("span",{class:"block text-sm text-color-secondary"},"Formateur",-1)),e("span",_e,d(t.value.instructor||"-"),1)]),e("div",null,[a[5]||(a[5]=e("span",{class:"block text-sm text-color-secondary"},"Coût",-1)),e("span",ye,d(t.value.cost?S(t.value.cost):"-"),1)])])]),_:1}),i(ne,{participations:t.value.participations||[],users:x.value,onAdd:j,onUpdate:u,onRemove:l},null,8,["participations","users"])]),e("div",ge,[i(n(z),null,{title:r(()=>[e("div",xe,[a[6]||(a[6]=e("span",null,"Documents",-1)),R((m(),U(n(p),{text:"",rounded:"",size:"small"},{icon:r(()=>[i(o,{icon:"plus"})]),_:1})),[[A,"Ajouter un document"]])])]),content:r(()=>[t.value.documents&&t.value.documents.length>0?(m(),_("div",be,[(m(!0),_(Q,null,W(t.value.documents,L=>(m(),_("div",{key:L.id,class:"flex items-center justify-between p-2 hover:bg-surface-50 dark:hover:bg-surface-800 rounded"},[e("div",we,[i(o,{icon:"file",class:"text-color-secondary"}),e("span",he,d(L.title),1)]),i(n(p),{text:"",rounded:"",size:"small",severity:"secondary"},{icon:r(()=>[i(o,{icon:"download"})]),_:1})]))),128))])):(m(),_("div",ke,"Aucun document associé."))]),_:1}),i(n(z),null,{title:r(()=>[...a[7]||(a[7]=[h("Statistiques",-1)])]),content:r(()=>[e("div",Se,[e("div",Ce,[a[8]||(a[8]=e("span",{class:"text-sm text-color-secondary"},"Inscrits",-1)),e("span",Pe,d(t.value.participations?.length||0)+" / "+d(t.value.max_participants||"∞"),1)]),e("div",Ve,[e("div",{class:"bg-blue-500 h-2 rounded-full",style:X({width:V()+"%"})},null,4)])])]),_:1})])])])):(m(),_("div",$e,[i(o,{icon:["fas","spinner"],spin:"",size:"2x",class:"text-color-secondary"})]))}}});export{Ge as default};
