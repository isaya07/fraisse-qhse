import{T as J}from"./index-C9vCuLi4.js";import{s as pe}from"./index-CO5Pw-j-.js";import{d as K,f as W,g as X,i as P,h as f,q as Y,m as V,w as i,a as s,c as v,b as e,r as Z,F as ve,I as fe,v as I,x as G,t as h,l as U,u as l,s as b,n as Q,p as F,o as m,_ as ye,j as be,e as ge,y as _e}from"./index-oOuEsLBu.js";import{u as xe,s as he}from"./index-CpmQ7Zn9.js";import{u as ee}from"./actionTypes-CCheubGm.js";import{s as we,a as x}from"./index-obDBiGqA.js";import{s as te}from"./index-IzGGsCUm.js";import{s as ke,a as $e}from"./index-kYhIjE44.js";import{s as O}from"./index-B3ik4ugR.js";import{s as q}from"./index-CFLhIysZ.js";import{s as Ce}from"./index-DsZb2wqs.js";import{s as Ve}from"./index-CFZhMzUY.js";import{s as Te}from"./index-D25kfrV8.js";import{s as Ae,_ as Pe}from"./IconPicker.vue_vue_type_script_setup_true_lang-BKN-Qb48.js";import"./index-DXuF__Dl.js";import"./index-D4NNOuL2.js";import"./index-B0RCps1L.js";import"./index-D2qS9a38.js";import"./index-C1JXx-aU.js";import"./index-Bsb9bHmP.js";const Se={class:"flex items-center gap-2"},Le={class:"flex flex-col h-full"},je={class:"flex-1 overflow-y-auto mb-4 custom-scrollbar pr-2"},Re={key:0,class:"flex justify-center py-8"},Ue={key:1,class:"text-center py-8 text-color-secondary"},De={key:2,class:"flex flex-col gap-3"},Ne=["onClick"],ze={class:"flex items-center gap-4"},Be={class:"font-bold text-color text-base mb-0.5"},Me={class:"text-sm text-color-secondary line-clamp-2 leading-tight"},Ee={key:0,class:"ml-2"},Fe={key:1,class:"ml-2"},Oe={class:"border-t border-surface-border pt-6 mt-auto"},qe={class:"flex items-center justify-between mb-4"},Ie={class:"text-xl font-bold text-color"},Ge={key:0,class:"text-red-500"},He={class:"grid grid-cols-2 gap-4"},Qe={class:"flex gap-2"},Je={class:"flex justify-end gap-2 mt-4"},Ke=K({__name:"ActionTypeManager",props:{visible:{type:Boolean}},emits:["update:visible"],setup(D,{emit:T}){const w=D,L=T,g=ee(),j=W(),y=X(),k=P(()=>g.types),A=P(()=>g.loading),u=f(null),$=f(!1),_=f(!1),c=f({name:"",description:"",color:"3b82f6",icon:"tag"}),S=()=>{u.value=null,c.value={name:"",description:"",color:"3b82f6",icon:"tag"},_.value=!1},N=d=>{u.value=d,c.value={name:d.name,description:d.description||"",color:d.color?d.color.replace("#",""):"3b82f6",icon:d.icon||"tag"}},z=async()=>{if(_.value=!0,!!c.value.name){$.value=!0;try{const d={...c.value,color:`#${c.value.color}`};u.value?(await g.updateType(u.value.id,d),y.add({severity:"success",summary:"Succès",detail:"Type mis à jour",life:3e3})):(await g.createType(d),y.add({severity:"success",summary:"Succès",detail:"Type créé",life:3e3})),S()}catch{y.add({severity:"error",summary:"Erreur",detail:"Une erreur est survenue",life:3e3})}finally{$.value=!1}}},R=d=>{j.require({message:`Voulez-vous vraiment supprimer le type "${d.name}" ?`,header:"Confirmation",icon:"exclamation-triangle",acceptClass:"p-button-danger",accept:async()=>{try{await g.deleteType(d.id),y.add({severity:"success",summary:"Succès",detail:"Type supprimé",life:3e3}),u.value?.id===d.id&&S()}catch{y.add({severity:"error",summary:"Erreur",detail:"Impossible de supprimer ce type",life:3e3})}}})};return Y(()=>w.visible,d=>{d&&g.fetchTypes()}),(d,a)=>{const p=Z("font-awesome-icon"),B=J;return m(),V(l(Ve),{visible:D.visible,"onUpdate:visible":a[5]||(a[5]=n=>L("update:visible",n)),position:"right",style:{width:"40rem"}},{header:i(()=>[s("div",Se,[e(p,{icon:"tags",class:"text-xl text-primary"}),a[6]||(a[6]=s("span",{class:"text-xl font-bold"},"Gérer les types d'actions",-1))])]),default:i(()=>[s("div",Le,[s("div",je,[A.value?(m(),v("div",Re,[e(p,{icon:"spinner",spin:"",size:"2x",class:"text-color-secondary"})])):k.value.length===0?(m(),v("div",Ue,[...a[7]||(a[7]=[s("p",null,"Aucun type d'action défini",-1)])])):(m(),v("div",De,[(m(!0),v(ve,null,fe(k.value,n=>(m(),v("div",{key:n.id,onClick:M=>N(n),class:I(["relative flex items-center justify-between p-4 rounded-xl border transition-all cursor-pointer group",[u.value?.id===n.id?"border-primary bg-primary-50 dark:bg-primary-900/20":"border-surface-border bg-surface-card hover:border-primary-200 hover:shadow-sm"]])},[s("div",ze,[s("div",{class:"w-10 h-10 rounded-lg flex items-center justify-center text-white shadow-sm",style:G({backgroundColor:n.color||"#3b82f6"})},[e(p,{icon:n.icon||"tag",class:"text-lg"},null,8,["icon"])],4),s("div",null,[s("div",Be,h(n.name),1),s("div",Me,h(n.description),1)])]),u.value?.id!==n.id?(m(),v("div",Ee,[U((m(),V(l(b),{icon:"pi pi-trash",text:"",rounded:"",severity:"danger",size:"small",class:"opacity-0 group-hover:opacity-100 transition-opacity",onClick:Q(M=>R(n),["stop"])},{icon:i(()=>[e(p,{icon:"trash",class:"text-sm"})]),_:1},8,["onClick"])),[[B,"Supprimer",void 0,{top:!0}]])])):(m(),v("div",Fe,[e(p,{icon:"pen",class:"text-primary text-sm"})]))],10,Ne))),128))]))]),s("div",Oe,[s("div",qe,[s("h3",Ie,h(u.value?"Modifier le type":"Nouveau type"),1),u.value?(m(),V(l(b),{key:0,label:"Nouveau type",icon:"pi pi-plus",size:"small",severity:"secondary",outlined:"",onClick:S},{icon:i(()=>[e(p,{icon:"plus",class:"mr-2"})]),_:1})):F("",!0)]),s("form",{onSubmit:Q(z,["prevent"]),class:"flex flex-col gap-4"},[s("div",null,[a[8]||(a[8]=s("label",{class:"block text-sm font-medium mb-1 text-color-secondary"},"Nom *",-1)),e(l(te),{modelValue:c.value.name,"onUpdate:modelValue":a[0]||(a[0]=n=>c.value.name=n),placeholder:"Ex: Audit sécurité",class:I(["w-full",{"p-invalid":_.value&&!c.value.name}])},null,8,["modelValue","class"]),_.value&&!c.value.name?(m(),v("small",Ge,"Le nom est requis")):F("",!0)]),s("div",null,[a[9]||(a[9]=s("label",{class:"block text-sm font-medium mb-1 text-color-secondary"},"Description",-1)),e(l(Te),{modelValue:c.value.description,"onUpdate:modelValue":a[1]||(a[1]=n=>c.value.description=n),rows:"2",class:"w-full",placeholder:"Brève description..."},null,8,["modelValue"])]),s("div",He,[s("div",null,[a[10]||(a[10]=s("label",{class:"block text-sm font-medium mb-1 text-color-secondary"},"Couleur",-1)),s("div",Qe,[e(l(Ae),{modelValue:c.value.color,"onUpdate:modelValue":a[2]||(a[2]=n=>c.value.color=n),format:"hex",class:"w-full"},null,8,["modelValue"]),s("div",{style:G({backgroundColor:`#${c.value.color}`,width:"2rem",height:"2rem",borderRadius:"4px"}),class:"border border-surface-border"},null,4)])]),s("div",null,[a[11]||(a[11]=s("label",{class:"block text-sm font-medium mb-1 text-color-secondary"},"Icône",-1)),e(Pe,{modelValue:c.value.icon,"onUpdate:modelValue":a[3]||(a[3]=n=>c.value.icon=n)},null,8,["modelValue"])])]),s("div",Je,[u.value?(m(),V(l(b),{key:0,label:"Supprimer",severity:"danger",text:"",onClick:a[4]||(a[4]=n=>R(u.value)),size:"small",class:"mr-auto"},{icon:i(()=>[e(p,{icon:"trash",class:"mr-2"})]),_:1})):F("",!0),e(l(b),{type:"submit",label:u.value?"Enregistrer":"Ajouter",loading:$.value},{icon:i(()=>[e(p,{icon:u.value?"check":"plus",class:"mr-2"},null,8,["icon"])]),_:1},8,["label","loading"])])],32)])])]),_:1},8,["visible"])}}}),We=ye(Ke,[["__scopeId","data-v-da6aefed"]]),Xe={class:"p-4"},Ye={class:"flex flex-col md:flex-row md:items-center md:justify-between mb-6 gap-4"},Ze={class:"flex items-center gap-4"},et={class:"flex gap-2"},tt={class:"flex flex-wrap items-center justify-between gap-2 mb-2"},st={class:"flex flex-wrap gap-2"},ot={class:"font-medium"},lt={class:"text-sm text-gray-500 truncate max-w-xs"},at={key:0,class:"flex items-center gap-2"},it={key:1,class:"text-gray-400 italic"},rt={class:"flex gap-2"},At=K({__name:"ActionConfig",setup(D){const T=_e(),w=xe(),L=ee(),g=W(),j=X(),y=f(""),k=f(null),A=f(null),u=f(null),$=f(10),_=f(0),c=f(!1),S=P(()=>w.actions),N=P(()=>w.loading),z=P(()=>w.pagination.total),R=P(()=>(L.types||[]).map(o=>({label:o.name,value:o.id}))),d=[{label:"Basse",value:"low"},{label:"Moyenne",value:"medium"},{label:"Haute",value:"high"},{label:"Critique",value:"critical"}],a=[{label:"Ouvert",value:"open"},{label:"En cours",value:"in_progress"},{label:"Terminé",value:"completed"},{label:"Annulé",value:"cancelled"}],p=async()=>{const o={search:y.value,action_type_id:k.value,priority:A.value,status:u.value};await w.fetchActions(_.value+1,$.value,o)},B=o=>{_.value=o.page,$.value=o.rows,p()},n=o=>({low:"Basse",medium:"Moyenne",high:"Haute",critical:"Critique"})[o]||o,M=o=>({low:"info",medium:"warn",high:"danger",critical:"danger"})[o]||"info",se=o=>({open:"Ouvert",in_progress:"En cours",completed:"Terminé",cancelled:"Annulé"})[o]||o,oe=o=>({open:"info",in_progress:"warn",completed:"success",cancelled:"secondary"})[o]||"secondary",le=o=>o?new Date(o).toLocaleDateString("fr-FR",{day:"2-digit",month:"2-digit",year:"numeric"}):"-",ae=(o,r)=>!o||r==="completed"||r==="cancelled"?!1:new Date(o)<new Date,ie=o=>`${o.first_name.charAt(0)}${o.last_name.charAt(0)}`.toUpperCase(),re=()=>{T.push("/actions/create")},ne=()=>T.back(),ce=o=>{T.push(`/actions/${o}`)},ue=o=>{T.push(`/actions/${o}/edit`)},de=o=>{g.require({message:`Voulez-vous vraiment supprimer l'action "${o.title}" ?`,header:"Confirmation de suppression",icon:"exclamation-triangle",rejectLabel:"Annuler",acceptLabel:"Supprimer",rejectClass:"p-button-secondary p-button-outlined",acceptClass:"p-button-danger",accept:async()=>{try{await w.deleteAction(o.id),j.add({severity:"success",summary:"Succès",detail:"Action supprimée",life:3e3,icon:"check"}),p()}catch{j.add({severity:"error",summary:"Erreur",detail:"Impossible de supprimer l'action",life:3e3,icon:"times"})}}})};return Y([y,k,A,u],()=>{_.value=0,p()}),be(()=>{L.fetchTypes(),p()}),(o,r)=>{const C=Z("font-awesome-icon"),me=pe,E=J;return m(),v("div",Xe,[s("div",Ye,[s("div",Ze,[e(l(b),{text:"",rounded:"",severity:"secondary",onClick:ne},{icon:i(()=>[e(C,{icon:"arrow-left"})]),_:1}),r[6]||(r[6]=s("h2",{class:"mt-0!"},"Gérer les actions",-1))]),s("div",et,[e(l(b),{label:"Gérer les types",icon:"pi pi-tags",severity:"secondary",outlined:"",onClick:r[0]||(r[0]=t=>c.value=!0)},{icon:i(()=>[e(C,{icon:"tags",class:"mr-2"})]),_:1}),e(l(b),{label:"Nouvelle action",onClick:re,severity:"primary"},{icon:i(()=>[e(C,{icon:"plus",class:"mr-2"})]),_:1})])]),e(me,null,{content:i(()=>[e(We,{visible:c.value,"onUpdate:visible":r[1]||(r[1]=t=>c.value=t)},null,8,["visible"]),e(l(we),{ref:"dt",value:S.value,lazy:"",paginator:!0,rows:$.value,totalRecords:z.value,loading:N.value,onPage:B,paginatorTemplate:"FirstPageLink PrevPageLink PageLinks NextPageLink LastPageLink CurrentPageReport RowsPerPageDropdown",rowsPerPageOptions:[5,10,25,50],currentPageReportTemplate:"Affichage de {first} à {last} sur {totalRecords} actions",tableStyle:"min-width: 50rem",class:"p-datatable-sm"},{header:i(()=>[s("div",tt,[s("div",st,[e(l(q),{modelValue:k.value,"onUpdate:modelValue":r[2]||(r[2]=t=>k.value=t),options:R.value,optionLabel:"label",optionValue:"value",placeholder:"Type",class:"w-full md:w-40",showClear:""},null,8,["modelValue","options"]),e(l(q),{modelValue:A.value,"onUpdate:modelValue":r[3]||(r[3]=t=>A.value=t),options:d,optionLabel:"label",optionValue:"value",placeholder:"Priorité",class:"w-full md:w-40",showClear:""},null,8,["modelValue"]),e(l(q),{modelValue:u.value,"onUpdate:modelValue":r[4]||(r[4]=t=>u.value=t),options:a,optionLabel:"label",optionValue:"value",placeholder:"Statut",class:"w-full md:w-40",showClear:""},null,8,["modelValue"])]),e(l(ke),{iconPosition:"left"},{default:i(()=>[e(l($e),null,{default:i(()=>[e(C,{icon:"magnifying-glass"})]),_:1}),e(l(te),{modelValue:y.value,"onUpdate:modelValue":r[5]||(r[5]=t=>y.value=t),placeholder:"Rechercher..."},null,8,["modelValue"])]),_:1})])]),empty:i(()=>[...r[7]||(r[7]=[ge(" Aucune action trouvée. ",-1)])]),default:i(()=>[e(l(x),{field:"title",header:"Titre",sortable:"",style:{"min-width":"14rem"}},{body:i(({data:t})=>[s("div",ot,h(t.title),1),s("div",lt,h(t.description),1)]),_:1}),e(l(x),{field:"action_type_id",header:"Type",sortable:"",style:{"min-width":"8rem"}},{body:i(({data:t})=>[e(l(O),{value:t.action_type?.name||"-",style:G({backgroundColor:t.action_type?.color})},null,8,["value","style"])]),_:1}),e(l(x),{field:"priority",header:"Priorité",sortable:"",style:{"min-width":"8rem"}},{body:i(({data:t})=>[e(l(O),{value:n(t.priority),severity:M(t.priority)},null,8,["value","severity"])]),_:1}),e(l(x),{field:"status",header:"Statut",sortable:"",style:{"min-width":"8rem"}},{body:i(({data:t})=>[e(l(O),{value:se(t.status),severity:oe(t.status)},null,8,["value","severity"])]),_:1}),e(l(x),{field:"assigned_to",header:"Responsable",sortable:"",style:{"min-width":"10rem"}},{body:i(({data:t})=>[t.assignee?(m(),v("div",at,[e(l(he),{label:ie(t.assignee),shape:"circle",size:"small"},null,8,["label"]),s("span",null,h(t.assignee.first_name)+" "+h(t.assignee.last_name),1)])):(m(),v("span",it,"Non assigné"))]),_:1}),e(l(x),{field:"progress",header:"Progression",sortable:"",style:{"min-width":"10rem"}},{body:i(({data:t})=>[e(l(Ce),{value:t.progress,showValue:!0,style:{height:"1rem"}},null,8,["value"])]),_:1}),e(l(x),{field:"due_date",header:"Échéance",sortable:"",style:{"min-width":"10rem"}},{body:i(({data:t})=>[s("span",{class:I({"text-red-500 font-bold":ae(t.due_date,t.status)})},h(le(t.due_date)),3)]),_:1}),e(l(x),{header:"Actions",exportable:!1,style:{"min-width":"8rem"}},{body:i(({data:t})=>[s("div",rt,[U((m(),V(l(b),{text:"",rounded:"",severity:"info",onClick:H=>ce(t.id)},{default:i(()=>[e(C,{icon:"eye"})]),_:1},8,["onClick"])),[[E,"Voir",void 0,{top:!0}]]),U((m(),V(l(b),{text:"",rounded:"",severity:"success",onClick:H=>ue(t.id)},{default:i(()=>[e(C,{icon:"pencil"})]),_:1},8,["onClick"])),[[E,"Modifier",void 0,{top:!0}]]),U((m(),V(l(b),{text:"",rounded:"",severity:"danger",onClick:H=>de(t)},{default:i(()=>[e(C,{icon:"trash"})]),_:1},8,["onClick"])),[[E,"Supprimer",void 0,{top:!0}]])])]),_:1})]),_:1},8,["value","rows","totalRecords","loading"])]),_:1})])}}});export{At as default};
