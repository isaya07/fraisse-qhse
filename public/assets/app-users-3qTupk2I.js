import{u as X,j as B,a as C,q as Y,r as w,h as O,l as Z,m as ee,b as R,T as se,K as ae,L as k,M as P,d as te,H as re,N as ie}from"./vendor-primevue-_kQtzldN.js";import{d as q,r as $,c as N,w as le,o as D,b as F,f as a,i as s,l as t,u as e,j as oe,t as u,k as p,v as T,h as g,s as G,m,x as ne,g as S}from"./vendor-vue-7xZ5dmFb.js";import{e as H,d as ue}from"./app-actions-MIoyI-E5.js";import{o as de,s as j,b as ce,_ as me,h as pe}from"./vendor-other-akJw3aOu.js";const fe={class:"p-4"},ve={class:"card surface-card p-4 border-round shadow-2"},_e={class:"flex flex-col md:flex-row md:items-center md:justify-between mb-6 gap-4"},ge={class:"flex gap-2"},ye={class:"flex flex-wrap gap-2 items-center justify-between"},be={class:"font-medium"},we={class:"flex gap-2"},he=q({__name:"UserIndex",setup(K){const h=G(),f=H(),n=ue(),x=X(),_=B(),d=$(""),L=$(15),U=$(0),E=N(()=>f.users),z=N(()=>f.loading),I=N(()=>f.pagination.total),M=N(()=>n.currentUser),y=async()=>{const o={search:d.value};await f.fetchUsers(U.value+1,L.value,o)},v=o=>{U.value=o.page,L.value=o.rows,y()},l=o=>({admin:"Administrateur",manager:"Manager",user:"Utilisateur",viewer:"Observateur"})[o]||o,i=o=>({admin:"danger",manager:"warn",user:"info",viewer:"secondary"})[o]||"info",b=()=>{h.push("/users/create")},Q=o=>{h.push(`/users/${o}/edit`)},J=o=>{x.require({message:`Voulez-vous vraiment supprimer l'utilisateur "${o.username}" ?`,header:"Confirmation de suppression",icon:"exclamation-triangle",rejectLabel:"Annuler",acceptLabel:"Supprimer",rejectClass:"p-button-secondary p-button-outlined",acceptClass:"p-button-danger",accept:async()=>{try{await f.deleteUser(o.id),_.add({severity:"success",summary:"Succès",detail:"Utilisateur supprimé",life:3e3,icon:"check"}),y()}catch{_.add({severity:"error",summary:"Erreur",detail:"Impossible de supprimer l'utilisateur",life:3e3,icon:"times"})}}})};return le(d,()=>{U.value=0,y()}),D(()=>{y()}),(o,c)=>{const V=oe("font-awesome-icon"),A=se;return m(),F("div",fe,[a("div",ve,[a("div",_e,[c[1]||(c[1]=a("h1",{class:"text-2xl font-bold text-color"},"Gestion des Utilisateurs",-1)),a("div",ge,[s(e(C),{label:"Nouvel utilisateur",onClick:b,severity:"primary"},{icon:t(()=>[s(V,{icon:"plus",class:"mr-2"})]),_:1})])]),s(e(Y),{ref:"dt",value:E.value,lazy:"",paginator:!0,rows:L.value,totalRecords:I.value,loading:z.value,onPage:v,paginatorTemplate:"FirstPageLink PrevPageLink PageLinks NextPageLink LastPageLink CurrentPageReport RowsPerPageDropdown",rowsPerPageOptions:[5,10,15,25,50],currentPageReportTemplate:"Affichage de {first} à {last} sur {totalRecords} utilisateurs",tableStyle:"min-width: 50rem",class:"p-datatable-sm"},{header:t(()=>[a("div",ye,[c[2]||(c[2]=a("h4",{class:"m-0"},"Liste des utilisateurs",-1)),s(e(Z),{iconPosition:"left"},{default:t(()=>[s(e(ee),null,{default:t(()=>[s(V,{icon:"magnifying-glass"})]),_:1}),s(e(R),{modelValue:d.value,"onUpdate:modelValue":c[0]||(c[0]=r=>d.value=r),placeholder:"Rechercher..."},null,8,["modelValue"])]),_:1})])]),empty:t(()=>[...c[3]||(c[3]=[p(" Aucun utilisateur trouvé. ",-1)])]),default:t(()=>[s(e(w),{field:"username",header:"Nom d'utilisateur",sortable:"",style:{"min-width":"10rem"}},{body:t(({data:r})=>[a("div",be,u(r.username),1)]),_:1}),s(e(w),{field:"email",header:"Email",sortable:"",style:{"min-width":"14rem"}},{body:t(({data:r})=>[p(u(r.email),1)]),_:1}),s(e(w),{field:"first_name",header:"Prénom",sortable:"",style:{"min-width":"10rem"}},{body:t(({data:r})=>[p(u(r.first_name),1)]),_:1}),s(e(w),{field:"last_name",header:"Nom",sortable:"",style:{"min-width":"10rem"}},{body:t(({data:r})=>[p(u(r.last_name),1)]),_:1}),s(e(w),{field:"role",header:"Rôle",sortable:"",style:{"min-width":"8rem"}},{body:t(({data:r})=>[s(e(O),{value:l(r.role),severity:i(r.role)},null,8,["value","severity"])]),_:1}),s(e(w),{field:"is_active",header:"Statut",sortable:"",style:{"min-width":"8rem"}},{body:t(({data:r})=>[s(e(O),{value:r.is_active?"Actif":"Inactif",severity:r.is_active?"success":"danger"},null,8,["value","severity"])]),_:1}),s(e(w),{header:"Actions",exportable:!1,style:{"min-width":"8rem"}},{body:t(({data:r})=>[a("div",we,[T((m(),g(e(C),{text:"",rounded:"",severity:"success",onClick:W=>Q(r.id)},{default:t(()=>[s(V,{icon:"pencil"})]),_:1},8,["onClick"])),[[A,"Modifier",void 0,{top:!0}]]),T((m(),g(e(C),{text:"",rounded:"",severity:"danger",onClick:W=>J(r),disabled:r.id===M.value?.id},{default:t(()=>[s(V,{icon:"trash"})]),_:1},8,["onClick","disabled"])),[[A,"Supprimer",void 0,{top:!0}]])])]),_:1})]),_:1},8,["value","rows","totalRecords","loading"])])])}}}),Fe=Object.freeze(Object.defineProperty({__proto__:null,default:he},Symbol.toStringTag,{value:"Module"})),xe={class:"p-4"},Ue={class:"flex flex-col md:flex-row md:items-center md:justify-between mb-6"},ke={class:"text-2xl font-bold text-color mb-4 md:mb-0"},Pe={class:"card surface-card p-4 border-round shadow-2 max-w-2xl mx-auto"},Se={class:"flex flex-col gap-6"},Ce={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},Le={class:"flex flex-col gap-2"},je={class:"flex flex-col gap-2"},Re={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},Ne={class:"flex flex-col gap-2"},$e={class:"flex flex-col gap-2"},Ve={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},Ee={class:"flex flex-col gap-2"},ze={class:"flex items-center gap-2 h-full pt-2"},Ie={class:"flex flex-col gap-2"},Me={for:"password"},Ae={class:"flex justify-end gap-2 mt-4"},Oe=q({__name:"UserEdit",setup(K){const h=G(),f=ne(),n=H(),x=B(),_=N(()=>f.params.id!==void 0),d=$(!1),L=[{label:"Administrateur",value:"admin"},{label:"Manager",value:"manager"},{label:"Utilisateur",value:"user"},{label:"Observateur",value:"viewer"}],U=$({username:"",email:"",first_name:"",last_name:"",role:"user",is_active:!0,password:""}),E=de({username:j().min(3,"Le nom d'utilisateur doit contenir au moins 3 caractères"),email:j().email("Format d'email invalide"),first_name:j().min(2,"Le prénom est requis"),last_name:j().min(2,"Le nom est requis"),role:me(["admin","manager","user","viewer"]),is_active:ce().optional(),password:j().optional()}).refine(v=>!(!_.value&&(!v.password||v.password.length<6)),{message:"Le mot de passe est requis (min 6 caractères)",path:["password"]}),z=pe(E),I=async()=>{if(_.value){const v=parseInt(f.params.id);d.value=!0;try{await n.fetchUserById(v),n.currentUser&&(U.value={username:n.currentUser.username,email:n.currentUser.email,first_name:n.currentUser.first_name,last_name:n.currentUser.last_name,role:n.currentUser.role,is_active:n.currentUser.is_active??!1,password:""})}catch{x.add({severity:"error",summary:"Erreur",detail:"Erreur lors de la mise à jour de l'utilisateur",life:3e3,icon:"times"}),h.push("/users")}finally{d.value=!1}}},M=async({valid:v,values:l})=>{if(v){d.value=!0;try{if(_.value){const i=parseInt(f.params.id),b={...l};b.password||delete b.password,await n.updateUser(i,b),x.add({severity:"success",summary:"Succès",detail:"Utilisateur mis à jour avec succès",life:3e3,icon:"check"})}else await n.createUser(l),x.add({severity:"success",summary:"Succès",detail:"Utilisateur créé"});h.push("/users")}catch(i){const b=i.message||"Une erreur est survenue";x.add({severity:"error",summary:"Erreur",detail:b})}finally{d.value=!1}}},y=()=>{h.push("/users")};return D(()=>{I()}),(v,l)=>(m(),F("div",xe,[a("div",Ue,[a("h1",ke,u(_.value?"Modifier l'utilisateur":"Nouvel utilisateur"),1),s(e(C),{label:"Retour à la liste",icon:"pi pi-arrow-left",onClick:y,severity:"secondary",outlined:""})]),a("div",Pe,[s(e(ae),{resolver:e(z),onSubmit:M,initialValues:U.value},{default:t(i=>[a("div",Se,[a("div",Ce,[a("div",Le,[s(e(k),{variant:"on"},{default:t(()=>[s(e(R),{name:"username",id:"username",type:"text",class:"w-full",fluid:""}),l[0]||(l[0]=a("label",{for:"username"},"Nom d'utilisateur",-1))]),_:1}),i.username?.invalid?(m(),g(e(P),{key:0,severity:"error",size:"small",variant:"simple"},{default:t(()=>[p(u(i.username.error.message),1)]),_:2},1024)):S("",!0)]),a("div",je,[s(e(k),{variant:"on"},{default:t(()=>[s(e(R),{name:"email",id:"email",type:"email",class:"w-full",fluid:""}),l[1]||(l[1]=a("label",{for:"email"},"Email",-1))]),_:1}),i.email?.invalid?(m(),g(e(P),{key:0,severity:"error",size:"small",variant:"simple"},{default:t(()=>[p(u(i.email.error.message),1)]),_:2},1024)):S("",!0)])]),a("div",Re,[a("div",Ne,[s(e(k),{variant:"on"},{default:t(()=>[s(e(R),{name:"first_name",id:"first_name",type:"text",class:"w-full",fluid:""}),l[2]||(l[2]=a("label",{for:"first_name"},"Prénom",-1))]),_:1}),i.first_name?.invalid?(m(),g(e(P),{key:0,severity:"error",size:"small",variant:"simple"},{default:t(()=>[p(u(i.first_name.error.message),1)]),_:2},1024)):S("",!0)]),a("div",$e,[s(e(k),{variant:"on"},{default:t(()=>[s(e(R),{name:"last_name",id:"last_name",type:"text",class:"w-full",fluid:""}),l[3]||(l[3]=a("label",{for:"last_name"},"Nom",-1))]),_:1}),i.last_name?.invalid?(m(),g(e(P),{key:0,severity:"error",size:"small",variant:"simple"},{default:t(()=>[p(u(i.last_name.error.message),1)]),_:2},1024)):S("",!0)])]),a("div",Ve,[a("div",Ee,[s(e(k),{variant:"on"},{default:t(()=>[s(e(te),{name:"role",inputId:"role",options:L,optionLabel:"label",optionValue:"value",class:"w-full",fluid:""}),l[4]||(l[4]=a("label",{for:"role"},"Rôle",-1))]),_:1}),i.role?.invalid?(m(),g(e(P),{key:0,severity:"error",size:"small",variant:"simple"},{default:t(()=>[p(u(i.role.error.message),1)]),_:2},1024)):S("",!0)]),a("div",ze,[s(e(re),{name:"is_active",inputId:"is_active",binary:!0}),l[5]||(l[5]=a("label",{for:"is_active",class:"cursor-pointer"},"Compte actif",-1))])]),a("div",Ie,[s(e(k),{variant:"on"},{default:t(()=>[s(e(ie),{name:"password",inputId:"password",toggleMask:!0,class:"w-full",inputClass:"w-full",fluid:""}),a("label",Me,u(_.value?"Nouveau mot de passe (laisser vide pour ne pas changer)":"Mot de passe"),1)]),_:1}),i.password?.invalid?(m(),g(e(P),{key:0,severity:"error",size:"small",variant:"simple"},{default:t(()=>[p(u(i.password.error.message),1)]),_:2},1024)):S("",!0)]),a("div",Ae,[s(e(C),{label:"Annuler",severity:"secondary",text:"",onClick:y,disabled:d.value},null,8,["disabled"]),s(e(C),{type:"submit",label:"Enregistrer",icon:"pi pi-check",loading:d.value},null,8,["loading"])])])]),_:1},8,["resolver","initialValues"])])]))}}),Ge=Object.freeze(Object.defineProperty({__proto__:null,default:Oe},Symbol.toStringTag,{value:"Module"}));export{Fe as U,Ge as a};
