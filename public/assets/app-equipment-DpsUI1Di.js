import{g as z,E as ce,a as S,j as ee,b as O,d as I,e as J,F as oe,n as W,f as te,C as ne,h as de,u as me}from"./vendor-primevue-_kQtzldN.js";import{d as N,h as j,l as D,f as e,b as g,t as b,u as c,n as E,i as o,j as B,m,c as T,o as Q,F as H,q as G,p as pe,k as X,s as se,r as M,g as V,x as ie,w as fe}from"./vendor-vue-7xZ5dmFb.js";import{f as R,a as K,b as ae,i as ve,c as le}from"./vendor-utils-CgaVvxla.js";import{d as ye}from"./vendor-pinia--L0FGc_G.js";import{c as A,e as re,f as be}from"./app-actions-MIoyI-E5.js";const ge={class:"flex justify-between items-center"},_e={class:"block text-color-secondary text-sm font-medium mb-1"},xe={key:1,class:"text-2xl font-bold text-color"},Y=N({__name:"StatTile",props:{title:{},value:{},icon:{},color:{},loading:{type:Boolean}},setup(l){return(u,n)=>{const p=B("font-awesome-icon"),f=z;return m(),j(f,{class:"transition-all hover:shadow-md"},{content:D(()=>[e("div",ge,[e("div",null,[e("span",_e,b(l.title),1),l.loading?(m(),j(c(ce),{key:0,style:{width:"16px",height:"16px"},fill:"transparent"})):(m(),g("span",xe,b(l.value),1))]),e("div",{class:E(["w-12 h-12 rounded-full flex items-center justify-center",`bg-${l.color}-100 text-${l.color}-600 dark:bg-${l.color}-900/30 dark:text-${l.color}-400`])},[o(p,{icon:l.icon,size:"lg"},null,8,["icon"])],2)])]),_:1})}}}),P=ye("equipment",{state:()=>({categories:[],equipmentList:[],currentEquipment:null,maintenanceLogs:[],loading:!1,error:null}),getters:{getEquipmentById:l=>u=>l.equipmentList.find(n=>n.id===u),getEquipmentByCategory:l=>u=>l.equipmentList.filter(n=>n.category_id===u),getEquipmentByStatus:l=>u=>l.equipmentList.filter(n=>n.status===u)},actions:{async fetchCategories(){this.loading=!0;try{const{get:l}=A(),u=await l("/equipment-categories");if(u.success&&u.data){const n=u.data;this.categories=n.data||n}}catch(l){this.error="Failed to fetch categories",console.error(l)}finally{this.loading=!1}},async createCategory(l){this.loading=!0;try{const{post:u}=A(),n=await u("/equipment-categories",l);if(n.success&&n.data){const p=n.data,f=p.data||p;return this.categories.push(f),f}}catch(u){throw this.error="Failed to create category",u}finally{this.loading=!1}},async updateCategory(l,u){this.loading=!0;try{const{put:n}=A(),p=await n(`/equipment-categories/${l}`,u);if(p.success&&p.data){const f=p.data,i=f.data||f,s=this.categories.findIndex(t=>t.id===l);return s!==-1&&(this.categories[s]=i),i}}catch(n){throw this.error="Failed to update category",n}finally{this.loading=!1}},async deleteCategory(l){this.loading=!0;try{const{del:u}=A();(await u(`/equipment-categories/${l}`)).success&&(this.categories=this.categories.filter(p=>p.id!==l))}catch(u){throw this.error="Failed to delete category",u}finally{this.loading=!1}},async fetchEquipment(l){this.loading=!0;try{const{get:u}=A();let n="/equipment";if(l){const f=new URLSearchParams;Object.keys(l).forEach(s=>{l[s]&&f.append(s,l[s])});const i=f.toString();i&&(n+=`?${i}`)}const p=await u(n);if(p.success&&p.data){const f=p.data;this.equipmentList=f.data||f}}catch(u){this.error="Failed to fetch equipment",console.error(u)}finally{this.loading=!1}},async fetchEquipmentDetail(l){this.loading=!0;try{const{get:u}=A(),n=await u(`/equipment/${l}`);if(n.success&&n.data){const p=n.data;return this.currentEquipment=p.data||p,this.currentEquipment}}catch(u){this.error="Failed to fetch equipment detail",console.error(u)}finally{this.loading=!1}},async createEquipment(l){this.loading=!0;try{const{post:u}=A(),n=await u("/equipment",l);if(n.success&&n.data){const p=n.data,f=p.data||p;return this.equipmentList.push(f),f}}catch(u){throw this.error="Failed to create equipment",u}finally{this.loading=!1}},async updateEquipment(l,u){this.loading=!0;try{const{put:n}=A(),p=await n(`/equipment/${l}`,u);if(p.success&&p.data){const f=p.data,i=f.data||f,s=this.equipmentList.findIndex(t=>t.id===l);return s!==-1&&(this.equipmentList[s]=i),this.currentEquipment&&this.currentEquipment.id===l&&(this.currentEquipment=i),i}}catch(n){throw this.error="Failed to update equipment",n}finally{this.loading=!1}},async deleteEquipment(l){this.loading=!0;try{const{del:u}=A();(await u(`/equipment/${l}`)).success&&(this.equipmentList=this.equipmentList.filter(p=>p.id!==l))}catch(u){throw this.error="Failed to delete equipment",u}finally{this.loading=!1}},async assignEquipment(l,u){this.loading=!0;try{const{post:n}=A(),p=await n(`/equipment/${l}/assign`,u);if(p.success&&p.data){const f=p.data,i=f.data||f,s=this.equipmentList.findIndex(t=>t.id===l);return s!==-1&&(this.equipmentList[s]=i),this.currentEquipment&&this.currentEquipment.id===l&&(this.currentEquipment=i),i}}catch(n){throw this.error="Failed to assign equipment",n}finally{this.loading=!1}},async returnEquipment(l,u){this.loading=!0;try{const{post:n}=A(),p=await n(`/equipment/${l}/return`,u);if(p.success&&p.data){const f=p.data,i=f.data||f,s=this.equipmentList.findIndex(t=>t.id===l);return s!==-1&&(this.equipmentList[s]=i),this.currentEquipment&&this.currentEquipment.id===l&&(this.currentEquipment=i),i}}catch(n){throw this.error="Failed to return equipment",n}finally{this.loading=!1}},async fetchMaintenanceLogs(l){this.loading=!0;try{const{get:u}=A();let n="/maintenance-logs";l&&(n+=`?equipment_id=${l}`);const p=await u(n);if(p.success&&p.data){const f=p.data;this.maintenanceLogs=f.data||f}}catch(u){this.error="Failed to fetch maintenance logs",console.error(u)}finally{this.loading=!1}},async createMaintenanceLog(l){this.loading=!0;try{const{post:u}=A(),n=await u("/maintenance-logs",l);if(n.success&&n.data){const p=n.data,f=p.data||p;return this.maintenanceLogs.unshift(f),l.equipment_id&&await this.fetchEquipmentDetail(l.equipment_id),f}}catch(u){throw this.error="Failed to create maintenance log",u}finally{this.loading=!1}}}}),he={class:"p-4"},qe={class:"flex flex-col md:flex-row md:items-center md:justify-between mb-6"},we={class:"flex gap-2"},$e={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-4"},ke={key:0,class:"flex justify-center py-12"},Ve={key:1,class:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4 mb-8"},Ee={class:"flex items-center gap-3"},Le={class:"flex-1 min-w-0"},De={class:"truncate"},Ce={class:"text-xs text-color-secondary"},Me={class:"w-10 h-10 rounded-lg bg-surface-100 dark:bg-surface-800 flex items-center justify-center text-color-secondary group-hover:text-blue-500 transition-colors"},Se={class:"grid grid-cols-1 lg:grid-cols-2 gap-6"},Ue={class:"pb-2"},je={key:0,class:"text-center py-8 text-color-secondary"},Re={key:1,class:"space-y-3"},Ae={class:"flex items-center gap-3"},Fe={class:"font-medium text-color"},Ne={class:"text-xs text-red-600 dark:text-red-400"},Ie={class:"pb-2"},Te={key:0,class:"text-center py-8 text-color-secondary"},Oe={key:1,class:"space-y-3"},Be={class:"flex items-center gap-3"},Pe={class:"font-medium text-color"},ze={class:"text-xs text-color-secondary"},He=N({__name:"EquipmentDashboard",setup(l){const u=se(),n=P(),p=T(()=>n.equipmentList.filter(d=>d.status==="available").length),f=T(()=>n.equipmentList.filter(d=>d.status==="maintenance").length),i=T(()=>{const d=new Date;return n.equipmentList.filter(y=>y.expiration_date?new Date(y.expiration_date)<=d:!1)}),s=T(()=>i.value.length),t=d=>R(new Date(d),"dd MMM yyyy",{locale:K}),r=d=>{if(!d.expiration_date)return"";const y=new Date(d.expiration_date);return`Expiré le ${R(y,"dd/MM/yyyy")}`},_=d=>{switch(d){case"periodic_check":return"bg-blue-500";case"repair":return"bg-orange-500";case"calibration":return"bg-purple-500";default:return"bg-gray-500"}},w=d=>{switch(d){case"periodic_check":return"clipboard-check";case"repair":return"tools";case"calibration":return"balance-scale";default:return"file"}},$=d=>{switch(d){case"compliant":return"bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-300";case"non_compliant":return"bg-red-100 text-red-700 dark:bg-red-900/30 dark:text-red-300";case"fixed":return"bg-blue-100 text-blue-700 dark:bg-blue-900/30 dark:text-blue-300";default:return"bg-gray-100 text-gray-700 dark:bg-gray-700 dark:text-gray-300"}},x=d=>{switch(d){case"compliant":return"Conforme";case"non_compliant":return"Non Conforme";case"fixed":return"Réparé";default:return d}},a=d=>{u.push({path:"/equipment/inventory",query:{category:d}})},q=()=>{u.push("/equipment/inventory")},k=()=>{},h=d=>{u.push(`/equipment/${d.id}`)};return Q(async()=>{await Promise.all([n.fetchCategories(),n.fetchEquipment(),n.fetchMaintenanceLogs()])}),(d,y)=>{const C=B("font-awesome-icon"),U=z;return m(),g("div",he,[e("div",qe,[y[0]||(y[0]=e("h2",null,"Gestion des Équipements & EPI",-1)),e("div",we,[o(c(S),{label:"Nouvel équipement",icon:"pi pi-plus",onClick:q})])]),e("div",$e,[o(Y,{title:"Total Équipements",value:c(n).equipmentList.length,icon:"tools",color:"blue",loading:c(n).loading},null,8,["value","loading"]),o(Y,{title:"Disponibles",value:p.value,icon:"check-circle",color:"green",loading:c(n).loading},null,8,["value","loading"]),o(Y,{title:"En Maintenance",value:f.value,icon:"wrench",color:"orange",loading:c(n).loading},null,8,["value","loading"]),o(Y,{title:"EPI Expirés / À contrôler",value:s.value,icon:"exclamation-triangle",color:"red",loading:c(n).loading},null,8,["value","loading"])]),y[6]||(y[6]=e("h3",{class:"pb-4"},"Parcourir par catégorie",-1)),c(n).loading&&!c(n).categories.length?(m(),g("div",ke,[o(C,{icon:["fas","spinner"],spin:"",size:"2x",class:"text-color-secondary"})])):(m(),g("div",Ve,[(m(!0),g(H,null,G(c(n).categories,v=>(m(),j(U,{key:v.id,class:"hover:shadow-md transition-all cursor-pointer group",onClick:L=>a(v.id)},{content:D(()=>[e("div",Ee,[e("div",{class:"w-12 h-12 rounded-full flex items-center justify-center text-white text-lg shadow-sm",style:pe({backgroundColor:v.color||"#64748B"})},[o(C,{icon:v.icon||"box"},null,8,["icon"])],4),e("div",Le,[e("h5",De,b(v.name),1),e("p",Ce,b(v.equipment_count||0)+" éléments ",1)]),o(C,{icon:"chevron-right",class:"text-surface-300 group-hover:text-blue-500 transition-colors text-lg"})])]),_:2},1032,["onClick"]))),128)),e("div",{class:"border border-dashed border-surface-border rounded-xl flex items-center gap-3 p-3 cursor-pointer hover:border-blue-500 hover:bg-blue-50 dark:hover:bg-blue-900/20 transition-colors group",onClick:k},[e("div",Me,[o(C,{icon:"plus"})]),y[1]||(y[1]=e("span",{class:"text-color-secondary font-medium text-sm group-hover:text-blue-500 transition-colors"},"Nouvelle catégorie",-1))])])),e("div",Se,[o(U,null,{content:D(()=>[e("h4",Ue,[o(C,{icon:"bell",class:"text-red-500"}),y[2]||(y[2]=X(" Alertes & Rappels ",-1))]),i.value.length===0?(m(),g("div",je,[o(C,{icon:"check-circle",class:"text-green-500 text-3xl mb-2"}),y[3]||(y[3]=e("p",null,"Tout est en ordre !",-1))])):(m(),g("div",Re,[(m(!0),g(H,null,G(i.value.slice(0,5),v=>(m(),g("div",{key:v.id,class:"flex items-center justify-between p-3 bg-red-50 dark:bg-red-900/20 rounded border border-red-100 dark:border-red-800"},[e("div",Ae,[o(C,{icon:"exclamation-circle",class:"text-red-500"}),e("div",null,[e("p",Fe,b(v.name),1),e("p",Ne,b(r(v)),1)])]),o(c(S),{label:"Voir",size:"small",severity:"danger",text:"",onClick:L=>h(v)},null,8,["onClick"])]))),128))]))]),_:1}),o(U,null,{content:D(()=>[e("h4",Ie,[o(C,{icon:"history",class:"text-blue-500"}),y[4]||(y[4]=X(" Dernières interventions ",-1))]),c(n).maintenanceLogs.length===0?(m(),g("div",Te,[...y[5]||(y[5]=[e("p",null,"Aucun historique récent",-1)])])):(m(),g("div",Oe,[(m(!0),g(H,null,G(c(n).maintenanceLogs.slice(0,5),v=>(m(),g("div",{key:v.id,class:"flex items-center justify-between p-3 bg-surface-50 dark:bg-surface-800 rounded border border-surface-border"},[e("div",Be,[e("div",{class:E(["w-8 h-8 rounded-full flex items-center justify-center text-white text-xs shadow-sm",_(v.type)])},[o(C,{icon:w(v.type)},null,8,["icon"])],2),e("div",null,[e("p",Pe,b(v.equipment?.name||"Équipement inconnu"),1),e("p",ze,b(t(v.date))+" - "+b(v.performer),1)])]),e("span",{class:E(["text-xs px-2 py-1 rounded font-medium",$(v.result)])},b(x(v.result)),3)]))),128))]))]),_:1})])])}}}),Fn=Object.freeze(Object.defineProperty({__proto__:null,default:He},Symbol.toStringTag,{value:"Module"})),Ge={class:"equipment-form"},Je={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Ke={class:"field"},Qe={key:0,class:"text-red-500"},We={class:"field"},Xe={key:0,class:"text-red-500"},Ye={class:"field"},Ze={key:0,class:"text-red-500"},et={class:"field"},tt={class:"field"},st={class:"field"},nt={class:"field"},at={key:0,class:"text-red-500"},lt={class:"field"},ot={class:"field"},it={class:"field"},rt={class:"field"},ut={class:"field col-span-1 md:col-span-2"},ct={class:"flex justify-end gap-2 mt-6"},ue=N({__name:"EquipmentForm",props:{equipment:{}},emits:["save","cancel"],setup(l,{emit:u}){const n=l,p=u,f=P(),i=ee(),s=M({name:"",category_id:null,serial_number:"",internal_ref:"",brand:"",model:"",purchase_date:null,expiration_date:null,maintenance_frequency_months:null,status:"available",location:"warehouse",image_path:""}),t=M({}),r=[{label:"Disponible",value:"available"},{label:"Affecté",value:"assigned"},{label:"En Maintenance",value:"maintenance"},{label:"Hors Service",value:"broken"},{label:"Rebuté",value:"retired"}],_=[{label:"Magasin",value:"warehouse"},{label:"Atelier",value:"workshop"},{label:"Bureau",value:"office"},{label:"Véhicule",value:"vehicle"},{label:"Chantier",value:"site"}];Q(()=>{n.equipment&&(s.value={name:n.equipment.name,category_id:n.equipment.category_id,serial_number:n.equipment.serial_number,internal_ref:n.equipment.internal_ref,brand:n.equipment.brand,model:n.equipment.model,purchase_date:n.equipment.purchase_date?new Date(n.equipment.purchase_date):null,expiration_date:n.equipment.expiration_date?new Date(n.equipment.expiration_date):null,maintenance_frequency_months:n.equipment.maintenance_frequency_months,status:n.equipment.status,location:n.equipment.location,image_path:n.equipment.image_path})});const w=()=>(t.value={},s.value.name||(t.value.name="Le nom est requis"),s.value.category_id||(t.value.category_id="La catégorie est requise"),s.value.serial_number||(t.value.serial_number="Le numéro de série est requis"),s.value.purchase_date||(t.value.purchase_date="La date d'achat est requise"),s.value.status||(t.value.status="Le statut est requis"),s.value.location||(t.value.location="La localisation est requise"),Object.keys(t.value).length===0),$=async()=>{if(!w())return;const x={...s.value,category_id:s.value.category_id||void 0,status:s.value.status,location:s.value.location,purchase_date:s.value.purchase_date?R(s.value.purchase_date,"yyyy-MM-dd"):void 0,expiration_date:s.value.expiration_date?R(s.value.expiration_date,"yyyy-MM-dd"):null};try{n.equipment?(await f.updateEquipment(n.equipment.id,x),i.add({severity:"success",summary:"Succès",detail:"Équipement mis à jour",life:3e3})):(await f.createEquipment(x),i.add({severity:"success",summary:"Succès",detail:"Équipement créé",life:3e3})),p("save")}catch(a){console.error(a),i.add({severity:"error",summary:"Erreur",detail:"Une erreur est survenue lors de l'enregistrement",life:3e3})}};return(x,a)=>(m(),g("div",Ge,[e("div",Je,[e("div",Ke,[a[13]||(a[13]=e("label",{for:"name",class:"block text-sm font-medium text-color-secondary mb-1"},"Nom de l'équipement *",-1)),o(c(O),{id:"name",modelValue:s.value.name,"onUpdate:modelValue":a[0]||(a[0]=q=>s.value.name=q),class:E(["w-full",{"p-invalid":t.value.name}])},null,8,["modelValue","class"]),t.value.name?(m(),g("small",Qe,b(t.value.name),1)):V("",!0)]),e("div",We,[a[14]||(a[14]=e("label",{for:"category",class:"block text-sm font-medium text-color-secondary mb-1"},"Catégorie *",-1)),o(c(I),{id:"category",modelValue:s.value.category_id,"onUpdate:modelValue":a[1]||(a[1]=q=>s.value.category_id=q),options:c(f).categories,optionLabel:"name",optionValue:"id",placeholder:"Sélectionner une catégorie",class:E(["w-full",{"p-invalid":t.value.category_id}])},null,8,["modelValue","options","class"]),t.value.category_id?(m(),g("small",Xe,b(t.value.category_id),1)):V("",!0)]),e("div",Ye,[a[15]||(a[15]=e("label",{for:"serial_number",class:"block text-sm font-medium text-color-secondary mb-1"},"Numéro de série *",-1)),o(c(O),{id:"serial_number",modelValue:s.value.serial_number,"onUpdate:modelValue":a[2]||(a[2]=q=>s.value.serial_number=q),class:E(["w-full",{"p-invalid":t.value.serial_number}])},null,8,["modelValue","class"]),t.value.serial_number?(m(),g("small",Ze,b(t.value.serial_number),1)):V("",!0)]),e("div",et,[a[16]||(a[16]=e("label",{for:"internal_ref",class:"block text-sm font-medium text-color-secondary mb-1"},"Référence interne",-1)),o(c(O),{id:"internal_ref",modelValue:s.value.internal_ref,"onUpdate:modelValue":a[3]||(a[3]=q=>s.value.internal_ref=q),class:"w-full"},null,8,["modelValue"])]),e("div",tt,[a[17]||(a[17]=e("label",{for:"brand",class:"block text-sm font-medium text-color-secondary mb-1"},"Marque",-1)),o(c(O),{id:"brand",modelValue:s.value.brand,"onUpdate:modelValue":a[4]||(a[4]=q=>s.value.brand=q),class:"w-full"},null,8,["modelValue"])]),e("div",st,[a[18]||(a[18]=e("label",{for:"model",class:"block text-sm font-medium text-color-secondary mb-1"},"Modèle",-1)),o(c(O),{id:"model",modelValue:s.value.model,"onUpdate:modelValue":a[5]||(a[5]=q=>s.value.model=q),class:"w-full"},null,8,["modelValue"])]),e("div",nt,[a[19]||(a[19]=e("label",{for:"purchase_date",class:"block text-sm font-medium text-color-secondary mb-1"},"Date d'achat *",-1)),o(c(J),{id:"purchase_date",modelValue:s.value.purchase_date,"onUpdate:modelValue":a[6]||(a[6]=q=>s.value.purchase_date=q),dateFormat:"dd/mm/yy",class:E(["w-full",{"p-invalid":t.value.purchase_date}])},null,8,["modelValue","class"]),t.value.purchase_date?(m(),g("small",at,b(t.value.purchase_date),1)):V("",!0)]),e("div",lt,[a[20]||(a[20]=e("label",{for:"expiration_date",class:"block text-sm font-medium text-color-secondary mb-1"},"Date d'expiration",-1)),o(c(J),{id:"expiration_date",modelValue:s.value.expiration_date,"onUpdate:modelValue":a[7]||(a[7]=q=>s.value.expiration_date=q),dateFormat:"dd/mm/yy",class:"w-full"},null,8,["modelValue"])]),e("div",ot,[a[21]||(a[21]=e("label",{for:"maintenance_frequency_months",class:"block text-sm font-medium text-color-secondary mb-1"},"Fréquence de contrôle (mois)",-1)),o(c(oe),{id:"maintenance_frequency_months",modelValue:s.value.maintenance_frequency_months,"onUpdate:modelValue":a[8]||(a[8]=q=>s.value.maintenance_frequency_months=q),class:"w-full",min:0,showButtons:""},null,8,["modelValue"])]),e("div",it,[a[22]||(a[22]=e("label",{for:"status",class:"block text-sm font-medium text-color-secondary mb-1"},"Statut *",-1)),o(c(I),{id:"status",modelValue:s.value.status,"onUpdate:modelValue":a[9]||(a[9]=q=>s.value.status=q),options:r,optionLabel:"label",optionValue:"value",class:E(["w-full",{"p-invalid":t.value.status}])},null,8,["modelValue","class"])]),e("div",rt,[a[23]||(a[23]=e("label",{for:"location",class:"block text-sm font-medium text-color-secondary mb-1"},"Localisation *",-1)),o(c(I),{id:"location",modelValue:s.value.location,"onUpdate:modelValue":a[10]||(a[10]=q=>s.value.location=q),options:_,optionLabel:"label",optionValue:"value",class:E(["w-full",{"p-invalid":t.value.location}])},null,8,["modelValue","class"])]),e("div",ut,[a[24]||(a[24]=e("label",{for:"image_path",class:"block text-sm font-medium text-color-secondary mb-1"},"URL Image",-1)),o(c(O),{id:"image_path",modelValue:s.value.image_path,"onUpdate:modelValue":a[11]||(a[11]=q=>s.value.image_path=q),class:"w-full",placeholder:"https://..."},null,8,["modelValue"])])]),e("div",ct,[o(c(S),{label:"Annuler",icon:"pi pi-times",severity:"secondary",text:"",onClick:a[12]||(a[12]=q=>x.$emit("cancel"))}),o(c(S),{label:"Enregistrer",icon:"pi pi-check",onClick:$,loading:c(f).loading},null,8,["loading"])])]))}}),dt={class:"p-4"},mt={class:"flex flex-col md:flex-row md:items-center md:justify-between mb-6"},pt={class:"grid grid-cols-1 md:grid-cols-4 gap-4"},ft={class:"field"},vt={class:"p-input-icon-left w-full"},yt={class:"field"},bt={class:"field"},gt={class:"field"},_t={key:0,class:"flex justify-center py-12"},xt={key:1,class:"text-center py-12 surface-card rounded-lg shadow"},ht={key:2,class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6"},qt={class:"h-32 bg-surface-100 dark:bg-surface-800 rounded-t-lg flex items-center justify-center relative overflow-hidden"},wt=["src"],$t={key:1,class:"text-color-secondary flex flex-col items-center"},kt={class:"text-xs"},Vt={class:"p-4 flex-1 flex flex-col"},Et=["title"],Lt={class:"text-sm text-color-secondary mb-2 truncate"},Dt={class:"mt-auto space-y-2"},Ct={class:"flex items-center text-sm text-color-secondary"},Mt={key:0,class:"flex items-center text-sm text-blue-600"},St={class:"truncate"},Ut={key:2,class:"flex items-center text-sm text-color-secondary"},jt=N({__name:"EquipmentInventory",setup(l){const u=ie(),n=se(),p=P(),f=M(!1),i=M({search:"",category_id:null,status:null,location:null}),s=[{label:"Disponible",value:"available"},{label:"Affecté",value:"assigned"},{label:"En Maintenance",value:"maintenance"},{label:"Hors Service",value:"broken"},{label:"Rebuté",value:"retired"}],t=[{label:"Magasin",value:"warehouse"},{label:"Atelier",value:"workshop"},{label:"Bureau",value:"office"},{label:"Véhicule",value:"vehicle"},{label:"Chantier",value:"site"}],r=T(()=>p.equipmentList.filter(d=>{if(i.value.search){const y=i.value.search.toLowerCase(),C=d.name.toLowerCase().includes(y),U=(d.internal_ref||"").toLowerCase().includes(y),v=d.serial_number.toLowerCase().includes(y);if(!C&&!U&&!v)return!1}return!(i.value.category_id&&d.category_id!==i.value.category_id||i.value.status&&d.status!==i.value.status||i.value.location&&d.location!==i.value.location)})),_=d=>{switch(d){case"available":return"bg-green-100 text-green-700";case"assigned":return"bg-blue-100 text-blue-700";case"maintenance":return"bg-orange-100 text-orange-700";case"broken":return"bg-red-100 text-red-700";case"retired":return"bg-gray-100 text-gray-700";default:return"bg-gray-100 text-gray-700"}},w=d=>{const y=s.find(C=>C.value===d);return y?y.label:d},$=d=>{const y=t.find(C=>C.value===d);return y?y.label:d},x=d=>R(new Date(d),"dd/MM/yyyy"),a=d=>new Date(d)<=new Date,q=()=>{f.value=!0},k=()=>{f.value=!1},h=d=>{n.push(`/equipment/${d.id}`)};return Q(async()=>{await Promise.all([p.fetchCategories(),p.fetchEquipment()]),u.query.category&&(i.value.category_id=Number(u.query.category))}),fe(()=>i.value.category_id,d=>{if(d)n.replace({query:{...u.query,category:d}});else{const y={...u.query};delete y.category,n.replace({query:y})}}),(d,y)=>{const C=z,U=B("font-awesome-icon");return m(),g("div",dt,[e("div",mt,[y[6]||(y[6]=e("h2",null,"Inventaire Équipements",-1)),o(c(S),{label:"Nouvel équipement",icon:"pi pi-plus",onClick:q})]),o(C,{class:"mb-6"},{content:D(()=>[e("div",pt,[e("div",ft,[y[8]||(y[8]=e("label",{class:"block text-sm font-medium text-color-secondary mb-1"},"Recherche",-1)),e("span",vt,[y[7]||(y[7]=e("i",{class:"pi pi-search"},null,-1)),o(c(O),{modelValue:i.value.search,"onUpdate:modelValue":y[0]||(y[0]=v=>i.value.search=v),placeholder:"Nom, série, réf...",class:"w-full"},null,8,["modelValue"])])]),e("div",yt,[y[9]||(y[9]=e("label",{class:"block text-sm font-medium text-color-secondary mb-1"},"Catégorie",-1)),o(c(I),{modelValue:i.value.category_id,"onUpdate:modelValue":y[1]||(y[1]=v=>i.value.category_id=v),options:c(p).categories,optionLabel:"name",optionValue:"id",placeholder:"Toutes les catégories",showClear:"",class:"w-full"},null,8,["modelValue","options"])]),e("div",bt,[y[10]||(y[10]=e("label",{class:"block text-sm font-medium text-color-secondary mb-1"},"Statut",-1)),o(c(I),{modelValue:i.value.status,"onUpdate:modelValue":y[2]||(y[2]=v=>i.value.status=v),options:s,optionLabel:"label",optionValue:"value",placeholder:"Tous les statuts",showClear:"",class:"w-full"},null,8,["modelValue"])]),e("div",gt,[y[11]||(y[11]=e("label",{class:"block text-sm font-medium text-color-secondary mb-1"},"Localisation",-1)),o(c(I),{modelValue:i.value.location,"onUpdate:modelValue":y[3]||(y[3]=v=>i.value.location=v),options:t,optionLabel:"label",optionValue:"value",placeholder:"Toutes les localisations",showClear:"",class:"w-full"},null,8,["modelValue"])])])]),_:1}),c(p).loading?(m(),g("div",_t,[o(U,{icon:["fas","spinner"],spin:"",size:"2x",class:"text-color-secondary"})])):r.value.length===0?(m(),g("div",xt,[o(U,{icon:"box-open",class:"text-color-secondary text-5xl mb-4"}),y[12]||(y[12]=e("p",{class:"text-color-secondary text-lg"},"Aucun équipement trouvé",-1))])):(m(),g("div",ht,[(m(!0),g(H,null,G(r.value,v=>(m(),j(C,{key:v.id,class:"surface-card rounded-lg shadow hover:shadow-md transition-all cursor-pointer border border-surface-border flex flex-col",onClick:L=>h(v)},{content:D(()=>[e("div",qt,[v.image_path?(m(),g("img",{key:0,src:v.image_path,class:"w-full h-full object-cover"},null,8,wt)):(m(),g("div",$t,[o(U,{icon:v.category?.icon||"tools",class:"text-3xl mb-2"},null,8,["icon"]),e("span",kt,b(v.category?.name),1)])),e("div",{class:E(["absolute top-2 right-2 px-2 py-1 rounded text-xs font-bold shadow-sm",_(v.status)])},b(w(v.status)),3)]),e("div",Vt,[e("h4",{class:"font-bold text-color mb-1 truncate",title:v.name},b(v.name),9,Et),e("p",Lt," Ref: "+b(v.internal_ref||v.serial_number),1),e("div",Dt,[e("div",Ct,[o(U,{icon:"map-marker-alt",class:"w-4 mr-2 text-color-secondary"}),e("span",null,b($(v.location)),1)]),v.current_assignment?(m(),g("div",Mt,[o(U,{icon:"user",class:"w-4 mr-2"}),e("span",St,b(v.current_assignment.user?.first_name)+" "+b(v.current_assignment.user?.last_name),1)])):V("",!0),v.expiration_date?(m(),g("div",{key:1,class:E(["flex items-center text-sm",a(v.expiration_date)?"text-red-600 font-bold":"text-color-secondary"])},[o(U,{icon:"clock",class:E(["w-4 mr-2",a(v.expiration_date)?"text-red-500":"text-color-secondary"])},null,8,["class"]),e("span",null,"Exp: "+b(x(v.expiration_date)),1)],2)):V("",!0),v.maintenance_frequency_months?(m(),g("div",Ut,[o(U,{icon:"calendar-check",class:"w-4 mr-2 text-color-secondary"}),e("span",null,"Freq: "+b(v.maintenance_frequency_months)+" mois",1)])):V("",!0)])])]),_:2},1032,["onClick"]))),128))])),o(c(W),{visible:f.value,"onUpdate:visible":y[5]||(y[5]=v=>f.value=v),header:"Nouvel équipement",modal:!0,class:"p-fluid w-full max-w-2xl"},{default:D(()=>[o(ue,{onSave:k,onCancel:y[4]||(y[4]=v=>f.value=!1)})]),_:1},8,["visible"])])}}}),Nn=Object.freeze(Object.defineProperty({__proto__:null,default:jt},Symbol.toStringTag,{value:"Module"})),Rt={class:"maintenance-form"},At={class:"grid grid-cols-1 gap-4"},Ft={class:"field"},Nt={key:0,class:"text-red-500"},It={class:"field"},Tt={key:0,class:"text-red-500"},Ot={class:"field"},Bt={key:0,class:"text-red-500"},Pt={class:"field"},zt={class:"flex gap-4"},Ht={class:"flex items-center"},Gt={class:"flex items-center"},Jt={class:"grid grid-cols-2 gap-4"},Kt={class:"field"},Qt={key:0},Wt={key:1},Xt={key:2,class:"text-red-500"},Yt={class:"field"},Zt={class:"field"},es={key:0,class:"text-red-500"},ts={class:"field"},ss={class:"flex justify-end gap-2 mt-6"},ns=N({__name:"MaintenanceForm",props:{equipmentId:{}},emits:["save","cancel"],setup(l,{emit:u}){const n=l,p=u,f=P(),i=re(),s=M("internal"),t=M(null),r=M({type:"periodic_check",date:new Date,description:"",cost:null,performer:"",result:"compliant",next_maintenance_date:null,document_path:""}),_=M({}),w=[{label:"Contrôle Périodique",value:"periodic_check"},{label:"Réparation",value:"repair"},{label:"Calibration",value:"calibration"}],$=[{label:"Conforme",value:"compliant"},{label:"Non Conforme",value:"non_compliant"},{label:"Réparé",value:"fixed"}],x=T(()=>i.users.map(k=>({...k,fullname:`${k.first_name} ${k.last_name}`})));Q(async()=>{i.users.length===0&&await i.fetchUsers()});const a=()=>(_.value={},r.value.type||(_.value.type="Le type est requis"),r.value.date||(_.value.date="La date est requise"),r.value.description||(_.value.description="La description est requise"),s.value==="internal"&&!t.value?_.value.performer="L'utilisateur interne est requis":s.value==="external"&&!r.value.performer&&(_.value.performer="Le nom de l'intervenant est requis"),r.value.result||(_.value.result="Le résultat est requis"),Object.keys(_.value).length===0),q=async()=>{if(!a())return;let k=r.value.performer;if(s.value==="internal"&&t.value){const d=x.value.find(y=>y.id===t.value);d&&(k=d.fullname)}const h={equipment_id:n.equipmentId,...r.value,performer:k,type:r.value.type,result:r.value.result,date:R(r.value.date,"yyyy-MM-dd"),next_maintenance_date:r.value.next_maintenance_date?R(r.value.next_maintenance_date,"yyyy-MM-dd"):null};try{await f.createMaintenanceLog(h),p("save")}catch(d){console.error(d)}};return(k,h)=>(m(),g("div",Rt,[e("div",At,[e("div",Ft,[h[11]||(h[11]=e("label",{for:"type",class:"block text-sm font-medium text-color-secondary mb-1"},"Type d'intervention *",-1)),o(c(I),{id:"type",modelValue:r.value.type,"onUpdate:modelValue":h[0]||(h[0]=d=>r.value.type=d),options:w,optionLabel:"label",optionValue:"value",class:E(["w-full",{"p-invalid":_.value.type}])},null,8,["modelValue","class"]),_.value.type?(m(),g("small",Nt,b(_.value.type),1)):V("",!0)]),e("div",It,[h[12]||(h[12]=e("label",{for:"date",class:"block text-sm font-medium text-color-secondary mb-1"},"Date *",-1)),o(c(J),{id:"date",modelValue:r.value.date,"onUpdate:modelValue":h[1]||(h[1]=d=>r.value.date=d),dateFormat:"dd/mm/yy",class:E(["w-full",{"p-invalid":_.value.date}])},null,8,["modelValue","class"]),_.value.date?(m(),g("small",Tt,b(_.value.date),1)):V("",!0)]),e("div",Ot,[h[13]||(h[13]=e("label",{for:"description",class:"block text-sm font-medium text-color-secondary mb-1"},"Description *",-1)),o(c(te),{id:"description",modelValue:r.value.description,"onUpdate:modelValue":h[2]||(h[2]=d=>r.value.description=d),rows:"3",class:E(["w-full",{"p-invalid":_.value.description}])},null,8,["modelValue","class"]),_.value.description?(m(),g("small",Bt,b(_.value.description),1)):V("",!0)]),e("div",Pt,[h[16]||(h[16]=e("label",{class:"block text-sm font-medium text-color-secondary mb-1"},"Type d'intervenant",-1)),e("div",zt,[e("div",Ht,[o(c(ne),{modelValue:s.value,"onUpdate:modelValue":h[3]||(h[3]=d=>s.value=d),inputId:"internal",value:"internal"},null,8,["modelValue"]),h[14]||(h[14]=e("label",{for:"internal",class:"ml-2 cursor-pointer"},"Interne",-1))]),e("div",Gt,[o(c(ne),{modelValue:s.value,"onUpdate:modelValue":h[4]||(h[4]=d=>s.value=d),inputId:"external",value:"external"},null,8,["modelValue"]),h[15]||(h[15]=e("label",{for:"external",class:"ml-2 cursor-pointer"},"Externe",-1))])])]),e("div",Jt,[e("div",Kt,[h[17]||(h[17]=e("label",{for:"performer",class:"block text-sm font-medium text-color-secondary mb-1"},"Intervenant *",-1)),s.value==="internal"?(m(),g("div",Qt,[o(c(I),{modelValue:t.value,"onUpdate:modelValue":h[5]||(h[5]=d=>t.value=d),options:x.value,optionLabel:"fullname",optionValue:"id",placeholder:"Sélectionner un utilisateur",class:E(["w-full",{"p-invalid":_.value.performer}]),filter:""},null,8,["modelValue","options","class"])])):(m(),g("div",Wt,[o(c(O),{id:"performer",modelValue:r.value.performer,"onUpdate:modelValue":h[6]||(h[6]=d=>r.value.performer=d),class:E(["w-full",{"p-invalid":_.value.performer}]),placeholder:"Nom de l'entreprise ou intervenant"},null,8,["modelValue","class"])])),_.value.performer?(m(),g("small",Xt,b(_.value.performer),1)):V("",!0)]),e("div",Yt,[h[18]||(h[18]=e("label",{for:"cost",class:"block text-sm font-medium text-color-secondary mb-1"},"Coût (€)",-1)),o(c(oe),{id:"cost",modelValue:r.value.cost,"onUpdate:modelValue":h[7]||(h[7]=d=>r.value.cost=d),mode:"currency",currency:"EUR",locale:"fr-FR",class:"w-full"},null,8,["modelValue"])])]),e("div",Zt,[h[19]||(h[19]=e("label",{for:"result",class:"block text-sm font-medium text-color-secondary mb-1"},"Résultat *",-1)),o(c(I),{id:"result",modelValue:r.value.result,"onUpdate:modelValue":h[8]||(h[8]=d=>r.value.result=d),options:$,optionLabel:"label",optionValue:"value",class:E(["w-full",{"p-invalid":_.value.result}])},null,8,["modelValue","class"]),_.value.result?(m(),g("small",es,b(_.value.result),1)):V("",!0)]),e("div",ts,[h[20]||(h[20]=e("label",{for:"next_maintenance_date",class:"block text-sm font-medium text-color-secondary mb-1"},"Prochaine maintenance",-1)),o(c(J),{id:"next_maintenance_date",modelValue:r.value.next_maintenance_date,"onUpdate:modelValue":h[9]||(h[9]=d=>r.value.next_maintenance_date=d),dateFormat:"dd/mm/yy",class:"w-full"},null,8,["modelValue"])])]),e("div",ss,[o(c(S),{label:"Annuler",icon:"pi pi-times",severity:"secondary",text:"",onClick:h[10]||(h[10]=d=>k.$emit("cancel"))}),o(c(S),{label:"Enregistrer",icon:"pi pi-check",onClick:q,loading:c(f).loading},null,8,["loading"])])]))}}),as={class:"assignment-form"},ls={class:"grid grid-cols-1 gap-4"},os={class:"field"},is={key:0,class:"text-red-500"},rs={class:"field"},us={key:0,class:"text-red-500"},cs={class:"field"},ds={class:"flex justify-end gap-2 mt-6"},ms=N({__name:"AssignmentForm",props:{equipmentId:{}},emits:["save","cancel"],setup(l,{emit:u}){const n=l,p=u,f=P(),i=re(),s=M({user_id:null,assigned_at:new Date,notes:""}),t=M({}),r=T(()=>i.users.map($=>({...$,fullname:`${$.first_name} ${$.last_name}`})));Q(async()=>{i.users.length===0&&await i.fetchUsers()});const _=()=>(t.value={},s.value.user_id||(t.value.user_id="L'utilisateur est requis"),s.value.assigned_at||(t.value.assigned_at="La date est requise"),Object.keys(t.value).length===0),w=async()=>{if(!_())return;const $={user_id:s.value.user_id,assigned_at:R(s.value.assigned_at,"yyyy-MM-dd HH:mm:ss"),notes:s.value.notes};try{await f.assignEquipment(n.equipmentId,$),p("save")}catch(x){console.error(x)}};return($,x)=>(m(),g("div",as,[e("div",ls,[e("div",os,[x[4]||(x[4]=e("label",{for:"user",class:"block text-sm font-medium text-color-secondary mb-1"},"Utilisateur *",-1)),o(c(I),{id:"user",modelValue:s.value.user_id,"onUpdate:modelValue":x[0]||(x[0]=a=>s.value.user_id=a),options:r.value,optionLabel:"fullname",optionValue:"id",placeholder:"Sélectionner un utilisateur",class:E(["w-full",{"p-invalid":t.value.user_id}]),filter:""},null,8,["modelValue","options","class"]),t.value.user_id?(m(),g("small",is,b(t.value.user_id),1)):V("",!0)]),e("div",rs,[x[5]||(x[5]=e("label",{for:"assigned_at",class:"block text-sm font-medium text-color-secondary mb-1"},"Date d'affectation *",-1)),o(c(J),{id:"assigned_at",modelValue:s.value.assigned_at,"onUpdate:modelValue":x[1]||(x[1]=a=>s.value.assigned_at=a),showTime:"",dateFormat:"dd/mm/yy",class:E(["w-full",{"p-invalid":t.value.assigned_at}])},null,8,["modelValue","class"]),t.value.assigned_at?(m(),g("small",us,b(t.value.assigned_at),1)):V("",!0)]),e("div",cs,[x[6]||(x[6]=e("label",{for:"notes",class:"block text-sm font-medium text-color-secondary mb-1"},"Notes",-1)),o(c(te),{id:"notes",modelValue:s.value.notes,"onUpdate:modelValue":x[2]||(x[2]=a=>s.value.notes=a),rows:"3",class:"w-full"},null,8,["modelValue"])])]),e("div",ds,[o(c(S),{label:"Annuler",icon:"pi pi-times",severity:"secondary",text:"",onClick:x[3]||(x[3]=a=>$.$emit("cancel"))}),o(c(S),{label:"Affecter",icon:"pi pi-check",onClick:w,loading:c(f).loading},null,8,["loading"])])]))}}),ps={class:"return-form"},fs={class:"grid grid-cols-1 gap-4"},vs={class:"field"},ys={key:0,class:"text-red-500"},bs={class:"field"},gs={key:0,class:"text-red-500"},_s={class:"field"},xs={class:"flex justify-end gap-2 mt-6"},hs=N({__name:"ReturnForm",props:{equipmentId:{}},emits:["save","cancel"],setup(l,{emit:u}){const n=l,p=u,f=P(),i=M({returned_at:new Date,location:"warehouse",notes:""}),s=[{label:"Magasin",value:"warehouse"},{label:"Atelier",value:"workshop"},{label:"Bureau",value:"office"},{label:"Véhicule",value:"vehicle"},{label:"Chantier",value:"site"}],t=M({}),r=()=>(t.value={},i.value.returned_at||(t.value.returned_at="La date est requise"),i.value.location||(t.value.location="La localisation est requise"),Object.keys(t.value).length===0),_=async()=>{if(!r())return;const w={returned_at:R(i.value.returned_at,"yyyy-MM-dd HH:mm:ss"),location:i.value.location,notes:i.value.notes};try{await f.returnEquipment(n.equipmentId,w),p("save")}catch($){console.error($)}};return(w,$)=>{const x=B("font-awesome-icon");return m(),g("div",ps,[e("div",fs,[e("div",vs,[$[4]||($[4]=e("label",{for:"returned_at",class:"block text-sm font-medium text-color-secondary mb-1"},"Date de retour *",-1)),o(c(J),{id:"returned_at",modelValue:i.value.returned_at,"onUpdate:modelValue":$[0]||($[0]=a=>i.value.returned_at=a),showTime:"",dateFormat:"dd/mm/yy",class:E(["w-full",{"p-invalid":t.value.returned_at}])},null,8,["modelValue","class"]),t.value.returned_at?(m(),g("small",ys,b(t.value.returned_at),1)):V("",!0)]),e("div",bs,[$[5]||($[5]=e("label",{for:"location",class:"block text-sm font-medium text-color-secondary mb-1"},"Nouvelle Localisation *",-1)),o(c(I),{id:"location",modelValue:i.value.location,"onUpdate:modelValue":$[1]||($[1]=a=>i.value.location=a),options:s,optionLabel:"label",optionValue:"value",placeholder:"Sélectionner un emplacement",class:E(["w-full",{"p-invalid":t.value.location}])},null,8,["modelValue","class"]),t.value.location?(m(),g("small",gs,b(t.value.location),1)):V("",!0)]),e("div",_s,[$[6]||($[6]=e("label",{for:"notes",class:"block text-sm font-medium text-color-secondary mb-1"},"Notes / État",-1)),o(c(te),{id:"notes",modelValue:i.value.notes,"onUpdate:modelValue":$[2]||($[2]=a=>i.value.notes=a),rows:"3",class:"w-full",placeholder:"État de l'équipement au retour..."},null,8,["modelValue"])])]),e("div",xs,[o(c(S),{label:"Annuler",severity:"secondary",text:"",onClick:$[3]||($[3]=a=>w.$emit("cancel"))},{icon:D(()=>[o(x,{icon:"xmark",class:"mr-2"})]),_:1}),o(c(S),{label:"Confirmer le retour",onClick:_,loading:c(f).loading},{icon:D(()=>[o(x,{icon:"check",class:"mr-2"})]),_:1},8,["loading"])])])}}}),qs=N({__name:"EquipmentDocuments",props:{equipment:{}},setup(l){const u=l,n=ee(),p=P(),{get:f,post:i,del:s}=A(),t=M(!1),r=async x=>{t.value=!0;try{const a=new FormData;Object.keys(x).forEach(k=>{k!=="file"&&x[k]!==null&&x[k]!==void 0&&(x[k]instanceof Date?a.append(k,R(x[k],"yyyy-MM-dd")):a.append(k,x[k]))}),x.file&&a.append("file",x.file),a.append("equipment_id",u.equipment.id.toString());const q=await i("/documents",a);if(q.success)n.add({severity:"success",summary:"Succès",detail:"Document ajouté",life:3e3}),await p.fetchEquipmentDetail(u.equipment.id);else throw new Error(q.error||"Erreur lors de l'ajout")}catch(a){console.error(a),n.add({severity:"error",summary:"Erreur",detail:a.message||"Échec de l'upload",life:3e3})}finally{t.value=!1}},_=async x=>{try{const a=await i(`/equipment/${u.equipment.id}/documents`,{document_id:x.id});a.success?(n.add({severity:"success",summary:"Succès",detail:"Document lié avec succès",life:3e3}),await p.fetchEquipmentDetail(u.equipment.id)):n.add({severity:"error",summary:"Erreur",detail:a.error||"Erreur lors de la liaison",life:3e3})}catch(a){console.error(a),n.add({severity:"error",summary:"Erreur",detail:"Erreur lors de la liaison",life:3e3})}},w=async x=>{try{const a=await s(`/equipment/${u.equipment.id}/documents/${x.id}`);a.success?(n.add({severity:"success",summary:"Succès",detail:"Document délié avec succès",life:3e3}),await p.fetchEquipmentDetail(u.equipment.id)):n.add({severity:"error",summary:"Erreur",detail:a.error||"Erreur lors du déliage",life:3e3})}catch(a){console.error(a),n.add({severity:"error",summary:"Erreur",detail:"Erreur lors du déliage",life:3e3})}},$=async x=>{try{const a=await f(`/documents/${x.id}/download`,{responseType:"blob"});if(a.success&&a.data){const q=window.URL.createObjectURL(a.data),k=document.createElement("a");k.href=q,k.setAttribute("download",x.filename),document.body.appendChild(k),k.click(),k.remove(),window.URL.revokeObjectURL(q)}else n.add({severity:"error",summary:"Erreur",detail:"Impossible de télécharger le fichier",life:3e3})}catch(a){console.error(a),n.add({severity:"error",summary:"Erreur",detail:"Erreur de téléchargement",life:3e3})}};return(x,a)=>(m(),j(be,{documents:l.equipment.documents,loading:t.value,onRequestCreate:r,onRequestLink:_,onRequestDownload:$,onRequestUnlink:w},null,8,["documents","loading"]))}}),ws={class:"h-32 bg-surface-100 dark:bg-surface-800 rounded-t-lg flex items-center justify-center relative overflow-hidden mb-4"},$s=["src"],ks={key:1,class:"text-color-secondary flex flex-col items-center"},Vs={class:"text-xs"},Es={class:"absolute top-2 right-2"},Ls={class:"flex flex-col gap-3"},Ds={class:"flex items-baseline"},Cs={class:"text-color font-mono"},Ms={class:"flex items-baseline"},Ss={class:"text-color"},Us={class:"flex items-baseline"},js={class:"text-color"},Rs={class:"flex items-baseline"},As={class:"text-color"},Fs={class:"flex items-baseline"},Ns={class:"text-color"},Is={class:"flex items-baseline"},Ts={class:"text-color"},Os={class:"flex items-baseline"},Bs={class:"text-color"},Ps={class:"flex items-baseline"},zs={class:"flex gap-2 mt-6 pt-4 border-t border-surface-border"},Hs=N({__name:"EquipmentInfo",props:{equipment:{}},emits:["edit","delete"],setup(l){const u=t=>({available:"Disponible",assigned:"Assigné",maintenance:"En Maintenance",broken:"Hors Service",retired:"Rebuté"})[t]||t,n=t=>({available:"success",assigned:"info",maintenance:"warn",broken:"danger",retired:"secondary"})[t]||"info",p=t=>({warehouse:"Entrepôt",workshop:"Atelier",office:"Bureau",vehicle:"Véhicule",site:"Chantier"})[t]||t,f=t=>t?R(new Date(t),"dd MMMM yyyy",{locale:K}):"-",i=t=>{if(t.maintenance_frequency_months&&t.purchase_date){const r=t.purchase_date,_=ae(new Date(r),t.maintenance_frequency_months);return R(_,"dd MMMM yyyy",{locale:K})}return"-"},s=t=>{if(t.maintenance_frequency_months&&t.purchase_date){const r=t.purchase_date,_=ae(new Date(r),t.maintenance_frequency_months);if(ve(_)&&!le(_))return"text-red-500 font-bold";if(le(_))return"text-orange-500 font-bold"}return"text-900"};return(t,r)=>{const _=B("font-awesome-icon");return m(),j(c(z),null,{content:D(()=>[e("div",ws,[l.equipment.image_path?(m(),g("img",{key:0,src:l.equipment.image_path,class:"w-full h-full object-cover"},null,8,$s)):(m(),g("div",ks,[o(_,{icon:l.equipment.category?.icon||"tools",class:"text-3xl mb-2"},null,8,["icon"]),e("span",Vs,b(l.equipment.category?.name),1)])),e("div",Es,[o(c(de),{value:u(l.equipment.status),severity:n(l.equipment.status),class:"px-2 py-1 text-xs font-bold"},null,8,["value","severity"])])]),e("div",Ls,[e("div",Ds,[r[2]||(r[2]=e("span",{class:"text-base font-medium text-color-secondary w-40 shrink-0"},"Numéro de série :",-1)),e("span",Cs,b(l.equipment.serial_number),1)]),e("div",Ms,[r[3]||(r[3]=e("span",{class:"text-base font-medium text-color-secondary w-40 shrink-0"},"Référence Interne :",-1)),e("span",Ss,b(l.equipment.internal_ref||"-"),1)]),e("div",Us,[r[4]||(r[4]=e("span",{class:"text-base font-medium text-color-secondary w-40 shrink-0"},"Catégorie :",-1)),e("span",js,b(l.equipment.category?.name||"-"),1)]),e("div",Rs,[r[5]||(r[5]=e("span",{class:"text-base font-medium text-color-secondary w-40 shrink-0"},"Marque :",-1)),e("span",As,b(l.equipment.brand||"-"),1)]),e("div",Fs,[r[6]||(r[6]=e("span",{class:"text-base font-medium text-color-secondary w-40 shrink-0"},"Modèle :",-1)),e("span",Ns,b(l.equipment.model||"-"),1)]),e("div",Is,[r[7]||(r[7]=e("span",{class:"text-base font-medium text-color-secondary w-40 shrink-0"},"Localisation :",-1)),e("span",Ts,b(p(l.equipment.location)),1)]),e("div",Os,[r[8]||(r[8]=e("span",{class:"text-base font-medium text-color-secondary w-40 shrink-0"},"Date d'achat :",-1)),e("span",Bs,b(f(l.equipment.purchase_date)),1)]),e("div",Ps,[r[9]||(r[9]=e("span",{class:"text-base font-medium text-color-secondary w-40 shrink-0"},"Prochaine Maint. :",-1)),e("span",{class:E(s(l.equipment))},b(i(l.equipment)),3)])]),e("div",zs,[o(c(S),{label:"Modifier",outlined:"",class:"flex-1 p-button-sm",onClick:r[0]||(r[0]=w=>t.$emit("edit"))},{icon:D(()=>[o(_,{icon:"pen",class:"mr-2"})]),_:1}),o(c(S),{label:"Supprimer",outlined:"",severity:"danger",class:"flex-1 p-button-sm",onClick:r[1]||(r[1]=w=>t.$emit("delete"))},{icon:D(()=>[o(_,{icon:"trash",class:"mr-2"})]),_:1})])]),_:1})}}}),Gs={class:"flex justify-between items-center mb-4"},Js={key:0,class:"text-center py-8 text-color-secondary"},Ks={key:1,class:"space-y-4"},Qs={class:"flex justify-between items-start mb-2"},Ws={class:"flex items-center gap-2"},Xs={class:"flex flex-col"},Ys={class:"font-bold text-sm"},Zs={class:"text-xs text-color-secondary"},en={class:"text-color mb-2"},tn={class:"flex justify-between items-center text-sm text-color-secondary"},sn={key:0},nn=N({__name:"EquipmentMaintenance",props:{maintenanceLogs:{}},emits:["add-maintenance"],setup(l){const u=t=>R(new Date(t),"dd MMM yyyy",{locale:K}),n=t=>({periodic_check:"Vérification Périodique",repair:"Réparation",calibration:"Étalonnage"})[t]||t,p=t=>({periodic_check:"bg-blue-500",repair:"bg-orange-500",calibration:"bg-purple-500"})[t]||"bg-gray-500",f=t=>({periodic_check:"clipboard-check",repair:"tools",calibration:"balance-scale"})[t]||"clipboard",i=t=>({compliant:"Conforme",non_compliant:"Non Conforme",fixed:"Réparé"})[t]||t,s=t=>({compliant:"success",non_compliant:"danger",fixed:"info"})[t]||"info";return(t,r)=>{const _=B("font-awesome-icon");return m(),j(c(z),null,{content:D(()=>[e("div",Gs,[r[1]||(r[1]=e("h4",null,"Historique de Maintenance",-1)),o(c(S),{label:"Ajouter",size:"small",outlined:"",onClick:r[0]||(r[0]=w=>t.$emit("add-maintenance"))},{icon:D(()=>[o(_,{icon:"plus",class:"mr-2"})]),_:1})]),!l.maintenanceLogs||l.maintenanceLogs.length===0?(m(),g("div",Js,[...r[2]||(r[2]=[e("p",null,"Aucune maintenance enregistrée",-1)])])):(m(),g("div",Ks,[(m(!0),g(H,null,G(l.maintenanceLogs,w=>(m(),g("div",{key:w.id,class:"border-b border-surface-border last:border-0 pb-4 last:pb-0"},[e("div",Qs,[e("div",Ws,[e("span",{class:E(["w-8 h-8 flex items-center justify-center rounded-full text-white text-sm",p(w.type)])},[o(_,{icon:f(w.type)},null,8,["icon"])],2),e("div",Xs,[e("span",Ys,b(n(w.type)),1),e("span",Zs,b(u(w.date)),1)])]),e("span",{class:E(["text-xs px-2 py-1 rounded font-medium",s(w.result)])},b(i(w.result)),3)]),e("p",en,b(w.description),1),e("div",tn,[e("span",null,"Par: "+b(w.performer),1),w.cost?(m(),g("span",sn,b(w.cost)+" €",1)):V("",!0)])]))),128))]))]),_:1})}}}),an={class:"flex justify-between items-center mb-4"},ln={key:0,class:"text-center py-8 text-color-secondary"},on={key:1,class:"space-y-4 max-h-96 overflow-y-auto custom-scrollbar pr-2"},rn={class:"flex justify-between items-start mb-2"},un={class:"flex items-center gap-3"},cn={class:"w-8 h-8 rounded-full bg-surface-100 dark:bg-surface-800 flex items-center justify-center text-color-secondary"},dn={class:"font-medium text-color"},mn={class:"text-xs text-color-secondary"},pn={key:0},fn={key:1,class:"text-green-600 font-medium ml-1"},vn={key:0,class:"bg-surface-50 dark:bg-surface-900 p-2 rounded text-sm text-color-secondary italic ml-11 mb-2"},yn={key:1,class:"bg-orange-50 dark:bg-orange-900/20 p-2 rounded text-sm text-color-secondary italic ml-11"},bn=N({__name:"EquipmentAssignments",props:{assignments:{},status:{}},emits:["assign","return"],setup(l){const u=l,n=T(()=>u.assignments?[...u.assignments].sort((f,i)=>new Date(i.assigned_at).getTime()-new Date(f.assigned_at).getTime()):[]),p=f=>R(new Date(f),"dd/MM/yyyy HH:mm",{locale:K});return(f,i)=>{const s=B("font-awesome-icon");return m(),j(c(z),null,{content:D(()=>[e("div",an,[i[2]||(i[2]=e("h4",null,"Historique des Affectations",-1)),l.status==="available"?(m(),j(c(S),{key:0,label:"Nouvelle Affectation",size:"small",outlined:"",onClick:i[0]||(i[0]=t=>f.$emit("assign"))},{icon:D(()=>[o(s,{icon:"user-plus",class:"mr-2"})]),_:1})):l.status==="assigned"?(m(),j(c(S),{key:1,label:"Retourner",size:"small",severity:"warning",outlined:"",onClick:i[1]||(i[1]=t=>f.$emit("return"))},{icon:D(()=>[o(s,{icon:"rotate-left",class:"mr-2"})]),_:1})):V("",!0)]),!l.assignments||l.assignments.length===0?(m(),g("div",ln,[...i[3]||(i[3]=[e("p",null,"Aucune affectation enregistrée",-1)])])):(m(),g("div",on,[(m(!0),g(H,null,G(n.value,t=>(m(),g("div",{key:t.id,class:"border-b border-surface-border last:border-0 pb-4 last:pb-0"},[e("div",rn,[e("div",un,[e("div",cn,[o(s,{icon:"user",class:"text-xs"})]),e("div",null,[e("p",dn,b(t.user?.first_name)+" "+b(t.user?.last_name),1),e("p",mn,[X(b(p(t.assigned_at))+" ",1),t.returned_at?(m(),g("span",pn," - "+b(p(t.returned_at)),1)):(m(),g("span",fn," (En cours) "))])])])]),t.notes?(m(),g("div",vn,[i[4]||(i[4]=e("span",{class:"font-bold not-italic text-xs text-blue-500 block mb-1"},"Affectation :",-1)),X(' "'+b(t.notes)+'" ',1)])):V("",!0),t.return_notes?(m(),g("div",yn,[i[5]||(i[5]=e("span",{class:"font-bold not-italic text-xs text-orange-500 block mb-1"},"Retour :",-1)),X(' "'+b(t.return_notes)+'" ',1)])):V("",!0)]))),128))]))]),_:1})}}}),gn={key:0,class:"p-4"},_n={class:"flex flex-col md:flex-row md:items-center md:justify-between mb-6"},xn={class:"flex items-center gap-4"},hn={class:"text-color-secondary"},qn={class:"grid grid-cols-1 lg:grid-cols-3 gap-6"},wn={class:"lg:col-span-1 space-y-6"},$n={class:"flex items-center gap-4 mb-4"},kn={class:"w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center text-blue-600 text-xl"},Vn={class:"font-bold text-color"},En={class:"text-sm text-color-secondary"},Ln={key:0,class:"bg-surface-100 dark:bg-surface-800 p-3 rounded text-sm text-color-secondary italic"},Dn={class:"lg:col-span-2 space-y-6"},Cn={key:1,class:"flex justify-center py-12"},Mn=N({__name:"EquipmentDetail",setup(l){const u=ie(),n=se(),p=P(),f=me(),i=ee(),s=T(()=>p.currentEquipment),t=M(!1),r=M(!1),_=M(!1),w=M(!1),$=v=>R(new Date(v),"dd/MM/yyyy HH:mm",{locale:K}),x=()=>{w.value=!0},a=()=>{r.value=!0},q=()=>{_.value=!0},k=()=>{t.value=!0},h=()=>{t.value=!1},d=()=>{r.value=!1},y=()=>{_.value=!1},C=()=>{w.value=!1},U=()=>{f.require({message:"Êtes-vous sûr de vouloir supprimer cet équipement ?",header:"Confirmation",icon:"pi pi-exclamation-triangle",accept:async()=>{if(s.value)try{await p.deleteEquipment(s.value.id),i.add({severity:"success",summary:"Succès",detail:"Équipement supprimé",life:3e3}),n.push("/equipment")}catch(v){console.error(v),i.add({severity:"error",summary:"Erreur",detail:"Erreur lors de la suppression",life:3e3})}}})};return Q(async()=>{const v=Number(u.params.id);v&&(await p.fetchEquipmentDetail(v),await p.fetchMaintenanceLogs(v))}),(v,L)=>{const Z=B("font-awesome-icon");return s.value?(m(),g("div",gn,[e("div",_n,[e("div",xn,[o(c(S),{text:"",rounded:"",onClick:L[0]||(L[0]=F=>c(n).back())},{icon:D(()=>[o(Z,{icon:"arrow-left"})]),_:1}),e("div",null,[e("h2",null,b(s.value.name),1),e("p",hn,b(s.value.category?.name)+" • "+b(s.value.brand)+" "+b(s.value.model),1)])])]),e("div",qn,[e("div",wn,[o(Hs,{equipment:s.value,onEdit:x,onDelete:U},null,8,["equipment"]),s.value.current_assignment?(m(),j(c(z),{key:0},{content:D(()=>[L[9]||(L[9]=e("div",{class:"mb-4"},[e("h4",null,"Affectation en cours")],-1)),e("div",$n,[e("div",kn,[o(Z,{icon:"user"})]),e("div",null,[e("p",Vn,b(s.value.current_assignment.user?.first_name)+" "+b(s.value.current_assignment.user?.last_name),1),e("p",En," Depuis le "+b($(s.value.current_assignment.assigned_at)),1)])]),s.value.current_assignment.notes?(m(),g("div",Ln,' "'+b(s.value.current_assignment.notes)+'" ',1)):V("",!0)]),_:1})):V("",!0),o(qs,{equipment:s.value},null,8,["equipment"])]),e("div",Dn,[o(nn,{"maintenance-logs":c(p).maintenanceLogs,onAddMaintenance:k},null,8,["maintenance-logs"]),o(bn,{assignments:s.value.assignments||[],status:s.value.status,onAssign:a,onReturn:q},null,8,["assignments","status"])])]),o(c(W),{visible:t.value,"onUpdate:visible":L[2]||(L[2]=F=>t.value=F),header:"Nouvelle Maintenance",modal:!0,class:"p-fluid w-full max-w-lg"},{default:D(()=>[s.value?(m(),j(ns,{key:0,"equipment-id":s.value.id,onSave:h,onCancel:L[1]||(L[1]=F=>t.value=!1)},null,8,["equipment-id"])):V("",!0)]),_:1},8,["visible"]),o(c(W),{visible:r.value,"onUpdate:visible":L[4]||(L[4]=F=>r.value=F),header:"Affecter l'équipement",modal:!0,class:"p-fluid w-full max-w-lg"},{default:D(()=>[s.value?(m(),j(ms,{key:0,"equipment-id":s.value.id,onSave:d,onCancel:L[3]||(L[3]=F=>r.value=!1)},null,8,["equipment-id"])):V("",!0)]),_:1},8,["visible"]),o(c(W),{visible:_.value,"onUpdate:visible":L[6]||(L[6]=F=>_.value=F),header:"Retourner l'équipement",modal:!0,class:"p-fluid w-full max-w-lg"},{default:D(()=>[s.value?(m(),j(hs,{key:0,"equipment-id":s.value.id,onSave:y,onCancel:L[5]||(L[5]=F=>_.value=!1)},null,8,["equipment-id"])):V("",!0)]),_:1},8,["visible"]),o(c(W),{visible:w.value,"onUpdate:visible":L[8]||(L[8]=F=>w.value=F),header:"Modifier l'équipement",modal:!0,class:"p-fluid w-full max-w-2xl"},{default:D(()=>[s.value?(m(),j(ue,{key:0,equipment:s.value,onSave:C,onCancel:L[7]||(L[7]=F=>w.value=!1)},null,8,["equipment"])):V("",!0)]),_:1},8,["visible"])])):(m(),g("div",Cn,[o(Z,{icon:["fas","spinner"],spin:"",size:"2x",class:"text-color-secondary"})]))}}}),In=Object.freeze(Object.defineProperty({__proto__:null,default:Mn},Symbol.toStringTag,{value:"Module"}));export{Fn as E,Y as _,Nn as a,In as b};
