import{d as N,h as k,i as $,j as R,H as j,q as B,c as r,a as s,b as a,u,s as M,r as U,F as A,I as F,w as I,k as T,t as c,v,p as x,y as z,o as i}from"./index-oOuEsLBu.js";import{u as H}from"./equipment-DEhfSx24.js";import{_ as O}from"./EquipmentForm.vue_vue_type_script_setup_true_lang-CoxbsHWl.js";import{s as P}from"./index-IzGGsCUm.js";import{s as b}from"./index-DHIZNu1f.js";import{f as G}from"./format-t1Knertl.js";import"./index-CFLhIysZ.js";import"./index-B0RCps1L.js";import"./index-kYhIjE44.js";import"./index-CYWC0yQY.js";import"./index-D2qS9a38.js";import"./index-D4NNOuL2.js";const J={class:"p-4"},K={class:"flex flex-col md:flex-row md:items-center md:justify-between mb-6"},Q={class:"surface-card p-4 rounded-lg shadow mb-6"},W={class:"grid grid-cols-1 md:grid-cols-4 gap-4"},X={class:"field"},Y={class:"p-input-icon-left w-full"},Z={class:"field"},ee={class:"field"},te={class:"field"},se={key:0,class:"flex justify-center py-12"},oe={key:1,class:"text-center py-12 surface-card rounded-lg shadow"},le={key:2,class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6"},ae=["onClick"],ne={class:"h-32 bg-surface-100 dark:bg-surface-800 rounded-t-lg flex items-center justify-center relative overflow-hidden"},re=["src"],ie={key:1,class:"text-color-secondary flex flex-col items-center"},ce={class:"text-xs"},ue={class:"p-4 flex-1 flex flex-col"},de=["title"],me={class:"text-sm text-color-secondary mb-2 truncate"},pe={class:"mt-auto space-y-2"},fe={class:"flex items-center text-sm text-color-secondary"},ve={key:0,class:"flex items-center text-sm text-blue-600"},xe={class:"truncate"},be={key:2,class:"flex items-center text-sm text-color-secondary"},Ne=N({__name:"EquipmentInventory",setup(ge){const p=j(),f=z(),d=H(),m=k(!1),l=k({search:"",category_id:null,status:null,location:null}),g=[{label:"Disponible",value:"available"},{label:"Affecté",value:"assigned"},{label:"En Maintenance",value:"maintenance"},{label:"Hors Service",value:"broken"},{label:"Rebuté",value:"retired"}],_=[{label:"Magasin",value:"warehouse"},{label:"Atelier",value:"workshop"},{label:"Bureau",value:"office"},{label:"Véhicule",value:"vehicle"},{label:"Chantier",value:"site"}],y=$(()=>d.equipmentList.filter(o=>{if(l.value.search){const e=l.value.search.toLowerCase(),n=o.name.toLowerCase().includes(e),t=(o.internal_ref||"").toLowerCase().includes(e),w=o.serial_number.toLowerCase().includes(e);if(!n&&!t&&!w)return!1}return!(l.value.category_id&&o.category_id!==l.value.category_id||l.value.status&&o.status!==l.value.status||l.value.location&&o.location!==l.value.location)})),q=o=>{switch(o){case"available":return"bg-green-100 text-green-700";case"assigned":return"bg-blue-100 text-blue-700";case"maintenance":return"bg-orange-100 text-orange-700";case"broken":return"bg-red-100 text-red-700";case"retired":return"bg-gray-100 text-gray-700";default:return"bg-gray-100 text-gray-700"}},C=o=>{const e=g.find(n=>n.value===o);return e?e.label:o},V=o=>{const e=_.find(n=>n.value===o);return e?e.label:o},L=o=>G(new Date(o),"dd/MM/yyyy"),h=o=>new Date(o)<=new Date,E=()=>{m.value=!0},S=()=>{m.value=!1},D=o=>{f.push(`/equipment/${o.id}`)};return R(async()=>{await Promise.all([d.fetchCategories(),d.fetchEquipment()]),p.query.category&&(l.value.category_id=Number(p.query.category))}),B(()=>l.value.category_id,o=>{if(o)f.replace({query:{...p.query,category:o}});else{const e={...p.query};delete e.category,f.replace({query:e})}}),(o,e)=>{const n=U("font-awesome-icon");return i(),r("div",J,[s("div",K,[e[6]||(e[6]=s("h1",{class:"text-2xl font-bold text-color mb-4 md:mb-0"},"Inventaire Équipements",-1)),a(u(M),{label:"Nouvel équipement",icon:"pi pi-plus",onClick:E})]),s("div",Q,[s("div",W,[s("div",X,[e[8]||(e[8]=s("label",{class:"block text-sm font-medium text-color-secondary mb-1"},"Recherche",-1)),s("span",Y,[e[7]||(e[7]=s("i",{class:"pi pi-search"},null,-1)),a(u(P),{modelValue:l.value.search,"onUpdate:modelValue":e[0]||(e[0]=t=>l.value.search=t),placeholder:"Nom, série, réf...",class:"w-full"},null,8,["modelValue"])])]),s("div",Z,[e[9]||(e[9]=s("label",{class:"block text-sm font-medium text-color-secondary mb-1"},"Catégorie",-1)),a(u(b),{modelValue:l.value.category_id,"onUpdate:modelValue":e[1]||(e[1]=t=>l.value.category_id=t),options:u(d).categories,optionLabel:"name",optionValue:"id",placeholder:"Toutes les catégories",showClear:"",class:"w-full"},null,8,["modelValue","options"])]),s("div",ee,[e[10]||(e[10]=s("label",{class:"block text-sm font-medium text-color-secondary mb-1"},"Statut",-1)),a(u(b),{modelValue:l.value.status,"onUpdate:modelValue":e[2]||(e[2]=t=>l.value.status=t),options:g,optionLabel:"label",optionValue:"value",placeholder:"Tous les statuts",showClear:"",class:"w-full"},null,8,["modelValue"])]),s("div",te,[e[11]||(e[11]=s("label",{class:"block text-sm font-medium text-color-secondary mb-1"},"Localisation",-1)),a(u(b),{modelValue:l.value.location,"onUpdate:modelValue":e[3]||(e[3]=t=>l.value.location=t),options:_,optionLabel:"label",optionValue:"value",placeholder:"Toutes les localisations",showClear:"",class:"w-full"},null,8,["modelValue"])])])]),u(d).loading?(i(),r("div",se,[a(n,{icon:["fas","spinner"],spin:"",size:"2x",class:"text-color-secondary"})])):y.value.length===0?(i(),r("div",oe,[a(n,{icon:"box-open",class:"text-color-secondary text-5xl mb-4"}),e[12]||(e[12]=s("p",{class:"text-color-secondary text-lg"},"Aucun équipement trouvé",-1))])):(i(),r("div",le,[(i(!0),r(A,null,F(y.value,t=>(i(),r("div",{key:t.id,class:"surface-card rounded-lg shadow hover:shadow-md transition-all cursor-pointer border border-surface-border flex flex-col",onClick:w=>D(t)},[s("div",ne,[t.image_path?(i(),r("img",{key:0,src:t.image_path,class:"w-full h-full object-cover"},null,8,re)):(i(),r("div",ie,[a(n,{icon:t.category?.icon||"tools",class:"text-3xl mb-2"},null,8,["icon"]),s("span",ce,c(t.category?.name),1)])),s("div",{class:v(["absolute top-2 right-2 px-2 py-1 rounded text-xs font-bold shadow-sm",q(t.status)])},c(C(t.status)),3)]),s("div",ue,[s("h3",{class:"font-bold text-color mb-1 truncate",title:t.name},c(t.name),9,de),s("p",me," Ref: "+c(t.internal_ref||t.serial_number),1),s("div",pe,[s("div",fe,[a(n,{icon:"map-marker-alt",class:"w-4 mr-2 text-color-secondary"}),s("span",null,c(V(t.location)),1)]),t.current_assignment?(i(),r("div",ve,[a(n,{icon:"user",class:"w-4 mr-2"}),s("span",xe,c(t.current_assignment.user?.first_name)+" "+c(t.current_assignment.user?.last_name),1)])):x("",!0),t.expiration_date?(i(),r("div",{key:1,class:v(["flex items-center text-sm",h(t.expiration_date)?"text-red-600 font-bold":"text-color-secondary"])},[a(n,{icon:"clock",class:v(["w-4 mr-2",h(t.expiration_date)?"text-red-500":"text-color-secondary"])},null,8,["class"]),s("span",null,"Exp: "+c(L(t.expiration_date)),1)],2)):x("",!0),t.maintenance_frequency_months?(i(),r("div",be,[a(n,{icon:"calendar-check",class:"w-4 mr-2 text-color-secondary"}),s("span",null,"Freq: "+c(t.maintenance_frequency_months)+" mois",1)])):x("",!0)])])],8,ae))),128))])),a(u(T),{visible:m.value,"onUpdate:visible":e[5]||(e[5]=t=>m.value=t),header:"Nouvel équipement",modal:!0,class:"p-fluid w-full max-w-2xl"},{default:I(()=>[a(O,{onSave:S,onCancel:e[4]||(e[4]=t=>m.value=!1)})]),_:1},8,["visible"])])}}});export{Ne as default};
