import{T as K}from"./index-CrhbiAe9.js";import{d as W,f as X,g as Y,i as P,h as y,q as Z,m as V,w as r,u as o,a as s,c as f,b as e,r as ee,F as de,I as ue,v as Q,x as G,t as v,l as R,s as g,n as H,p as E,o as m,_ as me,j as pe,e as z,y as ve}from"./index-d7axL_xv.js";import{u as fe}from"./indicators-BcWegbov.js";import{u as te}from"./indicatorCategories-Bys3qs2i.js";import{s as ye}from"./index-DN7ljz-6.js";import{s as se}from"./index-DZQqA5uS.js";import{s as be}from"./index-BrM16FOF.js";import{s as ge,_ as _e}from"./IconPicker.vue_vue_type_script_setup_true_lang-ZXAFQX2H.js";import{s as xe,a as w}from"./index-C0aPiIhq.js";import{s as he,a as we}from"./index-D_33rlMc.js";import{s as J}from"./index-Dw7kVe-F.js";import{s as D}from"./index-C4Jjik4c.js";import"./index-C45h_JBJ.js";import"./index-DbX5rEQv.js";import"./index-xoP2DrFw.js";import"./index-rhSU9nKe.js";import"./index-BixvgfbH.js";import"./index-Cx-_v3H7.js";const Ce={class:"flex items-center gap-2"},ke={class:"flex flex-col h-full"},$e={class:"flex-1 overflow-y-auto mb-4 custom-scrollbar pr-2"},Ve={key:0,class:"flex justify-center py-8"},Se={key:1,class:"text-center py-8 text-color-secondary"},Ie={key:2,class:"flex flex-col gap-3"},Pe=["onClick"],Le={class:"flex items-center gap-4"},Te={class:"font-bold text-color text-base mb-0.5"},je={class:"text-sm text-color-secondary line-clamp-2 leading-tight"},Ne={key:0,class:"ml-2"},ze={key:1,class:"ml-2"},Re={class:"border-t border-surface-border pt-6 mt-auto"},Ue={class:"flex items-center justify-between mb-4"},qe={class:"text-xl font-bold text-color"},Ae={key:0,class:"text-red-500"},Fe={class:"grid grid-cols-2 gap-4"},Be={class:"flex gap-2"},Me={class:"flex justify-end gap-2 mt-4"},Ee=W({__name:"IndicatorTypeManager",props:{visible:{type:Boolean}},emits:["update:visible"],setup(U,{emit:S}){const C=U,T=S,_=te(),j=X(),b=Y(),k=P(()=>_.categories),I=P(()=>_.loading),d=y(null),$=y(!1),x=y(!1),c=y({name:"",description:"",color:"3b82f6",icon:"tag"}),L=()=>{d.value=null,c.value={name:"",description:"",color:"3b82f6",icon:"tag"},x.value=!1},q=u=>{d.value=u,c.value={name:u.name,description:u.description||"",color:u.color?u.color.replace("#",""):"3b82f6",icon:u.icon||"tag"}},A=async()=>{if(x.value=!0,!!c.value.name){$.value=!0;try{const u={...c.value,color:`#${c.value.color}`};d.value?(await _.updateCategory(d.value.id,u),b.add({severity:"success",summary:"Succès",detail:"Type mis à jour",life:3e3})):(await _.createCategory(u),b.add({severity:"success",summary:"Succès",detail:"Type créé",life:3e3})),L()}catch{b.add({severity:"error",summary:"Erreur",detail:"Une erreur est survenue",life:3e3})}finally{$.value=!1}}},N=u=>{j.require({message:`Voulez-vous vraiment supprimer le type "${u.name}" ?`,header:"Confirmation",icon:"exclamation-triangle",acceptClass:"p-button-danger",accept:async()=>{try{await _.deleteCategory(u.id),b.add({severity:"success",summary:"Succès",detail:"Type supprimé",life:3e3}),d.value?.id===u.id&&L()}catch{b.add({severity:"error",summary:"Erreur",detail:"Impossible de supprimer ce type",life:3e3})}}})};return Z(()=>C.visible,u=>{u&&_.fetchCategories()}),(u,l)=>{const p=ee("font-awesome-icon"),F=K;return m(),V(o(ye),{visible:U.visible,"onUpdate:visible":l[5]||(l[5]=n=>T("update:visible",n)),position:"right",style:{width:"40rem"}},{header:r(()=>[s("div",Ce,[e(p,{icon:"tags",class:"text-xl text-primary"}),l[6]||(l[6]=s("span",{class:"text-xl font-bold"},"Gérer les types d'indicateurs",-1))])]),default:r(()=>[s("div",ke,[s("div",$e,[I.value?(m(),f("div",Ve,[e(p,{icon:"spinner",spin:"",size:"2x",class:"text-color-secondary"})])):k.value.length===0?(m(),f("div",Se,[...l[7]||(l[7]=[s("p",null,"Aucun type d'indicateur défini",-1)])])):(m(),f("div",Ie,[(m(!0),f(de,null,ue(k.value,n=>(m(),f("div",{key:n.id,onClick:B=>q(n),class:Q(["relative flex items-center justify-between p-4 rounded-xl border transition-all cursor-pointer group",[d.value?.id===n.id?"border-primary bg-primary-50 dark:bg-primary-900/20":"border-surface-border bg-surface-card hover:border-primary-200 hover:shadow-sm"]])},[s("div",Le,[s("div",{class:"w-10 h-10 rounded-lg flex items-center justify-center text-white shadow-sm",style:G({backgroundColor:n.color||"#3b82f6"})},[e(p,{icon:n.icon||"tag",class:"text-lg"},null,8,["icon"])],4),s("div",null,[s("div",Te,v(n.name),1),s("div",je,v(n.description),1)])]),d.value?.id!==n.id?(m(),f("div",Ne,[R((m(),V(o(g),{icon:"pi pi-trash",text:"",rounded:"",severity:"danger",size:"small",class:"opacity-0 group-hover:opacity-100 transition-opacity",onClick:H(B=>N(n),["stop"])},{icon:r(()=>[e(p,{icon:"trash",class:"text-sm"})]),_:1},8,["onClick"])),[[F,"Supprimer",void 0,{top:!0}]])])):(m(),f("div",ze,[e(p,{icon:"pen",class:"text-primary text-sm"})]))],10,Pe))),128))]))]),s("div",Re,[s("div",Ue,[s("h3",qe,v(d.value?"Modifier le type":"Nouveau type"),1),d.value?(m(),V(o(g),{key:0,label:"Nouveau type",icon:"pi pi-plus",size:"small",severity:"secondary",outlined:"",onClick:L},{icon:r(()=>[e(p,{icon:"plus",class:"mr-2"})]),_:1})):E("",!0)]),s("form",{onSubmit:H(A,["prevent"]),class:"flex flex-col gap-4"},[s("div",null,[l[8]||(l[8]=s("label",{class:"block text-sm font-medium mb-1 text-color-secondary"},"Nom *",-1)),e(o(se),{modelValue:c.value.name,"onUpdate:modelValue":l[0]||(l[0]=n=>c.value.name=n),placeholder:"Ex: Sécurité, Qualité...",class:Q(["w-full",{"p-invalid":x.value&&!c.value.name}])},null,8,["modelValue","class"]),x.value&&!c.value.name?(m(),f("small",Ae,"Le nom est requis")):E("",!0)]),s("div",null,[l[9]||(l[9]=s("label",{class:"block text-sm font-medium mb-1 text-color-secondary"},"Description",-1)),e(o(be),{modelValue:c.value.description,"onUpdate:modelValue":l[1]||(l[1]=n=>c.value.description=n),rows:"2",class:"w-full",placeholder:"Brève description..."},null,8,["modelValue"])]),s("div",Fe,[s("div",null,[l[10]||(l[10]=s("label",{class:"block text-sm font-medium mb-1 text-color-secondary"},"Couleur",-1)),s("div",Be,[e(o(ge),{modelValue:c.value.color,"onUpdate:modelValue":l[2]||(l[2]=n=>c.value.color=n),format:"hex",class:"w-full"},null,8,["modelValue"]),s("div",{style:G({backgroundColor:`#${c.value.color}`,width:"2rem",height:"2rem",borderRadius:"4px"}),class:"border border-surface-border"},null,4)])]),s("div",null,[l[11]||(l[11]=s("label",{class:"block text-sm font-medium mb-1 text-color-secondary"},"Icône",-1)),e(_e,{modelValue:c.value.icon,"onUpdate:modelValue":l[3]||(l[3]=n=>c.value.icon=n)},null,8,["modelValue"])])]),s("div",Me,[d.value?(m(),V(o(g),{key:0,label:"Supprimer",severity:"danger",text:"",onClick:l[4]||(l[4]=n=>N(d.value)),size:"small",class:"mr-auto"},{icon:r(()=>[e(p,{icon:"trash",class:"mr-2"})]),_:1})):E("",!0),e(o(g),{type:"submit",label:d.value?"Enregistrer":"Ajouter",loading:$.value},{icon:r(()=>[e(p,{icon:d.value?"check":"plus",class:"mr-2"},null,8,["icon"])]),_:1},8,["label","loading"])])],32)])])]),_:1},8,["visible"])}}}),De=me(Ee,[["__scopeId","data-v-ad78552c"]]),Oe={class:"p-4"},Qe={class:"flex flex-col md:flex-row md:items-center md:justify-between mb-6 gap-4"},Ge={class:"flex items-center gap-4"},He={class:"flex gap-2"},Je={class:"card"},Ke={class:"flex flex-wrap gap-2 items-center justify-between mb-4"},We={class:"font-medium"},Xe={class:"text-sm text-color-secondary truncate max-w-xs"},Ye={key:0,class:"flex items-center gap-2"},Ze={class:"w-6 h-6 rounded-full bg-blue-100 flex items-center justify-center text-blue-600 text-xs font-bold"},et={class:"text-sm"},tt={key:1,class:"text-color-secondary"},st={class:"flex gap-2"},ht=W({__name:"IndicateurConfig",setup(U){const S=ve(),C=fe(),T=te(),_=X(),j=Y(),b=y(""),k=y(null),I=y(null),d=y(null),$=y(10),x=y(0),c=y(!1),L=P(()=>C.indicators),q=P(()=>C.loading),A=P(()=>C.pagination.total),N=P(()=>T.categories),u=[{label:"Positive",value:"positive"},{label:"Négative",value:"negative"},{label:"Neutre",value:"neutral"}],l=[{label:"Actif",value:"true"},{label:"Inactif",value:"false"}],p=async()=>{const a={search:b.value,indicator_category_id:k.value,trend_direction:I.value,is_active:d.value};await C.fetchIndicators(x.value+1,$.value,a)},F=a=>{x.value=a.page,$.value=a.rows,p()},n=a=>({daily:"Quotidienne",weekly:"Hebdomadaire",monthly:"Mensuelle",quarterly:"Trimestrielle",yearly:"Annuelle"})[a]||a,B=a=>({positive:"Hausse",negative:"Baisse",neutral:"Stable"})[a]||a,oe=(a,i)=>!a||!i||a==="neutral"?"info":i==="maximize"?a==="positive"?"success":"danger":i==="minimize"?a==="positive"?"danger":"success":"info",ie=a=>a&&{positive:"arrow-trend-up",negative:"arrow-trend-down",neutral:"minus"}[a]||"minus",le=()=>{S.push("/indicators/create")},ae=a=>{S.push(`/indicators/${a}`)},re=a=>{S.push(`/indicators/${a}/edit`)},ne=a=>{_.require({message:`Voulez-vous vraiment supprimer l'indicateur "${a.name}" ?`,header:"Confirmation de suppression",icon:"exclamation-triangle",rejectLabel:"Annuler",acceptLabel:"Supprimer",rejectClass:"p-button-secondary p-button-outlined",acceptClass:"p-button-danger",accept:async()=>{try{await C.deleteIndicator(a.id),j.add({severity:"success",summary:"Succès",detail:"Indicateur supprimé",life:3e3}),p()}catch(i){console.error("Erreur lors de la suppression:",i),j.add({severity:"error",summary:"Erreur",detail:"Impossible de supprimer l'indicateur",life:3e3})}}})},ce=()=>S.back();return Z([b,k,I,d],()=>{x.value=0,p()}),pe(()=>{T.fetchCategories(),p()}),(a,i)=>{const h=ee("font-awesome-icon"),M=K;return m(),f("div",Oe,[s("div",Qe,[s("div",Ge,[e(o(g),{text:"",rounded:"",severity:"secondary",onClick:ce},{icon:r(()=>[e(h,{icon:"arrow-left"})]),_:1}),i[6]||(i[6]=s("h2",{class:"mt-0!"},"Configuration des indicateurs",-1))]),s("div",He,[e(o(g),{label:"Gérer les types",onClick:i[0]||(i[0]=t=>c.value=!0),severity:"secondary",outlined:""},{icon:r(()=>[e(h,{icon:"tags",class:"mr-2"})]),_:1}),e(o(g),{label:"Nouvel indicateur",onClick:le,severity:"primary"},{icon:r(()=>[e(h,{icon:"plus",class:"mr-2"})]),_:1})])]),s("div",Je,[e(o(xe),{ref:"dt",value:L.value,lazy:"",paginator:!0,rows:$.value,totalRecords:A.value,loading:q.value,onPage:F,paginatorTemplate:"FirstPageLink PrevPageLink PageLinks NextPageLink LastPageLink CurrentPageReport RowsPerPageDropdown",rowsPerPageOptions:[5,10,25,50],currentPageReportTemplate:"Affichage de {first} à {last} sur {totalRecords} indicateurs",tableStyle:"min-width: 50rem",class:"p-datatable-sm"},{header:r(()=>[s("div",Ke,[i[7]||(i[7]=s("h4",{class:"m-0"},"Liste des indicateurs",-1)),e(o(D),{modelValue:k.value,"onUpdate:modelValue":i[1]||(i[1]=t=>k.value=t),options:N.value,optionLabel:"name",optionValue:"id",placeholder:"Catégorie",class:"w-full md:w-40",showClear:""},null,8,["modelValue","options"]),e(o(D),{modelValue:I.value,"onUpdate:modelValue":i[2]||(i[2]=t=>I.value=t),options:u,optionLabel:"label",optionValue:"value",placeholder:"Tendance",class:"w-full md:w-40",showClear:""},null,8,["modelValue"]),e(o(D),{modelValue:d.value,"onUpdate:modelValue":i[3]||(i[3]=t=>d.value=t),options:l,optionLabel:"label",optionValue:"value",placeholder:"Statut",class:"w-full md:w-40",showClear:""},null,8,["modelValue"]),e(o(he),{iconPosition:"left"},{default:r(()=>[e(o(we),null,{default:r(()=>[e(h,{icon:"magnifying-glass"})]),_:1}),e(o(se),{modelValue:b.value,"onUpdate:modelValue":i[4]||(i[4]=t=>b.value=t),placeholder:"Rechercher..."},null,8,["modelValue"])]),_:1})])]),empty:r(()=>[...i[8]||(i[8]=[z(" Aucun indicateur trouvé. ",-1)])]),default:r(()=>[e(o(w),{field:"name",header:"Nom",sortable:"",style:{"min-width":"14rem"}},{body:r(({data:t})=>[s("div",We,v(t.name),1),s("div",Xe,v(t.description),1)]),_:1}),e(o(w),{field:"indicator_category.name",header:"Catégorie",sortable:"",style:{"min-width":"10rem"}},{body:r(({data:t})=>[z(v(t.indicator_category?.name||"-"),1)]),_:1}),e(o(w),{field:"manager",header:"Responsable",style:{"min-width":"12rem"}},{body:r(({data:t})=>[t.manager?(m(),f("div",Ye,[s("div",Ze,v(t.manager.first_name[0])+v(t.manager.last_name[0]),1),s("span",et,v(t.manager.first_name)+" "+v(t.manager.last_name),1)])):(m(),f("span",tt,"-"))]),_:1}),e(o(w),{field:"frequency",header:"Fréquence",sortable:"",style:{"min-width":"10rem"}},{body:r(({data:t})=>[z(v(n(t.frequency)),1)]),_:1}),e(o(w),{field:"target_value",header:"Cible",sortable:"",style:{"min-width":"8rem"}},{body:r(({data:t})=>[z(v(t.target_value)+" "+v(t.unit),1)]),_:1}),e(o(w),{field:"trend_direction",header:"Tendance",sortable:"",style:{"min-width":"10rem"}},{body:r(({data:t})=>[e(o(J),{value:B(t.trend_direction),severity:oe(t.trend_direction,t.goal_type)},{icon:r(()=>[e(h,{icon:ie(t.trend_direction),class:"mr-2"},null,8,["icon"])]),_:2},1032,["value","severity"])]),_:1}),e(o(w),{field:"is_active",header:"Statut",sortable:"",style:{"min-width":"8rem"}},{body:r(({data:t})=>[e(o(J),{value:t.is_active?"Actif":"Inactif",severity:t.is_active?"success":"secondary"},null,8,["value","severity"])]),_:1}),e(o(w),{header:"Actions",exportable:!1,style:{"min-width":"8rem"}},{body:r(({data:t})=>[s("div",st,[R((m(),V(o(g),{text:"",rounded:"",severity:"info",onClick:O=>ae(t.id)},{default:r(()=>[e(h,{icon:"eye"})]),_:1},8,["onClick"])),[[M,"Voir",void 0,{top:!0}]]),R((m(),V(o(g),{text:"",rounded:"",severity:"success",onClick:O=>re(t.id)},{default:r(()=>[e(h,{icon:"pencil"})]),_:1},8,["onClick"])),[[M,"Modifier",void 0,{top:!0}]]),R((m(),V(o(g),{text:"",rounded:"",severity:"danger",onClick:O=>ne(t)},{default:r(()=>[e(h,{icon:"trash"})]),_:1},8,["onClick"])),[[M,"Supprimer",void 0,{top:!0}]])])]),_:1})]),_:1},8,["value","rows","totalRecords","loading"])]),e(De,{visible:c.value,"onUpdate:visible":i[5]||(i[5]=t=>c.value=t)},null,8,["visible"])])}}});export{ht as default};
