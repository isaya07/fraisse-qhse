import{d as N,h,c as p,a as e,b as c,p as v,u as r,v as x,t as i,s as k,o as d,i as A,j as P,H as te,y as se,m as w,r as ae,e as H,F as le,I as ne,w as R,k as j,aJ as I}from"./index-oOuEsLBu.js";import{u as F}from"./equipment-DEhfSx24.js";import{s as oe}from"./index-IzGGsCUm.js";import{s as S}from"./index-CFLhIysZ.js";import{s as E}from"./index-CYWC0yQY.js";import{s as O}from"./index-D25kfrV8.js";import{s as ie}from"./index-D4NNOuL2.js";import{f as C}from"./format-t1Knertl.js";import{u as re}from"./users-CY6PsBvV.js";import{_ as de}from"./EquipmentForm.vue_vue_type_script_setup_true_lang-CoxbsHWl.js";import{a as T}from"./addMonths-oUsRuMvM.js";import"./index-B0RCps1L.js";import"./index-kYhIjE44.js";import"./index-D2qS9a38.js";const ue={class:"maintenance-form"},ce={class:"grid grid-cols-1 gap-4"},me={class:"field"},pe={key:0,class:"text-red-500"},ve={class:"field"},fe={key:0,class:"text-red-500"},be={class:"field"},xe={key:0,class:"text-red-500"},_e={class:"grid grid-cols-2 gap-4"},ye={class:"field"},ge={key:0,class:"text-red-500"},ke={class:"field"},we={class:"field"},he={key:0,class:"text-red-500"},$e={class:"field"},Ve={class:"flex justify-end gap-2 mt-6"},qe=N({__name:"MaintenanceForm",props:{equipmentId:{}},emits:["save","cancel"],setup(L,{emit:$}){const V=L,_=$,s=F(),n=h({type:"periodic_check",date:new Date,description:"",cost:null,performer:"",result:"compliant",next_maintenance_date:null,document_path:""}),l=h({}),f=[{label:"Contrôle Périodique",value:"periodic_check"},{label:"Réparation",value:"repair"},{label:"Calibration",value:"calibration"}],y=[{label:"Conforme",value:"compliant"},{label:"Non Conforme",value:"non_compliant"},{label:"Réparé",value:"fixed"}],q=()=>(l.value={},n.value.type||(l.value.type="Le type est requis"),n.value.date||(l.value.date="La date est requise"),n.value.description||(l.value.description="La description est requise"),n.value.performer||(l.value.performer="L'intervenant est requis"),n.value.result||(l.value.result="Le résultat est requis"),Object.keys(l.value).length===0),D=async()=>{if(!q())return;const b={equipment_id:V.equipmentId,...n.value,type:n.value.type,result:n.value.result,date:C(n.value.date,"yyyy-MM-dd"),next_maintenance_date:n.value.next_maintenance_date?C(n.value.next_maintenance_date,"yyyy-MM-dd"):null};try{await s.createMaintenanceLog(b),_("save")}catch(t){console.error(t)}};return(b,t)=>(d(),p("div",ue,[e("div",ce,[e("div",me,[t[8]||(t[8]=e("label",{for:"type",class:"block text-sm font-medium text-color-secondary mb-1"},"Type d'intervention *",-1)),c(r(S),{id:"type",modelValue:n.value.type,"onUpdate:modelValue":t[0]||(t[0]=m=>n.value.type=m),options:f,optionLabel:"label",optionValue:"value",class:x(["w-full",{"p-invalid":l.value.type}])},null,8,["modelValue","class"]),l.value.type?(d(),p("small",pe,i(l.value.type),1)):v("",!0)]),e("div",ve,[t[9]||(t[9]=e("label",{for:"date",class:"block text-sm font-medium text-color-secondary mb-1"},"Date *",-1)),c(r(E),{id:"date",modelValue:n.value.date,"onUpdate:modelValue":t[1]||(t[1]=m=>n.value.date=m),dateFormat:"dd/mm/yy",class:x(["w-full",{"p-invalid":l.value.date}])},null,8,["modelValue","class"]),l.value.date?(d(),p("small",fe,i(l.value.date),1)):v("",!0)]),e("div",be,[t[10]||(t[10]=e("label",{for:"description",class:"block text-sm font-medium text-color-secondary mb-1"},"Description *",-1)),c(r(O),{id:"description",modelValue:n.value.description,"onUpdate:modelValue":t[2]||(t[2]=m=>n.value.description=m),rows:"3",class:x(["w-full",{"p-invalid":l.value.description}])},null,8,["modelValue","class"]),l.value.description?(d(),p("small",xe,i(l.value.description),1)):v("",!0)]),e("div",_e,[e("div",ye,[t[11]||(t[11]=e("label",{for:"performer",class:"block text-sm font-medium text-color-secondary mb-1"},"Intervenant *",-1)),c(r(oe),{id:"performer",modelValue:n.value.performer,"onUpdate:modelValue":t[3]||(t[3]=m=>n.value.performer=m),class:x(["w-full",{"p-invalid":l.value.performer}])},null,8,["modelValue","class"]),l.value.performer?(d(),p("small",ge,i(l.value.performer),1)):v("",!0)]),e("div",ke,[t[12]||(t[12]=e("label",{for:"cost",class:"block text-sm font-medium text-color-secondary mb-1"},"Coût (€)",-1)),c(r(ie),{id:"cost",modelValue:n.value.cost,"onUpdate:modelValue":t[4]||(t[4]=m=>n.value.cost=m),mode:"currency",currency:"EUR",locale:"fr-FR",class:"w-full"},null,8,["modelValue"])])]),e("div",we,[t[13]||(t[13]=e("label",{for:"result",class:"block text-sm font-medium text-color-secondary mb-1"},"Résultat *",-1)),c(r(S),{id:"result",modelValue:n.value.result,"onUpdate:modelValue":t[5]||(t[5]=m=>n.value.result=m),options:y,optionLabel:"label",optionValue:"value",class:x(["w-full",{"p-invalid":l.value.result}])},null,8,["modelValue","class"]),l.value.result?(d(),p("small",he,i(l.value.result),1)):v("",!0)]),e("div",$e,[t[14]||(t[14]=e("label",{for:"next_maintenance_date",class:"block text-sm font-medium text-color-secondary mb-1"},"Prochaine maintenance",-1)),c(r(E),{id:"next_maintenance_date",modelValue:n.value.next_maintenance_date,"onUpdate:modelValue":t[6]||(t[6]=m=>n.value.next_maintenance_date=m),dateFormat:"dd/mm/yy",class:"w-full"},null,8,["modelValue"])])]),e("div",Ve,[c(r(k),{label:"Annuler",icon:"pi pi-times",severity:"secondary",text:"",onClick:t[7]||(t[7]=m=>b.$emit("cancel"))}),c(r(k),{label:"Enregistrer",icon:"pi pi-check",onClick:D,loading:r(s).loading},null,8,["loading"])])]))}}),De={class:"assignment-form"},Ce={class:"grid grid-cols-1 gap-4"},Le={class:"field"},Me={key:0,class:"text-red-500"},Ue={class:"field"},Re={key:0,class:"text-red-500"},je={class:"field"},Ae={class:"flex justify-end gap-2 mt-6"},Se=N({__name:"AssignmentForm",props:{equipmentId:{}},emits:["save","cancel"],setup(L,{emit:$}){const V=L,_=$,s=F(),n=re(),l=h({user_id:null,assigned_at:new Date,notes:""}),f=h({}),y=A(()=>n.users.map(b=>({...b,fullname:`${b.first_name} ${b.last_name}`})));P(async()=>{n.users.length===0&&await n.fetchUsers()});const q=()=>(f.value={},l.value.user_id||(f.value.user_id="L'utilisateur est requis"),l.value.assigned_at||(f.value.assigned_at="La date est requise"),Object.keys(f.value).length===0),D=async()=>{if(!q())return;const b={user_id:l.value.user_id,assigned_at:C(l.value.assigned_at,"yyyy-MM-dd HH:mm:ss"),notes:l.value.notes};try{await s.assignEquipment(V.equipmentId,b),_("save")}catch(t){console.error(t)}};return(b,t)=>(d(),p("div",De,[e("div",Ce,[e("div",Le,[t[4]||(t[4]=e("label",{for:"user",class:"block text-sm font-medium text-color-secondary mb-1"},"Utilisateur *",-1)),c(r(S),{id:"user",modelValue:l.value.user_id,"onUpdate:modelValue":t[0]||(t[0]=m=>l.value.user_id=m),options:y.value,optionLabel:"fullname",optionValue:"id",placeholder:"Sélectionner un utilisateur",class:x(["w-full",{"p-invalid":f.value.user_id}]),filter:""},null,8,["modelValue","options","class"]),f.value.user_id?(d(),p("small",Me,i(f.value.user_id),1)):v("",!0)]),e("div",Ue,[t[5]||(t[5]=e("label",{for:"assigned_at",class:"block text-sm font-medium text-color-secondary mb-1"},"Date d'affectation *",-1)),c(r(E),{id:"assigned_at",modelValue:l.value.assigned_at,"onUpdate:modelValue":t[1]||(t[1]=m=>l.value.assigned_at=m),showTime:"",dateFormat:"dd/mm/yy",class:x(["w-full",{"p-invalid":f.value.assigned_at}])},null,8,["modelValue","class"]),f.value.assigned_at?(d(),p("small",Re,i(f.value.assigned_at),1)):v("",!0)]),e("div",je,[t[6]||(t[6]=e("label",{for:"notes",class:"block text-sm font-medium text-color-secondary mb-1"},"Notes",-1)),c(r(O),{id:"notes",modelValue:l.value.notes,"onUpdate:modelValue":t[2]||(t[2]=m=>l.value.notes=m),rows:"3",class:"w-full"},null,8,["modelValue"])])]),e("div",Ae,[c(r(k),{label:"Annuler",icon:"pi pi-times",severity:"secondary",text:"",onClick:t[3]||(t[3]=m=>b.$emit("cancel"))}),c(r(k),{label:"Affecter",icon:"pi pi-check",onClick:D,loading:r(s).loading},null,8,["loading"])])]))}}),Ee={key:0,class:"p-4"},Ne={class:"flex flex-col md:flex-row md:items-center md:justify-between mb-6"},Fe={class:"flex items-center gap-4"},Be={class:"text-2xl font-bold text-color"},He={class:"text-color-secondary"},Ie={class:"flex gap-2 mt-4 md:mt-0"},Te={class:"grid grid-cols-1 lg:grid-cols-3 gap-6"},Pe={class:"lg:col-span-1 space-y-6"},Oe={class:"surface-card rounded-lg shadow p-6"},ze={class:"flex justify-between items-start mb-4"},Je={key:0,class:"mb-6 rounded-lg overflow-hidden h-48 bg-surface-100 dark:bg-surface-800"},Ge=["src"],Ke={class:"space-y-4"},Qe={class:"text-color font-mono"},We={class:"text-color"},Xe={class:"flex items-center gap-2"},Ye={class:"text-color"},Ze={class:"font-medium text-color"},et={class:"text-color"},tt={key:0},st={key:0,class:"surface-card rounded-lg shadow p-6 border-l-4 border-blue-500"},at={class:"flex items-center gap-4 mb-4"},lt={class:"w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center text-blue-600 text-xl"},nt={class:"font-bold text-color"},ot={class:"text-sm text-color-secondary"},it={key:0,class:"bg-surface-100 dark:bg-surface-800 p-3 rounded text-sm text-color-secondary italic"},rt={class:"lg:col-span-2 space-y-6"},dt={class:"surface-card rounded-lg shadow p-6"},ut={class:"flex justify-between items-center mb-4"},ct={key:0,class:"text-center py-8 text-color-secondary"},mt={key:1,class:"space-y-4"},pt={class:"flex justify-between items-start mb-2"},vt={class:"flex items-center gap-2"},ft={class:"text-sm text-color-secondary"},bt={class:"text-color mb-2"},xt={class:"flex justify-between items-center text-sm text-color-secondary"},_t={key:0},yt={key:1,class:"flex justify-center py-12"},At=N({__name:"EquipmentDetail",setup(L){const $=te(),V=se(),_=F(),s=A(()=>_.currentEquipment),n=h(!1),l=h(!1),f=h(!1),y=A(()=>{if(!s.value)return null;const o=_.maintenanceLogs;if(o&&o.length>0){const g=[...o].sort((u,ee)=>new Date(ee.date).getTime()-new Date(u.date).getTime())[0];if(g){if(g.next_maintenance_date)return new Date(g.next_maintenance_date);if(s.value.maintenance_frequency_months){const u=new Date(g.date);return T(u,s.value.maintenance_frequency_months)}}}if(s.value.purchase_date&&s.value.maintenance_frequency_months){const a=new Date(s.value.purchase_date);return T(a,s.value.maintenance_frequency_months)}return null}),q=o=>{switch(o){case"available":return"bg-green-100 text-green-700";case"assigned":return"bg-blue-100 text-blue-700";case"maintenance":return"bg-orange-100 text-orange-700";case"broken":return"bg-red-100 text-red-700";case"retired":return"bg-gray-100 text-gray-700";default:return"bg-gray-100 text-gray-700"}},D=o=>({available:"Disponible",assigned:"Affecté",maintenance:"En Maintenance",broken:"Hors Service",retired:"Rebuté"})[o]||o,b=o=>({warehouse:"Magasin",workshop:"Atelier",office:"Bureau",vehicle:"Véhicule",site:"Chantier"})[o]||o,t=o=>{switch(o){case"periodic_check":return"bg-blue-100 text-blue-700";case"repair":return"bg-orange-100 text-orange-700";case"calibration":return"bg-purple-100 text-purple-700";default:return"bg-gray-100 text-gray-700"}},m=o=>({periodic_check:"Contrôle Périodique",repair:"Réparation",calibration:"Calibration"})[o]||o,z=o=>{switch(o){case"compliant":return"bg-green-100 text-green-700";case"non_compliant":return"bg-red-100 text-red-700";case"fixed":return"bg-blue-100 text-blue-700";default:return"bg-gray-100 text-gray-700"}},J=o=>({compliant:"Conforme",non_compliant:"Non Conforme",fixed:"Réparé"})[o]||o,M=o=>C(new Date(o),"dd MMMM yyyy",{locale:I}),G=o=>C(new Date(o),"dd/MM/yyyy HH:mm",{locale:I}),U=o=>new Date(o)<=new Date,K=()=>{f.value=!0},Q=()=>{l.value=!0},W=()=>{},B=()=>{n.value=!0},X=()=>{n.value=!1},Y=()=>{l.value=!1},Z=()=>{f.value=!1};return P(async()=>{const o=Number($.params.id);o&&(await _.fetchEquipmentDetail(o),await _.fetchMaintenanceLogs(o))}),(o,a)=>{const g=ae("font-awesome-icon");return s.value?(d(),p("div",Ee,[e("div",Ne,[e("div",Fe,[c(r(k),{icon:"pi pi-arrow-left",text:"",rounded:"",onClick:a[0]||(a[0]=u=>r(V).back())}),e("div",null,[e("h1",Be,i(s.value.name),1),e("p",He,i(s.value.category?.name)+" • "+i(s.value.brand)+" "+i(s.value.model),1)])]),e("div",Ie,[c(r(k),{label:"Modifier",icon:"pi pi-pencil",severity:"secondary",outlined:"",onClick:K}),s.value.status==="available"?(d(),w(r(k),{key:0,label:"Affecter",icon:"pi pi-user-plus",onClick:Q})):v("",!0),s.value.status==="assigned"?(d(),w(r(k),{key:1,label:"Retourner",icon:"pi pi-replay",severity:"warning",onClick:W})):v("",!0),c(r(k),{label:"Maintenance",icon:"pi pi-wrench",severity:"help",onClick:B})])]),e("div",Te,[e("div",Pe,[e("div",Oe,[e("div",ze,[a[7]||(a[7]=e("h2",{class:"text-lg font-semibold text-color"},"Informations",-1)),e("span",{class:x(["px-2 py-1 rounded text-xs font-bold",q(s.value.status)])},i(D(s.value.status)),3)]),s.value.image_path?(d(),p("div",Je,[e("img",{src:s.value.image_path,class:"w-full h-full object-cover"},null,8,Ge)])):v("",!0),e("div",Ke,[e("div",null,[a[8]||(a[8]=e("label",{class:"text-xs font-bold text-color-secondary uppercase"},"Numéro de série",-1)),e("p",Qe,i(s.value.serial_number),1)]),e("div",null,[a[9]||(a[9]=e("label",{class:"text-xs font-bold text-color-secondary uppercase"},"Référence Interne",-1)),e("p",We,i(s.value.internal_ref||"-"),1)]),e("div",null,[a[10]||(a[10]=e("label",{class:"text-xs font-bold text-color-secondary uppercase"},"Localisation",-1)),e("div",Xe,[c(g,{icon:"map-marker-alt",class:"text-color-secondary"}),e("p",Ye,i(b(s.value.location)),1)])]),e("div",null,[a[11]||(a[11]=e("label",{class:"text-xs font-bold text-color-secondary uppercase"},"Fréquence de contrôle",-1)),e("p",Ze,i(s.value.maintenance_frequency_months?`${s.value.maintenance_frequency_months} mois`:"Non défini"),1)]),e("div",null,[a[12]||(a[12]=e("label",{class:"text-xs font-bold text-color-secondary uppercase"},"Prochaine vérification",-1)),e("p",{class:x(["font-medium",y.value&&U(y.value)?"text-red-600":"text-color"])},[H(i(y.value?M(y.value):"Non planifiée")+" ",1),y.value&&U(y.value)?(d(),w(g,{key:0,icon:"exclamation-triangle",class:"ml-2"})):v("",!0)],2)]),e("div",null,[a[13]||(a[13]=e("label",{class:"text-xs font-bold text-color-secondary uppercase"},"Date d'achat",-1)),e("p",et,i(M(s.value.purchase_date)),1)]),s.value.expiration_date?(d(),p("div",tt,[a[14]||(a[14]=e("label",{class:"text-xs font-bold text-color-secondary uppercase"},"Date d'expiration",-1)),e("p",{class:x(["font-medium",U(s.value.expiration_date)?"text-red-600":"text-color"])},[H(i(M(s.value.expiration_date))+" ",1),U(s.value.expiration_date)?(d(),w(g,{key:0,icon:"exclamation-triangle",class:"ml-2"})):v("",!0)],2)])):v("",!0)])]),s.value.current_assignment?(d(),p("div",st,[a[15]||(a[15]=e("h2",{class:"text-lg font-semibold text-color mb-4"},"Affectation en cours",-1)),e("div",at,[e("div",lt,[c(g,{icon:"user"})]),e("div",null,[e("p",nt,i(s.value.current_assignment.user?.first_name)+" "+i(s.value.current_assignment.user?.last_name),1),e("p",ot," Depuis le "+i(G(s.value.current_assignment.assigned_at)),1)])]),s.value.current_assignment.notes?(d(),p("div",it,' "'+i(s.value.current_assignment.notes)+'" ',1)):v("",!0)])):v("",!0)]),e("div",rt,[e("div",dt,[e("div",ut,[a[16]||(a[16]=e("h2",{class:"text-lg font-semibold text-color"},"Historique de Maintenance",-1)),c(r(k),{label:"Ajouter",icon:"pi pi-plus",size:"small",text:"",onClick:B})]),r(_).maintenanceLogs.length===0?(d(),p("div",ct,[...a[17]||(a[17]=[e("p",null,"Aucune maintenance enregistrée",-1)])])):(d(),p("div",mt,[(d(!0),p(le,null,ne(r(_).maintenanceLogs,u=>(d(),p("div",{key:u.id,class:"border-b border-surface-border last:border-0 pb-4 last:pb-0"},[e("div",pt,[e("div",vt,[e("span",{class:x(["px-2 py-0.5 rounded text-xs font-bold uppercase",t(u.type)])},i(m(u.type)),3),e("span",ft,i(M(u.date)),1)]),e("span",{class:x(["text-xs px-2 py-1 rounded font-medium",z(u.result)])},i(J(u.result)),3)]),e("p",bt,i(u.description),1),e("div",xt,[e("span",null,"Par: "+i(u.performer),1),u.cost?(d(),p("span",_t,i(u.cost)+" €",1)):v("",!0)])]))),128))]))]),a[18]||(a[18]=e("div",{class:"surface-card rounded-lg shadow p-6"},[e("h2",{class:"text-lg font-semibold text-color mb-4"},"Historique des Affectations"),e("p",{class:"text-color-secondary italic"},"Fonctionnalité à venir...")],-1))])]),c(r(j),{visible:n.value,"onUpdate:visible":a[2]||(a[2]=u=>n.value=u),header:"Nouvelle Maintenance",modal:!0,class:"p-fluid w-full max-w-lg"},{default:R(()=>[s.value?(d(),w(qe,{key:0,"equipment-id":s.value.id,onSave:X,onCancel:a[1]||(a[1]=u=>n.value=!1)},null,8,["equipment-id"])):v("",!0)]),_:1},8,["visible"]),c(r(j),{visible:l.value,"onUpdate:visible":a[4]||(a[4]=u=>l.value=u),header:"Affecter l'équipement",modal:!0,class:"p-fluid w-full max-w-lg"},{default:R(()=>[s.value?(d(),w(Se,{key:0,"equipment-id":s.value.id,onSave:Y,onCancel:a[3]||(a[3]=u=>l.value=!1)},null,8,["equipment-id"])):v("",!0)]),_:1},8,["visible"]),c(r(j),{visible:f.value,"onUpdate:visible":a[6]||(a[6]=u=>f.value=u),header:"Modifier l'équipement",modal:!0,class:"p-fluid w-full max-w-2xl"},{default:R(()=>[s.value?(d(),w(de,{key:0,equipment:s.value,onSave:Z,onCancel:a[5]||(a[5]=u=>f.value=!1)},null,8,["equipment"])):v("",!0)]),_:1},8,["visible"])])):(d(),p("div",yt,[c(g,{icon:["fas","spinner"],spin:"",size:"2x",class:"text-color-secondary"})]))}}});export{At as default};
