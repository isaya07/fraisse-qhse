import{d as B,g as I,i as L,H as M,h as N,j as R,c as q,a as s,b as a,t as o,u as e,s as U,w as i,y as A,m,p as c,e as p,o as u}from"./index-oOuEsLBu.js";import{u as D}from"./users-CY6PsBvV.js";import{h as F,s as O,a as f,b as T}from"./index-B7S3eAql.js";import{s as x}from"./index-IzGGsCUm.js";import{s as H}from"./index-CFLhIysZ.js";import{a as P}from"./index-C1JXx-aU.js";import{s as v}from"./index-DGkmfP6q.js";import{o as G,s as y,b as J,_ as K}from"./schemas-C8kxHR-7.js";import"./index-B0RCps1L.js";import"./index-kYhIjE44.js";const Q={class:"p-4"},W={class:"flex flex-col md:flex-row md:items-center md:justify-between mb-6"},X={class:"text-2xl font-bold text-color mb-4 md:mb-0"},Y={class:"card surface-card p-4 border-round shadow-2 max-w-2xl mx-auto"},Z={class:"flex flex-col gap-6"},$={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},ee={class:"flex flex-col gap-2"},se={class:"flex flex-col gap-2"},ae={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},re={class:"flex flex-col gap-2"},te={class:"flex flex-col gap-2"},ie={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},le={class:"flex flex-col gap-2"},oe={class:"flex items-center gap-2 h-full pt-2"},ne={class:"flex flex-col gap-2"},ue={for:"password"},de={class:"flex justify-end gap-2 mt-4"},he=B({__name:"UserEdit",setup(me){const w=A(),h=M(),l=D(),b=I(),_=L(()=>h.params.id!==void 0),d=N(!1),V=[{label:"Administrateur",value:"admin"},{label:"Manager",value:"manager"},{label:"Utilisateur",value:"user"},{label:"Observateur",value:"viewer"}],k=N({username:"",email:"",first_name:"",last_name:"",role:"user",is_active:!0,password:""}),C=G({username:y().min(3,"Le nom d'utilisateur doit contenir au moins 3 caractères"),email:y().email("Format d'email invalide"),first_name:y().min(2,"Le prénom est requis"),last_name:y().min(2,"Le nom est requis"),role:K(["admin","manager","user","viewer"]),is_active:J().optional(),password:y().optional()}).refine(n=>!(!_.value&&(!n.password||n.password.length<6)),{message:"Le mot de passe est requis (min 6 caractères)",path:["password"]}),S=F(C),j=async()=>{if(_.value){const n=parseInt(h.params.id);d.value=!0;try{await l.fetchUserById(n),l.currentUser&&(k.value={username:l.currentUser.username,email:l.currentUser.email,first_name:l.currentUser.first_name,last_name:l.currentUser.last_name,role:l.currentUser.role,is_active:l.currentUser.is_active??!1,password:""})}catch{b.add({severity:"error",summary:"Erreur",detail:"Erreur lors de la mise à jour de l'utilisateur",life:3e3,icon:"times"}),w.push("/users")}finally{d.value=!1}}},z=async({valid:n,values:t})=>{if(n){d.value=!0;try{if(_.value){const r=parseInt(h.params.id),g={...t};g.password||delete g.password,await l.updateUser(r,g),b.add({severity:"success",summary:"Succès",detail:"Utilisateur mis à jour avec succès",life:3e3,icon:"check"})}else await l.createUser(t),b.add({severity:"success",summary:"Succès",detail:"Utilisateur créé"});w.push("/users")}catch(r){const g=r.message||"Une erreur est survenue";b.add({severity:"error",summary:"Erreur",detail:g})}finally{d.value=!1}}},E=()=>{w.push("/users")};return R(()=>{j()}),(n,t)=>(u(),q("div",Q,[s("div",W,[s("h1",X,o(_.value?"Modifier l'utilisateur":"Nouvel utilisateur"),1),a(e(U),{label:"Retour à la liste",icon:"pi pi-arrow-left",onClick:E,severity:"secondary",outlined:""})]),s("div",Y,[a(e(O),{resolver:e(S),onSubmit:z,initialValues:k.value},{default:i(r=>[s("div",Z,[s("div",$,[s("div",ee,[a(e(f),{variant:"on"},{default:i(()=>[a(e(x),{name:"username",id:"username",type:"text",class:"w-full",fluid:""}),t[0]||(t[0]=s("label",{for:"username"},"Nom d'utilisateur",-1))]),_:1}),r.username?.invalid?(u(),m(e(v),{key:0,severity:"error",size:"small",variant:"simple"},{default:i(()=>[p(o(r.username.error.message),1)]),_:2},1024)):c("",!0)]),s("div",se,[a(e(f),{variant:"on"},{default:i(()=>[a(e(x),{name:"email",id:"email",type:"email",class:"w-full",fluid:""}),t[1]||(t[1]=s("label",{for:"email"},"Email",-1))]),_:1}),r.email?.invalid?(u(),m(e(v),{key:0,severity:"error",size:"small",variant:"simple"},{default:i(()=>[p(o(r.email.error.message),1)]),_:2},1024)):c("",!0)])]),s("div",ae,[s("div",re,[a(e(f),{variant:"on"},{default:i(()=>[a(e(x),{name:"first_name",id:"first_name",type:"text",class:"w-full",fluid:""}),t[2]||(t[2]=s("label",{for:"first_name"},"Prénom",-1))]),_:1}),r.first_name?.invalid?(u(),m(e(v),{key:0,severity:"error",size:"small",variant:"simple"},{default:i(()=>[p(o(r.first_name.error.message),1)]),_:2},1024)):c("",!0)]),s("div",te,[a(e(f),{variant:"on"},{default:i(()=>[a(e(x),{name:"last_name",id:"last_name",type:"text",class:"w-full",fluid:""}),t[3]||(t[3]=s("label",{for:"last_name"},"Nom",-1))]),_:1}),r.last_name?.invalid?(u(),m(e(v),{key:0,severity:"error",size:"small",variant:"simple"},{default:i(()=>[p(o(r.last_name.error.message),1)]),_:2},1024)):c("",!0)])]),s("div",ie,[s("div",le,[a(e(f),{variant:"on"},{default:i(()=>[a(e(H),{name:"role",inputId:"role",options:V,optionLabel:"label",optionValue:"value",class:"w-full",fluid:""}),t[4]||(t[4]=s("label",{for:"role"},"Rôle",-1))]),_:1}),r.role?.invalid?(u(),m(e(v),{key:0,severity:"error",size:"small",variant:"simple"},{default:i(()=>[p(o(r.role.error.message),1)]),_:2},1024)):c("",!0)]),s("div",oe,[a(e(P),{name:"is_active",inputId:"is_active",binary:!0}),t[5]||(t[5]=s("label",{for:"is_active",class:"cursor-pointer"},"Compte actif",-1))])]),s("div",ne,[a(e(f),{variant:"on"},{default:i(()=>[a(e(T),{name:"password",inputId:"password",toggleMask:!0,class:"w-full",inputClass:"w-full",fluid:""}),s("label",ue,o(_.value?"Nouveau mot de passe (laisser vide pour ne pas changer)":"Mot de passe"),1)]),_:1}),r.password?.invalid?(u(),m(e(v),{key:0,severity:"error",size:"small",variant:"simple"},{default:i(()=>[p(o(r.password.error.message),1)]),_:2},1024)):c("",!0)]),s("div",de,[a(e(U),{label:"Annuler",severity:"secondary",text:"",onClick:E,disabled:d.value},null,8,["disabled"]),a(e(U),{type:"submit",label:"Enregistrer",icon:"pi pi-check",loading:d.value},null,8,["loading"])])])]),_:1},8,["resolver","initialValues"])])]))}});export{he as default};
