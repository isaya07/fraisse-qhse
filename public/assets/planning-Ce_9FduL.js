import{D as c,E as r}from"./index-oOuEsLBu.js";const h=c("planning",{state:()=>({events:[],visits:[],talks:[],loading:!1,error:null}),actions:{async fetchEvents(a,t){this.loading=!0;try{const{get:s}=r();let e="/planning/events";const i=new URLSearchParams;a&&i.append("start",a),t&&i.append("end",t);const n=i.toString();n&&(e+=`?${n}`);const o=await s(e);if(o.success&&o.data){const l=o.data;this.events=l.data||l}}catch(s){this.error="Failed to fetch events",console.error(s)}finally{this.loading=!1}},async fetchVisits(){this.loading=!0;try{const{get:a}=r(),t=await a("/safety-visits");if(t.success&&t.data){const s=t.data;this.visits=s.data||s}}catch(a){this.error="Failed to fetch visits",console.error(a)}finally{this.loading=!1}},async createVisit(a){this.loading=!0;try{const{post:t}=r(),s=await t("/safety-visits",a);if(s.success&&s.data){const e=s.data,i=e.data||e;return this.visits.unshift(i),i}}catch(t){throw this.error="Failed to create visit",t}finally{this.loading=!1}},async updateVisit(a,t){this.loading=!0;try{const{put:s}=r(),e=await s(`/safety-visits/${a}`,t);if(e.success&&e.data){const i=e.data,n=i.data||i,o=this.visits.findIndex(l=>l.id===a);return o!==-1&&(this.visits[o]=n),n}}catch(s){throw this.error="Failed to update visit",s}finally{this.loading=!1}},async deleteVisit(a){this.loading=!0;try{const{del:t}=r();(await t(`/safety-visits/${a}`)).success&&(this.visits=this.visits.filter(e=>e.id!==a))}catch(t){throw this.error="Failed to delete visit",t}finally{this.loading=!1}},async fetchTalks(){this.loading=!0;try{const{get:a}=r(),t=await a("/toolbox-talks");if(t.success&&t.data){const s=t.data;this.talks=s.data||s}}catch(a){this.error="Failed to fetch talks",console.error(a)}finally{this.loading=!1}},async createTalk(a){this.loading=!0;try{const{post:t}=r(),s=await t("/toolbox-talks",a);if(s.success&&s.data){const e=s.data,i=e.data||e;return this.talks.unshift(i),i}}catch(t){throw this.error="Failed to create talk",t}finally{this.loading=!1}},async updateTalk(a,t){this.loading=!0;try{const{put:s}=r(),e=await s(`/toolbox-talks/${a}`,t);if(e.success&&e.data){const i=e.data,n=i.data||i,o=this.talks.findIndex(l=>l.id===a);return o!==-1&&(this.talks[o]=n),n}}catch(s){throw this.error="Failed to update talk",s}finally{this.loading=!1}},async deleteTalk(a){this.loading=!0;try{const{del:t}=r();(await t(`/toolbox-talks/${a}`)).success&&(this.talks=this.talks.filter(e=>e.id!==a))}catch(t){throw this.error="Failed to delete talk",t}finally{this.loading=!1}}}});export{h as u};
