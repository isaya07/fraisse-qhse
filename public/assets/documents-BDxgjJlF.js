import{D as d,E as a,ap as l}from"./index-oOuEsLBu.js";const h=d("document",{state:()=>({documents:[],currentDocument:null,loading:!1,error:null,pagination:{page:1,limit:10,total:0,totalPages:1}}),getters:{documentById:t=>e=>t.documents.find(r=>r.id===e)},actions:{async fetchDocuments(t=1,e=10,r={}){this.loading=!0,this.error=null;try{const{get:o}=a(),n=new URLSearchParams({page:t.toString(),limit:e.toString()});Object.entries(r).forEach(([i,c])=>{c!=null&&c!==""&&n.append(i,String(c))});const s=await o(`/documents?${n.toString()}`);s.success&&s.data?l(s.data)?(this.documents=s.data.data||[],this.pagination={...this.pagination,page:s.data.current_page||t,limit:s.data.per_page||e,total:s.data.total||this.documents.length,totalPages:s.data.last_page||1}):(this.documents=Array.isArray(s.data)?s.data:[s.data],this.pagination={...this.pagination,page:t,limit:e,total:this.documents.length,totalPages:Math.ceil(this.documents.length/e)}):this.error=s.error||"Failed to fetch documents"}catch(o){this.error="An error occurred while fetching documents",console.error(o)}finally{this.loading=!1}},async fetchDocumentById(t){this.loading=!0,this.error=null;try{const{get:e}=a(),r=await e(`/documents/${t}`);r.success&&r.data?this.currentDocument=r.data:this.error=r.error||"Failed to fetch document"}catch(e){this.error="An error occurred while fetching document",console.error(e)}finally{this.loading=!1}},async createDocument(t){this.loading=!0,this.error=null;try{const{post:e}=a(),r=await e("/documents",t);if(r.success&&r.data)this.documents.unshift(r.data),this.currentDocument=r.data;else throw this.error=r.error||"Failed to create document",new Error(this.error)}catch(e){throw this.error="An error occurred while creating document",console.error(e),e}finally{this.loading=!1}},async updateDocument(t,e){this.loading=!0,this.error=null;try{const{put:r,post:o}=a();let n;if(e instanceof FormData?n=await o(`/documents/${t}`,e):n=await r(`/documents/${t}`,e),n.success&&n.data){const s=this.documents.findIndex(i=>i.id===t);s!==-1&&(this.documents[s]=n.data),this.currentDocument=n.data}else throw this.error=n.error||"Failed to update document",new Error(this.error)}catch(r){throw this.error="An error occurred while updating document",console.error(r),r}finally{this.loading=!1}},async deleteDocument(t){this.loading=!0,this.error=null;try{const{del:e}=a(),r=await e(`/documents/${t}`);if(r.success)this.documents=this.documents.filter(o=>o.id!==t),this.currentDocument?.id===t&&(this.currentDocument=null);else throw this.error=r.error||"Failed to delete document",new Error(this.error)}catch(e){throw this.error="An error occurred while deleting document",console.error(e),e}finally{this.loading=!1}},async requestApproval(t){this.loading=!0,this.error=null;try{const{post:e}=a(),r=await e(`/documents/${t}/request-approval`,{});if(r.success&&r.data){this.currentDocument=r.data;const o=this.documents.findIndex(n=>n.id===t);o!==-1&&(this.documents[o]=r.data)}else throw this.error=r.error||"Failed to request approval",new Error(this.error)}catch(e){throw this.error="An error occurred while requesting approval",console.error(e),e}finally{this.loading=!1}},async approveDocument(t){this.loading=!0,this.error=null;try{const{post:e}=a(),r=await e(`/documents/${t}/approve`,{});if(r.success&&r.data){this.currentDocument=r.data;const o=this.documents.findIndex(n=>n.id===t);o!==-1&&(this.documents[o]=r.data)}else throw this.error=r.error||"Failed to approve document",new Error(this.error)}catch(e){throw this.error="An error occurred while approving document",console.error(e),e}finally{this.loading=!1}},async rejectDocument(t){this.loading=!0,this.error=null;try{const{post:e}=a(),r=await e(`/documents/${t}/reject`,{});if(r.success&&r.data){this.currentDocument=r.data;const o=this.documents.findIndex(n=>n.id===t);o!==-1&&(this.documents[o]=r.data)}else throw this.error=r.error||"Failed to reject document",new Error(this.error)}catch(e){throw this.error="An error occurred while rejecting document",console.error(e),e}finally{this.loading=!1}},async downloadDocument(t,e){try{const{get:r}=a(),o=await r(`/documents/${t}/download`,{responseType:"blob"});if(o.success&&o.data){const n=window.URL.createObjectURL(new Blob([o.data])),s=document.createElement("a");s.href=n,s.setAttribute("download",e),document.body.appendChild(s),s.click(),document.body.removeChild(s),window.URL.revokeObjectURL(n)}else throw console.log(o),new Error(o.error||"Failed to download document")}catch(r){throw console.error("Download error:",r),r}},async fetchVersions(t){try{const{get:e}=a(),r=await e(`/documents/${t}/versions`);return r.success&&r.data?r.data:[]}catch(e){return console.error("Error fetching versions:",e),[]}},async addVersion(t,e){this.loading=!0,this.error=null;try{const{post:r}=a(),o=await r(`/documents/${t}/versions`,e);if(o.success&&o.data){this.currentDocument=o.data;const n=this.documents.findIndex(s=>s.id===t);return n!==-1&&(this.documents[n]=o.data),o.data}else throw new Error(o.error||"Failed to add version")}catch(r){throw this.error="An error occurred while adding version",console.error(r),r}finally{this.loading=!1}}}});export{h as u};
