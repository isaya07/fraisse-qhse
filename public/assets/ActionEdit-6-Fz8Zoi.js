import{s as w}from"./index-DK5WICtn.js";import{d as b,g as j,h as n,j as E,i as B,c,a as s,m as C,b as l,w as y,u as D,s as N,r as S,t as I,H as M,y as R,o as r}from"./index-d7axL_xv.js";import{u as T}from"./index-BjfdDptO.js";import{_ as V}from"./ActionForm.vue_vue_type_script_setup_true_lang-DlGXVR66.js";import"./index-DZQqA5uS.js";import"./index-C4Jjik4c.js";import"./index-xoP2DrFw.js";import"./index-D_33rlMc.js";import"./index-BrM16FOF.js";import"./index-BJVb_8vX.js";import"./index-rhSU9nKe.js";import"./actionTypes-DJoqH7I9.js";import"./users-CbvhcKd8.js";import"./schemas-C8kxHR-7.js";const $={class:"p-4"},z={class:"flex flex-col md:flex-row md:items-center md:justify-between mb-2 gap-4"},H={class:"flex items-center gap-4"},L={key:0,class:"flex justify-center items-center py-12"},q={key:1,class:"flex justify-center items-center py-12"},F={key:2,class:"flex justify-center items-center py-12"},G={class:"text-lg text-red-600"},re=b({__name:"ActionEdit",setup(J){const d=R(),_=M(),a=T(),f=j(),v=n({title:"",description:"",action_type_id:null,priority:"",status:"open",assigned_to:null,due_date:null,progress:0,related_to:"",related_id:null}),u=n(!1),p=n(!1),t=n(""),g=async()=>{const o=parseInt(_.params.id);if(isNaN(o)){t.value="ID d'action invalide";return}u.value=!0,t.value="";try{await a.fetchActionById(o);const e=a.currentAction;e?v.value={title:e.title,description:e.description||"",action_type_id:e.action_type_id||e.action_type?.id||null,priority:e.priority,status:e.status,assigned_to:e.assigned_to||null,due_date:e.due_date||null,progress:e.progress,related_to:e.related_to||"",related_id:e.related_id||null}:t.value="Action non trouvée"}catch(e){console.error("Erreur lors du chargement de l'action:",e),t.value="Erreur lors du chargement de l'action"}finally{u.value=!1}},x=async o=>{const e=parseInt(_.params.id);if(isNaN(e)){t.value="ID d'action invalide";return}p.value=!0,t.value="";try{await a.updateAction(e,{...o,assigned_to:o.assigned_to||void 0,related_id:o.related_id||void 0,due_date:o.due_date||void 0}),f.add({severity:"success",summary:"Succès",detail:"Action mise à jour avec succès",life:3e3}),d.push("/actions")}catch(i){const m=i.message||"Erreur lors de la mise à jour de l'action";console.error(m),f.add({severity:"error",summary:"Erreur",detail:"Erreur lors de la mise à jour de l'action",life:3e3}),console.error(i)}finally{p.value=!1}},h=()=>d.push("/actions"),A=()=>d.back();E(()=>{g()});const k=B(()=>a.currentAction);return(o,e)=>{const i=S("font-awesome-icon"),m=w;return r(),c("div",$,[s("div",z,[s("div",H,[l(D(N),{text:"",rounded:"",severity:"secondary",onClick:A},{icon:y(()=>[l(i,{icon:"arrow-left"})]),_:1}),e[0]||(e[0]=s("div",null,[s("div",{class:"flex items-center gap-3"},[s("h2",{class:"text-color"},"Modifier l'action")])],-1))])]),u.value?(r(),c("div",L,[l(i,{icon:["fas","spinner"],spin:"",size:"2x",class:"text-color-secondary"})])):!k.value&&!t.value?(r(),c("div",q,[...e[1]||(e[1]=[s("p",{class:"text-lg text-color-secondary"},"Action non trouvée",-1)])])):t.value?(r(),c("div",F,[s("p",G,I(t.value),1)])):(r(),C(m,{key:3},{content:y(()=>[l(V,{initialData:v.value,submitButtonText:"Enregistrer les modifications",loading:p.value,onSubmit:x,onCancel:h},null,8,["initialData","loading"])]),_:1}))])}}});export{re as default};
