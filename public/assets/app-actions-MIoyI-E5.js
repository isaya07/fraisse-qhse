import{s as ot,a as L,b as ae,c as rt,d as ee,e as Oe,f as ke,g as X,h as le,i as ne,u as $e,j as ue,k as at,l as Me,m as Re,n as be,o as it,p as nt,T as Ce,q as lt,r as oe,t as ct,v as dt,w as ut,x as mt,y as Be,z as pt}from"./vendor-primevue-_kQtzldN.js";import{r as j,d as K,a as qe,c as H,w as me,o as pe,b as y,e as _e,f as o,g as q,h as N,i as a,j as Z,k as xe,l as g,u as d,t as $,n as Q,m as p,p as se,F as ce,q as de,s as ge,v as te,x as Ne}from"./vendor-vue-7xZ5dmFb.js";import{d as ie}from"./vendor-pinia--L0FGc_G.js";import{o as Ge,d as ft,s as re,n as we,Z as He}from"./vendor-other-akJw3aOu.js";import{f as Qe,a as ht}from"./vendor-utils-CgaVvxla.js";const Je={development:{apiUrl:void 0},production:{apiUrl:"/api"}},Ke="production";console.log(Je[Ke].apiUrl);const gt={apiUrl:Je[Ke].apiUrl},S=()=>{const t=Ze(),s=async(i,n={})=>{try{const u=n.body instanceof FormData,b={Authorization:`Bearer ${t.token}`,Accept:"application/json",...n.headers};u||(b["Content-Type"]="application/json");const k=await fetch(`${t.apiUrl}${i}`,{...n,headers:b}),C=k.headers.get("content-type");let f;if(n.responseType==="blob"||C&&!C.includes("application/json")&&!C.includes("text/plain"))f=await k.blob();else try{f=await k.json()}catch(D){console.log(D),f=null}if(k.status===401){const D=f?.error?.message||"Votre session a expiré, veuillez vous reconnecter";return window.dispatchEvent(new CustomEvent("api-error",{detail:{severity:"error",summary:"Erreur d'authentification",detail:D,life:5e3}})),t.clearToken(),{success:!1,error:f?.error?.message||"Unauthorized"}}if(k.status===403){const D=f?.error?.message||"Accès refusé";return window.dispatchEvent(new CustomEvent("api-error",{detail:{severity:"error",summary:"Accès refusé",detail:D,life:5e3}})),{success:!1,error:f?.error?.message||"Forbidden"}}if(k.ok)return{success:!0,data:f};{const D=f?.error?.message||"Request failed";return k.status>=500&&window.dispatchEvent(new CustomEvent("api-error",{detail:{severity:"error",summary:"Erreur Serveur",detail:D,life:5e3}})),{success:!1,error:D}}}catch(u){return console.error("API request error:",u),{success:!1,error:"Network error"}}};return{get:async(i,n={})=>s(i,{method:"GET",...n}),post:async(i,n)=>s(i,{method:"POST",body:n instanceof FormData?n:JSON.stringify(n)}),put:async(i,n)=>s(i,{method:"PUT",body:n instanceof FormData?n:JSON.stringify(n)}),patch:async(i,n)=>s(i,{method:"PATCH",body:n instanceof FormData?n:JSON.stringify(n)}),del:async i=>s(i,{method:"DELETE"})}};function Ae(t){return typeof t=="object"&&t!==null&&"data"in t&&Array.isArray(t.data)&&"total"in t&&"current_page"in t&&"per_page"in t}const Ze=ie("app",{state:()=>({user:null,token:localStorage.getItem("token")||"",apiUrl:gt.apiUrl,theme:localStorage.getItem("theme")||"light"}),getters:{isAuthenticated:t=>!!t.token,currentUser:t=>t.user,userRole:t=>t.user?.role||""},actions:{setToken(t){this.token=t,localStorage.setItem("token",t)},clearToken(){this.token="",this.user=null,localStorage.removeItem("token"),localStorage.removeItem("user_role")},setTheme(t){this.theme=t,localStorage.setItem("theme",t),document.documentElement.setAttribute("data-theme",t),document.documentElement.classList.toggle("app-dark")},toggleTheme(){const t=this.theme==="light"?"dark":"light";this.setTheme(t)},setUser(t){this.user=t,t.role&&localStorage.setItem("user_role",t.role)},async login(t){const{post:s}=S(),e=await s("/login",t);if(e.success&&e.data){const r=e.data;return this.setToken(r.token),this.setUser(r.user),{success:!0,user:r.user}}else return{success:!1,message:e.error||"Login failed"}},async logout(){const{post:t}=S();await t("/logout",{}),this.clearToken()},async fetchCurrentUser(){if(!this.token)return;const{get:t}=S(),s=await t("/user");if(s.success&&s.data){const e=s.data;this.setUser(e)}else this.clearToken()}}}),vt=(t,s)=>{const e=t.__vccOpts||t;for(const[r,c]of s)e[r]=c;return e},yt=ie("document",{state:()=>({documents:[],currentDocument:null,loading:!1,error:null,pagination:{page:1,limit:10,total:0,totalPages:1}}),getters:{documentById:t=>s=>t.documents.find(e=>e.id===s)},actions:{async fetchDocuments(t=1,s=10,e={}){this.loading=!0,this.error=null;try{const{get:r}=S(),c=new URLSearchParams({page:t.toString(),limit:s.toString()});Object.entries(e).forEach(([_,i])=>{i!=null&&i!==""&&c.append(_,String(i))});const l=await r(`/documents?${c.toString()}`);l.success&&l.data?Ae(l.data)?(this.documents=l.data.data||[],this.pagination={...this.pagination,page:l.data.current_page||t,limit:l.data.per_page||s,total:l.data.total||this.documents.length,totalPages:l.data.last_page||1}):(this.documents=Array.isArray(l.data)?l.data:[l.data],this.pagination={...this.pagination,page:t,limit:s,total:this.documents.length,totalPages:Math.ceil(this.documents.length/s)}):this.error=l.error||"Failed to fetch documents"}catch(r){this.error="An error occurred while fetching documents",console.error(r)}finally{this.loading=!1}},async fetchDocumentById(t){this.loading=!0,this.error=null;try{const{get:s}=S(),e=await s(`/documents/${t}`);e.success&&e.data?this.currentDocument=e.data:this.error=e.error||"Failed to fetch document"}catch(s){this.error="An error occurred while fetching document",console.error(s)}finally{this.loading=!1}},async createDocument(t){this.loading=!0,this.error=null;try{const{post:s}=S(),e=await s("/documents",t);if(e.success&&e.data)this.documents.unshift(e.data),this.currentDocument=e.data;else throw this.error=e.error||"Failed to create document",new Error(this.error)}catch(s){throw this.error="An error occurred while creating document",console.error(s),s}finally{this.loading=!1}},async updateDocument(t,s){this.loading=!0,this.error=null;try{const{put:e,post:r}=S();let c;if(s instanceof FormData?c=await r(`/documents/${t}`,s):c=await e(`/documents/${t}`,s),c.success&&c.data){const l=this.documents.findIndex(_=>_.id===t);l!==-1&&(this.documents[l]=c.data),this.currentDocument=c.data}else throw this.error=c.error||"Failed to update document",new Error(this.error)}catch(e){throw this.error="An error occurred while updating document",console.error(e),e}finally{this.loading=!1}},async deleteDocument(t){this.loading=!0,this.error=null;try{const{del:s}=S(),e=await s(`/documents/${t}`);if(e.success)this.documents=this.documents.filter(r=>r.id!==t),this.currentDocument?.id===t&&(this.currentDocument=null);else throw this.error=e.error||"Failed to delete document",new Error(this.error)}catch(s){throw this.error="An error occurred while deleting document",console.error(s),s}finally{this.loading=!1}},async requestApproval(t){this.loading=!0,this.error=null;try{const{post:s}=S(),e=await s(`/documents/${t}/request-approval`,{});if(e.success&&e.data){this.currentDocument=e.data;const r=this.documents.findIndex(c=>c.id===t);r!==-1&&(this.documents[r]=e.data)}else throw this.error=e.error||"Failed to request approval",new Error(this.error)}catch(s){throw this.error="An error occurred while requesting approval",console.error(s),s}finally{this.loading=!1}},async approveDocument(t){this.loading=!0,this.error=null;try{const{post:s}=S(),e=await s(`/documents/${t}/approve`,{});if(e.success&&e.data){this.currentDocument=e.data;const r=this.documents.findIndex(c=>c.id===t);r!==-1&&(this.documents[r]=e.data)}else throw this.error=e.error||"Failed to approve document",new Error(this.error)}catch(s){throw this.error="An error occurred while approving document",console.error(s),s}finally{this.loading=!1}},async rejectDocument(t){this.loading=!0,this.error=null;try{const{post:s}=S(),e=await s(`/documents/${t}/reject`,{});if(e.success&&e.data){this.currentDocument=e.data;const r=this.documents.findIndex(c=>c.id===t);r!==-1&&(this.documents[r]=e.data)}else throw this.error=e.error||"Failed to reject document",new Error(this.error)}catch(s){throw this.error="An error occurred while rejecting document",console.error(s),s}finally{this.loading=!1}},async downloadDocument(t,s){try{const{get:e}=S(),r=await e(`/documents/${t}/download`,{responseType:"blob"});if(r.success&&r.data){const c=window.URL.createObjectURL(new Blob([r.data])),l=document.createElement("a");l.href=c,l.setAttribute("download",s),document.body.appendChild(l),l.click(),document.body.removeChild(l),window.URL.revokeObjectURL(c)}else throw console.log(r),new Error(r.error||"Failed to download document")}catch(e){throw console.error("Download error:",e),e}},async fetchVersions(t){try{const{get:s}=S(),e=await s(`/documents/${t}/versions`);return e.success&&e.data?e.data:[]}catch(s){return console.error("Error fetching versions:",s),[]}},async addVersion(t,s){this.loading=!0,this.error=null;try{const{post:e}=S(),r=await e(`/documents/${t}/versions`,s);if(r.success&&r.data){this.currentDocument=r.data;const c=this.documents.findIndex(l=>l.id===t);return c!==-1&&(this.documents[c]=r.data),r.data}else throw new Error(r.error||"Failed to add version")}catch(e){throw this.error="An error occurred while adding version",console.error(e),e}finally{this.loading=!1}}}}),bt=ie("document-folder",{state:()=>({folders:[],loading:!1,error:null}),getters:{flattenedFolders:t=>{const s=(e,r="")=>{let c=[];return e.forEach(l=>{c.push({...l,label:r+l.name}),l.children&&l.children.length>0&&(c=c.concat(s(l.children,r+"-- ")))}),c};return s(t.folders)}},actions:{async fetchFolders(){this.loading=!0,this.error=null;try{const{get:t}=S(),s=await t("/document-folders");if(s.success&&s.data&&s.data.data){const e=r=>({id:r.id,name:r.name,parent_id:r.parent_id,documents_count:r.documents_count,children:r.children_recursive?r.children_recursive.map(e):r.childrenRecursive?r.childrenRecursive.map(e):r.children?r.children.map(e):[]});this.folders=Array.isArray(s.data.data)?s.data.data.map(e):[]}else this.folders=[]}catch(t){this.error="Failed to fetch folders",console.error(t)}finally{this.loading=!1}},async createFolder(t){this.loading=!0;try{const{post:s}=S(),e=await s("/document-folders",t);if(e.success&&e.data)return await this.fetchFolders(),e.data}catch(s){throw this.error="Failed to create folder",s}finally{this.loading=!1}},async updateFolder(t,s){this.loading=!0;try{const{put:e}=S(),r=await e(`/document-folders/${t}`,s);if(r.success&&r.data)return await this.fetchFolders(),r.data}catch(e){throw this.error="Failed to update folder",e}finally{this.loading=!1}},async deleteFolder(t){this.loading=!0;try{const{del:s}=S();(await s(`/document-folders/${t}`)).success&&await this.fetchFolders()}catch(s){throw this.error="Failed to delete folder",s}finally{this.loading=!1}}}}),_t=ie("category",()=>{const t=j([]),s=j(!1),e=j(null);return{categories:t,loading:s,error:e,fetchCategories:async()=>{s.value=!0,e.value=null;try{const{get:i}=S(),n=await i("/categories");n.success&&n.data?t.value=n.data:e.value=n.error||"Impossible de charger les catégories"}catch(i){console.error("Error fetching categories:",i),e.value="Impossible de charger les catégories"}finally{s.value=!1}},createCategory:async i=>{s.value=!0,e.value=null;try{const{post:n}=S(),u=await n("/categories",i);if(u.success&&u.data)return t.value.push(u.data),u.data;throw e.value=u.error||"Impossible de créer la catégorie",new Error(e.value)}catch(n){throw console.error("Error creating category:",n),e.value="Impossible de créer la catégorie",n}finally{s.value=!1}},updateCategory:async(i,n)=>{s.value=!0,e.value=null;try{const{put:u}=S(),b=await u(`/categories/${i}`,n);if(b.success&&b.data){const k=t.value.findIndex(C=>C.id===i);return k!==-1&&(t.value[k]=b.data),b.data}else throw e.value=b.error||"Impossible de mettre à jour la catégorie",new Error(e.value)}catch(u){throw console.error("Error updating category:",u),e.value="Impossible de mettre à jour la catégorie",u}finally{s.value=!1}},deleteCategory:async i=>{s.value=!0,e.value=null;try{const{del:n}=S(),u=await n(`/categories/${i}`);if(u.success)t.value=t.value.filter(b=>b.id!==i);else throw e.value=u.error||"Impossible de supprimer la catégorie",new Error(e.value)}catch(n){throw console.error("Error deleting category:",n),e.value="Impossible de supprimer la catégorie",n}finally{s.value=!1}}}}),xt={class:"field"},wt={key:0,class:"bg-blue-50 p-4 rounded-md border border-blue-200 mb-2"},kt={class:"flex items-start"},$t={class:"flex items-center justify-center flex-col"},Ct={key:2,class:"mt-2 flex items-center gap-2 text-sm text-color bg-surface-100 dark:bg-surface-800 p-2 rounded"},At={class:"font-semibold"},St={key:3,class:"text-red-500"},Dt={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},Et={class:"field"},Vt={key:0,class:"text-red-500"},jt={class:"field"},It={key:0,class:"text-red-500"},Tt={class:"field"},Ft={key:0,class:"text-red-500"},Ut={class:"field"},Lt={class:"flex items-center gap-2"},zt={key:0,class:"flex items-center gap-2"},Pt={key:0,class:"text-red-500"},Bt={class:"field"},qt={key:0,class:"text-red-500"},Ot={class:"field"},Mt={key:0,class:"text-red-500"},Rt={class:"field"},Nt={class:"flex justify-end gap-3 pt-4 border-t border-surface-border"},Gt=K({__name:"DocumentForm",props:{initialData:{default:()=>({title:"",description:"",document_folder_id:null,category_id:null,version:"1.0",status:"draft"})},submitButtonText:{default:"Enregistrer"},loading:{type:Boolean,default:!1},isEditMode:{type:Boolean,default:!1}},emits:["submit","cancel"],setup(t,{emit:s}){const e=t,r=s,c=bt(),l=_t(),_=qe({title:"",description:"",document_folder_id:null,category_id:null,version:"1.0",status:"draft",...e.initialData}),i=j(void 0),n=qe({}),u=Ge({title:re().min(1,"Le titre est requis").max(255,"Le titre est trop long"),description:re().optional(),document_folder_id:we().nullable(),category_id:we(),version:re().min(1,"La version est requise"),status:re().min(1,"Le statut est requis"),expires_date:ft().nullable().optional()}),b=H(()=>{const T=h=>({key:h.id.toString(),label:h.name,data:h.id,children:h.children?h.children.map(T):[]});return c.folders.map(T)}),k=H(()=>l.categories.map(T=>({value:T.id,text:T.name,icon:T.icon}))),C=[{value:"draft",text:"Brouillon"},{value:"pending_approval",text:"En attente d'approbation"},{value:"approved",text:"Approuvé"},{value:"rejected",text:"Rejeté"},{value:"archived",text:"Archivé"}],f=T=>{const h=Array.isArray(T.files)?T.files[0]:T.files;h&&(i.value=h,delete n.file)},D=()=>{i.value=void 0},V=H({get:()=>_.document_folder_id?{[_.document_folder_id.toString()]:!0}:null,set:T=>{if(T&&typeof T=="object"){const h=Object.keys(T);h.length>0?_.document_folder_id=parseInt(h[0]):_.document_folder_id=null}else _.document_folder_id=null}}),O=T=>{if(T===0)return"0 Bytes";const h=1024,x=["Bytes","KB","MB","GB"],m=Math.floor(Math.log(T)/Math.log(h)),z=x[m]||x[x.length-1];return parseFloat((T/Math.pow(h,m)).toFixed(2))+" "+z},E=()=>{Object.keys(n).forEach(T=>delete n[T]);try{return u.parse(_),!0}catch(T){return T instanceof He&&T.issues.forEach(h=>{h.path&&(n[h.path[0]]=h.message)}),!1}},I=()=>{if(E()){if(!i.value&&!e.initialData.title){n.file="Le fichier est requis pour un nouveau document";return}r("submit",{..._,file:i.value})}},M=()=>{r("cancel")};return me(()=>e.initialData,T=>{T&&Object.assign(_,T)},{deep:!0}),pe(()=>{c.fetchFolders(),l.fetchCategories()}),(T,h)=>{const x=Z("font-awesome-icon");return p(),y("form",{onSubmit:_e(I,["prevent"]),class:"flex flex-col gap-6"},[o("div",xt,[h[9]||(h[9]=o("label",{class:"block text-sm font-medium mb-2 text-color-secondary"},"Fichier",-1)),t.isEditMode?(p(),y("div",wt,[o("div",kt,[a(x,{icon:["fas","info-circle"],class:"text-blue-500 mt-1 mr-2"}),h[7]||(h[7]=o("p",{class:"text-sm text-blue-700 m-0"},[xe(" Pour modifier le fichier ou créer une nouvelle version, veuillez utiliser le bouton "),o("strong",null,'"Nouvelle Version"'),xe(" sur la page de détail du document. ")],-1))])])):q("",!0),t.isEditMode?q("",!0):(p(),N(d(ot),{key:1,name:"file",auto:!0,customUpload:!0,onUploader:f,maxFileSize:1e7,accept:".pdf,.doc,.docx,.xls,.xlsx,.jpg,.jpeg,.png,application/pdf,application/msword,application/vnd.openxmlformats-officedocument.wordprocessingml.document,application/vnd.ms-excel,application/vnd.openxmlformats-officedocument.spreadsheetml.sheet,image/jpeg,image/png"},{empty:g(()=>[o("div",$t,[a(x,{icon:["fas","cloud-upload-alt"],class:"text-6xl text-color-secondary mb-4"}),h[8]||(h[8]=o("p",{class:"mt-4 mb-0 text-color-secondary"}," Glisser-déposer le fichier ici pour le télécharger. ",-1))])]),_:1})),i.value?(p(),y("div",Ct,[a(x,{icon:["fas","check-circle"],class:"text-green-500"}),o("span",At,$(i.value.name),1),o("span",null,"("+$(O(i.value.size))+")",1),a(d(L),{onClick:D,outlined:"",rounded:"",severity:"danger",size:"small",class:"w-8 h-8"},{icon:g(()=>[a(x,{icon:["fas","times"]})]),_:1})])):q("",!0),n.file?(p(),y("small",St,$(n.file),1)):q("",!0)]),o("div",Dt,[o("div",Et,[h[10]||(h[10]=o("label",{for:"title",class:"block text-sm font-medium mb-2 text-color-secondary"},"Titre *",-1)),a(d(ae),{id:"title",modelValue:_.title,"onUpdate:modelValue":h[0]||(h[0]=m=>_.title=m),placeholder:"Titre du document",class:Q(["w-full",{"p-invalid":n.title}])},null,8,["modelValue","class"]),n.title?(p(),y("small",Vt,$(n.title),1)):q("",!0)]),o("div",jt,[h[11]||(h[11]=o("label",{for:"version",class:"block text-sm font-medium mb-2 text-color-secondary"},"Version *",-1)),a(d(ae),{id:"version",modelValue:_.version,"onUpdate:modelValue":h[1]||(h[1]=m=>_.version=m),placeholder:"1.0",class:Q(["w-full",{"p-invalid":n.version}]),disabled:t.isEditMode},null,8,["modelValue","class","disabled"]),n.version?(p(),y("small",It,$(n.version),1)):q("",!0)]),o("div",Tt,[h[12]||(h[12]=o("label",{for:"folder",class:"block text-sm font-medium mb-2 text-color-secondary"},"Dossier",-1)),a(d(rt),{modelValue:V.value,"onUpdate:modelValue":h[2]||(h[2]=m=>V.value=m),options:b.value,placeholder:"Sélectionnez un dossier",class:Q(["w-full",{"p-invalid":n.document_folder_id}])},null,8,["modelValue","options","class"]),n.document_folder_id?(p(),y("small",Ft,$(n.document_folder_id),1)):q("",!0)]),o("div",Ut,[h[13]||(h[13]=o("label",{for:"category",class:"block text-sm font-medium mb-2 text-color-secondary"},"Type de document *",-1)),a(d(ee),{id:"category",modelValue:_.category_id,"onUpdate:modelValue":h[3]||(h[3]=m=>_.category_id=m),options:k.value,optionLabel:"text",optionValue:"value",placeholder:"Sélectionnez un type",class:Q(["w-full",{"p-invalid":n.category_id}])},{option:g(({option:m})=>[o("div",Lt,[m.icon?(p(),N(x,{key:0,icon:["fas",m.icon]},null,8,["icon"])):q("",!0),o("span",null,$(m.text),1)])]),value:g(({value:m})=>[m?(p(),y("div",zt,[k.value.find(z=>z.value===m)?.icon?(p(),N(x,{key:0,icon:["fas",k.value.find(z=>z.value===m)?.icon]},null,8,["icon"])):q("",!0),o("span",null,$(k.value.find(z=>z.value===m)?.text),1)])):q("",!0)]),_:1},8,["modelValue","options","class"]),n.category_id?(p(),y("small",Pt,$(n.category_id),1)):q("",!0)]),o("div",Bt,[h[14]||(h[14]=o("label",{for:"status",class:"block text-sm font-medium mb-2 text-color-secondary"},"Statut *",-1)),a(d(ee),{id:"status",modelValue:_.status,"onUpdate:modelValue":h[4]||(h[4]=m=>_.status=m),options:C,optionLabel:"text",optionValue:"value",placeholder:"Sélectionnez un statut",class:Q(["w-full",{"p-invalid":n.status}])},null,8,["modelValue","class"]),n.status?(p(),y("small",qt,$(n.status),1)):q("",!0)]),o("div",Ot,[h[15]||(h[15]=o("label",{for:"expires_date",class:"block text-sm font-medium mb-2 text-color-secondary"},"Date d'expiration (optionnel)",-1)),a(d(Oe),{id:"expires_date",modelValue:_.expires_date,"onUpdate:modelValue":h[5]||(h[5]=m=>_.expires_date=m),dateFormat:"dd/mm/yy",placeholder:"Sélectionnez une date",class:Q(["w-full",{"p-invalid":n.expires_date}]),fluid:"",showIcon:"",iconDisplay:"input"},null,8,["modelValue","class"]),n.expires_date?(p(),y("small",Mt,$(n.expires_date),1)):q("",!0)])]),o("div",Rt,[h[16]||(h[16]=o("label",{for:"description",class:"block text-sm font-medium mb-2 text-color-secondary"},"Description",-1)),a(d(ke),{id:"description",modelValue:_.description,"onUpdate:modelValue":h[6]||(h[6]=m=>_.description=m),placeholder:"Description du document",rows:"4",class:"w-full"},null,8,["modelValue"])]),o("div",Nt,[a(d(L),{label:"Annuler",text:"",severity:"secondary",onClick:M},{icon:g(()=>[a(x,{icon:["fas","times"]})]),_:1}),a(d(L),{type:"submit",label:t.submitButtonText,loading:t.loading},{icon:g(()=>[a(x,{icon:["fas","save"]})]),_:1},8,["label","loading"])])],32)}}}),ve=ie("action",{state:()=>({actions:[],currentAction:null,loading:!1,error:null,pagination:{page:1,limit:10,total:0,totalPages:1}}),getters:{actionById:t=>s=>t.actions.find(e=>e.id===s)},actions:{async fetchActions(t=1,s=10,e={}){this.loading=!0,this.error=null;try{const{get:r}=S(),c=new URLSearchParams({page:t.toString(),limit:s.toString()});Object.entries(e).forEach(([_,i])=>{i!=null&&i!==""&&c.append(_,String(i))});const l=await r(`/actions?${c.toString()}`);l.success&&l.data?Ae(l.data)?(this.actions=l.data.data||[],this.pagination={...this.pagination,page:l.data.current_page||t,limit:l.data.per_page||s,total:l.data.total||this.actions.length,totalPages:l.data.last_page||1}):(this.actions=Array.isArray(l.data)?l.data:[l.data],this.pagination={...this.pagination,page:t,limit:s,total:this.actions.length,totalPages:Math.ceil(this.actions.length/s)}):this.error=l.error||"Failed to fetch actions"}catch(r){this.error="An error occurred while fetching actions",console.error(r)}finally{this.loading=!1}},async fetchActionById(t){this.loading=!0,this.error=null;try{const{get:s}=S(),e=await s(`/actions/${t}`);e.success&&e.data?this.currentAction=e.data:this.error=e.error||"Failed to fetch action"}catch(s){this.error="An error occurred while fetching action",console.error(s)}finally{this.loading=!1}},async createAction(t){this.loading=!0,this.error=null;try{const{post:s}=S(),e=await s("/actions",t);if(e.success&&e.data)this.actions.unshift(e.data),this.currentAction=e.data;else throw this.error=e.error||"Failed to create action",new Error(this.error)}catch(s){throw this.error="An error occurred while creating action",console.error(s),s}finally{this.loading=!1}},async updateAction(t,s){this.loading=!0,this.error=null;try{const{put:e}=S(),r=await e(`/actions/${t}`,s);if(r.success&&r.data){const c=this.actions.findIndex(l=>l.id===t);c!==-1&&(this.actions[c]=r.data),this.currentAction=r.data}else throw this.error=r.error||"Failed to update action",new Error(this.error)}catch(e){throw this.error="An error occurred while updating action",console.error(e),e}finally{this.loading=!1}},async deleteAction(t){this.loading=!0,this.error=null;try{const{del:s}=S(),e=await s(`/actions/${t}`);if(e.success)this.actions=this.actions.filter(r=>r.id!==t),this.currentAction?.id===t&&(this.currentAction=null);else throw this.error=e.error||"Failed to delete action",new Error(this.error)}catch(s){throw this.error="An error occurred while deleting action",console.error(s),s}finally{this.loading=!1}},async updateProgress(t,s){this.loading=!0,this.error=null;try{const{post:e}=S(),r=await e(`/actions/${t}/update-progress`,{progress:s});if(r.success&&r.data){const c=this.actions.findIndex(l=>l.id===t);c!==-1&&(this.actions[c]=r.data),this.currentAction?.id===t&&(this.currentAction=r.data)}else throw this.error=r.error||"Failed to update progress",new Error(this.error)}catch(e){throw this.error="An error occurred while updating progress",console.error(e),e}finally{this.loading=!1}},async addComment(t,s){this.loading=!0,this.error=null;try{const{post:e}=S(),r=await e(`/actions/${t}/comments`,{content:s});if(r.success&&r.data)this.currentAction&&this.currentAction.id===t&&(this.currentAction.comments||(this.currentAction.comments=[]),this.currentAction.comments.push(r.data));else throw this.error=r.error||"Failed to add comment",new Error(this.error)}catch(e){throw this.error="An error occurred while adding comment",console.error(e),e}finally{this.loading=!1}},async linkDocument(t,s){this.loading=!0,this.error=null;try{const{post:e}=S(),r=await e(`/actions/${t}/documents`,{document_id:s});if(r.success&&r.data)this.currentAction=r.data;else throw new Error(r.error||"Failed to link document")}catch(e){throw this.error="Error linking document",e}finally{this.loading=!1}},async unlinkDocument(t,s){this.loading=!0,this.error=null;try{const{del:e}=S(),r=await e(`/actions/${t}/documents/${s}`);if(r.success&&r.data)this.currentAction=r.data;else throw new Error(r.error||"Failed to unlink document")}catch(e){throw this.error="Error unlinking document",e}finally{this.loading=!1}},async linkIndicator(t,s){this.loading=!0,this.error=null;try{const{post:e}=S(),r=await e(`/actions/${t}/indicators`,{indicator_id:s});if(r.success&&r.data)this.currentAction=r.data;else throw new Error(r.error||"Failed to link indicator")}catch(e){throw this.error="Error linking indicator",e}finally{this.loading=!1}},async unlinkIndicator(t,s){this.loading=!0,this.error=null;try{const{del:e}=S(),r=await e(`/actions/${t}/indicators/${s}`);if(r.success&&r.data)this.currentAction=r.data;else throw new Error(r.error||"Failed to unlink indicator")}catch(e){throw this.error="Error unlinking indicator",e}finally{this.loading=!1}},async deleteComment(t){this.loading=!0,this.error=null;try{const{del:s}=S(),e=await s(`/comments/${t}`);if(e.success)this.currentAction&&this.currentAction.comments&&(this.currentAction.comments=this.currentAction.comments.filter(r=>r.id!==t));else throw new Error(e.error||"Failed to delete comment")}catch(s){throw this.error="Error deleting comment",s}finally{this.loading=!1}}}}),Se=ie("actionTypes",{state:()=>({types:[],loading:!1}),actions:{async fetchTypes(){this.loading=!0;const{get:t}=S(),s=await t("/action-types");if(s.success&&s.data){const e=s.data;this.types=e.data||e}this.loading=!1},async createType(t){const{post:s}=S(),e=await s("/action-types",t);if(e.success)return await this.fetchTypes(),e.data;throw new Error(e.message||"Erreur lors de la création")},async updateType(t,s){const{put:e}=S(),r=await e(`/action-types/${t}`,s);if(r.success)return await this.fetchTypes(),r.data;throw new Error(r.message||"Erreur lors de la mise à jour")},async deleteType(t){const{del:s}=S(),e=await s(`/action-types/${t}`);if(e.success)return await this.fetchTypes(),!0;throw new Error(e.message||"Erreur lors de la suppression")}}}),Ht={class:"flex-1 flex flex-col gap-4"},Qt={class:"flex items-center justify-between"},Jt={class:"flex items-center gap-2 text-sm text-color-secondary"},Kt={class:"text-xl font-medium"},Zt={class:"flex items-center gap-2"},Wt={class:"font-bold text-color text-lg leading-snug"},Xt={class:"mt-auto"},Yt={class:"flex justify-between text-xs text-color-secondary mb-1"},es={class:"font-medium"},ts={class:"w-full bg-surface-100 dark:bg-surface-800 rounded-full h-4"},ss={class:"flex items-center justify-between pt-4 border-t border-surface-border mt-2"},os={class:"flex items-center gap-2"},rs={class:"flex flex-col"},as={class:"text-sm font-medium text-color truncate max-w-[120px]"},is={class:"flex flex-col items-end"},ns=K({__name:"ActionCard",props:{action:{type:Object,required:!0}},emits:["view","edit","delete"],setup(t){const s=t,e=u=>({open:"Ouvert",in_progress:"En cours",completed:"Terminé",cancelled:"Annulé"})[u]||u,r=u=>({open:"info",in_progress:"warn",completed:"success",cancelled:"secondary"})[u]||"info",c=u=>({low:"bg-green-500",medium:"bg-yellow-500",high:"bg-orange-500",critical:"bg-red-600"})[u]||"bg-gray-300",l=u=>u>=100?"bg-green-500":u>60?"bg-blue-500":u>30?"bg-yellow-500":"bg-gray-400",_=u=>{if(!u)return"-";const b=new Date(u);return new Intl.DateTimeFormat("fr-FR",{day:"numeric",month:"short",year:"numeric"}).format(b)},i=H(()=>!s.action.due_date||["completed","cancelled"].includes(s.action.status)?!1:new Date(s.action.due_date)<new Date),n=u=>`${u.first_name.charAt(0)}${u.last_name.charAt(0)}`.toUpperCase();return(u,b)=>{const k=Z("font-awesome-icon"),C=X;return p(),N(C,{class:"hover:shadow-md transition-all duration-200 cursor-pointer h-full flex flex-col relative overflow-hidden group",onClick:b[0]||(b[0]=f=>u.$emit("view",t.action.id))},{content:g(()=>[o("div",Ht,[o("div",Qt,[o("div",Jt,[a(k,{icon:["fas",t.action.action_type?.icon||"tasks"],style:se({color:t.action.action_type?.color}),size:"xl"},null,8,["icon","style"]),o("span",Kt,$(t.action.action_type?.name),1)]),o("div",Zt,[a(d(le),{value:e(t.action.status),severity:r(t.action.status),class:"text-xs px-2 py-0.5"},null,8,["value","severity"])])]),o("h3",Wt,$(t.action.title),1),o("div",Xt,[o("div",Yt,[b[1]||(b[1]=o("span",null,"Progression",-1)),o("span",es,$(t.action.progress)+"%",1)]),o("div",ts,[o("div",{class:Q(["h-4 rounded-full transition-all duration-300",l(t.action.progress)]),style:se({width:`${t.action.progress}%`})},null,6)])]),o("div",ss,[o("div",os,[t.action.assignee?(p(),N(d(ne),{key:0,label:n(t.action.assignee),shape:"circle",size:"small",class:"w-8 h-8 text-xs bg-surface-200 dark:bg-surface-700 text-color-secondary"},null,8,["label"])):q("",!0),o("div",rs,[b[2]||(b[2]=o("span",{class:"text-xs text-color-secondary"},"Responsable",-1)),o("span",as,$(t.action.assignee?`${t.action.assignee.first_name} ${t.action.assignee.last_name}`:"Non assigné"),1)])]),o("div",is,[b[3]||(b[3]=o("span",{class:"text-xs text-color-secondary"},"Échéance",-1)),o("div",{class:Q(["flex items-center gap-1.5 text-sm font-medium",i.value?"text-red-500":"text-color"])},[a(k,{icon:"calendar",class:"text-xs"}),o("span",null,$(_(t.action.due_date)),1)],2)])])])]),default:g(()=>[o("div",{class:Q(`absolute left-0 top-0 bottom-0 w-1.5 ${c(t.action.priority)}`)},null,2)]),_:1})}}}),ls={class:"p-4"},cs={class:"flex flex-col md:flex-row md:items-center md:justify-between mb-6 gap-4"},ds={class:"flex gap-2"},us={class:"flex flex-wrap gap-4"},ms={class:"flex-1 min-w-[200px]"},ps={key:0,class:"flex justify-center py-12"},fs={key:1,class:"text-center py-12 bg-surface-50 dark:bg-surface-800 rounded-lg border-2 border-dashed border-surface-border"},hs={key:2,class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"},gs={key:3,class:"mt-6"},vs=K({__name:"ActionIndex",setup(t){const s=ge(),e=ve(),r=Se(),c=$e(),l=ue(),_=j(""),i=j(null),n=j(null),u=j(9),b=j(0),k=H(()=>e.actions),C=H(()=>e.loading),f=H(()=>e.pagination.total),D=H(()=>(r.types||[]).map(m=>({label:m.name,value:m.id}))),V=[{label:"Ouvert",value:"open"},{label:"En cours",value:"in_progress"},{label:"Terminé",value:"completed"},{label:"Annulé",value:"cancelled"}],O=async()=>{const m={search:_.value,action_type_id:i.value,status:n.value};await e.fetchActions(b.value+1,u.value,m)},E=m=>{b.value=m.page,O()},I=()=>{s.push("/actions/create")},M=()=>{s.push("/actions/config")},T=m=>{s.push(`/actions/${m}`)},h=m=>{s.push(`/actions/${m}/edit`)},x=m=>{const z=k.value.find(A=>A.id===m);z&&c.require({message:`Voulez-vous vraiment supprimer l'action "${z.title}" ?`,header:"Confirmation de suppression",icon:"pi pi-exclamation-triangle",rejectLabel:"Annuler",acceptLabel:"Supprimer",rejectClass:"p-button-secondary p-button-outlined",acceptClass:"p-button-danger",accept:async()=>{try{await e.deleteAction(z.id),l.add({severity:"success",summary:"Succès",detail:"Action supprimée",life:3e3}),O()}catch{l.add({severity:"error",summary:"Erreur",detail:"Impossible de supprimer l'action",life:3e3})}}})};return me([_,i,n],()=>{b.value=0,O()}),pe(()=>{r.fetchTypes(),O()}),(m,z)=>{const A=Z("font-awesome-icon"),W=X;return p(),y("div",ls,[o("div",cs,[z[3]||(z[3]=o("h2",null,"Tableau de bord Actions",-1)),o("div",ds,[a(d(L),{label:"Gérer les actions",onClick:M,severity:"secondary",outlined:""},{icon:g(()=>[a(A,{icon:"cog",class:"mr-2"})]),_:1}),a(d(L),{label:"Nouvelle action",onClick:I,severity:"primary"},{icon:g(()=>[a(A,{icon:"plus",class:"mr-2"})]),_:1})])]),a(W,{class:"mb-6"},{content:g(()=>[o("div",us,[o("div",ms,[a(d(Me),{iconPosition:"left"},{default:g(()=>[a(d(Re),null,{default:g(()=>[a(A,{icon:"magnifying-glass"})]),_:1}),a(d(ae),{modelValue:_.value,"onUpdate:modelValue":z[0]||(z[0]=J=>_.value=J),placeholder:"Rechercher...",class:"w-full"},null,8,["modelValue"])]),_:1})]),a(d(ee),{modelValue:i.value,"onUpdate:modelValue":z[1]||(z[1]=J=>i.value=J),options:D.value,optionLabel:"label",optionValue:"value",placeholder:"Type",class:"w-full md:w-40",showClear:""},null,8,["modelValue","options"]),a(d(ee),{modelValue:n.value,"onUpdate:modelValue":z[2]||(z[2]=J=>n.value=J),options:V,optionLabel:"label",optionValue:"value",placeholder:"Statut",class:"w-full md:w-40",showClear:""},null,8,["modelValue"])])]),_:1}),C.value?(p(),y("div",ps,[a(A,{icon:["fas","spinner"],spin:"",size:"2x",class:"text-color-secondary"})])):k.value.length===0?(p(),y("div",fs,[a(A,{icon:"tasks",class:"text-color-secondary text-5xl mb-4"}),z[4]||(z[4]=o("h3",{class:"text-lg font-medium text-color"},"Aucune action trouvée",-1)),z[5]||(z[5]=o("p",{class:"text-color-secondary mt-1"},"Commencez par créer une nouvelle action.",-1)),a(d(L),{label:"Nouvelle action",onClick:I,severity:"primary",class:"mt-4"},{icon:g(()=>[a(A,{icon:"plus",class:"mr-2"})]),_:1})])):(p(),y("div",hs,[(p(!0),y(ce,null,de(k.value,J=>(p(),N(ns,{key:J.id,action:J,onView:T,onEdit:h,onDelete:x},null,8,["action"]))),128))])),f.value>u.value?(p(),y("div",gs,[a(d(at),{rows:u.value,totalRecords:f.value,first:b.value*u.value,onPage:E},null,8,["rows","totalRecords","first"])])):q("",!0)])}}}),fa=Object.freeze(Object.defineProperty({__proto__:null,default:vs},Symbol.toStringTag,{value:"Module"})),ys={class:"icon-picker"},bs={class:"w-8 h-8 flex items-center justify-center bg-surface-100 dark:bg-surface-700 rounded text-color-secondary"},_s={class:"flex-1 text-color-secondary"},xs={class:"flex flex-col gap-4"},ws={class:"p-input-icon-left w-full"},ks={class:"h-[30rem] overflow-y-auto custom-scrollbar p-1"},$s={key:0,class:"text-center py-8 text-color-secondary"},Cs={key:1,class:"grid grid-cols-6 sm:grid-cols-8 md:grid-cols-10 gap-2"},As=["onClick","title"],Ss=K({__name:"IconPicker",props:{modelValue:{type:String,default:""}},emits:["update:modelValue"],setup(t,{emit:s}){const e=s,r=j(!1),c=j(""),l=["folder","folder-open","file","file-alt","file-lines","file-circle-check","clipboard","clipboard-list","clipboard-check","check","check-circle","check-double","times","times-circle","exclamation","exclamation-circle","exclamation-triangle","info","info-circle","question","question-circle","user","user-circle","users","user-plus","user-check","user-tie","user-graduate","graduation-cap","book","book-open","bookmark","calendar","calendar-alt","calendar-check","calendar-plus","clock","building","home","industry","warehouse","cog","cogs","tools","wrench","hammer","chart-bar","chart-line","chart-pie","chart-area","eye","eye-slash","search","filter","sort","lock","lock-open","key","shield-alt","envelope","paper-plane","inbox","phone","mobile-alt","map-marker-alt","globe","flag","star","heart","thumbs-up","thumbs-down","trash","trash-alt","edit","pen","pencil-alt","save","download","upload","cloud","link","unlink","external-link-alt","list","list-ul","list-ol","list-check","th","th-large","th-list","arrow-right","arrow-left","arrow-up","arrow-down","sync","sync-alt","redo","undo","plus","plus-circle","minus","minus-circle","medkit","first-aid","heartbeat","stethoscope","hard-hat","fire-extinguisher","biohazard"],_=H(()=>{if(!c.value)return l;const n=c.value.toLowerCase();return l.filter(u=>u.toLowerCase().includes(n))}),i=n=>{e("update:modelValue",n),r.value=!1};return(n,u)=>{const b=Z("font-awesome-icon");return p(),y("div",ys,[o("div",{class:Q(["flex items-center gap-2 p-2 border rounded cursor-pointer hover:bg-surface-50 dark:hover:bg-surface-800 transition-colors",{"border-primary-500 ring-2 ring-primary-200 dark:ring-primary-900/50":r.value}]),onClick:u[0]||(u[0]=k=>r.value=!0)},[o("div",bs,[a(b,{icon:t.modelValue||"circle-question"},null,8,["icon"])]),o("span",_s,$(t.modelValue||"Sélectionner une icône"),1),u[3]||(u[3]=o("i",{class:"pi pi-chevron-down text-color-secondary"},null,-1))],2),a(d(be),{visible:r.value,"onUpdate:visible":u[2]||(u[2]=k=>r.value=k),modal:"",header:"Choisir une icône",style:{width:"50rem"},breakpoints:{"1199px":"75vw","575px":"90vw"}},{default:g(()=>[o("div",xs,[o("span",ws,[u[4]||(u[4]=o("i",{class:"pi pi-search"},null,-1)),a(d(ae),{modelValue:c.value,"onUpdate:modelValue":u[1]||(u[1]=k=>c.value=k),placeholder:"Rechercher une icône...",class:"w-full",autofocus:""},null,8,["modelValue"])]),o("div",ks,[_.value.length===0?(p(),y("div",$s,[o("p",null,'Aucune icône trouvée pour "'+$(c.value)+'"',1)])):(p(),y("div",Cs,[(p(!0),y(ce,null,de(_.value,k=>(p(),y("div",{key:k,class:Q(["aspect-square flex flex-col items-center justify-center rounded cursor-pointer hover:bg-surface-100 dark:hover:bg-surface-700 text-color transition-colors gap-1 p-1",{"bg-primary-100 text-primary-700 dark:bg-primary-500/20 dark:text-primary-300 ring-2 ring-primary-200 dark:ring-primary-500/50":t.modelValue===k}]),onClick:C=>i(k),title:k},[a(b,{icon:k,class:"text-xl"},null,8,["icon"])],10,As))),128))]))])])]),_:1},8,["visible"])])}}}),Ds={class:"flex items-center gap-2"},Es={class:"flex flex-col h-full"},Vs={class:"flex-1 overflow-y-auto mb-4 custom-scrollbar pr-2"},js={key:0,class:"flex justify-center py-8"},Is={key:1,class:"text-center py-8 text-color-secondary"},Ts={key:2,class:"flex flex-col gap-3"},Fs=["onClick"],Us={class:"flex items-center gap-4"},Ls={class:"font-bold text-color text-base mb-0.5"},zs={class:"text-sm text-color-secondary line-clamp-2 leading-tight"},Ps={key:0,class:"ml-2"},Bs={key:1,class:"ml-2"},qs={class:"border-t border-surface-border pt-6 mt-auto"},Os={class:"flex items-center justify-between mb-4"},Ms={class:"text-xl font-bold text-color"},Rs={key:0,class:"text-red-500"},Ns={class:"grid grid-cols-2 gap-4"},Gs={class:"flex gap-2"},Hs={class:"flex justify-end gap-2 mt-4"},Qs=K({__name:"ActionTypeManager",props:{visible:{type:Boolean}},emits:["update:visible"],setup(t,{emit:s}){const e=t,r=s,c=Se(),l=$e(),_=ue(),i=H(()=>c.types),n=H(()=>c.loading),u=j(null),b=j(!1),k=j(!1),C=j({name:"",description:"",color:"3b82f6",icon:"tag"}),f=()=>{u.value=null,C.value={name:"",description:"",color:"3b82f6",icon:"tag"},k.value=!1},D=E=>{u.value=E,C.value={name:E.name,description:E.description||"",color:E.color?E.color.replace("#",""):"3b82f6",icon:E.icon||"tag"}},V=async()=>{if(k.value=!0,!!C.value.name){b.value=!0;try{const E={...C.value,color:`#${C.value.color}`};u.value?(await c.updateType(u.value.id,E),_.add({severity:"success",summary:"Succès",detail:"Type mis à jour",life:3e3})):(await c.createType(E),_.add({severity:"success",summary:"Succès",detail:"Type créé",life:3e3})),f()}catch{_.add({severity:"error",summary:"Erreur",detail:"Une erreur est survenue",life:3e3})}finally{b.value=!1}}},O=E=>{l.require({message:`Voulez-vous vraiment supprimer le type "${E.name}" ?`,header:"Confirmation",icon:"exclamation-triangle",acceptClass:"p-button-danger",accept:async()=>{try{await c.deleteType(E.id),_.add({severity:"success",summary:"Succès",detail:"Type supprimé",life:3e3}),u.value?.id===E.id&&f()}catch{_.add({severity:"error",summary:"Erreur",detail:"Impossible de supprimer ce type",life:3e3})}}})};return me(()=>e.visible,E=>{E&&c.fetchTypes()}),(E,I)=>{const M=Z("font-awesome-icon"),T=Ce;return p(),N(d(nt),{visible:t.visible,"onUpdate:visible":I[5]||(I[5]=h=>r("update:visible",h)),position:"right",style:{width:"40rem"}},{header:g(()=>[o("div",Ds,[a(M,{icon:"tags",class:"text-xl text-primary"}),I[6]||(I[6]=o("span",{class:"text-xl font-bold"},"Gérer les types d'actions",-1))])]),default:g(()=>[o("div",Es,[o("div",Vs,[n.value?(p(),y("div",js,[a(M,{icon:"spinner",spin:"",size:"2x",class:"text-color-secondary"})])):i.value.length===0?(p(),y("div",Is,[...I[7]||(I[7]=[o("p",null,"Aucun type d'action défini",-1)])])):(p(),y("div",Ts,[(p(!0),y(ce,null,de(i.value,h=>(p(),y("div",{key:h.id,onClick:x=>D(h),class:Q(["relative flex items-center justify-between p-4 rounded-xl border transition-all cursor-pointer group",[u.value?.id===h.id?"border-primary bg-primary-50 dark:bg-primary-900/20":"border-surface-border bg-surface-card hover:border-primary-200 hover:shadow-sm"]])},[o("div",Us,[o("div",{class:"w-10 h-10 rounded-lg flex items-center justify-center text-white shadow-sm",style:se({backgroundColor:h.color||"#3b82f6"})},[a(M,{icon:h.icon||"tag",class:"text-lg"},null,8,["icon"])],4),o("div",null,[o("div",Ls,$(h.name),1),o("div",zs,$(h.description),1)])]),u.value?.id!==h.id?(p(),y("div",Ps,[te((p(),N(d(L),{icon:"pi pi-trash",text:"",rounded:"",severity:"danger",size:"small",class:"opacity-0 group-hover:opacity-100 transition-opacity",onClick:_e(x=>O(h),["stop"])},{icon:g(()=>[a(M,{icon:"trash",class:"text-sm"})]),_:1},8,["onClick"])),[[T,"Supprimer",void 0,{top:!0}]])])):(p(),y("div",Bs,[a(M,{icon:"pen",class:"text-primary text-sm"})]))],10,Fs))),128))]))]),o("div",qs,[o("div",Os,[o("h3",Ms,$(u.value?"Modifier le type":"Nouveau type"),1),u.value?(p(),N(d(L),{key:0,label:"Nouveau type",icon:"pi pi-plus",size:"small",severity:"secondary",outlined:"",onClick:f},{icon:g(()=>[a(M,{icon:"plus",class:"mr-2"})]),_:1})):q("",!0)]),o("form",{onSubmit:_e(V,["prevent"]),class:"flex flex-col gap-4"},[o("div",null,[I[8]||(I[8]=o("label",{class:"block text-sm font-medium mb-1 text-color-secondary"},"Nom *",-1)),a(d(ae),{modelValue:C.value.name,"onUpdate:modelValue":I[0]||(I[0]=h=>C.value.name=h),placeholder:"Ex: Audit sécurité",class:Q(["w-full",{"p-invalid":k.value&&!C.value.name}])},null,8,["modelValue","class"]),k.value&&!C.value.name?(p(),y("small",Rs,"Le nom est requis")):q("",!0)]),o("div",null,[I[9]||(I[9]=o("label",{class:"block text-sm font-medium mb-1 text-color-secondary"},"Description",-1)),a(d(ke),{modelValue:C.value.description,"onUpdate:modelValue":I[1]||(I[1]=h=>C.value.description=h),rows:"2",class:"w-full",placeholder:"Brève description..."},null,8,["modelValue"])]),o("div",Ns,[o("div",null,[I[10]||(I[10]=o("label",{class:"block text-sm font-medium mb-1 text-color-secondary"},"Couleur",-1)),o("div",Gs,[a(d(it),{modelValue:C.value.color,"onUpdate:modelValue":I[2]||(I[2]=h=>C.value.color=h),format:"hex",class:"w-full"},null,8,["modelValue"]),o("div",{style:se({backgroundColor:`#${C.value.color}`,width:"2rem",height:"2rem",borderRadius:"4px"}),class:"border border-surface-border"},null,4)])]),o("div",null,[I[11]||(I[11]=o("label",{class:"block text-sm font-medium mb-1 text-color-secondary"},"Icône",-1)),a(Ss,{modelValue:C.value.icon,"onUpdate:modelValue":I[3]||(I[3]=h=>C.value.icon=h)},null,8,["modelValue"])])]),o("div",Hs,[u.value?(p(),N(d(L),{key:0,label:"Supprimer",severity:"danger",text:"",onClick:I[4]||(I[4]=h=>O(u.value)),size:"small",class:"mr-auto"},{icon:g(()=>[a(M,{icon:"trash",class:"mr-2"})]),_:1})):q("",!0),a(d(L),{type:"submit",label:u.value?"Enregistrer":"Ajouter",loading:b.value},{icon:g(()=>[a(M,{icon:u.value?"check":"plus",class:"mr-2"},null,8,["icon"])]),_:1},8,["label","loading"])])],32)])])]),_:1},8,["visible"])}}}),Js=vt(Qs,[["__scopeId","data-v-da6aefed"]]),Ks={class:"p-4"},Zs={class:"flex flex-col md:flex-row md:items-center md:justify-between mb-6 gap-4"},Ws={class:"flex items-center gap-4"},Xs={class:"flex gap-2"},Ys={class:"flex flex-wrap items-center justify-between gap-2 mb-2"},eo={class:"flex flex-wrap gap-2"},to={class:"font-medium"},so={class:"text-sm text-gray-500 truncate max-w-xs"},oo={key:0,class:"flex items-center gap-2"},ro={key:1,class:"text-gray-400 italic"},ao={class:"flex gap-2"},io=K({__name:"ActionConfig",setup(t){const s=ge(),e=ve(),r=Se(),c=$e(),l=ue(),_=j(""),i=j(null),n=j(null),u=j(null),b=j(10),k=j(0),C=j(!1),f=H(()=>e.actions),D=H(()=>e.loading),V=H(()=>e.pagination.total),O=H(()=>(r.types||[]).map(U=>({label:U.name,value:U.id}))),E=[{label:"Basse",value:"low"},{label:"Moyenne",value:"medium"},{label:"Haute",value:"high"},{label:"Critique",value:"critical"}],I=[{label:"Ouvert",value:"open"},{label:"En cours",value:"in_progress"},{label:"Terminé",value:"completed"},{label:"Annulé",value:"cancelled"}],M=async()=>{const U={search:_.value,action_type_id:i.value,priority:n.value,status:u.value};await e.fetchActions(k.value+1,b.value,U)},T=U=>{k.value=U.page,b.value=U.rows,M()},h=U=>({low:"Basse",medium:"Moyenne",high:"Haute",critical:"Critique"})[U]||U,x=U=>({low:"info",medium:"warn",high:"danger",critical:"danger"})[U]||"info",m=U=>({open:"Ouvert",in_progress:"En cours",completed:"Terminé",cancelled:"Annulé"})[U]||U,z=U=>({open:"info",in_progress:"warn",completed:"success",cancelled:"secondary"})[U]||"secondary",A=U=>U?new Date(U).toLocaleDateString("fr-FR",{day:"2-digit",month:"2-digit",year:"numeric"}):"-",W=(U,R)=>!U||R==="completed"||R==="cancelled"?!1:new Date(U)<new Date,J=U=>`${U.first_name.charAt(0)}${U.last_name.charAt(0)}`.toUpperCase(),De=()=>{s.push("/actions/create")},Ee=()=>s.back(),Ve=U=>{s.push(`/actions/${U}`)},je=U=>{s.push(`/actions/${U}/edit`)},Ie=U=>{c.require({message:`Voulez-vous vraiment supprimer l'action "${U.title}" ?`,header:"Confirmation de suppression",icon:"exclamation-triangle",rejectLabel:"Annuler",acceptLabel:"Supprimer",rejectClass:"p-button-secondary p-button-outlined",acceptClass:"p-button-danger",accept:async()=>{try{await e.deleteAction(U.id),l.add({severity:"success",summary:"Succès",detail:"Action supprimée",life:3e3,icon:"check"}),M()}catch{l.add({severity:"error",summary:"Erreur",detail:"Impossible de supprimer l'action",life:3e3,icon:"times"})}}})};return me([_,i,n,u],()=>{k.value=0,M()}),pe(()=>{r.fetchTypes(),M()}),(U,R)=>{const Y=Z("font-awesome-icon"),Te=X,fe=Ce;return p(),y("div",Ks,[o("div",Zs,[o("div",Ws,[a(d(L),{text:"",rounded:"",severity:"secondary",onClick:Ee},{icon:g(()=>[a(Y,{icon:"arrow-left"})]),_:1}),R[6]||(R[6]=o("h2",{class:"mt-0!"},"Gérer les actions",-1))]),o("div",Xs,[a(d(L),{label:"Gérer les types",icon:"pi pi-tags",severity:"secondary",outlined:"",onClick:R[0]||(R[0]=F=>C.value=!0)},{icon:g(()=>[a(Y,{icon:"tags",class:"mr-2"})]),_:1}),a(d(L),{label:"Nouvelle action",onClick:De,severity:"primary"},{icon:g(()=>[a(Y,{icon:"plus",class:"mr-2"})]),_:1})])]),a(Te,null,{content:g(()=>[a(Js,{visible:C.value,"onUpdate:visible":R[1]||(R[1]=F=>C.value=F)},null,8,["visible"]),a(d(lt),{ref:"dt",value:f.value,lazy:"",paginator:!0,rows:b.value,totalRecords:V.value,loading:D.value,onPage:T,paginatorTemplate:"FirstPageLink PrevPageLink PageLinks NextPageLink LastPageLink CurrentPageReport RowsPerPageDropdown",rowsPerPageOptions:[5,10,25,50],currentPageReportTemplate:"Affichage de {first} à {last} sur {totalRecords} actions",tableStyle:"min-width: 50rem",class:"p-datatable-sm"},{header:g(()=>[o("div",Ys,[o("div",eo,[a(d(ee),{modelValue:i.value,"onUpdate:modelValue":R[2]||(R[2]=F=>i.value=F),options:O.value,optionLabel:"label",optionValue:"value",placeholder:"Type",class:"w-full md:w-40",showClear:""},null,8,["modelValue","options"]),a(d(ee),{modelValue:n.value,"onUpdate:modelValue":R[3]||(R[3]=F=>n.value=F),options:E,optionLabel:"label",optionValue:"value",placeholder:"Priorité",class:"w-full md:w-40",showClear:""},null,8,["modelValue"]),a(d(ee),{modelValue:u.value,"onUpdate:modelValue":R[4]||(R[4]=F=>u.value=F),options:I,optionLabel:"label",optionValue:"value",placeholder:"Statut",class:"w-full md:w-40",showClear:""},null,8,["modelValue"])]),a(d(Me),{iconPosition:"left"},{default:g(()=>[a(d(Re),null,{default:g(()=>[a(Y,{icon:"magnifying-glass"})]),_:1}),a(d(ae),{modelValue:_.value,"onUpdate:modelValue":R[5]||(R[5]=F=>_.value=F),placeholder:"Rechercher..."},null,8,["modelValue"])]),_:1})])]),empty:g(()=>[...R[7]||(R[7]=[xe(" Aucune action trouvée. ",-1)])]),default:g(()=>[a(d(oe),{field:"title",header:"Titre",sortable:"",style:{"min-width":"14rem"}},{body:g(({data:F})=>[o("div",to,$(F.title),1),o("div",so,$(F.description),1)]),_:1}),a(d(oe),{field:"action_type_id",header:"Type",sortable:"",style:{"min-width":"8rem"}},{body:g(({data:F})=>[a(d(le),{value:F.action_type?.name||"-",style:se({backgroundColor:F.action_type?.color})},null,8,["value","style"])]),_:1}),a(d(oe),{field:"priority",header:"Priorité",sortable:"",style:{"min-width":"8rem"}},{body:g(({data:F})=>[a(d(le),{value:h(F.priority),severity:x(F.priority)},null,8,["value","severity"])]),_:1}),a(d(oe),{field:"status",header:"Statut",sortable:"",style:{"min-width":"8rem"}},{body:g(({data:F})=>[a(d(le),{value:m(F.status),severity:z(F.status)},null,8,["value","severity"])]),_:1}),a(d(oe),{field:"assigned_to",header:"Responsable",sortable:"",style:{"min-width":"10rem"}},{body:g(({data:F})=>[F.assignee?(p(),y("div",oo,[a(d(ne),{label:J(F.assignee),shape:"circle",size:"small"},null,8,["label"]),o("span",null,$(F.assignee.first_name)+" "+$(F.assignee.last_name),1)])):(p(),y("span",ro,"Non assigné"))]),_:1}),a(d(oe),{field:"progress",header:"Progression",sortable:"",style:{"min-width":"10rem"}},{body:g(({data:F})=>[a(d(ct),{value:F.progress,showValue:!0,style:{height:"1rem"}},null,8,["value"])]),_:1}),a(d(oe),{field:"due_date",header:"Échéance",sortable:"",style:{"min-width":"10rem"}},{body:g(({data:F})=>[o("span",{class:Q({"text-red-500 font-bold":W(F.due_date,F.status)})},$(A(F.due_date)),3)]),_:1}),a(d(oe),{header:"Actions",exportable:!1,style:{"min-width":"8rem"}},{body:g(({data:F})=>[o("div",ao,[te((p(),N(d(L),{text:"",rounded:"",severity:"info",onClick:ye=>Ve(F.id)},{default:g(()=>[a(Y,{icon:"eye"})]),_:1},8,["onClick"])),[[fe,"Voir",void 0,{top:!0}]]),te((p(),N(d(L),{text:"",rounded:"",severity:"success",onClick:ye=>je(F.id)},{default:g(()=>[a(Y,{icon:"pencil"})]),_:1},8,["onClick"])),[[fe,"Modifier",void 0,{top:!0}]]),te((p(),N(d(L),{text:"",rounded:"",severity:"danger",onClick:ye=>Ie(F)},{default:g(()=>[a(Y,{icon:"trash"})]),_:1},8,["onClick"])),[[fe,"Supprimer",void 0,{top:!0}]])])]),_:1})]),_:1},8,["value","rows","totalRecords","loading"])]),_:1})])}}}),ha=Object.freeze(Object.defineProperty({__proto__:null,default:io},Symbol.toStringTag,{value:"Module"})),no=ie("indicator",{state:()=>({indicators:[],currentIndicator:null,loading:!1,error:null,pagination:{page:1,limit:10,total:0,totalPages:1}}),getters:{indicatorById:t=>s=>t.indicators.find(e=>e.id===s)},actions:{async fetchIndicators(t=1,s=10,e={}){this.loading=!0,this.error=null;try{const{get:r}=S(),c=new URLSearchParams({page:t.toString(),limit:s.toString()});Object.entries(e).forEach(([_,i])=>{i!=null&&i!==""&&c.append(_,String(i))});const l=await r(`/indicators?${c.toString()}`);l.success&&l.data?Ae(l.data)?(this.indicators=l.data.data||[],this.pagination={...this.pagination,page:l.data.current_page||t,limit:l.data.per_page||s,total:l.data.total||this.indicators.length,totalPages:l.data.last_page||1}):(this.indicators=Array.isArray(l.data)?l.data:[l.data],this.pagination={...this.pagination,page:t,limit:s,total:this.indicators.length,totalPages:Math.ceil(this.indicators.length/s)}):this.error=l.error||"Failed to fetch indicators"}catch(r){this.error="An error occurred while fetching indicators",console.error(r)}finally{this.loading=!1}},async fetchIndicatorById(t){this.loading=!0,this.error=null;try{const{get:s}=S(),e=await s(`/indicators/${t}`);e.success&&e.data?this.currentIndicator=e.data:this.error=e.error||"Failed to fetch indicator"}catch(s){this.error="An error occurred while fetching indicator",console.error(s)}finally{this.loading=!1}},async createIndicator(t){this.loading=!0,this.error=null;try{const{post:s}=S(),e=await s("/indicators",t);if(e.success&&e.data)this.indicators.unshift(e.data),this.currentIndicator=e.data;else throw this.error=e.error||"Failed to create indicator",new Error(this.error)}catch(s){throw this.error="An error occurred while creating indicator",console.error(s),s}finally{this.loading=!1}},async updateIndicator(t,s){this.loading=!0,this.error=null;try{const{put:e}=S(),r=await e(`/indicators/${t}`,s);if(r.success&&r.data){const c=this.indicators.findIndex(l=>l.id===t);c!==-1&&(this.indicators[c]=r.data),this.currentIndicator=r.data}else throw this.error=r.error||"Failed to update indicator",new Error(this.error)}catch(e){throw this.error="An error occurred while updating indicator",console.error(e),e}finally{this.loading=!1}},async deleteIndicator(t){this.loading=!0,this.error=null;try{const{del:s}=S(),e=await s(`/indicators/${t}`);if(e.success)this.indicators=this.indicators.filter(r=>r.id!==t),this.currentIndicator?.id===t&&(this.currentIndicator=null);else throw this.error=e.error||"Failed to delete indicator",new Error(this.error)}catch(s){throw this.error="An error occurred while deleting indicator",console.error(s),s}finally{this.loading=!1}},async toggleActivation(t){this.loading=!0,this.error=null;try{const{post:s}=S(),e=await s(`/indicators/${t}/toggle-activation`,{});if(e.success&&e.data){const r=this.indicators.findIndex(c=>c.id===t);r!==-1&&(this.indicators[r]=e.data),this.currentIndicator?.id===t&&(this.currentIndicator=e.data)}else throw this.error=e.error||"Failed to toggle activation",new Error(this.error)}catch(s){throw this.error="An error occurred while toggling activation",console.error(s),s}finally{this.loading=!1}},async addIndicatorValue(t,s){this.loading=!0,this.error=null;try{const{post:e}=S(),r=await e(`/indicators/${t}/values`,s);if(r.success&&r.data)await this.fetchIndicatorById(t);else throw this.error=r.error||"Failed to add indicator value",new Error(this.error)}catch(e){throw this.error="An error occurred while adding indicator value",console.error(e),e}finally{this.loading=!1}},async updateIndicatorValue(t,s,e){this.loading=!0,this.error=null;try{const{put:r}=S(),c=await r(`/indicator-values/${s}`,e);if(c.success&&c.data)await this.fetchIndicatorById(t);else throw this.error=c.error||"Failed to update indicator value",new Error(this.error)}catch(r){throw this.error="An error occurred while updating indicator value",console.error(r),r}finally{this.loading=!1}},async deleteIndicatorValue(t,s){this.loading=!0,this.error=null;try{const{del:e}=S(),r=await e(`/indicator-values/${s}`);if(r.success)await this.fetchIndicatorById(t);else throw this.error=r.error||"Failed to delete indicator value",new Error(this.error)}catch(e){throw this.error="An error occurred while deleting indicator value",console.error(e),e}finally{this.loading=!1}}}}),lo={class:"document-selector"},co={class:"flex items-center gap-2"},uo={class:"w-8 h-8 flex items-center justify-center bg-gray-100 rounded text-gray-500"},mo={class:"flex flex-col"},po={class:"font-medium"},fo={class:"text-xs text-gray-500"},ho=K({__name:"DocumentSelector",emits:["select"],setup(t,{emit:s}){const e=s,{get:r}=S(),c=j(null),l=j([]),_=async u=>{try{const b=await r(`/documents?search=${u.query}&limit=10`);if(b.success&&b.data){const k=b.data.data?b.data.data:b.data;l.value=k}}catch(b){console.error("Search failed",b),l.value=[]}},i=u=>{e("select",u.value)},n=u=>{switch(u.split(".").pop()?.toLowerCase()){case"pdf":return["fas","file-pdf"];case"doc":case"docx":return["fas","file-word"];case"xls":case"xlsx":return["fas","file-excel"];case"jpg":case"jpeg":case"png":return["fas","file-image"];default:return["fas","file"]}};return(u,b)=>{const k=Z("font-awesome-icon");return p(),y("div",lo,[a(d(dt),{modelValue:c.value,"onUpdate:modelValue":b[0]||(b[0]=C=>c.value=C),suggestions:l.value,onComplete:_,optionLabel:"title",placeholder:"Rechercher un document (titre, fichier...)",class:"w-full",delay:300,forceSelection:"",onItemSelect:i,dropdown:""},{option:g(C=>[o("div",co,[o("div",uo,[a(k,{icon:n(C.option.filename)},null,8,["icon"])]),o("div",mo,[o("span",po,$(C.option.title),1),o("span",fo,$(C.option.filename)+" ("+$(C.option.version)+")",1)])])]),_:1},8,["modelValue","suggestions"])])}}}),go={class:"flex justify-between items-center mb-4"},vo={key:0,class:"flex gap-2"},yo={key:0,class:"flex justify-center py-8"},bo={key:1,class:"text-center py-8 text-color-secondary"},_o={key:2,class:"space-y-4"},xo={class:"flex items-center gap-3"},wo={class:"w-10 h-10 rounded-lg bg-blue-50 text-blue-600 flex items-center justify-center text-xl"},ko=["onClick"],$o={class:"text-xs text-color-secondary"},Co={key:0},Ao={class:"flex gap-2"},So={class:"flex flex-col gap-4"},Do=K({__name:"LinkedDocuments",props:{documents:{},title:{default:"Documents liés"},readonly:{type:Boolean,default:!1},loading:{type:Boolean,default:!1},initialStatus:{default:"approved"}},emits:["request-link","request-unlink","request-create","request-download"],setup(t,{emit:s}){const e=t,r=s,c=j(!1),l=j(!1),_={status:e.initialStatus,version:"1.0"},i=f=>{if(!f)return["fas","file"];switch(f.split(".").pop()?.toLowerCase()){case"pdf":return["fas","file-pdf"];case"doc":case"docx":return["fas","file-word"];case"xls":case"xlsx":return["fas","file-excel"];case"jpg":case"jpeg":case"png":return["fas","file-image"];default:return["fas","file"]}},n=f=>f?Qe(new Date(f),"dd MMM yyyy",{locale:ht}):"-",u=f=>{if(f===0)return"0 B";const D=1024,V=["B","KB","MB","GB"],O=Math.floor(Math.log(f)/Math.log(D));return parseFloat((f/Math.pow(D,O)).toFixed(2))+" "+V[O]},b=f=>{r("request-link",f),l.value=!1},k=f=>{r("request-create",f),c.value=!1},C=f=>{r("request-unlink",f)};return(f,D)=>{const V=Z("font-awesome-icon"),O=Ce;return p(),N(d(X),null,{content:g(()=>[o("div",go,[o("h4",null,$(t.title||"Documents liés"),1),t.readonly?q("",!0):(p(),y("div",vo,[a(d(L),{label:"Lier un existant",size:"small",severity:"secondary",outlined:"",onClick:D[0]||(D[0]=E=>l.value=!0)},{icon:g(()=>[a(V,{icon:"link",class:"mr-2"})]),_:1}),a(d(L),{label:"Ajouter",size:"small",onClick:D[1]||(D[1]=E=>c.value=!0)},{icon:g(()=>[a(V,{icon:"plus",class:"mr-2"})]),_:1})]))]),t.loading?(p(),y("div",yo,[a(V,{icon:"spinner",spin:"",size:"2x",class:"text-color-secondary"})])):!t.documents||t.documents.length===0?(p(),y("div",bo,[...D[5]||(D[5]=[o("p",null,"Aucun document lié",-1)])])):(p(),y("div",_o,[(p(!0),y(ce,null,de(t.documents,E=>(p(),y("div",{key:E.id,class:"flex justify-between items-center border-b border-surface-border last:border-0 pb-4 last:pb-0"},[o("div",xo,[o("div",wo,[a(V,{icon:i(E.filename)},null,8,["icon"])]),o("div",null,[o("p",{class:"font-medium text-color cursor-pointer hover:text-primary transition-colors",onClick:I=>f.$emit("request-download",E)},$(E.title||E.filename),9,ko),o("p",$o,[xe($(n(E.created_at))+" ",1),E.file_size?(p(),y("span",Co," • "+$(u(E.file_size)),1)):q("",!0)])])]),o("div",Ao,[te((p(),N(d(L),{text:"",rounded:"","aria-label":"Télécharger",onClick:I=>f.$emit("request-download",E)},{icon:g(()=>[a(V,{icon:"download"})]),_:1},8,["onClick"])),[[O,"Télécharger",void 0,{top:!0}]]),t.readonly?q("",!0):te((p(),N(d(L),{key:0,text:"",rounded:"",severity:"danger","aria-label":"Délier",onClick:I=>C(E)},{icon:g(()=>[a(V,{icon:"unlink"})]),_:1},8,["onClick"])),[[O,"Délier",void 0,{top:!0}]])])]))),128))])),a(d(be),{visible:c.value,"onUpdate:visible":D[3]||(D[3]=E=>c.value=E),header:"Ajouter un document",modal:!0,class:"p-fluid w-full max-w-2xl"},{default:g(()=>[a(Gt,{"initial-data":_,"submit-button-text":"Ajouter",loading:t.loading,onSubmit:k,onCancel:D[2]||(D[2]=E=>c.value=!1)},null,8,["loading"])]),_:1},8,["visible"]),a(d(be),{visible:l.value,"onUpdate:visible":D[4]||(D[4]=E=>l.value=E),header:"Lier un document existant",modal:!0,class:"p-fluid w-full max-w-lg"},{default:g(()=>[o("div",So,[D[6]||(D[6]=o("p",{class:"text-sm text-color-secondary"}," Recherchez un document existant dans la GED pour le lier. ",-1)),a(ho,{onSelect:b})])]),_:1},8,["visible"])]),_:1})}}}),Eo={class:"p-4"},Vo={class:"flex flex-col md:flex-row md:items-center md:justify-between mb-6 gap-4"},jo={class:"flex items-center gap-4"},Io={class:"flex items-center gap-3"},To={class:"flex gap-2"},Fo={key:0,class:"flex justify-center py-12"},Uo={key:1,class:"grid grid-cols-1 lg:grid-cols-3 gap-6"},Lo={class:"lg:col-span-2 space-y-6"},zo={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},Po={class:"flex items-center gap-2"},Bo={class:"font-medium text-lg"},qo={key:0,class:"flex items-center gap-3"},Oo={class:"font-medium"},Mo={key:1,class:"text-color-secondary italic"},Ro={class:"flex items-center gap-3"},No={class:"font-medium"},Go={class:"text-xs text-color-secondary"},Ho={key:0},Qo={class:"flex items-center gap-2"},Jo={key:1},Ko={class:"flex items-center gap-2"},Zo={class:"font-medium text-green-600"},Wo={class:"md:col-span-2"},Xo={class:"p-3 bg-surface-50 dark:bg-surface-800 rounded-lg text-color border border-surface-200 dark:border-surface-700 leading-relaxed whitespace-pre-line"},Yo={class:"flex items-center justify-between"},er={key:0,class:"grid grid-cols-1 sm:grid-cols-2 gap-2"},tr={class:"flex items-center gap-2"},sr={class:"w-10 h-10 rounded bg-orange-50 flex items-center justify-center text-orange-500 text-xs"},or={class:"flex flex-col gap-2"},rr={class:"font-bold text-color"},ar={key:1,class:"text-color-secondary italic"},ir={class:"space-y-6"},nr={class:"flex flex-col items-center gap-4"},lr={class:"text-center"},cr={class:"flex gap-2 justify-center"},dr={class:"space-y-6"},ur={key:0,class:"space-y-4"},mr={class:"flex-1"},pr={class:"flex items-center gap-2 mb-1 w-full justify-between"},fr={class:"flex items-center gap-2"},hr={class:"font-bold text-sm"},gr={class:"text-xs text-color-secondary"},vr={class:"text-color text-sm whitespace-pre-wrap bg-surface-50 dark:bg-surface-800 p-3 rounded-lg rounded-tl-none border border-surface-border"},yr={key:1,class:"text-color-secondary italic text-sm"},br={class:"border-t border-surface-border pt-4 mt-2"},_r={class:"flex flex-col gap-2"},xr={class:"flex justify-end"},wr={key:2,class:"text-center py-12"},kr={class:"flex flex-col gap-4"},$r={class:"relative w-full"},Cr={class:"absolute top-1/2 -translate-y-1/2 left-3 text-surface-500 z-10"},Ar={class:"flex align-items-center gap-2"},Sr={class:"font-medium"},Dr=K({__name:"ActionDetail",setup(t){const s=Ne(),e=ge(),r=ve(),c=Ze(),l=yt(),_=no(),i=ue(),{post:n}=S(),u=Number(s.params.id),b=j(!0),k=j(!1),C=j(0),f=H(()=>r.currentAction),D=async w=>{b.value=!0;try{const v=new FormData;Object.keys(w).forEach(G=>{G!=="file"&&w[G]!==null&&w[G]!==void 0&&(w[G]instanceof Date?v.append(G,Qe(w[G],"yyyy-MM-dd")):v.append(G,String(w[G])))}),w.file&&v.append("file",w.file),v.append("action_id",u.toString());const P=await n("/documents",v);if(P.success)i.add({severity:"success",summary:"Succès",detail:"Document ajouté",life:3e3}),await r.fetchActionById(u);else throw new Error(P.error||"Erreur lors de l'ajout")}catch(v){console.error(v),i.add({severity:"error",summary:"Erreur",detail:v instanceof Error?v.message:"Échec de l'upload",life:3e3})}finally{b.value=!1}},V=async w=>{try{await r.linkDocument(u,w.id),i.add({severity:"success",summary:"Succès",detail:"Document lié avec succès",life:3e3})}catch{i.add({severity:"error",summary:"Erreur",detail:"Erreur lors de la liaison du document",life:3e3})}},O=async w=>{try{await r.unlinkDocument(u,w.id),i.add({severity:"success",summary:"Succès",detail:"Document délié avec succès",life:3e3})}catch{i.add({severity:"error",summary:"Erreur",detail:"Erreur lors du déliage du document",life:3e3})}},E=async w=>{try{await l.downloadDocument(w.id,w.filename),i.add({severity:"success",summary:"Succès",detail:"Téléchargement démarré",life:3e3})}catch{i.add({severity:"error",summary:"Erreur",detail:"Erreur lors du téléchargement",life:3e3})}},I=j(!1),M=j(null),T=j(""),h=j(!1),x=()=>{M.value=null,T.value="",_.fetchIndicators(1,100),I.value=!0},m=H(()=>{if(!_.indicators)return[];const w=f.value?.indicators?.map(P=>P.id)||[];let v=_.indicators.filter(P=>!w.includes(P.id));if(T.value){const P=T.value.toLowerCase();v=v.filter(G=>G.name.toLowerCase().includes(P)||G.code.toLowerCase().includes(P))}return v}),z=async()=>{if(M.value){h.value=!0;try{await r.linkIndicator(u,M.value.id),i.add({severity:"success",summary:"Succès",detail:"Indicateur lié avec succès",life:3e3}),I.value=!1}catch{i.add({severity:"error",summary:"Erreur",detail:"Erreur lors de la liaison de l'indicateur",life:3e3})}finally{h.value=!1}}},A=async w=>{try{await r.unlinkIndicator(u,w),i.add({severity:"success",summary:"Succès",detail:"Indicateur délié avec succès",life:3e3})}catch{i.add({severity:"error",summary:"Erreur",detail:"Erreur lors du déliage de l'indicateur",life:3e3})}},W=j(""),J=j(!1),De=async()=>{if(W.value.trim()){J.value=!0;try{await r.addComment(u,W.value),W.value="",i.add({severity:"success",summary:"Succès",detail:"Commentaire ajouté",life:3e3})}catch{i.add({severity:"error",summary:"Erreur",detail:"Impossible d'ajouter le commentaire",life:3e3})}finally{J.value=!1}}};pe(async()=>{u&&(b.value=!0,await r.fetchActionById(u),b.value=!1)});const Ee=w=>w?{low:"Basse",medium:"Moyenne",high:"Haute",critical:"Critique"}[w]||w:"-",Ve=w=>w?{low:"info",medium:"warn",high:"danger",critical:"danger"}[w]||"info":"secondary",je=w=>w?{open:"Ouvert",in_progress:"En cours",completed:"Terminé",cancelled:"Annulé"}[w]||w:"-",Ie=w=>w&&{open:"info",in_progress:"warn",completed:"success",cancelled:"secondary"}[w]||"secondary",U=w=>w?new Date(w).toLocaleDateString("fr-FR",{day:"2-digit",month:"2-digit",year:"numeric"}):"-",R=w=>w?new Date(w).toLocaleString("fr-FR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}):"-",Y=(w,v)=>{if(!w||!v||v==="completed"||v==="cancelled")return"text-color";const P=new Date,B=new Date(w).getTime()-P.getTime(),he=Math.ceil(B/(1e3*60*60*24));return he<0?"text-red-600 font-bold":he<=3?"text-orange-500 font-bold":he<=7?"text-yellow-600":"text-color"},Te=w=>{const v=c.currentUser;return v?v.role==="admin"||v.id===w.user_id:!1},fe=$e(),F=w=>{fe.require({message:"Êtes-vous sûr de vouloir supprimer ce commentaire ?",header:"Confirmation de suppression",icon:"pi pi-exclamation-triangle",rejectLabel:"Annuler",acceptLabel:"Supprimer",rejectClass:"p-button-secondary p-button-outlined",acceptClass:"p-button-danger",accept:()=>{ye(w)}})},ye=async w=>{try{await r.deleteComment(w),i.add({severity:"success",summary:"Succès",detail:"Commentaire supprimé",life:3e3})}catch{i.add({severity:"error",summary:"Erreur",detail:"Erreur lors de la suppression du commentaire",life:3e3})}},Fe=w=>w?`${w.first_name.charAt(0)}${w.last_name.charAt(0)}`.toUpperCase():"?",Xe=w=>{let v=0;for(let G=0;G<w.length;G++)v=w.charCodeAt(G)+((v<<5)-v);const P=(v&16777215).toString(16).toUpperCase();return"#"+"00000".substring(0,6-P.length)+P},ze=()=>{e.back()},Ye=()=>{e.push(`/actions/${u}/edit`)},et=()=>{Le()},tt=()=>{Le()},Ue=j(null),Pe=w=>{let v=C.value+w;v<0&&(v=0),v>100&&(v=100),C.value=v,Ue.value&&clearTimeout(Ue.value),Ue.value=setTimeout(()=>{Le()},1e3)},st=w=>w<30?"#ef4444":w<70?"#f59e0b":"#22c55e",Le=async()=>{if(C.value!==f.value?.progress){k.value=!0;try{await r.updateProgress(u,C.value),i.add({severity:"success",summary:"Succès",detail:"Progression mise à jour",life:3e3})}catch{i.add({severity:"error",summary:"Erreur",detail:"Erreur lors de la mise à jour de la progression",life:3e3})}finally{k.value=!1}}};return me(f,w=>{w&&(C.value=w.progress||0)},{immediate:!0}),(w,v)=>{const P=Z("font-awesome-icon"),G=Ce;return p(),y("div",Eo,[o("div",Vo,[o("div",jo,[a(d(L),{text:"",rounded:"",severity:"secondary",onClick:ze},{icon:g(()=>[a(P,{icon:"arrow-left"})]),_:1}),o("div",null,[o("div",Io,[o("h2",null,$(f.value?.title),1),a(d(le),{value:je(f.value?.status),severity:Ie(f.value?.status)},null,8,["value","severity"])])])]),o("div",To,[a(d(L),{label:"Modifier",onClick:Ye,severity:"warning",outlined:""},{icon:g(()=>[a(P,{icon:"pencil",class:"mr-2"})]),_:1})])]),b.value?(p(),y("div",Fo,[a(P,{icon:["fas","spinner"],spin:"",size:"2x",class:"text-color-secondary"})])):f.value?(p(),y("div",Uo,[o("div",Lo,[a(d(X),null,{title:g(()=>[...v[8]||(v[8]=[o("h4",null,"Informations",-1)])]),content:g(()=>[o("div",zo,[o("div",null,[v[9]||(v[9]=o("span",{class:"block font-bold text-color-secondary mb-1"},"Type : ",-1)),o("div",Po,[o("div",{class:"w-8 h-8 rounded flex items-center justify-center",style:se({backgroundColor:f.value.action_type?.color+"20",color:f.value.action_type?.color})},[a(P,{icon:["fas",f.value.action_type?.icon||"tasks"]},null,8,["icon"])],4),o("span",Bo,$(f.value.action_type?.name||"-"),1)])]),o("div",null,[v[10]||(v[10]=o("span",{class:"block font-bold text-color-secondary mb-1"},"Priorité : ",-1)),a(d(le),{value:Ee(f.value.priority),severity:Ve(f.value.priority),class:"text-sm px-3 py-1"},null,8,["value","severity"])]),o("div",null,[v[11]||(v[11]=o("span",{class:"block font-bold text-color-secondary mb-1"},"Responsable : ",-1)),f.value.assignee?(p(),y("div",qo,[a(d(ne),{label:Fe(f.value.assignee),shape:"circle",size:"normal",class:"bg-primary-100 text-primary-700"},null,8,["label"]),o("div",null,[o("div",Oo,$(f.value.assignee.first_name)+" "+$(f.value.assignee.last_name),1)])])):(p(),y("span",Mo,"Non assigné"))]),o("div",null,[v[12]||(v[12]=o("span",{class:"block font-bold text-color-secondary mb-1"},"Créé par : ",-1)),o("div",Ro,[a(d(ne),{label:Fe(f.value.creator),shape:"circle",size:"normal",class:"bg-surface-200 text-surface-600"},null,8,["label"]),o("div",null,[o("div",No,$(f.value.creator?`${f.value.creator.first_name} ${f.value.creator.last_name}`:"Système"),1),o("div",Go," Le "+$(U(f.value.created_at)),1)])])]),f.value.due_date?(p(),y("div",Ho,[v[13]||(v[13]=o("span",{class:"block font-bold text-color-secondary mb-1"},"Échéance : ",-1)),o("div",Qo,[a(P,{icon:["fas","calendar"],class:"text-color-secondary"}),o("span",{class:Q(["font-medium",Y(f.value.due_date,f.value.status)])},$(U(f.value.due_date)),3)])])):q("",!0),f.value.completed_date?(p(),y("div",Jo,[v[14]||(v[14]=o("span",{class:"block font-bold text-color-secondary mb-1"},"Date de fin : ",-1)),o("div",Ko,[a(P,{icon:["fas","calendar-check"],class:"text-green-600"}),o("div",Zo,$(U(f.value.completed_date)),1)])])):q("",!0),o("div",Wo,[v[15]||(v[15]=o("span",{class:"block font-bold text-color-secondary mb-2"},"Description : ",-1)),o("div",Xo,$(f.value.description||"Aucune description."),1)])])]),_:1}),a(Do,{documents:f.value.documents||[],loading:b.value,onRequestCreate:D,onRequestLink:V,onRequestDownload:E,onRequestUnlink:O},null,8,["documents","loading"]),a(d(X),null,{title:g(()=>[o("div",Yo,[v[16]||(v[16]=o("h4",null,"Indicateurs liés",-1)),te((p(),N(d(L),{text:"",rounded:"",onClick:x},{icon:g(()=>[a(P,{icon:"plus"})]),_:1})),[[G,"Lier un indicateur"]])])]),content:g(()=>[f.value.indicators&&f.value.indicators.length>0?(p(),y("div",er,[(p(!0),y(ce,null,de(f.value.indicators,B=>(p(),y("div",{key:B.id,class:"flex items-center justify-between p-2 border rounded-lg hover:bg-surface-50 dark:hover:bg-surface-800 transition-colors group"},[o("div",tr,[o("div",sr,[a(P,{icon:"chart-line",class:"text-xl"})]),o("div",or,[o("span",rr,$(B.name),1)])]),te((p(),N(d(L),{text:"",rounded:"",severity:"danger",size:"small",class:"opacity-0 group-hover:opacity-100 transition-opacity",onClick:he=>A(B.id)},{icon:g(()=>[a(P,{icon:"xmark"})]),_:1},8,["onClick"])),[[G,"Délier",void 0,{top:!0}]])]))),128))])):(p(),y("p",ar,"Aucun indicateur lié."))]),_:1})]),o("div",ir,[a(d(X),null,{title:g(()=>[...v[17]||(v[17]=[o("h4",null,"Progression",-1)])]),content:g(()=>[o("div",nr,[a(d(ut),{modelValue:C.value,"onUpdate:modelValue":v[0]||(v[0]=B=>C.value=B),size:120,step:5,valueColor:st(C.value),rangeColor:"#e5e7eb",strokeWidth:15,valueTemplate:"{value}%",readonly:!1,onChange:tt},null,8,["modelValue","valueColor"]),o("div",lr,[v[18]||(v[18]=o("p",{class:"text-sm text-color-secondary"},"Modifier la progression",-1)),o("div",cr,[a(d(L),{size:"small",outlined:"",rounded:"",onClick:v[1]||(v[1]=B=>Pe(-10)),severity:"secondary",disabled:C.value<=0},{icon:g(()=>[a(P,{icon:"minus"})]),_:1},8,["disabled"]),C.value!==f.value?.progress?(p(),N(d(L),{key:0,size:"small",outlined:"",rounded:"",onClick:et,severity:"success",disabled:C.value===f.value?.progress},{icon:g(()=>[a(P,{icon:"check"})]),_:1},8,["disabled"])):q("",!0),a(d(L),{size:"small",outlined:"",rounded:"",onClick:v[2]||(v[2]=B=>Pe(10)),severity:"secondary",disabled:C.value>=100},{icon:g(()=>[a(P,{icon:"plus"})]),_:1},8,["disabled"])])])])]),_:1}),a(d(X),null,{title:g(()=>[...v[19]||(v[19]=[o("h4",null,"Commentaires",-1)])]),content:g(()=>[o("div",dr,[f.value.comments&&f.value.comments.length>0?(p(),y("div",ur,[(p(!0),y(ce,null,de(f.value.comments,B=>(p(),y("div",{key:B.id,class:"flex gap-4 group"},[a(d(ne),{label:Fe(B.user),shape:"circle",size:"normal",class:"shrink-0",style:se({backgroundColor:Xe(B.user?.username||""),color:"#fff"})},null,8,["label","style"]),o("div",mr,[o("div",pr,[o("div",fr,[o("span",hr,$(B.user?.first_name)+" "+$(B.user?.last_name),1),o("span",gr,$(R(B.created_at)),1)]),Te(B)?te((p(),N(d(L),{key:0,text:"",rounded:"",severity:"danger",size:"small",class:"w-6! h-6! opacity-0 group-hover:opacity-100 transition-opacity",onClick:he=>F(B.id)},{icon:g(()=>[a(P,{icon:"xmark",class:"text-xs"})]),_:1},8,["onClick"])),[[G,"Supprimer",void 0,{top:!0}]]):q("",!0)]),o("div",vr,$(B.content),1)])]))),128))])):(p(),y("p",yr,"Aucun commentaire.")),o("div",br,[o("div",_r,[a(d(ke),{modelValue:W.value,"onUpdate:modelValue":v[3]||(v[3]=B=>W.value=B),rows:"3",placeholder:"Écrire un commentaire...",class:"w-full",autoResize:""},null,8,["modelValue"]),o("div",xr,[a(d(L),{label:"Envoyer",size:"small",onClick:De,loading:J.value,disabled:!W.value.trim()},{icon:g(()=>[a(P,{icon:"paper-plane",class:"mr-2"})]),_:1},8,["loading","disabled"])])])])])]),_:1})])])):(p(),y("div",wr,[a(P,{icon:"exclamation-circle",class:"text-red-500 text-5xl mb-4"}),v[20]||(v[20]=o("h3",{class:"text-lg font-medium text-color"},"Action introuvable",-1)),a(d(L),{label:"Retour à la liste",onClick:ze,severity:"secondary",class:"mt-4"})])),a(d(be),{visible:I.value,"onUpdate:visible":v[7]||(v[7]=B=>I.value=B),header:"Lier un indicateur",style:{width:"40rem"},modal:""},{footer:g(()=>[a(d(L),{label:"Annuler",text:"",onClick:v[6]||(v[6]=B=>I.value=!1)},{icon:g(()=>[a(P,{icon:"xmark",class:"mr-2"})]),_:1}),a(d(L),{label:"Lier",onClick:z,disabled:!M.value,loading:h.value},{icon:g(()=>[a(P,{icon:"check",class:"mr-2"})]),_:1},8,["disabled","loading"])]),default:g(()=>[o("div",kr,[o("div",$r,[o("div",Cr,[a(P,{icon:"magnifying-glass"})]),a(d(ae),{modelValue:T.value,"onUpdate:modelValue":v[4]||(v[4]=B=>T.value=B),placeholder:"Rechercher un indicateur...",class:"w-full pl-12!",autofocus:""},null,8,["modelValue"])]),a(d(mt),{modelValue:M.value,"onUpdate:modelValue":v[5]||(v[5]=B=>M.value=B),options:m.value,optionLabel:"name",class:"w-full h-96",virtualScrollerOptions:{itemSize:50},listStyle:"height: 100%"},{option:g(B=>[o("div",Ar,[a(P,{icon:"chart-line",class:"text-orange-500"}),o("div",Sr,$(B.option.name),1)])]),_:1},8,["modelValue","options"])])]),_:1},8,["visible"])])}}}),ga=Object.freeze(Object.defineProperty({__proto__:null,default:Dr},Symbol.toStringTag,{value:"Module"})),Er=ie("user",{state:()=>({users:[],currentUser:null,loading:!1,error:null,pagination:{page:1,limit:15,total:0,totalPages:1}}),getters:{userById:t=>s=>t.users.find(e=>e.id===s)},actions:{async fetchUsers(t=1,s=15,e={}){this.loading=!0,this.error=null;try{const{get:r}=S(),c=new URLSearchParams({page:t.toString(),limit:s.toString()});Object.entries(e).forEach(([_,i])=>{i!=null&&i!==""&&c.append(_,String(i))});const l=await r(`/users?${c.toString()}`);l.success&&l.data?Ae(l.data)?(this.users=l.data.data||[],this.pagination={...this.pagination,page:l.data.current_page||t,limit:l.data.per_page||s,total:l.data.total||this.users.length,totalPages:l.data.last_page||1}):(this.users=Array.isArray(l.data)?l.data:[l.data],this.pagination={...this.pagination,page:t,limit:s,total:this.users.length,totalPages:Math.ceil(this.users.length/s)}):this.error=l.error||"Failed to fetch users"}catch(r){this.error="An error occurred while fetching users",console.error(r)}finally{this.loading=!1}},async fetchUserById(t){this.loading=!0,this.error=null;try{const{get:s}=S(),e=await s(`/users/${t}`);e.success&&e.data?this.currentUser=e.data:this.error=e.error||"Failed to fetch user"}catch(s){this.error="An error occurred while fetching user",console.error(s)}finally{this.loading=!1}},async createUser(t){this.loading=!0,this.error=null;try{const{post:s}=S(),e=await s("/users",t);if(e.success&&e.data)this.users.unshift(e.data),this.currentUser=e.data;else throw this.error=e.error||"Failed to create user",new Error(this.error)}catch(s){throw this.error="An error occurred while creating user",console.error(s),s}finally{this.loading=!1}},async updateUser(t,s){this.loading=!0,this.error=null;try{const{put:e}=S(),r=await e(`/users/${t}`,s);if(r.success&&r.data){const c=this.users.findIndex(l=>l.id===t);c!==-1&&(this.users[c]=r.data),this.currentUser=r.data}else throw this.error=r.error||"Failed to update user",new Error(this.error)}catch(e){throw this.error="An error occurred while updating user",console.error(e),e}finally{this.loading=!1}},async deleteUser(t){this.loading=!0,this.error=null;try{const{del:s}=S(),e=await s(`/users/${t}`);if(e.success)this.users=this.users.filter(r=>r.id!==t),this.currentUser?.id===t&&(this.currentUser=null);else throw this.error=e.error||"Failed to delete user",new Error(this.error)}catch(s){throw this.error="An error occurred while deleting user",console.error(s),s}finally{this.loading=!1}}}}),Vr={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},jr={class:"mb-2 col-span-1 md:col-span-2"},Ir={key:0,class:"text-red-500"},Tr={class:"mb-2"},Fr={key:0,class:"flex items-center gap-2"},Ur={key:1},Lr={class:"flex items-center gap-2"},zr={key:0,class:"text-red-500"},Pr={class:"mb-2"},Br={key:0,class:"flex items-center gap-2"},qr={key:1},Or={class:"flex items-center gap-2"},Mr={class:"mb-2"},Rr={key:0,class:"text-red-500"},Nr={class:"mb-2"},Gr={key:0,class:"text-red-500"},Hr={class:"mb-2"},Qr={class:"mb-2"},Jr={for:"progress",class:"block text-sm font-medium mb-2 text-color-secondary"},Kr={class:"mb-2"},Zr={class:"flex justify-end gap-3 pt-4 border-t border-surface-border"},We=K({__name:"ActionForm",props:{initialData:{default:()=>({title:"",description:"",action_type_id:null,priority:"",status:"open",assigned_to:null,due_date:null,progress:0,related_to:"",related_id:null})},submitButtonText:{default:"Enregistrer"},loading:{type:Boolean,default:!1}},emits:["submit","cancel"],setup(t,{emit:s}){const e=Se(),r=Er(),c=t,l=s,_=x=>x?x instanceof Date?x:new Date(x):null,i=j({title:c.initialData.title||"",description:c.initialData.description||"",action_type_id:c.initialData.action_type_id||null,priority:c.initialData.priority||"",status:c.initialData.status||"open",assigned_to:c.initialData.assigned_to||null,due_date:_(c.initialData.due_date),progress:c.initialData.progress||0,related_to:c.initialData.related_to||"",related_id:c.initialData.related_id||null}),n=j({}),u=Ge({title:re().min(1,"Le titre est requis").max(255,"Le titre est trop long"),description:re().optional(),action_type_id:we().int().positive("Le type est requis"),priority:re().min(1,"La priorité est requise"),status:re().min(1,"Le statut est requis"),progress:we().min(0).max(100)}),b=H(()=>(e.types||[]).map(x=>({label:x.name,value:x.id,icon:x.icon,color:x.color}))),k=x=>b.value.find(m=>m.value===x),C=x=>b.value.find(m=>m.value===x)?.label||"",f=H(()=>(r.users||[]).map(x=>({label:`${x.first_name} ${x.last_name}`,value:x.id,firstName:x.first_name,lastName:x.last_name}))),D=x=>{const m=f.value.find(z=>z.value===x);return m?O(m.firstName,m.lastName):"?"},V=x=>f.value.find(m=>m.value===x)?.label||"",O=(x,m)=>`${x.charAt(0)}${m.charAt(0)}`.toUpperCase(),E=[{label:"Basse",value:"low",class:"bg-green-100 text-green-700 hover:bg-green-200",activeClass:"bg-green-500 text-white hover:bg-green-600"},{label:"Moyenne",value:"medium",class:"bg-yellow-100 text-yellow-700 hover:bg-yellow-200",activeClass:"bg-yellow-500 text-white hover:bg-yellow-600"},{label:"Haute",value:"high",class:"bg-orange-100 text-orange-700 hover:bg-orange-200",activeClass:"bg-orange-500 text-white hover:bg-orange-600"},{label:"Critique",value:"critical",class:"bg-red-100 text-red-700 hover:bg-red-200",activeClass:"bg-red-500 text-white hover:bg-red-600"}],I=[{label:"Ouvert",value:"open",class:"bg-blue-100 text-blue-700 hover:bg-blue-200",activeClass:"bg-blue-500 text-white hover:bg-blue-600"},{label:"En cours",value:"in_progress",class:"bg-yellow-100 text-yellow-700 hover:bg-yellow-200",activeClass:"bg-yellow-500 text-white hover:bg-yellow-600"},{label:"Terminé",value:"completed",class:"bg-green-100 text-green-700 hover:bg-green-200",activeClass:"bg-green-500 text-white hover:bg-green-600"},{label:"Annulé",value:"cancelled",class:"bg-gray-100 text-gray-700 hover:bg-gray-200",activeClass:"bg-gray-500 text-white hover:bg-gray-600"}],M=()=>{n.value={};try{return u.parse(i.value),!0}catch(x){return x instanceof He&&x.issues.forEach(m=>{m.path&&(n.value[m.path[0]]=m.message)}),!1}},T=()=>{if(M()){const x={...i.value},m={...x};x.due_date instanceof Date?m.due_date=x.due_date.toISOString().split("T")[0]:m.due_date=null,l("submit",m)}},h=()=>{l("cancel")};return me(()=>c.initialData,x=>{x&&(i.value={title:x.title||"",description:x.description||"",action_type_id:x.action_type_id||null,priority:x.priority||"",status:x.status||"open",assigned_to:x.assigned_to||null,due_date:_(x.due_date),progress:x.progress||0,related_to:x.related_to||"",related_id:x.related_id||null})},{deep:!0}),pe(()=>{e.fetchTypes(),r.fetchUsers(1,100)}),(x,m)=>{const z=Z("font-awesome-icon");return p(),y("form",{onSubmit:_e(T,["prevent"]),class:"flex flex-col gap-6"},[o("div",Vr,[o("div",jr,[m[8]||(m[8]=o("label",{for:"title",class:"block text-sm font-medium mb-2 text-color-secondary"},"Titre *",-1)),a(d(ae),{id:"title",modelValue:i.value.title,"onUpdate:modelValue":m[0]||(m[0]=A=>i.value.title=A),placeholder:"Titre de l'action",class:Q(["w-full",{"p-invalid":n.value.title}]),size:"large"},null,8,["modelValue","class"]),n.value.title?(p(),y("small",Ir,$(n.value.title),1)):q("",!0)]),o("div",Tr,[m[9]||(m[9]=o("label",{for:"type",class:"block text-sm font-medium mb-2 text-color-secondary"},"Type *",-1)),a(d(ee),{id:"type",modelValue:i.value.action_type_id,"onUpdate:modelValue":m[1]||(m[1]=A=>i.value.action_type_id=A),options:b.value,optionLabel:"label",optionValue:"value",placeholder:"Sélectionnez un type",class:Q(["w-full",{"p-invalid":n.value.action_type_id}]),size:"large"},{value:g(A=>[A.value?(p(),y("div",Fr,[k(A.value)?(p(),y("div",{key:0,class:"w-8 h-8 rounded flex items-center justify-center text-base",style:se({backgroundColor:k(A.value)?.color+"20",color:k(A.value)?.color})},[a(z,{icon:["fas",k(A.value)?.icon||"tasks"]},null,8,["icon"])],4)):q("",!0),o("div",null,$(C(A.value)),1)])):(p(),y("span",Ur,$(A.placeholder),1))]),option:g(A=>[o("div",Lr,[o("div",{class:"w-8 h-8 rounded flex items-center justify-center text-base",style:se({backgroundColor:A.option.color+"20",color:A.option.color})},[a(z,{icon:["fas",A.option.icon||"tasks"]},null,8,["icon"])],4),o("div",null,$(A.option.label),1)])]),_:1},8,["modelValue","options","class"]),n.value.action_type_id?(p(),y("small",zr,$(n.value.action_type_id),1)):q("",!0)]),o("div",Pr,[m[10]||(m[10]=o("label",{for:"assigned_to",class:"block text-sm font-medium mb-2 text-color-secondary"},"Responsable",-1)),a(d(ee),{id:"assigned_to",modelValue:i.value.assigned_to,"onUpdate:modelValue":m[2]||(m[2]=A=>i.value.assigned_to=A),options:f.value,optionLabel:"label",optionValue:"value",placeholder:"Sélectionnez un responsable",class:"w-full",size:"large",showClear:"",filter:""},{value:g(A=>[A.value?(p(),y("div",Br,[a(d(ne),{label:D(A.value),shape:"circle",class:"bg-primary-100 text-primary-700 text-xs"},null,8,["label"]),o("div",null,$(V(A.value)),1)])):(p(),y("span",qr,$(A.placeholder),1))]),option:g(A=>[o("div",Or,[a(d(ne),{label:O(A.option.firstName,A.option.lastName),shape:"circle",class:"bg-primary-100 text-primary-700 text-xs"},null,8,["label"]),o("div",null,$(A.option.label),1)])]),_:1},8,["modelValue","options"])]),o("div",Mr,[m[11]||(m[11]=o("label",{for:"priority",class:"block text-sm font-medium mb-2 text-color-secondary"},"Priorité *",-1)),a(d(Be),{modelValue:i.value.priority,"onUpdate:modelValue":m[3]||(m[3]=A=>i.value.priority=A),options:E,optionLabel:"label",optionValue:"value",class:Q(["w-full",{"p-invalid":n.value.priority}]),size:"large",pt:{button:({context:A})=>({class:["flex-1 border-0 transition-colors duration-200",A.active?A.option.activeClass:A.option.class]})}},null,8,["modelValue","class","pt"]),n.value.priority?(p(),y("small",Rr,$(n.value.priority),1)):q("",!0)]),o("div",Nr,[m[12]||(m[12]=o("label",{for:"status",class:"block text-sm font-medium mb-2 text-color-secondary"},"Statut *",-1)),a(d(Be),{modelValue:i.value.status,"onUpdate:modelValue":m[4]||(m[4]=A=>i.value.status=A),options:I,optionLabel:"label",optionValue:"value",class:Q(["w-full",{"p-invalid":n.value.status}]),size:"large",pt:{button:({context:A})=>({class:["flex-1 border-0 transition-colors duration-200",A.active?A.option.activeClass:A.option.class]})}},null,8,["modelValue","class","pt"]),n.value.status?(p(),y("small",Gr,$(n.value.status),1)):q("",!0)]),o("div",Hr,[m[13]||(m[13]=o("label",{for:"due_date",class:"block text-sm font-medium mb-2 text-color-secondary"},"Échéance",-1)),a(d(Oe),{id:"due_date",modelValue:i.value.due_date,"onUpdate:modelValue":m[5]||(m[5]=A=>i.value.due_date=A),dateFormat:"yy-mm-dd",showIcon:"",class:"w-full",size:"large",fluid:""},null,8,["modelValue"])]),o("div",Qr,[o("label",Jr,"Progression ("+$(i.value.progress)+"%)",1),a(d(pt),{id:"progress",modelValue:i.value.progress,"onUpdate:modelValue":m[6]||(m[6]=A=>i.value.progress=A),class:"w-full",step:5},null,8,["modelValue"])])]),o("div",Kr,[m[14]||(m[14]=o("label",{for:"description",class:"block text-sm font-medium mb-2 text-color-secondary"},"Description",-1)),a(d(ke),{id:"description",modelValue:i.value.description,"onUpdate:modelValue":m[7]||(m[7]=A=>i.value.description=A),placeholder:"Description détaillée de l'action",rows:"4",class:"w-full"},null,8,["modelValue"])]),o("div",Zr,[a(d(L),{label:"Annuler",text:"",severity:"secondary",onClick:h},{icon:g(()=>[a(z,{icon:"xmark",class:"mr-2"})]),_:1}),a(d(L),{type:"submit",label:t.submitButtonText,loading:t.loading},{icon:g(()=>[a(z,{icon:"floppy-disk",class:"mr-2"})]),_:1},8,["label","loading"])])],32)}}}),Wr={class:"p-4"},Xr={class:"flex flex-col md:flex-row md:items-center md:justify-between mb-2 gap-4"},Yr={class:"flex items-center gap-4"},ea=K({__name:"ActionCreate",setup(t){const s=ge(),e=ve(),r=ue(),c=j(!1),l=async n=>{c.value=!0;try{await e.createAction({...n,assigned_to:n.assigned_to||void 0,related_id:n.related_id||void 0,due_date:n.due_date||void 0}),r.add({severity:"success",summary:"Succès",detail:"Action créée avec succès",life:3e3}),s.push("/actions")}catch(u){console.error("Erreur lors de la création de l'action:",u),r.add({severity:"error",summary:"Erreur",detail:"Erreur lors de la création de l'action",life:3e3})}finally{c.value=!1}},_=()=>s.push("/actions"),i=()=>s.back();return(n,u)=>{const b=Z("font-awesome-icon"),k=X;return p(),y("div",Wr,[o("div",Xr,[o("div",Yr,[a(d(L),{text:"",rounded:"",severity:"secondary",onClick:i},{icon:g(()=>[a(b,{icon:"arrow-left"})]),_:1}),u[0]||(u[0]=o("div",null,[o("div",{class:"flex items-center gap-3"},[o("h2",{class:"text-color"},"Créer une nouvelle action")])],-1))])]),a(k,null,{content:g(()=>[a(We,{submitButtonText:"Créer l'action",loading:c.value,onSubmit:l,onCancel:_},null,8,["loading"])]),_:1})])}}}),va=Object.freeze(Object.defineProperty({__proto__:null,default:ea},Symbol.toStringTag,{value:"Module"})),ta={class:"p-4"},sa={class:"flex flex-col md:flex-row md:items-center md:justify-between mb-2 gap-4"},oa={class:"flex items-center gap-4"},ra={key:0,class:"flex justify-center items-center py-12"},aa={key:1,class:"flex justify-center items-center py-12"},ia={key:2,class:"flex justify-center items-center py-12"},na={class:"text-lg text-red-600"},la=K({__name:"ActionEdit",setup(t){const s=ge(),e=Ne(),r=ve(),c=ue(),l=j({title:"",description:"",action_type_id:null,priority:"",status:"open",assigned_to:null,due_date:null,progress:0,related_to:"",related_id:null}),_=j(!1),i=j(!1),n=j(""),u=async()=>{const D=parseInt(e.params.id);if(isNaN(D)){n.value="ID d'action invalide";return}_.value=!0,n.value="";try{await r.fetchActionById(D);const V=r.currentAction;V?l.value={title:V.title,description:V.description||"",action_type_id:V.action_type_id||V.action_type?.id||null,priority:V.priority,status:V.status,assigned_to:V.assigned_to||null,due_date:V.due_date||null,progress:V.progress,related_to:V.related_to||"",related_id:V.related_id||null}:n.value="Action non trouvée"}catch(V){console.error("Erreur lors du chargement de l'action:",V),n.value="Erreur lors du chargement de l'action"}finally{_.value=!1}},b=async D=>{const V=parseInt(e.params.id);if(isNaN(V)){n.value="ID d'action invalide";return}i.value=!0,n.value="";try{await r.updateAction(V,{...D,assigned_to:D.assigned_to||void 0,related_id:D.related_id||void 0,due_date:D.due_date||void 0}),c.add({severity:"success",summary:"Succès",detail:"Action mise à jour avec succès",life:3e3}),s.push("/actions")}catch(O){const E=O.message||"Erreur lors de la mise à jour de l'action";console.error(E),c.add({severity:"error",summary:"Erreur",detail:"Erreur lors de la mise à jour de l'action",life:3e3}),console.error(O)}finally{i.value=!1}},k=()=>s.push("/actions"),C=()=>s.back();pe(()=>{u()});const f=H(()=>r.currentAction);return(D,V)=>{const O=Z("font-awesome-icon"),E=X;return p(),y("div",ta,[o("div",sa,[o("div",oa,[a(d(L),{text:"",rounded:"",severity:"secondary",onClick:C},{icon:g(()=>[a(O,{icon:"arrow-left"})]),_:1}),V[0]||(V[0]=o("div",null,[o("div",{class:"flex items-center gap-3"},[o("h2",{class:"text-color"},"Modifier l'action")])],-1))])]),_.value?(p(),y("div",ra,[a(O,{icon:["fas","spinner"],spin:"",size:"2x",class:"text-color-secondary"})])):!f.value&&!n.value?(p(),y("div",aa,[...V[1]||(V[1]=[o("p",{class:"text-lg text-color-secondary"},"Action non trouvée",-1)])])):n.value?(p(),y("div",ia,[o("p",na,$(n.value),1)])):(p(),N(E,{key:3},{content:g(()=>[a(We,{initialData:l.value,submitButtonText:"Enregistrer les modifications",loading:i.value,onSubmit:b,onCancel:k},null,8,["initialData","loading"])]),_:1}))])}}}),ya=Object.freeze(Object.defineProperty({__proto__:null,default:la},Symbol.toStringTag,{value:"Module"}));export{fa as A,vt as _,yt as a,Gt as b,S as c,Ze as d,Er as e,Do as f,no as g,Ss as h,_t as i,ha as j,ga as k,va as l,ya as m,bt as u};
