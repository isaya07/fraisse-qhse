import{g as q,r as E,h as ae,a as D,q as de,T as ee,j as ne,n as Y,b as W,o as ue,U as N,f as me,F as H,e as oe,u as fe}from"./vendor-primevue-_kQtzldN.js";import{d as L,h as P,l as m,i as s,u as l,k as I,t as k,f as e,v as B,j as M,m as p,c as U,o as te,b as S,F as J,q as K,n as le,s as se,p as Z,g as Q,r as F,w as ge,x as pe}from"./vendor-vue-7xZ5dmFb.js";import{c as j,h as ve,e as ye}from"./app-actions-MIoyI-E5.js";import{d as _e}from"./vendor-pinia--L0FGc_G.js";const ie=_e("training",{state:()=>({categories:[],organizations:[],trainings:[],sessions:[],loading:!1,error:null}),actions:{async fetchCategories(){this.loading=!0;try{const{get:o}=j(),n=await o("/training-categories");if(n.success&&n.data){const t=n.data;this.categories=Array.isArray(t)?t:t.data}}catch(o){this.error="Failed to fetch categories",console.error(o)}finally{this.loading=!1}},async createCategory(o){this.loading=!0;try{const{post:n}=j(),t=await n("/training-categories",o);if(t.success&&t.data){const i=t.data,a=Array.isArray(i)?i[0]:"data"in i?i.data:i;return this.categories.push(a),a}}catch(n){throw this.error="Failed to create category",n}finally{this.loading=!1}},async updateCategory(o,n){this.loading=!0;try{const{put:t}=j(),i=await t(`/training-categories/${o}`,n);if(i.success&&i.data){const a=i.data,u=Array.isArray(a)?a[0]:"data"in a?a.data:a,r=this.categories.findIndex(h=>h.id===o);return r!==-1&&(this.categories[r]=u),u}}catch(t){throw this.error="Failed to update category",t}finally{this.loading=!1}},async deleteCategory(o){this.loading=!0;try{const{del:n}=j();(await n(`/training-categories/${o}`)).success&&(this.categories=this.categories.filter(i=>i.id!==o))}catch(n){throw this.error="Failed to delete category",n}finally{this.loading=!1}},async fetchOrganizations(){this.loading=!0;try{const{get:o}=j(),n=await o("/training-organizations");if(n.success&&n.data){const t=n.data;this.organizations=Array.isArray(t)?t:t.data}}catch(o){this.error="Failed to fetch organizations",console.error(o)}finally{this.loading=!1}},async createOrganization(o){this.loading=!0;try{const{post:n}=j(),t=await n("/training-organizations",o);if(t.success&&t.data){const i=t.data,a=Array.isArray(i)?i[0]:"data"in i?i.data:i;return this.organizations.push(a),a}}catch(n){throw this.error="Failed to create organization",n}finally{this.loading=!1}},async updateOrganization(o,n){this.loading=!0;try{const{put:t}=j(),i=await t(`/training-organizations/${o}`,n);if(i.success&&i.data){const a=i.data,u=Array.isArray(a)?a[0]:"data"in a?a.data:a,r=this.organizations.findIndex(h=>h.id===o);return r!==-1&&(this.organizations[r]=u),u}}catch(t){throw this.error="Failed to update organization",t}finally{this.loading=!1}},async deleteOrganization(o){this.loading=!0;try{const{del:n}=j();(await n(`/training-organizations/${o}`)).success&&(this.organizations=this.organizations.filter(i=>i.id!==o))}catch(n){throw this.error="Failed to delete organization",n}finally{this.loading=!1}},async fetchTrainings(){this.loading=!0;try{const{get:o}=j(),n=await o("/trainings");if(n.success&&n.data){const t=n.data;this.trainings=Array.isArray(t)?t:t.data}}catch(o){this.error="Failed to fetch trainings",console.error(o)}finally{this.loading=!1}},async createTraining(o){this.loading=!0;try{const{post:n}=j(),t=await n("/trainings",o);if(t.success&&t.data){const i=t.data,a=Array.isArray(i)?i[0]:"data"in i?i.data:i;return this.trainings.push(a),a}}catch(n){throw this.error="Failed to create training",n}finally{this.loading=!1}},async updateTraining(o,n){this.loading=!0;try{const{put:t}=j(),i=await t(`/trainings/${o}`,n);if(i.success&&i.data){const a=i.data,u=Array.isArray(a)?a[0]:"data"in a?a.data:a,r=this.trainings.findIndex(h=>h.id===o);return r!==-1&&(this.trainings[r]=u),u}}catch(t){throw this.error="Failed to update training",t}finally{this.loading=!1}},async deleteTraining(o){this.loading=!0;try{const{del:n}=j();(await n(`/trainings/${o}`)).success&&(this.trainings=this.trainings.filter(i=>i.id!==o))}catch(n){throw this.error="Failed to delete training",n}finally{this.loading=!1}},async fetchSessions(){this.loading=!0;try{const{get:o}=j(),n=await o("/training-sessions");if(n.success&&n.data){const t=n.data;this.sessions=Array.isArray(t)?t:t.data}}catch(o){this.error="Failed to fetch sessions",console.error(o)}finally{this.loading=!1}},async createSession(o){this.loading=!0;try{const{post:n}=j(),t=await n("/training-sessions",o);if(t.success&&t.data){const i=t.data,a=Array.isArray(i)?i[0]:"data"in i?i.data:i;return this.sessions.push(a),a}}catch(n){throw this.error="Failed to create session",n}finally{this.loading=!1}},async updateSession(o,n){this.loading=!0;try{const{put:t}=j(),i=await t(`/training-sessions/${o}`,n);if(i.success&&i.data){const a=i.data,u=Array.isArray(a)?a[0]:"data"in a?a.data:a,r=this.sessions.findIndex(h=>h.id===o);return r!==-1&&(this.sessions[r]=u),u}}catch(t){throw this.error="Failed to update session",t}finally{this.loading=!1}},async deleteSession(o){this.loading=!0;try{const{del:n}=j();(await n(`/training-sessions/${o}`)).success&&(this.sessions=this.sessions.filter(i=>i.id!==o))}catch(n){throw this.error="Failed to delete session",n}finally{this.loading=!1}},async addParticipant(o){this.loading=!0;try{const{post:n}=j(),t=await n("/training-participations",o);if(t.success&&t.data){const i=t.data,a=Array.isArray(i)?i[0]:"data"in i?i.data:i,u=this.sessions.findIndex(r=>r.id===o.training_session_id);return u!==-1&&this.sessions[u]&&(this.sessions[u].participations||(this.sessions[u].participations=[]),this.sessions[u].participations?.push(a)),a}}catch(n){throw this.error="Failed to add participant",n}finally{this.loading=!1}},async updateParticipant(o,n){this.loading=!0;try{const{put:t}=j(),i=await t(`/training-participations/${o}`,n);if(i.success&&i.data){const a=i.data,u=Array.isArray(a)?a[0]:"data"in a?a.data:a,r=this.sessions.findIndex(h=>h.id===u.training_session_id);if(r!==-1&&this.sessions[r]){const h=this.sessions[r].participations;if(h){const g=h.findIndex(V=>V.id===o);g!==-1&&(h[g]=u)}}return u}}catch(t){throw this.error="Failed to update participant",t}finally{this.loading=!1}},async removeParticipant(o,n){this.loading=!0;try{const{del:t}=j();if((await t(`/training-participations/${o}`)).success){const a=this.sessions.findIndex(u=>u.id===n);if(a!==-1&&this.sessions[a]){const u=this.sessions[a].participations;u&&(this.sessions[a].participations=u.filter(r=>r.id!==o))}}}catch(t){throw this.error="Failed to remove participant",t}finally{this.loading=!1}}}}),he={class:"font-medium"},ce=L({__name:"SessionList",props:{sessions:{}},emits:["view","edit"],setup(o){const n=a=>a?new Date(a).toLocaleDateString("fr-FR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}):"-",t=a=>({planned:"Planifiée",completed:"Réalisée",cancelled:"Annulée"})[a]||a,i=a=>({planned:"info",completed:"success",cancelled:"danger"})[a]||"info";return(a,u)=>{const r=M("font-awesome-icon"),h=q,g=ee;return p(),P(h,null,{content:m(()=>[s(l(de),{value:o.sessions,paginator:"",rows:10,rowsPerPageOptions:[5,10,20,50],tableStyle:"min-width: 50rem",stripedRows:"",removableSort:""},{empty:m(()=>[...u[0]||(u[0]=[I(" Aucune session trouvée. ",-1)])]),default:m(()=>[s(l(E),{field:"start_date",header:"Date",sortable:""},{body:m(V=>[I(k(n(V.data.start_date)),1)]),_:1}),s(l(E),{field:"training.title",header:"Formation",sortable:""},{body:m(V=>[e("span",he,k(V.data.training?.title),1)]),_:1}),s(l(E),{field:"organization.name",header:"Organisme",sortable:""},{body:m(V=>[I(k(V.data.organization?.name||"-"),1)]),_:1}),s(l(E),{field:"location",header:"Lieu",sortable:""}),s(l(E),{field:"status",header:"Statut",sortable:""},{body:m(V=>[s(l(ae),{value:t(V.data.status),severity:i(V.data.status)},null,8,["value","severity"])]),_:1}),s(l(E),{header:"Actions",exportable:!1,style:{"min-width":"8rem"}},{body:m(V=>[B((p(),P(l(D),{text:"",rounded:"",severity:"secondary",onClick:x=>a.$emit("view",V.data)},{icon:m(()=>[s(r,{icon:"eye"})]),_:1},8,["onClick"])),[[g,"Voir les détails"]]),B((p(),P(l(D),{text:"",rounded:"",severity:"info",class:"mr-2",onClick:x=>a.$emit("edit",V.data)},{icon:m(()=>[s(r,{icon:"pencil"})]),_:1},8,["onClick"])),[[g,"Modifier"]])]),_:1})]),_:1},8,["value"])]),_:1})}}}),xe={class:"p-4"},be={class:"flex flex-col md:flex-row md:items-center md:justify-between mb-6"},we={class:"flex gap-2"},$e={class:"grid grid-cols-1 md:grid-cols-4 gap-6 mb-8"},ke={class:"flex items-center justify-between"},Ve={class:"text-3xl font-bold text-color"},Se={class:"w-12 h-12 rounded-full bg-blue-100 dark:bg-blue-900/20 flex items-center justify-center text-blue-600 dark:text-blue-400"},Ce={class:"flex items-center justify-between"},De={class:"text-3xl font-bold text-color"},ze={class:"w-12 h-12 rounded-full bg-green-100 dark:bg-green-900/20 flex items-center justify-center text-green-600 dark:text-green-400"},Ae={class:"flex items-center justify-between"},Te={class:"text-3xl font-bold text-color"},je={class:"w-12 h-12 rounded-full bg-purple-100 dark:bg-purple-900/20 flex items-center justify-center text-purple-600 dark:text-purple-400"},Fe={class:"flex items-center justify-between"},Ue={class:"text-3xl font-bold text-color"},Pe={class:"w-12 h-12 rounded-full bg-orange-100 dark:bg-orange-900/20 flex items-center justify-center text-orange-600 dark:text-orange-400"},qe={class:"mb-8"},Ee={class:"flex items-center justify-between mb-4"},Oe={class:"mb-8"},Ie={key:0,class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4"},Me={class:"flex items-start justify-between"},Le={class:"block font-semibold text-color"},Re={class:"block text-sm text-color-secondary mt-1"},Ne={class:"mt-2 flex items-center gap-2 text-sm"},Be=L({__name:"TrainingDashboard",setup(o){const n=se(),t=ie(),i=U(()=>t.sessions.filter(x=>x.status==="planned").length),a=U(()=>t.trainings.length),u=U(()=>0),r=U(()=>t.sessions.filter(x=>x.status==="planned").sort((x,b)=>new Date(x.start_date).getTime()-new Date(b.start_date).getTime()).slice(0,5)),h=U(()=>{const x=[],b=new Date,A=new Date;return A.setMonth(b.getMonth()+3),t.sessions.forEach(T=>{T.participations&&T.participations.forEach(v=>{if(v.status==="validated"&&v.expiration_date){const d=new Date(v.expiration_date);d<=A&&x.push({id:v.id,user:v.user,training:T.training,expiration_date:v.expiration_date,is_expired:d<b})}})}),x.sort((T,v)=>new Date(T.expiration_date).getTime()-new Date(v.expiration_date).getTime())}),g=x=>{n.push(`/trainings/sessions/${x.id}`)},V=x=>{console.log("Edit session",x.id)};return te(async()=>{await Promise.all([t.fetchSessions(),t.fetchTrainings()])}),(x,b)=>{const A=M("font-awesome-icon"),T=M("router-link"),v=ee;return p(),S("div",xe,[e("div",be,[b[0]||(b[0]=e("h2",null,"Tableau de bord Formation",-1)),e("div",we,[s(T,{to:"/trainings/catalog"},{default:m(()=>[s(l(D),{label:"Catalogue",severity:"secondary",outlined:""},{icon:m(()=>[s(A,{icon:"book",class:"mr-2"})]),_:1})]),_:1}),s(T,{to:"/trainings/sessions"},{default:m(()=>[s(l(D),{label:"Sessions",severity:"secondary",outlined:""},{icon:m(()=>[s(A,{icon:"calendar",class:"mr-2"})]),_:1})]),_:1})])]),e("div",$e,[s(l(q),null,{content:m(()=>[e("div",ke,[e("div",null,[b[1]||(b[1]=e("span",{class:"block text-color-secondary text-sm font-medium mb-1"},"Sessions à venir",-1)),e("span",Ve,k(i.value),1)]),e("div",Se,[s(A,{icon:"calendar-alt",size:"lg"})])])]),_:1}),s(l(q),null,{content:m(()=>[e("div",Ce,[e("div",null,[b[2]||(b[2]=e("span",{class:"block text-color-secondary text-sm font-medium mb-1"},"Formations actives",-1)),e("span",De,k(a.value),1)]),e("div",ze,[s(A,{icon:"book-open",size:"lg"})])])]),_:1}),s(l(q),null,{content:m(()=>[e("div",Ae,[e("div",null,[b[3]||(b[3]=e("span",{class:"block text-color-secondary text-sm font-medium mb-1"},"Participants ce mois",-1)),e("span",Te,k(u.value),1)]),e("div",je,[s(A,{icon:"users",size:"lg"})])])]),_:1}),s(l(q),null,{content:m(()=>[e("div",Fe,[e("div",null,[b[4]||(b[4]=e("span",{class:"block text-color-secondary text-sm font-medium mb-1"},"Renouvellements",-1)),e("span",Ue,k(h.value.length),1)]),e("div",Pe,[s(A,{icon:"clock",size:"lg"})])])]),_:1})]),e("div",qe,[e("div",Ee,[b[6]||(b[6]=e("h3",null,"Prochaines sessions",-1)),s(T,{to:"/trainings/sessions",class:"text-blue-600 hover:text-blue-800 text-sm font-medium"},{default:m(()=>[...b[5]||(b[5]=[I(" Voir tout ",-1)])]),_:1})]),s(ce,{sessions:r.value,onView:g,onEdit:V},null,8,["sessions"])]),e("div",Oe,[b[9]||(b[9]=e("h3",null,"Renouvellements à prévoir",-1)),h.value.length>0?(p(),S("div",Ie,[(p(!0),S(J,null,K(h.value,d=>(p(),P(l(q),{key:d.id},{content:m(()=>[e("div",Me,[e("div",null,[e("span",Le,k(d.training?.title),1),e("span",Re,k(d.user?.first_name)+" "+k(d.user?.last_name),1),e("div",Ne,[s(A,{icon:"clock",class:le(d.is_expired?"text-red-600":"text-orange-600")},null,8,["class"]),e("span",{class:le(d.is_expired?"text-red-700 font-medium":"text-orange-700")}," Expire le "+k(new Date(d.expiration_date).toLocaleDateString()),3)])]),B((p(),P(l(D),{text:"",rounded:"",size:"small",severity:d.is_expired?"danger":"warning"},{icon:m(()=>[s(A,{icon:"envelope"})]),_:1},8,["severity"])),[[v,"Relancer"]])])]),_:2},1024))),128))])):(p(),P(l(q),{key:1},{content:m(()=>[s(A,{icon:"check-circle",class:"text-green-500 text-3xl mb-3"}),b[7]||(b[7]=e("p",{class:"text-color font-medium"}," Aucun renouvellement à prévoir pour les 3 prochains mois. ",-1)),b[8]||(b[8]=e("p",{class:"text-color-secondary text-sm mt-1"},"Tout est à jour !",-1))]),_:1}))])])}}}),bs=Object.freeze(Object.defineProperty({__proto__:null,default:Be},Symbol.toStringTag,{value:"Module"})),Ge={class:"p-5 pl-7 flex-1 flex flex-col gap-4"},We={class:"flex items-center justify-between"},He={class:"flex items-center gap-2 text-sm text-color-secondary"},Je={class:"font-medium"},Ke={class:"font-bold text-color text-lg leading-snug"},Qe={key:0,class:"text-sm text-color-secondary line-clamp-2"},Xe={class:"flex items-center justify-between pt-4 border-t border-surface-border mt-auto"},Ye={key:0,class:"flex items-center gap-2 text-sm text-color-secondary"},Ze={key:1,class:"flex items-center gap-2 text-sm text-color-secondary"},re=L({__name:"TrainingCard",props:{training:{}},emits:["click"],setup(o){const n=t=>{if(t>=12){const i=Math.floor(t/12),a=t%12;return a>0?`${i} ans ${a} mois`:`${i} ans`}return`${t} mois`};return(t,i)=>{const a=M("font-awesome-icon");return p(),S("div",{class:"surface-card rounded-lg shadow-sm border border-surface-border hover:shadow-md transition-all duration-200 cursor-pointer h-full flex flex-col relative overflow-hidden group",onClick:i[0]||(i[0]=u=>t.$emit("click"))},[e("div",{class:"absolute left-0 top-0 bottom-0 w-1.5",style:Z({backgroundColor:o.training.category?.color||"#cbd5e1"})},null,4),e("div",Ge,[e("div",We,[e("div",He,[s(a,{icon:["fas",o.training.category?.icon||"book"],style:Z({color:o.training.category?.color||"var(--text-color-secondary)"})},null,8,["icon","style"]),e("span",Je,k(o.training.category?.name||"Sans catégorie"),1)])]),e("h3",Ke,k(o.training.title),1),o.training.description?(p(),S("p",Qe,k(o.training.description),1)):Q("",!0),e("div",Xe,[o.training.duration_hours?(p(),S("div",Ye,[s(a,{icon:"clock",class:"text-color-secondary"}),e("span",null,k(o.training.duration_hours)+"h",1)])):Q("",!0),o.training.validity_months?(p(),S("div",Ze,[s(a,{icon:"calendar-check",class:"text-color-secondary"}),e("span",null,"Validité: "+k(n(o.training.validity_months)),1)])):Q("",!0)])])])}}}),et={class:"p-4"},tt={class:"flex flex-col md:flex-row md:items-center md:justify-between mb-6"},st={class:"flex items-center gap-4"},it={class:"flex gap-2"},at={key:0,class:"flex justify-center py-12"},nt={key:1,class:"flex flex-col gap-8"},ot={class:"flex items-center gap-3 mb-4 border-b border-gray-200 pb-2"},lt={class:"text-xl font-semibold text-gray-800"},rt={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6"},dt=["onClick"],ct={key:0},ut={class:"flex items-center gap-3 mb-4 border-b border-gray-200 pb-2"},mt={class:"w-8 h-8 rounded bg-gray-400 flex items-center justify-center text-white"},ft={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6"},gt={class:"field"},pt={class:"field mt-4"},vt={class:"flex gap-2"},yt={class:"field mt-4"},_t={class:"field"},ht={class:"field mt-4"},xt={class:"field mt-4"},bt={class:"grid grid-cols-2 gap-4 mt-4"},wt={class:"field"},$t={class:"field"},kt={class:"field mt-4"},Vt=L({__name:"TrainingCatalog",setup(o){const n=se(),t=ie(),i=ne(),a=U(()=>t.loading),u=U(()=>t.categories),r=U(()=>t.trainings.filter(z=>!z.training_category_id)),h=z=>t.trainings.filter(f=>f.training_category_id===z),g=F(!1),V=F(null),x=F({name:"",color:"#64748B",icon:"folder"}),b=()=>{V.value=null,x.value={name:"",color:"#64748B",icon:"folder"},g.value=!0},A=z=>{V.value=z,x.value={name:z.name,color:z.color||"#64748B",icon:z.icon||"folder"},g.value=!0},T=()=>{g.value=!1,V.value=null},v=async()=>{try{V.value?(await t.updateCategory(V.value.id,x.value),i.add({severity:"success",summary:"Succès",detail:"Catégorie mise à jour",life:3e3})):(await t.createCategory(x.value),i.add({severity:"success",summary:"Succès",detail:"Catégorie créée",life:3e3})),T()}catch{i.add({severity:"error",summary:"Erreur",detail:"Une erreur est survenue",life:3e3})}},d=F(!1),$=F(null),c=F({training_category_id:null,title:"",description:"",duration_hours:null,validity_months:null,required_frequency_months:null}),y=z=>{$.value=null,c.value={training_category_id:typeof z=="number"?z:null,title:"",description:"",duration_hours:null,validity_months:null,required_frequency_months:null},d.value=!0},w=z=>{$.value=z,c.value={training_category_id:z.training_category_id,title:z.title,description:z.description||"",duration_hours:z.duration_hours,validity_months:z.validity_months,required_frequency_months:z.required_frequency_months},d.value=!0},C=()=>{d.value=!1,$.value=null},G=async()=>{if(!c.value.title||!c.value.training_category_id){i.add({severity:"warn",summary:"Attention",detail:"Veuillez remplir les champs obligatoires",life:3e3});return}try{$.value?(await t.updateTraining($.value.id,{...c.value,training_category_id:c.value.training_category_id}),i.add({severity:"success",summary:"Succès",detail:"Formation mise à jour",life:3e3})):(await t.createTraining({...c.value,training_category_id:c.value.training_category_id}),i.add({severity:"success",summary:"Succès",detail:"Formation créée",life:3e3})),C()}catch{i.add({severity:"error",summary:"Erreur",detail:"Une erreur est survenue",life:3e3})}},X=()=>{n.back()};return te(async()=>{await Promise.all([t.fetchCategories(),t.fetchTrainings()])}),(z,f)=>{const O=M("font-awesome-icon");return p(),S("div",et,[e("div",tt,[e("div",st,[s(l(D),{text:"",rounded:"",severity:"secondary",onClick:X},{icon:m(()=>[s(O,{icon:"arrow-left"})]),_:1}),f[12]||(f[12]=e("h2",null,"Catalogue des formations",-1)),e("div",it,[s(l(D),{label:"Nouvelle catégorie",severity:"secondary",outlined:"",onClick:b},{icon:m(()=>[s(O,{icon:"folder-plus",class:"mr-2"})]),_:1}),s(l(D),{label:"Nouvelle formation",onClick:y},{icon:m(()=>[s(O,{icon:"plus",class:"mr-2"})]),_:1})])])]),a.value?(p(),S("div",at,[s(O,{icon:["fas","spinner"],spin:"",size:"2x",class:"text-gray-500"})])):(p(),S("div",nt,[(p(!0),S(J,null,K(u.value,_=>(p(),S("div",{key:_.id},[e("div",ot,[e("div",{class:"w-8 h-8 rounded flex items-center justify-center text-white",style:Z({backgroundColor:_.color||"#64748B"})},[s(O,{icon:_.icon||"folder"},null,8,["icon"])],4),e("h2",lt,k(_.name),1),s(l(D),{text:"",rounded:"",size:"small",severity:"secondary",onClick:R=>A(_)},{icon:m(()=>[s(O,{icon:"pencil"})]),_:1},8,["onClick"])]),e("div",rt,[(p(!0),S(J,null,K(h(_.id),R=>(p(),P(re,{key:R.id,training:R,onClick:vs=>w(R)},null,8,["training","onClick"]))),128)),e("div",{class:"border-2 border-dashed border-gray-300 rounded-lg flex flex-col items-center justify-center p-6 cursor-pointer hover:border-blue-500 hover:bg-blue-50 transition-colors min-h-[200px]",onClick:R=>y(_.id)},[s(O,{icon:"plus",class:"text-gray-400 text-3xl mb-2"}),f[13]||(f[13]=e("span",{class:"text-gray-500 font-medium"},"Ajouter une formation",-1))],8,dt)])]))),128)),r.value.length>0?(p(),S("div",ct,[e("div",ut,[e("div",mt,[s(O,{icon:"question"})]),f[14]||(f[14]=e("h2",{class:"text-xl font-semibold text-gray-800"},"Sans catégorie",-1))]),e("div",ft,[(p(!0),S(J,null,K(r.value,_=>(p(),P(re,{key:_.id,training:_,onClick:R=>w(_)},null,8,["training","onClick"]))),128))])])):Q("",!0)])),s(l(Y),{visible:g.value,"onUpdate:visible":f[4]||(f[4]=_=>g.value=_),header:V.value?"Modifier la catégorie":"Nouvelle catégorie",modal:!0,class:"p-fluid w-full max-w-md"},{footer:m(()=>[s(l(D),{label:"Annuler",text:"",severity:"secondary",onClick:T}),s(l(D),{label:"Enregistrer",onClick:v})]),default:m(()=>[e("div",gt,[f[15]||(f[15]=e("label",{for:"catName"},"Nom",-1)),s(l(W),{id:"catName",modelValue:x.value.name,"onUpdate:modelValue":f[0]||(f[0]=_=>x.value.name=_),required:"",autofocus:""},null,8,["modelValue"])]),e("div",pt,[f[16]||(f[16]=e("label",{for:"catColor"},"Couleur",-1)),e("div",vt,[s(l(ue),{modelValue:x.value.color,"onUpdate:modelValue":f[1]||(f[1]=_=>x.value.color=_)},null,8,["modelValue"]),s(l(W),{modelValue:x.value.color,"onUpdate:modelValue":f[2]||(f[2]=_=>x.value.color=_),placeholder:"#RRGGBB"},null,8,["modelValue"])])]),e("div",yt,[f[17]||(f[17]=e("label",{for:"catIcon"},"Icône",-1)),s(ve,{modelValue:x.value.icon,"onUpdate:modelValue":f[3]||(f[3]=_=>x.value.icon=_)},null,8,["modelValue"])])]),_:1},8,["visible","header"]),s(l(Y),{visible:d.value,"onUpdate:visible":f[11]||(f[11]=_=>d.value=_),header:$.value?"Modifier la formation":"Nouvelle formation",modal:!0,class:"p-fluid w-full max-w-lg"},{footer:m(()=>[s(l(D),{label:"Annuler",text:"",severity:"secondary",onClick:C}),s(l(D),{label:"Enregistrer",onClick:G})]),default:m(()=>[e("div",_t,[f[18]||(f[18]=e("label",{for:"title"},"Titre",-1)),s(l(W),{id:"title",modelValue:c.value.title,"onUpdate:modelValue":f[5]||(f[5]=_=>c.value.title=_),required:"",autofocus:""},null,8,["modelValue"])]),e("div",ht,[f[19]||(f[19]=e("label",{for:"category"},"Catégorie",-1)),s(l(N),{id:"category",modelValue:c.value.training_category_id,"onUpdate:modelValue":f[6]||(f[6]=_=>c.value.training_category_id=_),options:l(t).categories,optionLabel:"name",optionValue:"id",placeholder:"Sélectionnez une catégorie"},null,8,["modelValue","options"])]),e("div",xt,[f[20]||(f[20]=e("label",{for:"description"},"Description",-1)),s(l(me),{id:"description",modelValue:c.value.description,"onUpdate:modelValue":f[7]||(f[7]=_=>c.value.description=_),rows:"3"},null,8,["modelValue"])]),e("div",bt,[e("div",wt,[f[21]||(f[21]=e("label",{for:"duration"},"Durée (heures)",-1)),s(l(H),{id:"duration",modelValue:c.value.duration_hours,"onUpdate:modelValue":f[8]||(f[8]=_=>c.value.duration_hours=_),min:0},null,8,["modelValue"])]),e("div",$t,[f[22]||(f[22]=e("label",{for:"validity"},"Validité (mois)",-1)),s(l(H),{id:"validity",modelValue:c.value.validity_months,"onUpdate:modelValue":f[9]||(f[9]=_=>c.value.validity_months=_),min:0},null,8,["modelValue"])])]),e("div",kt,[f[23]||(f[23]=e("label",{for:"frequency"},"Fréquence requise (mois)",-1)),s(l(H),{id:"frequency",modelValue:c.value.required_frequency_months,"onUpdate:modelValue":f[10]||(f[10]=_=>c.value.required_frequency_months=_),min:0},null,8,["modelValue"])])]),_:1},8,["visible","header"])])}}}),ws=Object.freeze(Object.defineProperty({__proto__:null,default:Vt},Symbol.toStringTag,{value:"Module"})),St={class:"p-4"},Ct={class:"flex flex-col md:flex-row md:items-center md:justify-between mb-6"},Dt={key:0,class:"flex justify-center py-12"},zt={key:1},At={class:"field"},Tt={class:"field mt-4"},jt={class:"grid grid-cols-2 gap-4 mt-4"},Ft={class:"field"},Ut={class:"field"},Pt={class:"field mt-4"},qt={class:"field mt-4"},Et={class:"grid grid-cols-2 gap-4 mt-4"},Ot={class:"field"},It={class:"field"},Mt={class:"field mt-4"},Lt=L({__name:"TrainingSessionList",setup(o){const n=se(),t=ie(),i=ne(),a=U(()=>t.loading),u=[{label:"Planifiée",value:"planned"},{label:"Réalisée",value:"completed"},{label:"Annulée",value:"cancelled"}],r=F(!1),h=F(null),g=F({training_id:null,training_organization_id:null,start_date:null,end_date:null,location:"",instructor:"",max_participants:null,cost:null,status:"planned"});ge([()=>g.value.training_id,()=>g.value.start_date],([v,d])=>{if(!h.value&&v&&d){const $=t.trainings.find(c=>c.id===v);if($&&$.duration_hours){const c=new Date(d),y=$.duration_hours*60*60*1e3;c.setTime(c.getTime()+y),g.value.end_date=c}}});const V=v=>{n.push(`/trainings/sessions/${v.id}`)},x=()=>{h.value=null,g.value={training_id:null,training_organization_id:null,start_date:new Date,end_date:new Date,location:"",instructor:"",max_participants:null,cost:null,status:"planned"},r.value=!0},b=v=>{h.value=v,g.value={training_id:v.training_id,training_organization_id:v.training_organization_id,start_date:new Date(v.start_date),end_date:new Date(v.end_date),location:v.location,instructor:v.instructor||"",max_participants:v.max_participants,cost:v.cost,status:v.status},r.value=!0},A=()=>{r.value=!1,h.value=null},T=async()=>{if(!g.value.training_id||!g.value.start_date||!g.value.end_date||!g.value.location){i.add({severity:"warn",summary:"Attention",detail:"Veuillez remplir les champs obligatoires",life:3e3});return}const v={...g.value,start_date:g.value.start_date.toISOString(),end_date:g.value.end_date.toISOString()};try{h.value?(await t.updateSession(h.value.id,v),i.add({severity:"success",summary:"Succès",detail:"Session mise à jour",life:3e3})):(await t.createSession(v),i.add({severity:"success",summary:"Succès",detail:"Session créée",life:3e3})),A()}catch(d){console.log(d),i.add({severity:"error",summary:"Erreur",detail:"Une erreur est survenue",life:3e3})}};return te(async()=>{await Promise.all([t.fetchSessions(),t.fetchTrainings(),t.fetchOrganizations()])}),(v,d)=>{const $=M("font-awesome-icon");return p(),S("div",St,[e("div",Ct,[d[10]||(d[10]=e("h1",{class:"text-2xl font-bold text-gray-800 mb-4 md:mb-0"},"Sessions de formation",-1)),s(l(D),{label:"Nouvelle session",onClick:x},{icon:m(()=>[s($,{icon:"plus",class:"mr-2"})]),_:1})]),a.value?(p(),S("div",Dt,[s($,{icon:["fas","spinner"],spin:"",size:"2x",class:"text-gray-500"})])):(p(),S("div",zt,[s(ce,{sessions:l(t).sessions,onView:V,onEdit:b},null,8,["sessions"])])),s(l(Y),{visible:r.value,"onUpdate:visible":d[9]||(d[9]=c=>r.value=c),header:h.value?"Modifier la session":"Nouvelle session",modal:!0,class:"p-fluid w-full max-w-lg"},{footer:m(()=>[s(l(D),{label:"Annuler",text:"",severity:"secondary",onClick:A}),s(l(D),{label:"Enregistrer",onClick:T})]),default:m(()=>[e("div",At,[d[11]||(d[11]=e("label",{for:"training"},"Formation",-1)),s(l(N),{id:"training",modelValue:g.value.training_id,"onUpdate:modelValue":d[0]||(d[0]=c=>g.value.training_id=c),options:l(t).trainings,optionLabel:"title",optionValue:"id",placeholder:"Sélectionnez une formation",filter:""},null,8,["modelValue","options"])]),e("div",Tt,[d[12]||(d[12]=e("label",{for:"organization"},"Organisme",-1)),s(l(N),{id:"organization",modelValue:g.value.training_organization_id,"onUpdate:modelValue":d[1]||(d[1]=c=>g.value.training_organization_id=c),options:l(t).organizations,optionLabel:"name",optionValue:"id",placeholder:"Sélectionnez un organisme",filter:"",showClear:""},null,8,["modelValue","options"])]),e("div",jt,[e("div",Ft,[d[13]||(d[13]=e("label",{for:"startDate"},"Date de début",-1)),s(l(oe),{id:"startDate",modelValue:g.value.start_date,"onUpdate:modelValue":d[2]||(d[2]=c=>g.value.start_date=c),showIcon:"",showTime:"",hourFormat:"24"},null,8,["modelValue"])]),e("div",Ut,[d[14]||(d[14]=e("label",{for:"endDate"},"Date de fin",-1)),s(l(oe),{id:"endDate",modelValue:g.value.end_date,"onUpdate:modelValue":d[3]||(d[3]=c=>g.value.end_date=c),showIcon:"",showTime:"",hourFormat:"24"},null,8,["modelValue"])])]),e("div",Pt,[d[15]||(d[15]=e("label",{for:"location"},"Lieu",-1)),s(l(W),{id:"location",modelValue:g.value.location,"onUpdate:modelValue":d[4]||(d[4]=c=>g.value.location=c)},null,8,["modelValue"])]),e("div",qt,[d[16]||(d[16]=e("label",{for:"instructor"},"Formateur",-1)),s(l(W),{id:"instructor",modelValue:g.value.instructor,"onUpdate:modelValue":d[5]||(d[5]=c=>g.value.instructor=c)},null,8,["modelValue"])]),e("div",Et,[e("div",Ot,[d[17]||(d[17]=e("label",{for:"maxParticipants"},"Max participants",-1)),s(l(H),{id:"maxParticipants",modelValue:g.value.max_participants,"onUpdate:modelValue":d[6]||(d[6]=c=>g.value.max_participants=c),min:1},null,8,["modelValue"])]),e("div",It,[d[18]||(d[18]=e("label",{for:"cost"},"Coût (€)",-1)),s(l(H),{id:"cost",modelValue:g.value.cost,"onUpdate:modelValue":d[7]||(d[7]=c=>g.value.cost=c),mode:"currency",currency:"EUR",locale:"fr-FR"},null,8,["modelValue"])])]),e("div",Mt,[d[19]||(d[19]=e("label",{for:"status"},"Statut",-1)),s(l(N),{id:"status",modelValue:g.value.status,"onUpdate:modelValue":d[8]||(d[8]=c=>g.value.status=c),options:u,optionLabel:"label",optionValue:"value"},null,8,["modelValue"])])]),_:1},8,["visible","header"])])}}}),$s=Object.freeze(Object.defineProperty({__proto__:null,default:Lt},Symbol.toStringTag,{value:"Module"})),Rt={class:"card"},Nt={class:"flex justify-between items-center mb-4"},Bt={key:0,class:"field"},Gt={class:"field mt-4"},Wt=L({__name:"ParticipantManager",props:{participations:{},users:{}},emits:["add","update","remove"],setup(o,{emit:n}){const t=n,i=fe(),a=F(!1),u=F(null),r=F({user_id:null,status:"registered"}),h=[{label:"Inscrit",value:"registered"},{label:"Présent",value:"attended"},{label:"Validé",value:"validated"},{label:"Échoué",value:"failed"},{label:"Annulé",value:"cancelled"}],g=$=>{const c=h.find(y=>y.value===$);return c?c.label:$},V=$=>({registered:"info",attended:"warning",validated:"success",failed:"danger",cancelled:"secondary"})[$]||"info",x=$=>$?`${$.last_name} ${$.first_name}`:"",b=()=>{u.value=null,r.value={user_id:null,status:"registered"},a.value=!0},A=$=>{u.value=$,r.value={user_id:$.user_id,status:$.status},a.value=!0},T=()=>{a.value=!1,u.value=null},v=()=>{u.value?t("update",{...u.value,status:r.value.status}):t("add",{user_id:r.value.user_id,status:r.value.status}),T()},d=$=>{i.require({message:"Voulez-vous vraiment retirer ce participant ?",header:"Confirmation",icon:"fas fa-exclamation-triangle",accept:()=>{t("remove",$.id)}})};return($,c)=>{const y=M("font-awesome-icon"),w=ee;return p(),S("div",Rt,[e("div",Nt,[c[3]||(c[3]=e("h3",{class:"text-lg font-medium"},"Participants",-1)),s(l(D),{label:"Ajouter",size:"small",onClick:b},{icon:m(()=>[s(y,{icon:"plus",class:"mr-2"})]),_:1})]),s(l(de),{value:o.participations,stripedRows:"",size:"small"},{empty:m(()=>[...c[4]||(c[4]=[I(" Aucun participant inscrit. ",-1)])]),default:m(()=>[s(l(E),{field:"user.last_name",header:"Nom"},{body:m(C=>[I(k(C.data.user?.last_name)+" "+k(C.data.user?.first_name),1)]),_:1}),s(l(E),{field:"status",header:"Statut"},{body:m(C=>[s(l(ae),{value:g(C.data.status),severity:V(C.data.status)},null,8,["value","severity"])]),_:1}),s(l(E),{header:"Actions",exportable:!1,style:{"min-width":"8rem"}},{body:m(C=>[B((p(),P(l(D),{text:"",rounded:"",severity:"info",class:"mr-2",onClick:G=>A(C.data)},{icon:m(()=>[s(y,{icon:"pencil"})]),_:1},8,["onClick"])),[[w,"Modifier le statut"]]),B((p(),P(l(D),{text:"",rounded:"",severity:"danger",onClick:G=>d(C.data)},{icon:m(()=>[s(y,{icon:"trash"})]),_:1},8,["onClick"])),[[w,"Retirer"]])]),_:1})]),_:1},8,["value"]),s(l(Y),{visible:a.value,"onUpdate:visible":c[2]||(c[2]=C=>a.value=C),header:u.value?"Modifier la participation":"Ajouter un participant",modal:!0,class:"p-fluid w-full max-w-md"},{footer:m(()=>[s(l(D),{label:"Annuler",text:"",severity:"secondary",onClick:T}),s(l(D),{label:"Enregistrer",onClick:v})]),default:m(()=>[u.value?Q("",!0):(p(),S("div",Bt,[c[5]||(c[5]=e("label",{for:"user"},"Utilisateur",-1)),s(l(N),{id:"user",modelValue:r.value.user_id,"onUpdate:modelValue":c[0]||(c[0]=C=>r.value.user_id=C),options:o.users,optionLabel:x,optionValue:"id",placeholder:"Sélectionnez un utilisateur",filter:"",class:"w-full"},null,8,["modelValue","options"])])),e("div",Gt,[c[6]||(c[6]=e("label",{for:"status"},"Statut",-1)),s(l(N),{id:"status",modelValue:r.value.status,"onUpdate:modelValue":c[1]||(c[1]=C=>r.value.status=C),options:h,optionLabel:"label",optionValue:"value",class:"w-full"},null,8,["modelValue"])])]),_:1},8,["visible","header"])])}}}),Ht={key:0,class:"p-4"},Jt={class:"flex flex-col md:flex-row md:items-center md:justify-between mb-6"},Kt={class:"flex items-center gap-4"},Qt={class:"flex items-center gap-2 text-sm text-color-secondary"},Xt={class:"grid grid-cols-1 lg:grid-cols-3 gap-6"},Yt={class:"lg:col-span-2 flex flex-col gap-6"},Zt={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},es={class:"font-medium"},ts={class:"font-medium"},ss={class:"font-medium"},is={class:"font-medium"},as={class:"flex flex-col gap-6"},ns={class:"flex justify-between items-center"},os={key:0,class:"flex flex-col gap-2"},ls={class:"flex items-center gap-2 overflow-hidden"},rs={class:"truncate text-sm"},ds={key:1,class:"text-center py-4 text-color-secondary text-sm"},cs={class:"flex flex-col gap-3"},us={class:"flex justify-between items-center"},ms={class:"font-medium"},fs={class:"w-full bg-surface-100 dark:bg-surface-700 rounded-full h-2"},gs={key:1,class:"flex justify-center py-12"},ps=L({__name:"TrainingSessionDetail",setup(o){const n=pe(),t=se(),i=ie(),a=ye(),u=ne(),r=U(()=>i.sessions.find(y=>y.id===parseInt(n.params.id))),h=U(()=>a.users),g=y=>y?new Date(y).toLocaleDateString("fr-FR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}):"-",V=y=>new Intl.NumberFormat("fr-FR",{style:"currency",currency:"EUR"}).format(y),x=y=>({planned:"Planifiée",completed:"Réalisée",cancelled:"Annulée"})[y]||y,b=y=>({planned:"info",completed:"success",cancelled:"danger"})[y]||"info",A=()=>{if(!r.value||!r.value.max_participants)return 0;const y=r.value.participations?.length||0;return Math.min(100,y/r.value.max_participants*100)},T=()=>{t.back()},v=()=>{console.log("Edit session")},d=async y=>{try{await i.addParticipant({training_session_id:r.value?.id,user_id:y.user_id,status:y.status}),u.add({severity:"success",summary:"Succès",detail:"Participant ajouté",life:3e3})}catch(w){console.log(w),u.add({severity:"error",summary:"Erreur",detail:"Erreur lors de l'ajout",life:3e3})}},$=async y=>{try{await i.updateParticipant(y.id,{status:y.status,obtained_date:y.obtained_date,expiration_date:y.expiration_date}),u.add({severity:"success",summary:"Succès",detail:"Participant mis à jour",life:3e3})}catch(w){console.log(w),u.add({severity:"error",summary:"Erreur",detail:"Erreur lors de la mise à jour",life:3e3})}},c=async y=>{if(r.value)try{await i.removeParticipant(y,r.value.id),u.add({severity:"success",summary:"Succès",detail:"Participant retiré",life:3e3})}catch(w){console.log(w),u.add({severity:"error",summary:"Erreur",detail:"Erreur lors de la suppression",life:3e3})}};return te(async()=>{parseInt(n.params.id)&&(i.sessions.length===0&&await i.fetchSessions(),await a.fetchUsers())}),(y,w)=>{const C=M("font-awesome-icon"),G=ee;return r.value?(p(),S("div",Ht,[e("div",Jt,[e("div",Kt,[s(l(D),{text:"",rounded:"",severity:"secondary",onClick:T},{icon:m(()=>[s(C,{icon:"arrow-left"})]),_:1}),e("div",null,[e("h2",null,k(r.value.training?.title),1),e("div",Qt,[s(C,{icon:"calendar"}),e("span",null,k(g(r.value.start_date))+" - "+k(g(r.value.end_date)),1),w[0]||(w[0]=e("span",{class:"mx-2"},"|",-1)),s(l(ae),{value:x(r.value.status),severity:b(r.value.status)},null,8,["value","severity"])])])]),s(l(D),{label:"Modifier",severity:"secondary",outlined:"",onClick:v},{icon:m(()=>[s(C,{icon:"pencil",class:"mr-2"})]),_:1})]),e("div",Xt,[e("div",Yt,[s(l(q),null,{title:m(()=>[...w[1]||(w[1]=[I("Informations",-1)])]),content:m(()=>[e("div",Zt,[e("div",null,[w[2]||(w[2]=e("span",{class:"block text-sm text-color-secondary"},"Organisme",-1)),e("span",es,k(r.value.organization?.name||"-"),1)]),e("div",null,[w[3]||(w[3]=e("span",{class:"block text-sm text-color-secondary"},"Lieu",-1)),e("span",ts,k(r.value.location),1)]),e("div",null,[w[4]||(w[4]=e("span",{class:"block text-sm text-color-secondary"},"Formateur",-1)),e("span",ss,k(r.value.instructor||"-"),1)]),e("div",null,[w[5]||(w[5]=e("span",{class:"block text-sm text-color-secondary"},"Coût",-1)),e("span",is,k(r.value.cost?V(r.value.cost):"-"),1)])])]),_:1}),s(Wt,{participations:r.value.participations||[],users:h.value,onAdd:d,onUpdate:$,onRemove:c},null,8,["participations","users"])]),e("div",as,[s(l(q),null,{title:m(()=>[e("div",ns,[w[6]||(w[6]=e("span",null,"Documents",-1)),B((p(),P(l(D),{text:"",rounded:"",size:"small"},{icon:m(()=>[s(C,{icon:"plus"})]),_:1})),[[G,"Ajouter un document"]])])]),content:m(()=>[r.value.documents&&r.value.documents.length>0?(p(),S("div",os,[(p(!0),S(J,null,K(r.value.documents,X=>(p(),S("div",{key:X.id,class:"flex items-center justify-between p-2 hover:bg-surface-50 dark:hover:bg-surface-800 rounded"},[e("div",ls,[s(C,{icon:"file",class:"text-color-secondary"}),e("span",rs,k(X.title),1)]),s(l(D),{text:"",rounded:"",size:"small",severity:"secondary"},{icon:m(()=>[s(C,{icon:"download"})]),_:1})]))),128))])):(p(),S("div",ds,"Aucun document associé."))]),_:1}),s(l(q),null,{title:m(()=>[...w[7]||(w[7]=[I("Statistiques",-1)])]),content:m(()=>[e("div",cs,[e("div",us,[w[8]||(w[8]=e("span",{class:"text-sm text-color-secondary"},"Inscrits",-1)),e("span",ms,k(r.value.participations?.length||0)+" / "+k(r.value.max_participants||"∞"),1)]),e("div",fs,[e("div",{class:"bg-blue-500 h-2 rounded-full",style:Z({width:A()+"%"})},null,4)])])]),_:1})])])])):(p(),S("div",gs,[s(C,{icon:["fas","spinner"],spin:"",size:"2x",class:"text-color-secondary"})]))}}}),ks=Object.freeze(Object.defineProperty({__proto__:null,default:ps},Symbol.toStringTag,{value:"Module"}));export{bs as T,ws as a,$s as b,ks as c};
