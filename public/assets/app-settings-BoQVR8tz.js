import{c as M,i as G,h as H,d as L}from"./app-actions-MIoyI-E5.js";import{d as E,c as N,r as x,o as D,b as w,f as e,i as t,u as o,l as d,j as B,g as P,p as R,t as O,h as U,v as I,m as b,k,x as Q,w as W}from"./vendor-vue-7xZ5dmFb.js";import{u as Z,j as T,a as _,q as J,r as V,n as K,b as S,f as X,o as Y,T as ee,H as te,e as se,F as $,O as le,P as oe,Q as j,R as ae,S as q,B as ie}from"./vendor-primevue-_kQtzldN.js";import{d as ne}from"./vendor-pinia--L0FGc_G.js";import{u as re}from"./app-notifications-HUyJPUVc.js";import"./vendor-other-akJw3aOu.js";import"./vendor-utils-CgaVvxla.js";import"./vendor-icons-Bx-8nqXz.js";const de=ne("settings",{state:()=>({settings:{},loading:!1,error:null}),actions:{async fetchSettings(){this.loading=!0,this.error=null;try{const{get:v}=M(),a=await v("/settings");a.success&&a.data&&(this.settings=a.data)}catch(v){this.error="Failed to fetch settings",console.error(v)}finally{this.loading=!1}},async updateSettings(v){this.loading=!0;try{const{post:a}=M();(await a("/settings",{settings:v})).success&&(this.settings={...this.settings,...v})}catch(a){throw this.error="Failed to update settings",a}finally{this.loading=!1}}}}),ue={class:"category-management"},ce={class:"flex justify-between items-center mb-4"},me={class:"flex items-center gap-2"},fe={key:1},pe={class:"flex gap-1"},ge={class:"flex flex-col gap-4 pt-4"},ve={class:"field"},be={class:"field"},_e={class:"field"},xe={class:"field"},he={class:"field"},ye=E({__name:"CategoryManagement",setup(v){const a=G(),m=Z(),u=T(),i=N(()=>a.categories),h=N(()=>a.loading),g=x(!1),n=x(null),s=x({name:"",slug:"",description:"",color:"",icon:""}),l=()=>{n.value=null,s.value={name:"",slug:"",description:"",color:"#3B82F6",icon:"file"},g.value=!0},y=f=>{n.value=f,s.value={name:f.name,slug:f.slug,description:f.description||"",color:f.color||"#3B82F6",icon:f.icon||"file"},g.value=!0},p=async()=>{try{const f={...s.value,color:s.value.color?.startsWith("#")?s.value.color:`#${s.value.color}`};console.log("Saving category with data:",f),n.value?(await a.updateCategory(n.value.id,f),u.add({severity:"success",summary:"Succès",detail:"Catégorie mise à jour",life:3e3})):(await a.createCategory(f),u.add({severity:"success",summary:"Succès",detail:"Catégorie créée",life:3e3})),g.value=!1}catch(f){console.error("Error saving category:",f),u.add({severity:"error",summary:"Erreur",detail:"Impossible de sauvegarder la catégorie",life:3e3})}},F=f=>{m.require({message:`Voulez-vous vraiment supprimer la catégorie "${f.name}" ?`,header:"Confirmation",icon:"pi pi-exclamation-triangle",acceptClass:"p-button-danger",accept:async()=>{try{await a.deleteCategory(f.id),u.add({severity:"success",summary:"Succès",detail:"Catégorie supprimée",life:3e3})}catch{u.add({severity:"error",summary:"Erreur",detail:"Impossible de supprimer la catégorie (peut-être utilisée par des documents)",life:3e3})}}})};return D(()=>{a.fetchCategories()}),(f,r)=>{const C=B("font-awesome-icon"),A=ee;return b(),w("div",ue,[e("div",ce,[r[7]||(r[7]=e("h3",{class:"text-lg font-semibold"},"Gestion des Catégories",-1)),t(o(_),{label:"Nouvelle catégorie",onClick:l},{icon:d(()=>[t(C,{icon:"plus",class:"mr-2"})]),_:1})]),t(o(J),{value:i.value,loading:h.value,class:"p-datatable-sm"},{default:d(()=>[t(o(V),{field:"name",header:"Nom"}),t(o(V),{field:"description",header:"Description"}),t(o(V),{header:"Couleur",style:{width:"100px"}},{body:d(({data:c})=>[e("div",me,[c.color?(b(),w("div",{key:0,style:R({backgroundColor:c.color}),class:"w-6 h-6 rounded border border-gray-300"},null,4)):P("",!0),e("span",null,O(c.color||"-"),1)])]),_:1}),t(o(V),{header:"Icône",style:{width:"100px"}},{body:d(({data:c})=>[c.icon?(b(),U(C,{key:0,icon:c.icon,class:"text-xl"},null,8,["icon"])):(b(),w("span",fe,"-"))]),_:1}),t(o(V),{header:"Actions",style:{width:"120px"}},{body:d(({data:c})=>[e("div",pe,[I((b(),U(o(_),{text:"",rounded:"",severity:"info",size:"small",onClick:z=>y(c)},{icon:d(()=>[t(C,{icon:"pen"})]),_:1},8,["onClick"])),[[A,"Modifier",void 0,{top:!0}]]),I((b(),U(o(_),{text:"",rounded:"",severity:"danger",size:"small",onClick:z=>F(c)},{icon:d(()=>[t(C,{icon:"trash"})]),_:1},8,["onClick"])),[[A,"Supprimer",void 0,{top:!0}]])])]),_:1})]),_:1},8,["value","loading"]),t(o(K),{visible:g.value,"onUpdate:visible":r[6]||(r[6]=c=>g.value=c),header:n.value?"Modifier la catégorie":"Nouvelle catégorie",modal:!0,style:{width:"500px"}},{footer:d(()=>[t(o(_),{label:"Annuler",text:"",onClick:r[5]||(r[5]=c=>g.value=!1)}),t(o(_),{label:n.value?"Mettre à jour":"Créer",onClick:p,loading:o(a).loading},null,8,["label","loading"])]),default:d(()=>[e("div",ge,[e("div",ve,[r[8]||(r[8]=e("label",{for:"name",class:"block text-sm font-medium mb-2"},"Nom *",-1)),t(o(S),{id:"name",modelValue:s.value.name,"onUpdate:modelValue":r[0]||(r[0]=c=>s.value.name=c),class:"w-full"},null,8,["modelValue"])]),e("div",be,[r[9]||(r[9]=e("label",{for:"slug",class:"block text-sm font-medium mb-2"},"Slug *",-1)),t(o(S),{id:"slug",modelValue:s.value.slug,"onUpdate:modelValue":r[1]||(r[1]=c=>s.value.slug=c),class:"w-full"},null,8,["modelValue"])]),e("div",_e,[r[10]||(r[10]=e("label",{for:"description",class:"block text-sm font-medium mb-2"},"Description",-1)),t(o(X),{id:"description",modelValue:s.value.description,"onUpdate:modelValue":r[2]||(r[2]=c=>s.value.description=c),rows:"3",class:"w-full"},null,8,["modelValue"])]),e("div",xe,[r[11]||(r[11]=e("label",{for:"color",class:"block text-sm font-medium mb-2"},"Couleur",-1)),t(o(Y),{modelValue:s.value.color,"onUpdate:modelValue":r[3]||(r[3]=c=>s.value.color=c),format:"hex",class:"w-full"},null,8,["modelValue"])]),e("div",he,[r[12]||(r[12]=e("label",{for:"icon",class:"block text-sm font-medium mb-2"},"Icône (FontAwesome)",-1)),t(H,{modelValue:s.value.icon,"onUpdate:modelValue":r[4]||(r[4]=c=>s.value.icon=c)},null,8,["modelValue"])])])]),_:1},8,["visible","header"])])}}}),we={class:"p-6 border border-surface-border rounded-lg bg-surface-50 dark:bg-surface-800"},Ve={class:"flex flex-col gap-4"},$e={class:"field"},ke={class:"field"},Ce={class:"flex justify-end mt-6 pt-4"},Se={class:"mt-8 pt-6 border-t border-surface-border"},Ee=E({__name:"DocumentSettings",setup(v){const a=de(),m=T(),u=N(()=>a.loading),i=x({document_base_path:"documents",document_naming_convention:"{original_name}"});D(async()=>{await a.fetchSettings(),a.settings&&(i.value={document_base_path:a.settings.document_base_path||"documents",document_naming_convention:a.settings.document_naming_convention||"{original_name}"})});const h=async()=>{try{await a.updateSettings(i.value),m.add({severity:"success",summary:"Succès",detail:"Paramètres sauvegardés",life:3e3,icon:"check"})}catch{m.add({severity:"error",summary:"Erreur",detail:"Impossible de sauvegarder les paramètres",life:3e3,icon:"times"})}};return(g,n)=>{const s=B("font-awesome-icon");return b(),w("div",we,[n[6]||(n[6]=e("h2",{class:"text-xl font-semibold mb-4 flex items-center gap-2 text-color"},[e("i",{class:"pi pi-file text-blue-500"}),k(" Module Documents ")],-1)),e("div",Ve,[e("div",$e,[n[2]||(n[2]=e("label",{for:"basePath",class:"block text-sm font-medium mb-2 text-color-secondary"}," Chemin de base (sur le serveur) ",-1)),t(o(S),{id:"basePath",modelValue:i.value.document_base_path,"onUpdate:modelValue":n[0]||(n[0]=l=>i.value.document_base_path=l),placeholder:"ex: documents",class:"w-full"},null,8,["modelValue"]),n[3]||(n[3]=e("small",{class:"text-color-secondary"},"Dossier où seront stockés les fichiers (relatif à storage/app/public)",-1))]),e("div",ke,[n[4]||(n[4]=e("label",{for:"namingConvention",class:"block text-sm font-medium mb-2 text-color-secondary"}," Convention de nommage ",-1)),t(o(S),{id:"namingConvention",modelValue:i.value.document_naming_convention,"onUpdate:modelValue":n[1]||(n[1]=l=>i.value.document_naming_convention=l),placeholder:"ex: {date}_{original_name}",class:"w-full"},null,8,["modelValue"]),n[5]||(n[5]=e("small",{class:"text-color-secondary"}," Variables disponibles: {original_name}, {date}, {timestamp} ",-1))])]),e("div",Ce,[t(o(_),{label:"Enregistrer les modifications",onClick:h,loading:u.value},{icon:d(()=>[t(s,{icon:"save",class:"mr-2"})]),_:1},8,["loading"])]),e("div",Se,[t(ye)])])}}}),De={class:"p-6 border border-surface-border rounded-lg bg-surface-50 dark:bg-surface-800"},Ue={class:"text-xl font-semibold mb-4 flex items-center gap-2 text-color"},je={class:"flex flex-col gap-6"},qe={class:"field-checkbox flex items-center gap-2"},Ne={key:0,class:"field"},Be={class:"border-t border-surface-border pt-4"},Te={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Ae={class:"field"},Me={class:"field"},Ie={class:"field"},Pe={class:"field"},Fe={class:"field"},ze={class:"border-t border-surface-border pt-4"},Ge={class:"flex flex-wrap gap-4"},He={class:"flex justify-end mt-6 pt-4 border-t border-surface-border"},Le=E({__name:"NotificationSettings",setup(v){const a=re(),m=T(),u=x(!1),i=x({email_enabled:!0,email_time:new Date(0,0,0,8,0,0),alert_thresholds:{action:3,equipment:7,document:30,training:7,planning:1}});D(async()=>{if(await a.fetchSettings(),a.settings){const[s,l]=a.settings.email_time.split(":").map(Number);i.value={email_enabled:a.settings.email_enabled,email_time:new Date(0,0,0,s,l,0),alert_thresholds:{action:a.settings.alert_thresholds.action??3,equipment:a.settings.alert_thresholds.equipment??7,document:a.settings.alert_thresholds.document??30,training:a.settings.alert_thresholds.training??7,planning:a.settings.alert_thresholds.planning??1}}}});const h=async()=>{u.value=!0;try{const s=i.value.email_time instanceof Date?`${String(i.value.email_time.getHours()).padStart(2,"0")}:${String(i.value.email_time.getMinutes()).padStart(2,"0")}:00`:i.value.email_time;await a.updateSettings({email_enabled:i.value.email_enabled,email_time:s,alert_thresholds:i.value.alert_thresholds}),m.add({severity:"success",summary:"Succès",detail:"Paramètres enregistrés",life:3e3})}catch(s){console.log(s),m.add({severity:"error",summary:"Erreur",detail:"Erreur lors de l'enregistrement",life:3e3})}finally{u.value=!1}},g=async()=>{u.value=!0;try{if(await a.generateAlerts())m.add({severity:"success",summary:"Tâche lancée",detail:"La génération des alertes a été lancée en arrière-plan.",life:3e3});else throw new Error("Echec de la demande")}catch(s){console.error(s),m.add({severity:"error",summary:"Erreur",detail:"Impossible de lancer la tâche",life:3e3})}finally{u.value=!1}},n=async()=>{u.value=!0;try{if(await a.sendEmails())m.add({severity:"success",summary:"Tâche lancée",detail:"L'envoi des emails a été lancé en arrière-plan.",life:3e3});else throw new Error("Echec de la demande")}catch{m.add({severity:"error",summary:"Erreur",detail:"Impossible de lancer la tâche",life:3e3})}finally{u.value=!1}};return(s,l)=>{const y=B("font-awesome-icon");return b(),w("div",De,[e("h2",Ue,[t(y,{icon:["fas","bell"],class:"text-blue-500"}),l[7]||(l[7]=k(" Module Notifications ",-1))]),e("div",je,[e("div",qe,[t(o(te),{id:"email_enabled",modelValue:i.value.email_enabled,"onUpdate:modelValue":l[0]||(l[0]=p=>i.value.email_enabled=p),binary:!0},null,8,["modelValue"]),l[8]||(l[8]=e("label",{for:"email_enabled",class:"font-medium text-color-secondary"},"Recevoir le résumé quotidien par email",-1))]),i.value.email_enabled?(b(),w("div",Ne,[l[9]||(l[9]=e("label",{for:"email_time",class:"block text-sm font-medium text-color-secondary mb-1"},"Heure d'envoi",-1)),t(o(se),{modelValue:i.value.email_time,"onUpdate:modelValue":l[1]||(l[1]=p=>i.value.email_time=p),updateModelType:"string",showIcon:"",fluid:"",iconDisplay:"input",timeOnly:"",inputId:"email_time"},{inputicon:d(()=>[t(y,{icon:["fas","clock"]})]),_:1},8,["modelValue"]),l[10]||(l[10]=e("small",{class:"text-color-secondary"},"L'heure à laquelle vous souhaitez recevoir le récapitulatif.",-1))])):P("",!0),e("div",Be,[l[16]||(l[16]=e("h3",{class:"text-lg font-semibold mb-4 text-color"}," Seuils d'alerte (jours avant échéance) ",-1)),e("div",Te,[e("div",Ae,[l[11]||(l[11]=e("label",{for:"action_threshold",class:"block text-sm font-medium text-color-secondary mb-1"},"Actions",-1)),t(o($),{id:"action_threshold",modelValue:i.value.alert_thresholds.action,"onUpdate:modelValue":l[2]||(l[2]=p=>i.value.alert_thresholds.action=p),showButtons:"",min:1,max:30,suffix:" jours",class:"w-full"},null,8,["modelValue"])]),e("div",Me,[l[12]||(l[12]=e("label",{for:"equipment_threshold",class:"block text-sm font-medium text-color-secondary mb-1"},"Équipements",-1)),t(o($),{id:"equipment_threshold",modelValue:i.value.alert_thresholds.equipment,"onUpdate:modelValue":l[3]||(l[3]=p=>i.value.alert_thresholds.equipment=p),showButtons:"",min:1,max:60,suffix:" jours",class:"w-full"},null,8,["modelValue"])]),e("div",Ie,[l[13]||(l[13]=e("label",{for:"document_threshold",class:"block text-sm font-medium text-color-secondary mb-1"},"Documents (Expiration)",-1)),t(o($),{id:"document_threshold",modelValue:i.value.alert_thresholds.document,"onUpdate:modelValue":l[4]||(l[4]=p=>i.value.alert_thresholds.document=p),showButtons:"",min:1,max:90,suffix:" jours",class:"w-full"},null,8,["modelValue"])]),e("div",Pe,[l[14]||(l[14]=e("label",{for:"training_threshold",class:"block text-sm font-medium text-color-secondary mb-1"},"Formations",-1)),t(o($),{id:"training_threshold",modelValue:i.value.alert_thresholds.training,"onUpdate:modelValue":l[5]||(l[5]=p=>i.value.alert_thresholds.training=p),showButtons:"",min:1,max:30,suffix:" jours",class:"w-full"},null,8,["modelValue"])]),e("div",Fe,[l[15]||(l[15]=e("label",{for:"planning_threshold",class:"block text-sm font-medium text-color-secondary mb-1"},"Planning (Visites/Causeries)",-1)),t(o($),{id:"planning_threshold",modelValue:i.value.alert_thresholds.planning,"onUpdate:modelValue":l[6]||(l[6]=p=>i.value.alert_thresholds.planning=p),showButtons:"",min:1,max:14,suffix:" jours",class:"w-full"},null,8,["modelValue"])])])]),e("div",ze,[l[17]||(l[17]=e("h3",{class:"text-lg font-semibold mb-4 text-color"},"Actions Manuelles (Tests & Débogage)",-1)),e("div",Ge,[t(o(_),{label:"Générer les alertes maintenant",severity:"warn",outlined:"",onClick:g,loading:u.value},{icon:d(()=>[t(y,{icon:"sync",class:"mr-2"})]),_:1},8,["loading"]),t(o(_),{label:"Envoyer les emails maintenant",severity:"help",outlined:"",onClick:n,loading:u.value},{icon:d(()=>[t(y,{icon:"envelope",class:"mr-2"})]),_:1},8,["loading"])])]),e("div",He,[t(o(_),{label:"Enregistrer les modifications",onClick:h,loading:u.value},{icon:d(()=>[t(y,{icon:"save",class:"mr-2"})]),_:1},8,["loading"])])])])}}}),Re={class:"p-4"},Oe={class:"card"},Qe={class:"grid grid-cols-1 md:grid-cols-2 gap-6 mt-4"},We={class:"p-6 border border-surface-border rounded-lg bg-surface-50 dark:bg-surface-800"},Ze={class:"flex items-center justify-between"},Je={class:"p-6 border border-red-200 dark:border-red-800 rounded-lg bg-red-50 dark:bg-red-900/20"},Ke={class:"flex items-center justify-between"},it=E({__name:"SettingsPage",setup(v){const a=L(),m=Q(),u=x(!1),i=x("0"),h=()=>{a.toggleTheme(),u.value=a.theme==="dark"},g=()=>{localStorage.clear(),window.location.reload()};return D(()=>{u.value=a.theme==="dark",m.query.tab&&(i.value=String(m.query.tab))}),W(()=>m.query.tab,n=>{n&&(i.value=String(n))}),(n,s)=>(b(),w("div",Re,[s[8]||(s[8]=e("h1",{class:"text-2xl font-bold text-color mb-6"},"Paramètres",-1)),e("div",Oe,[t(o(le),{value:i.value},{default:d(()=>[t(o(oe),null,{default:d(()=>[t(o(j),{value:"0"},{default:d(()=>[...s[1]||(s[1]=[k("Général",-1)])]),_:1}),t(o(j),{value:"1"},{default:d(()=>[...s[2]||(s[2]=[k("Documents",-1)])]),_:1}),t(o(j),{value:"2"},{default:d(()=>[...s[3]||(s[3]=[k("Notifications",-1)])]),_:1})]),_:1}),t(o(ae),null,{default:d(()=>[t(o(q),{value:"0"},{default:d(()=>[e("div",Qe,[e("div",We,[s[5]||(s[5]=e("h2",{class:"text-xl font-semibold mb-4 text-color"},"Apparence",-1)),e("div",Ze,[s[4]||(s[4]=e("div",{class:"flex flex-col"},[e("span",{class:"font-medium text-color"},"Thème sombre"),e("span",{class:"text-sm text-color-secondary"},"Activer le mode sombre pour l'application")],-1)),t(o(ie),{modelValue:u.value,"onUpdate:modelValue":s[0]||(s[0]=l=>u.value=l),onChange:h},null,8,["modelValue"])])]),e("div",Je,[s[7]||(s[7]=e("h2",{class:"text-xl font-semibold mb-4 text-red-600 dark:text-red-400"}," Zone de danger ",-1)),e("div",Ke,[s[6]||(s[6]=e("div",{class:"flex flex-col"},[e("span",{class:"font-medium text-red-700 dark:text-red-300"},"Vider le cache"),e("span",{class:"text-sm text-red-500 dark:text-red-400"},"Effacer le cache local de l'application")],-1)),t(o(_),{label:"Vider le cache",severity:"danger",outlined:"",onClick:g})])])])]),_:1}),t(o(q),{value:"1"},{default:d(()=>[t(Ee)]),_:1}),t(o(q),{value:"2"},{default:d(()=>[t(Le)]),_:1})]),_:1})]),_:1},8,["value"])])]))}});export{it as default};
