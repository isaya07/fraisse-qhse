import{d as B,h as S,j as D,i as C,m as $,u as d,w as u,a as i,b as o,e as V,t as b,r as z,p as k,c as v,x as N,o as c,q as j,s as T,F as R,I as A,y as F}from"./index-oOuEsLBu.js";import{u as L}from"./indicators-DW2GygZt.js";import{s as E}from"./index-IzGGsCUm.js";import{s as q,a as H}from"./index-kYhIjE44.js";import{s as M}from"./index-CO5Pw-j-.js";import{s as O}from"./index-B3ik4ugR.js";import{s as P}from"./index-Cho6rYmn.js";const Q={class:"flex justify-between items-start"},U=["title"],W={class:"flex items-center gap-2 mb-2"},G={class:"flex flex-col gap-4"},J={class:"flex justify-between items-end"},K={class:"flex flex-col"},X={class:"text-xl font-bold"},Y={class:"text-sm font-normal"},Z={class:"h-32 w-full"},ee=B({__name:"IndicatorCard",props:{indicator:{}},emits:["view","edit"],setup(t){const f=t,p=S(!1);D(()=>{setTimeout(()=>{p.value=!0},100)});const g=e=>({positive:"Hausse",negative:"Baisse",neutral:"Stable"})[e]||e,x=(e,s)=>!e||!s||e==="neutral"?"info":s==="maximize"?e==="positive"?"success":"danger":s==="minimize"?e==="positive"?"danger":"success":"info",y=e=>e&&{positive:"arrow-trend-up",negative:"arrow-trend-down",neutral:"minus"}[e]||"minus",_=C(()=>{const e=f.indicator;if(!e.values||e.values.length===0)return{labels:[],datasets:[]};const m=[...e.values].sort((n,l)=>new Date(n.date).getTime()-new Date(l.date).getTime()).slice(-6),h=m.map(n=>new Date(n.date).toLocaleDateString(void 0,{month:"short"})),w=m.map(n=>n.value),a=e.target_value,r=[{label:"Valeur",data:w,fill:!0,borderColor:"#3B82F6",backgroundColor:"rgba(59, 130, 246, 0.1)",tension:.4,pointRadius:2}];return a!=null&&r.push({label:"Cible",data:Array(h.length).fill(a),fill:!1,borderColor:"#10B981",borderDash:[5,5],tension:0,pointRadius:0,borderWidth:1}),{labels:h,datasets:r}}),I={maintainAspectRatio:!1,plugins:{legend:{display:!1},tooltip:{mode:"index",intersect:!1}},scales:{x:{display:!1,grid:{display:!1}},y:{display:!0,ticks:{count:3,font:{size:10}},grid:{color:"#f3f4f6"}}},interaction:{mode:"nearest",axis:"x",intersect:!1}};return(e,s)=>{const m=z("font-awesome-icon");return c(),$(d(M),{class:"h-full shadow-sm hover:shadow-md transition-shadow cursor-pointer",onClick:s[0]||(s[0]=h=>e.$emit("view",t.indicator.id))},{title:u(()=>[i("div",Q,[i("span",{class:"text-lg font-semibold truncate",title:t.indicator.name},b(t.indicator.name),9,U)])]),subtitle:u(()=>[i("div",W,[t.indicator.indicator_category?(c(),v("div",{key:0,class:"flex items-center gap-2 px-2 py-1 rounded text-xs font-medium text-white",style:N({backgroundColor:t.indicator.indicator_category.color||"#64748B"})},[o(m,{icon:t.indicator.indicator_category.icon||"folder"},null,8,["icon"]),V(" "+b(t.indicator.indicator_category.name),1)],4)):k("",!0)])]),content:u(()=>[i("div",G,[i("div",J,[i("div",K,[s[1]||(s[1]=i("span",{class:"text-sm text-gray-500"},"Cible",-1)),i("span",X,[V(b(t.indicator.target_value)+" ",1),i("span",Y,b(t.indicator.unit),1)])]),o(d(O),{severity:x(t.indicator.trend_direction,t.indicator.goal_type),value:g(t.indicator.trend_direction)},{icon:u(()=>[o(m,{icon:y(t.indicator.trend_direction),class:"mr-2"},null,8,["icon"])]),_:1},8,["severity","value"])]),i("div",Z,[p.value?(c(),$(d(P),{key:0,type:"line",data:_.value,options:I,class:"h-full"},null,8,["data"])):k("",!0)])])]),_:1})}}}),te={class:"p-4"},se={class:"flex flex-col md:flex-row md:items-center md:justify-between mb-6 gap-4"},ne={class:"flex gap-2 items-center"},ie={key:0,class:"flex justify-center items-center py-12"},oe={key:1,class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6"},ae={key:2,class:"text-center p-8 text-gray-500"},pe=B({__name:"IndicateurIndex",setup(t){const f=F(),p=L(),g=S(""),x=C(()=>p.indicators),y=C(()=>p.loading),_=async()=>{await p.fetchIndicators(1,100,{search:g.value})},e=((a,r)=>{let n;return(...l)=>{clearTimeout(n),n=setTimeout(()=>a(...l),r)}})(()=>{_()},300);j(g,()=>{e()});const s=()=>{f.push("/indicators/config")},m=()=>{f.push("/indicators/create")},h=a=>{f.push(`/indicators/${a}`)},w=a=>{f.push(`/indicators/${a}/edit`)};return D(()=>{_()}),(a,r)=>{const n=z("font-awesome-icon");return c(),v("div",te,[i("div",se,[r[1]||(r[1]=i("h2",null,"Tableau de bord Indicateurs",-1)),i("div",ne,[o(d(q),{iconPosition:"left"},{default:u(()=>[o(d(H),null,{default:u(()=>[o(n,{icon:"magnifying-glass"})]),_:1}),o(d(E),{modelValue:g.value,"onUpdate:modelValue":r[0]||(r[0]=l=>g.value=l),placeholder:"Rechercher...",class:"w-full md:w-64"},null,8,["modelValue"])]),_:1}),o(d(T),{label:"Configuration",onClick:s,severity:"secondary",variant:"outlined"},{icon:u(()=>[o(n,{icon:"cog",class:"mr-2"})]),_:1}),o(d(T),{label:"Nouvel indicateur",onClick:m,severity:"primary"},{icon:u(()=>[o(n,{icon:"plus",class:"mr-2"})]),_:1})])]),y.value?(c(),v("div",ie,[o(n,{icon:["fas","spinner"],spin:"",size:"2x",class:"text-gray-500"})])):(c(),v("div",oe,[(c(!0),v(R,null,A(x.value,l=>(c(),$(ee,{key:l.id,indicator:l,onView:h,onEdit:w},null,8,["indicator"]))),128))])),!y.value&&x.value.length===0?(c(),v("div",ae," Aucun indicateur trouvé. Commencez par en créer un. ")):k("",!0)])}}});export{pe as default};
