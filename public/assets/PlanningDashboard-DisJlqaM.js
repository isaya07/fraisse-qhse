import{aK as C,aL as F,aM as N,aN as G,aO as K,d as Q,h as w,i as X,aP as O,q as Z,j as ee,c as p,a as u,b as l,w as m,s as te,t as k,u as D,aJ as se,k as ne,r as oe,F as y,I as S,v as $,n as ae,x as re,y as ie,o as v,_ as le}from"./index-d7axL_xv.js";import{s as ce}from"./index-DK5WICtn.js";import{u as ue}from"./planning-DnUkG1g2.js";import{_ as de}from"./VisitForm.vue_vue_type_script_setup_true_lang-7GYW5jd8.js";import{_ as fe}from"./ToolboxTalkForm.vue_vue_type_script_setup_true_lang-DaRbo9sn.js";import{s as T,a as V,f as z}from"./format-hKf1W1ky.js";import{a as E}from"./addMonths-Dpap_fAF.js";import"./index-DbX5rEQv.js";import"./index-DZQqA5uS.js";import"./index-C4Jjik4c.js";import"./index-xoP2DrFw.js";import"./index-D_33rlMc.js";import"./index-BJVb_8vX.js";import"./index-rhSU9nKe.js";import"./users-CbvhcKd8.js";import"./index-BixvgfbH.js";import"./index-BDoF1CiN.js";function P(o,t,s){const[e,a]=C(s?.in,o,t);return+T(e)==+T(a)}function me(o,t){const[s,e]=C(o,t.start,t.end);return{start:s,end:e}}function pe(o,t){const{start:s,end:e}=me(t?.in,o);let a=+s>+e;const d=a?+s:+e,i=a?e:s;i.setHours(0,0,0,0);let x=1;const _=[];for(;+i<=d;)_.push(F(s,i)),i.setDate(i.getDate()+x),i.setHours(0,0,0,0);return a?_.reverse():_}function I(o,t){const s=N(o,t?.in);return s.setDate(1),s.setHours(0,0,0,0),s}function j(o,t){const s=G(),e=t?.weekStartsOn??t?.locale?.options?.weekStartsOn??s.weekStartsOn??s.locale?.options?.weekStartsOn??0,a=N(o,t?.in),d=a.getDay(),i=(d<e?-7:0)+6-(d-e);return a.setDate(a.getDate()+i),a.setHours(23,59,59,999),a}function ve(o,t,s){const[e,a]=C(s?.in,o,t);return e.getFullYear()===a.getFullYear()&&e.getMonth()===a.getMonth()}function _e(o,t){return P(F(o,o),K(o))}function ge(o,t,s){return E(o,-1,s)}const he={class:"p-4"},be={class:"flex flex-col md:flex-row md:items-center md:justify-between mb-6 gap-4"},ke={class:"flex gap-2 items-center"},xe={class:"flex gap-2 mr-4"},we={class:"flex gap-2"},De={class:"text-xl font-semibold min-w-[150px] text-center flex items-center justify-center"},ye={class:"grow flex flex-col border rounded-lg overflow-hidden"},Se={class:"grid grid-cols-7 bg-surface-50 dark:bg-surface-800 border-b border-surface-border"},Ce={class:"grid grid-cols-7 auto-rows-fr bg-surface-0 dark:bg-surface-900"},Me=["onClick"],Oe={class:"flex justify-between items-start mb-1"},$e={class:"flex flex-col gap-1 overflow-y-auto max-h-[90px] custom-scrollbar"},Te=["onClick"],Ve=Q({__name:"PlanningDashboard",setup(o){const t=ie(),s=ue(),e=w(new Date),a=["Lun","Mar","Mer","Jeu","Ven","Sam","Dim"],d=w(!1),i=w(!1),x=X(()=>{const c=V(I(e.value),{weekStartsOn:1}),r=j(O(e.value),{weekStartsOn:1});return pe({start:c,end:r}).map(f=>({date:f,isCurrentMonth:ve(f,e.value),isToday:_e(f),events:_(f)}))});function _(c){return s.events.filter(r=>P(new Date(r.start),c))}async function b(){const c=V(I(e.value),{weekStartsOn:1}),r=j(O(e.value),{weekStartsOn:1});await s.fetchEvents(c.toISOString(),r.toISOString())}function B(){e.value=ge(e.value)}function H(){e.value=E(e.value,1)}function L(){e.value=new Date}function q(c){console.log("Date clicked:",c)}function J(c){switch(c.type){case"action":t.push(`/actions/${c.original_id}`);break;case"training":t.push(`/trainings/sessions/${c.original_id}`);break;case"visit":t.push("/planning/visits");break;case"talk":t.push("/planning/toolbox-talks");break;case"maintenance":t.push(`/equipment/${c.original_id}`);break}}function R(){d.value=!0}function U(){i.value=!0}function W(){d.value=!1,b()}function Y(){i.value=!1,b()}return Z(e,()=>{b()}),ee(()=>{b()}),(c,r)=>{const g=oe("font-awesome-icon"),f=te,A=ce,M=ne;return v(),p("div",he,[u("div",be,[r[4]||(r[4]=u("h2",null,"Planning Global",-1)),u("div",ke,[u("div",xe,[l(f,{label:"Visite",size:"small",onClick:R},{icon:m(()=>[l(g,{icon:"plus"})]),_:1}),l(f,{label:"1/4h Sécurité",size:"small",severity:"secondary",onClick:U},{icon:m(()=>[l(g,{icon:"plus"})]),_:1})]),u("div",we,[l(f,{text:"",onClick:B},{icon:m(()=>[l(g,{icon:"chevron-left"})]),_:1}),u("span",De,k(D(z)(e.value,"MMMM yyyy",{locale:D(se)})),1),l(f,{text:"",onClick:H},{icon:m(()=>[l(g,{icon:"chevron-right"})]),_:1}),l(f,{label:"Aujourd'hui",variant:"outlined",size:"small",onClick:L})])])]),l(A,null,{content:m(()=>[u("div",ye,[u("div",Se,[(v(),p(y,null,S(a,n=>u("div",{key:n,class:"p-3 text-center font-semibold text-color-secondary uppercase text-sm"},k(n),1)),64))]),u("div",Ce,[(v(!0),p(y,null,S(x.value,n=>(v(),p("div",{key:n.date.toISOString(),class:$(["min-h-[120px] p-2 border-b border-r border-surface-border relative hover:bg-surface-50 dark:hover:bg-surface-800 transition-colors",{"bg-surface-50/50 dark:bg-surface-800/50":!n.isCurrentMonth,"bg-blue-50/30 dark:bg-blue-900/10":n.isToday}]),onClick:h=>q(n.date)},[u("div",Oe,[u("span",{class:$(["text-sm font-medium w-7 h-7 flex items-center justify-center rounded-full",{"bg-blue-600 text-white":n.isToday,"text-color-secondary":!n.isCurrentMonth,"text-color":n.isCurrentMonth&&!n.isToday}])},k(D(z)(n.date,"d")),3)]),u("div",$e,[(v(!0),p(y,null,S(n.events,h=>(v(),p("div",{key:h.id,class:"text-xs p-1 rounded truncate cursor-pointer hover:opacity-80 transition-opacity text-white shadow-sm",style:re({backgroundColor:h.color}),onClick:ae(ze=>J(h),["stop"])},k(h.title),13,Te))),128))])],10,Me))),128))])])]),_:1}),l(M,{visible:d.value,"onUpdate:visible":r[1]||(r[1]=n=>d.value=n),header:"Nouvelle visite",modal:"",class:"p-fluid w-full max-w-lg"},{default:m(()=>[l(de,{onSave:W,onCancel:r[0]||(r[0]=n=>d.value=!1)})]),_:1},8,["visible"]),l(M,{visible:i.value,"onUpdate:visible":r[3]||(r[3]=n=>i.value=n),header:"Nouveau 1/4h Sécurité",modal:"",class:"p-fluid w-full max-w-lg"},{default:m(()=>[l(fe,{onSave:Y,onCancel:r[2]||(r[2]=n=>i.value=!1)})]),_:1},8,["visible"])])}}}),Ke=le(Ve,[["__scopeId","data-v-e0650d18"]]);export{Ke as default};
