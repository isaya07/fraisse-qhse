import{d as F,h as V,i as D,j as N,q as O,c as u,n as w,a,b as s,p,u as n,v,t as f,s as q,o as d}from"./index-oOuEsLBu.js";import{s as b}from"./index-IzGGsCUm.js";import{s as _}from"./index-D4NNOuL2.js";import{s as m}from"./index-CFLhIysZ.js";import{s as k}from"./index-D25kfrV8.js";import{a as E}from"./index-C1JXx-aU.js";import{u as I}from"./indicatorCategories-nHEIoh8X.js";import{u as T}from"./users-CY6PsBvV.js";import{o as A,s as y,Z}from"./schemas-C8kxHR-7.js";const H={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},K={class:"mb-4 col-span-1 md:col-span-2"},Q={key:0,class:"text-red-500"},R={class:"mb-4"},G={class:"mb-4"},J={class:"mb-4"},P={class:"mb-4"},W={key:0,class:"text-red-500"},X={class:"mb-4"},Y={class:"mb-4"},ee={key:0,class:"text-red-500"},le={class:"mb-4"},ae={class:"mb-4"},te={class:"mb-4 col-span-1 md:col-span-2"},oe={class:"mb-4 col-span-1 md:col-span-2"},ie={class:"mb-4 col-span-1 md:col-span-2"},se={class:"mb-4 col-span-1 md:col-span-2 flex items-center gap-2"},ne={class:"flex justify-end gap-3 pt-4 border-t border-surface-border"},_e=F({__name:"IndicatorForm",props:{initialData:{default:()=>({name:"",description:"",code:"",indicator_category_id:null,manager_id:null,unit:"",target_value:null,threshold_min:null,threshold_max:null,calculation_method:"",data_source:"",frequency:"monthly",trend_direction:"neutral",goal_type:"maximize",is_active:!0})},submitButtonText:{default:"Enregistrer"},loading:{type:Boolean,default:!1}},emits:["submit","cancel"],setup(c,{emit:U}){const i=c,g=U,x=I(),h=T(),l=V({name:i.initialData.name||"",description:i.initialData.description||"",code:i.initialData.code||"",indicator_category_id:i.initialData.indicator_category_id||null,manager_id:i.initialData.manager_id||null,unit:i.initialData.unit||"",target_value:i.initialData.target_value??null,threshold_min:i.initialData.threshold_min??null,threshold_max:i.initialData.threshold_max??null,calculation_method:i.initialData.calculation_method||"",data_source:i.initialData.data_source||"",frequency:i.initialData.frequency||"monthly",trend_direction:i.initialData.trend_direction||"neutral",goal_type:i.initialData.goal_type||"maximize",is_active:i.initialData.is_active??!0}),r=V({}),S=A({name:y().min(1,"Le nom est requis").max(255,"Le nom est trop long"),frequency:y().min(1,"La fréquence est requise"),goal_type:y().min(1,"L'objectif est requis")}),C=D(()=>(x.categories||[]).map(o=>({label:o.name,value:o.id}))),z=D(()=>(h.users||[]).map(o=>({label:`${o.first_name} ${o.last_name}`,value:o.id}))),M=[{value:"daily",label:"Quotidienne"},{value:"weekly",label:"Hebdomadaire"},{value:"monthly",label:"Mensuelle"},{value:"quarterly",label:"Trimestrielle"},{value:"yearly",label:"Annuelle"}],L=[{value:"maximize",label:"Maximiser (Mieux si ça monte)"},{value:"minimize",label:"Minimiser (Mieux si ça descend)"},{value:"target",label:"Cibler (Mieux si proche de la cible)"}],$=()=>{r.value={};try{return S.parse(l.value),!0}catch(o){return o instanceof Z&&o.issues.forEach(e=>{if(e.path&&e.path.length>0){const t=e.path[0];t&&(r.value[t]=e.message)}}),!1}},j=()=>{$()&&(l.value.code||(l.value.code=l.value.name.toUpperCase().replace(/[^A-Z0-9]/g,"_").substring(0,50)),g("submit",{...l.value}))},B=()=>{g("cancel")};return N(()=>{x.fetchCategories(),h.fetchUsers(1,100)}),O(()=>i.initialData,o=>{o&&(l.value={name:o.name||"",description:o.description||"",code:o.code||"",indicator_category_id:o.indicator_category_id||null,manager_id:o.manager_id||null,unit:o.unit||"",target_value:o.target_value??null,threshold_min:o.threshold_min??null,threshold_max:o.threshold_max??null,calculation_method:o.calculation_method||"",data_source:o.data_source||"",frequency:o.frequency||"monthly",trend_direction:o.trend_direction||"neutral",goal_type:o.goal_type||"maximize",is_active:o.is_active??!0})},{deep:!0}),(o,e)=>(d(),u("form",{onSubmit:w(j,["prevent"]),class:"flex flex-col gap-6"},[a("div",H,[a("div",K,[e[13]||(e[13]=a("label",{for:"name",class:"block text-sm font-medium mb-2 text-color-secondary"},"Nom *",-1)),s(n(b),{id:"name",modelValue:l.value.name,"onUpdate:modelValue":e[0]||(e[0]=t=>l.value.name=t),placeholder:"Nom de l'indicateur",class:v(["w-full",{"p-invalid":r.value.name}])},null,8,["modelValue","class"]),r.value.name?(d(),u("small",Q,f(r.value.name),1)):p("",!0)]),a("div",R,[e[14]||(e[14]=a("label",{for:"category",class:"block text-sm font-medium mb-2 text-color-secondary"},"Catégorie",-1)),s(n(m),{id:"category",modelValue:l.value.indicator_category_id,"onUpdate:modelValue":e[1]||(e[1]=t=>l.value.indicator_category_id=t),options:C.value,optionLabel:"label",optionValue:"value",placeholder:"Sélectionnez une catégorie",class:"w-full",showClear:""},null,8,["modelValue","options"])]),a("div",G,[e[15]||(e[15]=a("label",{for:"manager",class:"block text-sm font-medium mb-2 text-color-secondary"},"Responsable",-1)),s(n(m),{id:"manager",modelValue:l.value.manager_id,"onUpdate:modelValue":e[2]||(e[2]=t=>l.value.manager_id=t),options:z.value,optionLabel:"label",optionValue:"value",placeholder:"Sélectionnez un responsable",class:"w-full",showClear:"",filter:""},null,8,["modelValue","options"])]),a("div",J,[e[16]||(e[16]=a("label",{for:"unit",class:"block text-sm font-medium mb-2 text-color-secondary"},"Unité",-1)),s(n(b),{id:"unit",modelValue:l.value.unit,"onUpdate:modelValue":e[3]||(e[3]=t=>l.value.unit=t),placeholder:"Unité de mesure (ex: %, kg, €)",class:"w-full"},null,8,["modelValue"])]),a("div",P,[e[17]||(e[17]=a("label",{for:"frequency",class:"block text-sm font-medium mb-2 text-color-secondary"},"Fréquence *",-1)),s(n(m),{id:"frequency",modelValue:l.value.frequency,"onUpdate:modelValue":e[4]||(e[4]=t=>l.value.frequency=t),options:M,optionLabel:"label",optionValue:"value",placeholder:"Sélectionnez une fréquence",class:v(["w-full",{"p-invalid":r.value.frequency}])},null,8,["modelValue","class"]),r.value.frequency?(d(),u("small",W,f(r.value.frequency),1)):p("",!0)]),a("div",X,[e[18]||(e[18]=a("label",{for:"target_value",class:"block text-sm font-medium mb-2 text-color-secondary"},"Valeur cible",-1)),s(n(_),{id:"target_value",modelValue:l.value.target_value,"onUpdate:modelValue":e[5]||(e[5]=t=>l.value.target_value=t),placeholder:"Valeur cible",min:0,maxFractionDigits:2,class:"w-full"},null,8,["modelValue"])]),a("div",Y,[e[19]||(e[19]=a("label",{for:"goal_type",class:"block text-sm font-medium mb-2 text-color-secondary"},"Objectif de l'indicateur *",-1)),s(n(m),{id:"goal_type",modelValue:l.value.goal_type,"onUpdate:modelValue":e[6]||(e[6]=t=>l.value.goal_type=t),options:L,optionLabel:"label",optionValue:"value",placeholder:"Sélectionnez l'objectif",class:v(["w-full",{"p-invalid":r.value.goal_type}])},null,8,["modelValue","class"]),r.value.goal_type?(d(),u("small",ee,f(r.value.goal_type),1)):p("",!0),e[20]||(e[20]=a("small",{class:"text-xs text-muted-color block mt-1"}," Détermine comment la tendance est calculée automatiquement. ",-1))]),a("div",le,[e[21]||(e[21]=a("label",{for:"threshold_min",class:"block text-sm font-medium mb-2 text-color-secondary"},"Seuil minimum",-1)),s(n(_),{id:"threshold_min",modelValue:l.value.threshold_min,"onUpdate:modelValue":e[7]||(e[7]=t=>l.value.threshold_min=t),placeholder:"Seuil minimum",min:0,maxFractionDigits:2,class:"w-full"},null,8,["modelValue"])]),a("div",ae,[e[22]||(e[22]=a("label",{for:"threshold_max",class:"block text-sm font-medium mb-2 text-color-secondary"},"Seuil maximum",-1)),s(n(_),{id:"threshold_max",modelValue:l.value.threshold_max,"onUpdate:modelValue":e[8]||(e[8]=t=>l.value.threshold_max=t),placeholder:"Seuil maximum",min:0,maxFractionDigits:2,class:"w-full"},null,8,["modelValue"])]),a("div",te,[e[23]||(e[23]=a("label",{for:"data_source",class:"block text-sm font-medium mb-2 text-color-secondary"},"Source des données",-1)),s(n(b),{id:"data_source",modelValue:l.value.data_source,"onUpdate:modelValue":e[9]||(e[9]=t=>l.value.data_source=t),placeholder:"Source des données",class:"w-full"},null,8,["modelValue"])]),a("div",oe,[e[24]||(e[24]=a("label",{for:"calculation_method",class:"block text-sm font-medium mb-2 text-color-secondary"},"Méthode de calcul",-1)),s(n(k),{id:"calculation_method",modelValue:l.value.calculation_method,"onUpdate:modelValue":e[10]||(e[10]=t=>l.value.calculation_method=t),placeholder:"Description de la méthode de calcul",rows:"3",class:"w-full"},null,8,["modelValue"])]),a("div",ie,[e[25]||(e[25]=a("label",{for:"description",class:"block text-sm font-medium mb-2 text-color-secondary"},"Description",-1)),s(n(k),{id:"description",modelValue:l.value.description,"onUpdate:modelValue":e[11]||(e[11]=t=>l.value.description=t),placeholder:"Description détaillée de l'indicateur",rows:"4",class:"w-full"},null,8,["modelValue"])]),a("div",se,[s(n(E),{modelValue:l.value.is_active,"onUpdate:modelValue":e[12]||(e[12]=t=>l.value.is_active=t),binary:!0,inputId:"is_active"},null,8,["modelValue"]),e[26]||(e[26]=a("label",{for:"is_active",class:"text-sm font-medium text-color-secondary cursor-pointer"},"Indicateur actif",-1))])]),a("div",ne,[s(n(q),{label:"Annuler",icon:"pi pi-times",text:"",severity:"secondary",onClick:B}),s(n(q),{type:"submit",label:c.submitButtonText,icon:"pi pi-save",loading:c.loading},null,8,["label","loading"])])],32))}});export{_e as _};
