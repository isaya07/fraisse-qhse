import{d as I,G as R,g as T,h as y,i as A,j as D,c as F,a,b as r,w as t,u as s,m as u,p as m,e as c,t as f,s as C,o as n}from"./index-d7axL_xv.js";import{u as G}from"./users-CbvhcKd8.js";import{h as L,s as M,a as d,b}from"./index-D2J_AaRN.js";import{s as w}from"./index-DZQqA5uS.js";import{s as p}from"./index-B5RzIAVk.js";import{o as P,s as v}from"./schemas-C8kxHR-7.js";const H={class:"p-4"},J={class:"grid grid-cols-1 lg:grid-cols-2 gap-6"},K={class:"card surface-card p-4 border-round shadow-2"},O={class:"flex flex-col gap-4"},Q={class:"flex flex-col gap-2"},W={class:"flex flex-col gap-2"},X={class:"flex flex-col gap-2"},Y={class:"flex flex-col gap-2"},Z={class:"flex justify-end mt-2"},$={class:"card surface-card p-4 border-round shadow-2"},ee={class:"flex flex-col gap-4"},se={class:"flex flex-col gap-2"},ae={class:"flex flex-col gap-2"},re={class:"flex flex-col gap-2"},le={class:"flex justify-end mt-2"},ce=I({__name:"ProfilePage",setup(te){const k=R(),h=G(),_=T(),g=y(!1),x=y(!1),o=A(()=>k.currentUser),S=y({username:"",email:"",first_name:"",last_name:""}),V=P({email:v().email("Format d'email invalide"),first_name:v().min(2,"Le prénom est requis"),last_name:v().min(2,"Le nom est requis")}),j=L(V),N=P({current_password:v().min(1,"Le mot de passe actuel est requis"),new_password:v().min(6,"Le nouveau mot de passe doit contenir au moins 6 caractères"),confirm_password:v().min(1,"La confirmation est requise")}).refine(i=>i.new_password===i.confirm_password,{message:"Les mots de passe ne correspondent pas",path:["confirm_password"]}),z=L(N),E=()=>{o.value&&(S.value={username:o.value.username,email:o.value.email,first_name:o.value.first_name,last_name:o.value.last_name})},U=async({valid:i,values:e})=>{if(!(!i||!o.value)){g.value=!0;try{await h.updateUser(o.value.id,e),k.setUser({...o.value,...e}),_.add({severity:"success",summary:"Succès",detail:"Profil mis à jour avec succès",life:3e3,icon:"check"})}catch(l){console.log(l),_.add({severity:"error",summary:"Erreur",detail:"Erreur lors de la mise à jour du profil",life:3e3,icon:"times"})}finally{g.value=!1}}},q=async({valid:i,values:e})=>{if(!i||!o.value)return;const l=e;x.value=!0;try{await h.updateUser(o.value.id,{password:l.new_password}),_.add({severity:"success",summary:"Succès",detail:"Mot de passe modifié avec succès",life:3e3,icon:"check"})}catch(B){_.add({severity:"error",summary:"Erreur",detail:B.message||"Erreur lors du changement de mot de passe",life:3e3,icon:"times"})}finally{x.value=!1}};return D(()=>{E()}),(i,e)=>(n(),F("div",H,[e[10]||(e[10]=a("h1",{class:"text-2xl font-bold text-color mb-6"},"Mon Profil",-1)),a("div",J,[a("div",K,[e[5]||(e[5]=a("h2",{class:"text-xl font-semibold mb-4 text-color"},"Informations personnelles",-1)),r(s(M),{resolver:s(j),onSubmit:U,initialValues:S.value},{default:t(l=>[a("div",O,[a("div",Q,[r(s(d),{variant:"on"},{default:t(()=>[r(s(w),{name:"username",id:"username",type:"text",class:"w-full",fluid:"",disabled:""}),e[0]||(e[0]=a("label",{for:"username"},"Nom d'utilisateur",-1))]),_:1}),e[1]||(e[1]=a("small",{class:"text-color-secondary"},"Le nom d'utilisateur ne peut pas être modifié.",-1))]),a("div",W,[r(s(d),{variant:"on"},{default:t(()=>[r(s(w),{name:"email",id:"email",type:"email",class:"w-full",fluid:""}),e[2]||(e[2]=a("label",{for:"email"},"Email",-1))]),_:1}),l.email?.invalid?(n(),u(s(p),{key:0,severity:"error",size:"small",variant:"simple"},{default:t(()=>[c(f(l.email.error.message),1)]),_:2},1024)):m("",!0)]),a("div",X,[r(s(d),{variant:"on"},{default:t(()=>[r(s(w),{name:"first_name",id:"first_name",type:"text",class:"w-full",fluid:""}),e[3]||(e[3]=a("label",{for:"first_name"},"Prénom",-1))]),_:1}),l.first_name?.invalid?(n(),u(s(p),{key:0,severity:"error",size:"small",variant:"simple"},{default:t(()=>[c(f(l.first_name.error.message),1)]),_:2},1024)):m("",!0)]),a("div",Y,[r(s(d),{variant:"on"},{default:t(()=>[r(s(w),{name:"last_name",id:"last_name",type:"text",class:"w-full",fluid:""}),e[4]||(e[4]=a("label",{for:"last_name"},"Nom",-1))]),_:1}),l.last_name?.invalid?(n(),u(s(p),{key:0,severity:"error",size:"small",variant:"simple"},{default:t(()=>[c(f(l.last_name.error.message),1)]),_:2},1024)):m("",!0)]),a("div",Z,[r(s(C),{type:"submit",label:"Mettre à jour",icon:"pi pi-check",loading:g.value},null,8,["loading"])])])]),_:1},8,["resolver","initialValues"])]),a("div",$,[e[9]||(e[9]=a("h2",{class:"text-xl font-semibold mb-4 text-color"},"Changer le mot de passe",-1)),r(s(M),{resolver:s(z),onSubmit:q},{default:t(l=>[a("div",ee,[a("div",se,[r(s(d),{variant:"on"},{default:t(()=>[r(s(b),{name:"current_password",inputId:"current_password",toggleMask:!0,feedback:!1,class:"w-full",inputClass:"w-full",fluid:""}),e[6]||(e[6]=a("label",{for:"current_password"},"Mot de passe actuel",-1))]),_:1}),l.current_password?.invalid?(n(),u(s(p),{key:0,severity:"error",size:"small",variant:"simple"},{default:t(()=>[c(f(l.current_password.error.message),1)]),_:2},1024)):m("",!0)]),a("div",ae,[r(s(d),{variant:"on"},{default:t(()=>[r(s(b),{name:"new_password",inputId:"new_password",toggleMask:!0,class:"w-full",inputClass:"w-full",fluid:""}),e[7]||(e[7]=a("label",{for:"new_password"},"Nouveau mot de passe",-1))]),_:1}),l.new_password?.invalid?(n(),u(s(p),{key:0,severity:"error",size:"small",variant:"simple"},{default:t(()=>[c(f(l.new_password.error.message),1)]),_:2},1024)):m("",!0)]),a("div",re,[r(s(d),{variant:"on"},{default:t(()=>[r(s(b),{name:"confirm_password",inputId:"confirm_password",toggleMask:!0,feedback:!1,class:"w-full",inputClass:"w-full",fluid:""}),e[8]||(e[8]=a("label",{for:"confirm_password"},"Confirmer le mot de passe",-1))]),_:1}),l.confirm_password?.invalid?(n(),u(s(p),{key:0,severity:"error",size:"small",variant:"simple"},{default:t(()=>[c(f(l.confirm_password.error.message),1)]),_:2},1024)):m("",!0)]),a("div",le,[r(s(C),{type:"submit",label:"Changer le mot de passe",icon:"pi pi-lock",severity:"warn",loading:x.value},null,8,["loading"])])])]),_:1},8,["resolver"])])])]))}});export{ce as default};
