import{d as O,r as S,o as Z,c as U,h as B,u as s,l as n,f as e,i as t,k as F,t as f,j as Q,g as E,b as g,p as re,m as v,w as ce,F as xe,q as he,s as ae,n as X,v as ne,e as de,x as Ve}from"./vendor-vue-7xZ5dmFb.js";import{g as le,c as ie,h as Te,_ as Ae,d as Ue,e as Le}from"./app-actions-MIoyI-E5.js";import{g as N,h as ee,G as Ce,l as Ie,a as z,m as Se,b as G,u as we,j as oe,p as Ee,f as te,o as Me,T as De,q as je,r as M,d as H,n as Be,e as ke,F as Y,H as Fe}from"./vendor-primevue-_kQtzldN.js";import{d as Re}from"./vendor-pinia--L0FGc_G.js";import{o as Ne,s as be,Z as Oe}from"./vendor-other-akJw3aOu.js";const Pe={class:"flex justify-between items-start"},He=["title"],Qe={class:"flex items-center gap-2 mb-2"},We={class:"flex flex-col gap-4"},Ge={class:"flex justify-between items-end"},Ze={class:"flex flex-col"},Ke={class:"text-xl font-bold"},Je={class:"text-sm font-normal"},Xe={class:"h-32 w-full"},Ye=O({__name:"IndicatorCard",props:{indicator:{}},emits:["view","edit"],setup(_){const y=_,u=S(!1);Z(()=>{setTimeout(()=>{u.value=!0},100)});const x=d=>({positive:"Hausse",negative:"Baisse",neutral:"Stable"})[d]||d,k=(d,o)=>!d||!o||d==="neutral"?"info":o==="maximize"?d==="positive"?"success":"danger":o==="minimize"?d==="positive"?"danger":"success":"info",C=d=>d&&{positive:"arrow-trend-up",negative:"arrow-trend-down",neutral:"minus"}[d]||"minus",c=U(()=>{const d=y.indicator;if(!d.values||d.values.length===0)return{labels:[],datasets:[]};const j=[...d.values].sort((p,m)=>new Date(p.date).getTime()-new Date(m.date).getTime()).slice(-6),q=j.map(p=>new Date(p.date).toLocaleDateString(void 0,{month:"short"})),w=j.map(p=>p.value),T=d.target_value,I=[{label:"Valeur",data:w,fill:!0,borderColor:"#3B82F6",backgroundColor:"rgba(59, 130, 246, 0.1)",tension:.4,pointRadius:2}];return T!=null&&I.push({label:"Cible",data:Array(q.length).fill(T),fill:!1,borderColor:"#10B981",borderDash:[5,5],tension:0,pointRadius:0,borderWidth:1}),{labels:q,datasets:I}}),h={maintainAspectRatio:!1,plugins:{legend:{display:!1},tooltip:{mode:"index",intersect:!1}},scales:{x:{display:!1,grid:{display:!1}},y:{display:!0,ticks:{count:3,font:{size:10}},grid:{color:"#f3f4f6"}}},interaction:{mode:"nearest",axis:"x",intersect:!1}};return(d,o)=>{const j=Q("font-awesome-icon");return v(),B(s(N),{class:"h-full shadow-sm hover:shadow-md transition-shadow cursor-pointer",onClick:o[0]||(o[0]=q=>d.$emit("view",_.indicator.id))},{title:n(()=>[e("div",Pe,[e("span",{class:"text-lg font-semibold truncate",title:_.indicator.name},f(_.indicator.name),9,He)])]),subtitle:n(()=>[e("div",Qe,[_.indicator.indicator_category?(v(),g("div",{key:0,class:"flex items-center gap-2 px-2 py-1 rounded text-xs font-medium text-white",style:re({backgroundColor:_.indicator.indicator_category.color||"#64748B"})},[t(j,{icon:_.indicator.indicator_category.icon||"folder"},null,8,["icon"]),F(" "+f(_.indicator.indicator_category.name),1)],4)):E("",!0)])]),content:n(()=>[e("div",We,[e("div",Ge,[e("div",Ze,[o[1]||(o[1]=e("span",{class:"text-sm text-gray-500"},"Cible",-1)),e("span",Ke,[F(f(_.indicator.target_value)+" ",1),e("span",Je,f(_.indicator.unit),1)])]),t(s(ee),{severity:k(_.indicator.trend_direction,_.indicator.goal_type),value:x(_.indicator.trend_direction)},{icon:n(()=>[t(j,{icon:C(_.indicator.trend_direction),class:"mr-2"},null,8,["icon"])]),_:1},8,["severity","value"])]),e("div",Xe,[u.value?(v(),B(s(Ce),{key:0,type:"line",data:c.value,options:h,class:"h-full"},null,8,["data"])):E("",!0)])])]),_:1})}}}),et={class:"p-4"},tt={class:"flex flex-col md:flex-row md:items-center md:justify-between mb-6 gap-4"},at={class:"flex gap-2 items-center"},lt={key:0,class:"flex justify-center items-center py-12"},ot={key:1,class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6"},st={key:2,class:"text-center p-8 text-gray-500"},it=O({__name:"IndicateurIndex",setup(_){const y=ae(),u=le(),x=S(""),k=U(()=>u.indicators),C=U(()=>u.loading),c=async()=>{await u.fetchIndicators(1,100,{search:x.value})},d=((T,I)=>{let p;return(...m)=>{clearTimeout(p),p=setTimeout(()=>T(...m),I)}})(()=>{c()},300);ce(x,()=>{d()});const o=()=>{y.push("/indicators/config")},j=()=>{y.push("/indicators/create")},q=T=>{y.push(`/indicators/${T}`)},w=T=>{y.push(`/indicators/${T}/edit`)};return Z(()=>{c()}),(T,I)=>{const p=Q("font-awesome-icon");return v(),g("div",et,[e("div",tt,[I[1]||(I[1]=e("h2",null,"Tableau de bord Indicateurs",-1)),e("div",at,[t(s(Ie),{iconPosition:"left"},{default:n(()=>[t(s(Se),null,{default:n(()=>[t(p,{icon:"magnifying-glass"})]),_:1}),t(s(G),{modelValue:x.value,"onUpdate:modelValue":I[0]||(I[0]=m=>x.value=m),placeholder:"Rechercher...",class:"w-full md:w-64"},null,8,["modelValue"])]),_:1}),t(s(z),{label:"Configuration",onClick:o,severity:"secondary",variant:"outlined"},{icon:n(()=>[t(p,{icon:"cog",class:"mr-2"})]),_:1}),t(s(z),{label:"Nouvel indicateur",onClick:j,severity:"primary"},{icon:n(()=>[t(p,{icon:"plus",class:"mr-2"})]),_:1})])]),C.value?(v(),g("div",lt,[t(p,{icon:["fas","spinner"],spin:"",size:"2x",class:"text-gray-500"})])):(v(),g("div",ot,[(v(!0),g(xe,null,he(k.value,m=>(v(),B(Ye,{key:m.id,indicator:m,onView:q,onEdit:w},null,8,["indicator"]))),128))])),!C.value&&k.value.length===0?(v(),g("div",st," Aucun indicateur trouvé. Commencez par en créer un. ")):E("",!0)])}}}),_l=Object.freeze(Object.defineProperty({__proto__:null,default:it},Symbol.toStringTag,{value:"Module"})),$e=Re("indicatorCategory",{state:()=>({categories:[],loading:!1,error:null}),actions:{async fetchCategories(){this.loading=!0,this.error=null;try{const{get:_}=ie(),y=await _("/indicator-categories");if(y.success&&y.data){const u=y.data;this.categories=(Array.isArray(u)?u:u.data)||[]}}catch(_){this.error="Erreur lors du chargement des catégories",console.error(_)}finally{this.loading=!1}},async createCategory(_){this.loading=!0;try{const{post:y}=ie(),u=await y("/indicator-categories",_);u.success&&u.data&&this.categories.push(u.data)}catch(y){throw y}finally{this.loading=!1}},async updateCategory(_,y){this.loading=!0;try{const{put:u}=ie(),x=await u(`/indicator-categories/${_}`,y);if(x.success&&x.data){const k=this.categories.findIndex(C=>C.id===_);k!==-1&&(this.categories[k]=x.data)}}catch(u){throw u}finally{this.loading=!1}},async deleteCategory(_){this.loading=!0;try{const{del:y}=ie();(await y(`/indicator-categories/${_}`)).success&&(this.categories=this.categories.filter(x=>x.id!==_))}catch(y){throw y}finally{this.loading=!1}}}}),nt={class:"flex items-center gap-2"},rt={class:"flex flex-col h-full"},dt={class:"flex-1 overflow-y-auto mb-4 custom-scrollbar pr-2"},ct={key:0,class:"flex justify-center py-8"},ut={key:1,class:"text-center py-8 text-color-secondary"},mt={key:2,class:"flex flex-col gap-3"},vt=["onClick"],pt={class:"flex items-center gap-4"},ft={class:"font-bold text-color text-base mb-0.5"},yt={class:"text-sm text-color-secondary line-clamp-2 leading-tight"},_t={key:0,class:"ml-2"},gt={key:1,class:"ml-2"},bt={class:"border-t border-surface-border pt-6 mt-auto"},xt={class:"flex items-center justify-between mb-4"},ht={class:"text-xl font-bold text-color"},wt={key:0,class:"text-red-500"},$t={class:"grid grid-cols-2 gap-4"},kt={class:"flex gap-2"},Vt={class:"flex justify-end gap-2 mt-4"},Ct=O({__name:"IndicatorTypeManager",props:{visible:{type:Boolean}},emits:["update:visible"],setup(_,{emit:y}){const u=_,x=y,k=$e(),C=we(),c=oe(),h=U(()=>k.categories),d=U(()=>k.loading),o=S(null),j=S(!1),q=S(!1),w=S({name:"",description:"",color:"3b82f6",icon:"tag"}),T=()=>{o.value=null,w.value={name:"",description:"",color:"3b82f6",icon:"tag"},q.value=!1},I=l=>{o.value=l,w.value={name:l.name,description:l.description||"",color:l.color?l.color.replace("#",""):"3b82f6",icon:l.icon||"tag"}},p=async()=>{if(q.value=!0,!!w.value.name){j.value=!0;try{const l={...w.value,color:`#${w.value.color}`};o.value?(await k.updateCategory(o.value.id,l),c.add({severity:"success",summary:"Succès",detail:"Type mis à jour",life:3e3})):(await k.createCategory(l),c.add({severity:"success",summary:"Succès",detail:"Type créé",life:3e3})),T()}catch{c.add({severity:"error",summary:"Erreur",detail:"Une erreur est survenue",life:3e3})}finally{j.value=!1}}},m=l=>{C.require({message:`Voulez-vous vraiment supprimer le type "${l.name}" ?`,header:"Confirmation",icon:"exclamation-triangle",acceptClass:"p-button-danger",accept:async()=>{try{await k.deleteCategory(l.id),c.add({severity:"success",summary:"Succès",detail:"Type supprimé",life:3e3}),o.value?.id===l.id&&T()}catch{c.add({severity:"error",summary:"Erreur",detail:"Impossible de supprimer ce type",life:3e3})}}})};return ce(()=>u.visible,l=>{l&&k.fetchCategories()}),(l,i)=>{const L=Q("font-awesome-icon"),K=De;return v(),B(s(Ee),{visible:_.visible,"onUpdate:visible":i[5]||(i[5]=D=>x("update:visible",D)),position:"right",style:{width:"40rem"}},{header:n(()=>[e("div",nt,[t(L,{icon:"tags",class:"text-xl text-primary"}),i[6]||(i[6]=e("span",{class:"text-xl font-bold"},"Gérer les types d'indicateurs",-1))])]),default:n(()=>[e("div",rt,[e("div",dt,[d.value?(v(),g("div",ct,[t(L,{icon:"spinner",spin:"",size:"2x",class:"text-color-secondary"})])):h.value.length===0?(v(),g("div",ut,[...i[7]||(i[7]=[e("p",null,"Aucun type d'indicateur défini",-1)])])):(v(),g("div",mt,[(v(!0),g(xe,null,he(h.value,D=>(v(),g("div",{key:D.id,onClick:J=>I(D),class:X(["relative flex items-center justify-between p-4 rounded-xl border transition-all cursor-pointer group",[o.value?.id===D.id?"border-primary bg-primary-50 dark:bg-primary-900/20":"border-surface-border bg-surface-card hover:border-primary-200 hover:shadow-sm"]])},[e("div",pt,[e("div",{class:"w-10 h-10 rounded-lg flex items-center justify-center text-white shadow-sm",style:re({backgroundColor:D.color||"#3b82f6"})},[t(L,{icon:D.icon||"tag",class:"text-lg"},null,8,["icon"])],4),e("div",null,[e("div",ft,f(D.name),1),e("div",yt,f(D.description),1)])]),o.value?.id!==D.id?(v(),g("div",_t,[ne((v(),B(s(z),{icon:"pi pi-trash",text:"",rounded:"",severity:"danger",size:"small",class:"opacity-0 group-hover:opacity-100 transition-opacity",onClick:de(J=>m(D),["stop"])},{icon:n(()=>[t(L,{icon:"trash",class:"text-sm"})]),_:1},8,["onClick"])),[[K,"Supprimer",void 0,{top:!0}]])])):(v(),g("div",gt,[t(L,{icon:"pen",class:"text-primary text-sm"})]))],10,vt))),128))]))]),e("div",bt,[e("div",xt,[e("h3",ht,f(o.value?"Modifier le type":"Nouveau type"),1),o.value?(v(),B(s(z),{key:0,label:"Nouveau type",icon:"pi pi-plus",size:"small",severity:"secondary",outlined:"",onClick:T},{icon:n(()=>[t(L,{icon:"plus",class:"mr-2"})]),_:1})):E("",!0)]),e("form",{onSubmit:de(p,["prevent"]),class:"flex flex-col gap-4"},[e("div",null,[i[8]||(i[8]=e("label",{class:"block text-sm font-medium mb-1 text-color-secondary"},"Nom *",-1)),t(s(G),{modelValue:w.value.name,"onUpdate:modelValue":i[0]||(i[0]=D=>w.value.name=D),placeholder:"Ex: Sécurité, Qualité...",class:X(["w-full",{"p-invalid":q.value&&!w.value.name}])},null,8,["modelValue","class"]),q.value&&!w.value.name?(v(),g("small",wt,"Le nom est requis")):E("",!0)]),e("div",null,[i[9]||(i[9]=e("label",{class:"block text-sm font-medium mb-1 text-color-secondary"},"Description",-1)),t(s(te),{modelValue:w.value.description,"onUpdate:modelValue":i[1]||(i[1]=D=>w.value.description=D),rows:"2",class:"w-full",placeholder:"Brève description..."},null,8,["modelValue"])]),e("div",$t,[e("div",null,[i[10]||(i[10]=e("label",{class:"block text-sm font-medium mb-1 text-color-secondary"},"Couleur",-1)),e("div",kt,[t(s(Me),{modelValue:w.value.color,"onUpdate:modelValue":i[2]||(i[2]=D=>w.value.color=D),format:"hex",class:"w-full"},null,8,["modelValue"]),e("div",{style:re({backgroundColor:`#${w.value.color}`,width:"2rem",height:"2rem",borderRadius:"4px"}),class:"border border-surface-border"},null,4)])]),e("div",null,[i[11]||(i[11]=e("label",{class:"block text-sm font-medium mb-1 text-color-secondary"},"Icône",-1)),t(Te,{modelValue:w.value.icon,"onUpdate:modelValue":i[3]||(i[3]=D=>w.value.icon=D)},null,8,["modelValue"])])]),e("div",Vt,[o.value?(v(),B(s(z),{key:0,label:"Supprimer",severity:"danger",text:"",onClick:i[4]||(i[4]=D=>m(o.value)),size:"small",class:"mr-auto"},{icon:n(()=>[t(L,{icon:"trash",class:"mr-2"})]),_:1})):E("",!0),t(s(z),{type:"submit",label:o.value?"Enregistrer":"Ajouter",loading:j.value},{icon:n(()=>[t(L,{icon:o.value?"check":"plus",class:"mr-2"},null,8,["icon"])]),_:1},8,["label","loading"])])],32)])])]),_:1},8,["visible"])}}}),It=Ae(Ct,[["__scopeId","data-v-ad78552c"]]),St={class:"p-4"},Dt={class:"flex flex-col md:flex-row md:items-center md:justify-between mb-6 gap-4"},jt={class:"flex items-center gap-4"},zt={class:"flex gap-2"},qt={class:"card"},Tt={class:"flex flex-wrap gap-2 items-center justify-between mb-4"},At={class:"font-medium"},Ut={class:"text-sm text-color-secondary truncate max-w-xs"},Lt={key:0,class:"flex items-center gap-2"},Et={class:"w-6 h-6 rounded-full bg-blue-100 flex items-center justify-center text-blue-600 text-xs font-bold"},Mt={class:"text-sm"},Bt={key:1,class:"text-color-secondary"},Ft={class:"flex gap-2"},Rt=O({__name:"IndicateurConfig",setup(_){const y=ae(),u=le(),x=$e(),k=we(),C=oe(),c=S(""),h=S(null),d=S(null),o=S(null),j=S(10),q=S(0),w=S(!1),T=U(()=>u.indicators),I=U(()=>u.loading),p=U(()=>u.pagination.total),m=U(()=>x.categories),l=[{label:"Positive",value:"positive"},{label:"Négative",value:"negative"},{label:"Neutre",value:"neutral"}],i=[{label:"Actif",value:"true"},{label:"Inactif",value:"false"}],L=async()=>{const V={search:c.value,indicator_category_id:h.value,trend_direction:d.value,is_active:o.value};await u.fetchIndicators(q.value+1,j.value,V)},K=V=>{q.value=V.page,j.value=V.rows,L()},D=V=>({daily:"Quotidienne",weekly:"Hebdomadaire",monthly:"Mensuelle",quarterly:"Trimestrielle",yearly:"Annuelle"})[V]||V,J=V=>({positive:"Hausse",negative:"Baisse",neutral:"Stable"})[V]||V,ue=(V,$)=>!V||!$||V==="neutral"?"info":$==="maximize"?V==="positive"?"success":"danger":$==="minimize"?V==="positive"?"danger":"success":"info",se=V=>V&&{positive:"arrow-trend-up",negative:"arrow-trend-down",neutral:"minus"}[V]||"minus",me=()=>{y.push("/indicators/create")},ve=V=>{y.push(`/indicators/${V}`)},pe=V=>{y.push(`/indicators/${V}/edit`)},fe=V=>{k.require({message:`Voulez-vous vraiment supprimer l'indicateur "${V.name}" ?`,header:"Confirmation de suppression",icon:"exclamation-triangle",rejectLabel:"Annuler",acceptLabel:"Supprimer",rejectClass:"p-button-secondary p-button-outlined",acceptClass:"p-button-danger",accept:async()=>{try{await u.deleteIndicator(V.id),C.add({severity:"success",summary:"Succès",detail:"Indicateur supprimé",life:3e3}),L()}catch($){console.error("Erreur lors de la suppression:",$),C.add({severity:"error",summary:"Erreur",detail:"Impossible de supprimer l'indicateur",life:3e3})}}})},ye=()=>y.back();return ce([c,h,d,o],()=>{q.value=0,L()}),Z(()=>{x.fetchCategories(),L()}),(V,$)=>{const R=Q("font-awesome-icon"),r=De;return v(),g("div",St,[e("div",Dt,[e("div",jt,[t(s(z),{text:"",rounded:"",severity:"secondary",onClick:ye},{icon:n(()=>[t(R,{icon:"arrow-left"})]),_:1}),$[6]||($[6]=e("h2",{class:"mt-0!"},"Configuration des indicateurs",-1))]),e("div",zt,[t(s(z),{label:"Gérer les types",onClick:$[0]||($[0]=a=>w.value=!0),severity:"secondary",outlined:""},{icon:n(()=>[t(R,{icon:"tags",class:"mr-2"})]),_:1}),t(s(z),{label:"Nouvel indicateur",onClick:me,severity:"primary"},{icon:n(()=>[t(R,{icon:"plus",class:"mr-2"})]),_:1})])]),e("div",qt,[t(s(je),{ref:"dt",value:T.value,lazy:"",paginator:!0,rows:j.value,totalRecords:p.value,loading:I.value,onPage:K,paginatorTemplate:"FirstPageLink PrevPageLink PageLinks NextPageLink LastPageLink CurrentPageReport RowsPerPageDropdown",rowsPerPageOptions:[5,10,25,50],currentPageReportTemplate:"Affichage de {first} à {last} sur {totalRecords} indicateurs",tableStyle:"min-width: 50rem",class:"p-datatable-sm"},{header:n(()=>[e("div",Tt,[$[7]||($[7]=e("h4",{class:"m-0"},"Liste des indicateurs",-1)),t(s(H),{modelValue:h.value,"onUpdate:modelValue":$[1]||($[1]=a=>h.value=a),options:m.value,optionLabel:"name",optionValue:"id",placeholder:"Catégorie",class:"w-full md:w-40",showClear:""},null,8,["modelValue","options"]),t(s(H),{modelValue:d.value,"onUpdate:modelValue":$[2]||($[2]=a=>d.value=a),options:l,optionLabel:"label",optionValue:"value",placeholder:"Tendance",class:"w-full md:w-40",showClear:""},null,8,["modelValue"]),t(s(H),{modelValue:o.value,"onUpdate:modelValue":$[3]||($[3]=a=>o.value=a),options:i,optionLabel:"label",optionValue:"value",placeholder:"Statut",class:"w-full md:w-40",showClear:""},null,8,["modelValue"]),t(s(Ie),{iconPosition:"left"},{default:n(()=>[t(s(Se),null,{default:n(()=>[t(R,{icon:"magnifying-glass"})]),_:1}),t(s(G),{modelValue:c.value,"onUpdate:modelValue":$[4]||($[4]=a=>c.value=a),placeholder:"Rechercher..."},null,8,["modelValue"])]),_:1})])]),empty:n(()=>[...$[8]||($[8]=[F(" Aucun indicateur trouvé. ",-1)])]),default:n(()=>[t(s(M),{field:"name",header:"Nom",sortable:"",style:{"min-width":"14rem"}},{body:n(({data:a})=>[e("div",At,f(a.name),1),e("div",Ut,f(a.description),1)]),_:1}),t(s(M),{field:"indicator_category.name",header:"Catégorie",sortable:"",style:{"min-width":"10rem"}},{body:n(({data:a})=>[F(f(a.indicator_category?.name||"-"),1)]),_:1}),t(s(M),{field:"manager",header:"Responsable",style:{"min-width":"12rem"}},{body:n(({data:a})=>[a.manager?(v(),g("div",Lt,[e("div",Et,f(a.manager.first_name[0])+f(a.manager.last_name[0]),1),e("span",Mt,f(a.manager.first_name)+" "+f(a.manager.last_name),1)])):(v(),g("span",Bt,"-"))]),_:1}),t(s(M),{field:"frequency",header:"Fréquence",sortable:"",style:{"min-width":"10rem"}},{body:n(({data:a})=>[F(f(D(a.frequency)),1)]),_:1}),t(s(M),{field:"target_value",header:"Cible",sortable:"",style:{"min-width":"8rem"}},{body:n(({data:a})=>[F(f(a.target_value)+" "+f(a.unit),1)]),_:1}),t(s(M),{field:"trend_direction",header:"Tendance",sortable:"",style:{"min-width":"10rem"}},{body:n(({data:a})=>[t(s(ee),{value:J(a.trend_direction),severity:ue(a.trend_direction,a.goal_type)},{icon:n(()=>[t(R,{icon:se(a.trend_direction),class:"mr-2"},null,8,["icon"])]),_:2},1032,["value","severity"])]),_:1}),t(s(M),{field:"is_active",header:"Statut",sortable:"",style:{"min-width":"8rem"}},{body:n(({data:a})=>[t(s(ee),{value:a.is_active?"Actif":"Inactif",severity:a.is_active?"success":"secondary"},null,8,["value","severity"])]),_:1}),t(s(M),{header:"Actions",exportable:!1,style:{"min-width":"8rem"}},{body:n(({data:a})=>[e("div",Ft,[ne((v(),B(s(z),{text:"",rounded:"",severity:"info",onClick:A=>ve(a.id)},{default:n(()=>[t(R,{icon:"eye"})]),_:1},8,["onClick"])),[[r,"Voir",void 0,{top:!0}]]),ne((v(),B(s(z),{text:"",rounded:"",severity:"success",onClick:A=>pe(a.id)},{default:n(()=>[t(R,{icon:"pencil"})]),_:1},8,["onClick"])),[[r,"Modifier",void 0,{top:!0}]]),ne((v(),B(s(z),{text:"",rounded:"",severity:"danger",onClick:A=>fe(a)},{default:n(()=>[t(R,{icon:"trash"})]),_:1},8,["onClick"])),[[r,"Supprimer",void 0,{top:!0}]])])]),_:1})]),_:1},8,["value","rows","totalRecords","loading"])]),t(It,{visible:w.value,"onUpdate:visible":$[5]||($[5]=a=>w.value=a)},null,8,["visible"])])}}}),gl=Object.freeze(Object.defineProperty({__proto__:null,default:Rt},Symbol.toStringTag,{value:"Module"})),Nt={class:"p-4"},Ot={class:"flex flex-col md:flex-row md:items-center md:justify-between mb-6 gap-4"},Pt={class:"flex items-center gap-4"},Ht={class:"flex items-center gap-3"},Qt={class:"flex gap-2"},Wt={key:0,class:"flex justify-center py-12"},Gt={key:1,class:"grid grid-cols-1 lg:grid-cols-3 gap-6"},Zt={class:"lg:col-span-2 flex flex-col gap-6"},Kt={class:"h-[400px] w-full"},Jt={class:"font-bold"},Xt={class:"flex gap-2"},Yt={class:"flex flex-col gap-6"},ea={class:"flex flex-col gap-2"},ta={class:"flex items-end gap-2"},aa={class:"text-4xl font-bold text-color"},la={class:"text-lg text-color-secondary mb-1"},oa={class:"flex items-center gap-2 mt-2"},sa={class:"text-sm text-color-secondary"},ia={class:"flex flex-col gap-2"},na={class:"flex flex-col gap-2"},ra={for:"value",class:"text-sm font-medium text-color-secondary"},da={class:"flex flex-col gap-2"},ca={class:"flex flex-col gap-3 text-sm"},ua={class:"flex justify-between"},ma={class:"font-medium"},va={class:"flex justify-between"},pa={class:"font-medium"},fa={class:"flex justify-between"},ya={class:"font-medium"},_a={class:"flex justify-between"},ga={class:"font-medium text-right max-w-[60%]"},ba={key:0,class:"mt-2 pt-2 border-t border-surface-border"},xa={class:"text-color"},ha={key:1,class:"mt-2 pt-2 border-t border-surface-border"},wa={class:"flex items-center gap-2"},$a={class:"w-8 h-8 rounded-full bg-blue-100 dark:bg-blue-900/20 flex items-center justify-center text-blue-600 dark:text-blue-400 font-bold"},ka={class:"font-medium"},Va={class:"flex items-center gap-2 mb-2"},Ca={key:0,class:"flex flex-col gap-3"},Ia=["onClick"],Sa={class:"flex justify-between items-start mb-1"},Da={class:"font-medium text-color text-sm line-clamp-2"},ja={class:"flex justify-between items-center text-xs text-color-secondary"},za={key:0},qa={key:1,class:"text-color-secondary text-sm italic"},Ta={class:"flex flex-col gap-4 pt-4"},Aa={class:"flex flex-col gap-2"},Ua={class:"flex flex-col gap-2"},La={class:"flex flex-col gap-2"},Ea=O({__name:"IndicateurDetail",setup(_){const y=Ve(),u=ae(),x=le(),k=Ue(),C=oe(),c=we(),h=S(!1),d=S({date:new Date,value:null,comment:""}),o=U(()=>x.currentIndicator),j=U(()=>x.loading),q=U(()=>o.value?.values&&o.value.values.length>0?o.value.values[0]:null),w=U(()=>{if(!o.value||!o.value.values)return{labels:[],datasets:[]};const r=[...o.value.values].sort((W,qe)=>new Date(W.date).getTime()-new Date(qe.date).getTime()),a=r.map(W=>W.date?new Date(W.date).toLocaleDateString():"-"),A=r.map(W=>W.value),b=o.value.target_value,P=[{label:"Valeur",data:A,fill:!0,borderColor:"#3B82F6",backgroundColor:"rgba(59, 130, 246, 0.1)",tension:.4,borderWidth:1}];b!=null&&P.push({label:"Cible",data:Array(a.length).fill(b),fill:!1,borderColor:"#10B981",borderDash:[5,5],tension:0,pointRadius:0,borderWidth:2});const _e=o.value.threshold_min;_e!=null&&P.push({label:"Seuil Min",data:Array(a.length).fill(_e),fill:!1,borderColor:"#F97316",borderDash:[2,2],tension:0,pointRadius:0,borderWidth:1});const ge=o.value.threshold_max;return ge!=null&&P.push({label:"Seuil Max",data:Array(a.length).fill(ge),fill:!1,borderColor:"#EF4444",borderDash:[2,2],tension:0,pointRadius:0,borderWidth:1}),{labels:a,datasets:P}}),T={maintainAspectRatio:!1,plugins:{legend:{position:"bottom"}},scales:{y:{beginAtZero:!0}}},I=async()=>{const r=y.params.id,a=Array.isArray(r)?r[0]:r;if(a){const A=parseInt(a);isNaN(A)||await x.fetchIndicatorById(A)}},p=async()=>{if(!d.value.value||!d.value.date){C.add({severity:"warn",summary:"Attention",detail:"Veuillez remplir la date et la valeur",life:3e3,icon:"exclamation-triangle"});return}h.value=!0;try{const r=y.params.id,a=Array.isArray(r)?r[0]:r;if(!a)throw new Error("ID de l'indicateur manquant");const A=parseInt(a);if(isNaN(A))throw new Error("ID de l'indicateur invalide");const b=d.value.date.toISOString().split("T")[0];await x.addIndicatorValue(A,{value:d.value.value,date:b,comment:d.value.comment}),C.add({severity:"success",summary:"Succès",detail:"Valeur ajoutée",life:3e3,icon:"check"}),d.value={date:new Date,value:null,comment:""}}catch(r){console.log(r),C.add({severity:"error",summary:"Erreur",detail:"Erreur lors de l'ajout",life:3e3,icon:"times"})}finally{h.value=!1}},m=S(!1),l=S(!1),i=S({id:0,date:new Date,value:null,comment:""}),L=r=>{i.value={id:r.id,date:new Date(r.date),value:r.value,comment:r.comment||""},m.value=!0},K=async()=>{if(i.value.value!==null){l.value=!0;try{const r=o.value?.id;if(!r)return;const a=i.value.date.toISOString().split("T")[0]??"";await x.updateIndicatorValue(r,i.value.id,{value:i.value.value,date:a,comment:i.value.comment}),C.add({severity:"success",summary:"Succès",detail:"Valeur mise à jour",life:3e3}),m.value=!1}catch{C.add({severity:"error",summary:"Erreur",detail:"Impossible de mettre à jour la valeur",life:3e3})}finally{l.value=!1}}},D=r=>{c.require({message:"Voulez-vous vraiment supprimer cette valeur ?",header:"Confirmation",icon:"exclamation-triangle",acceptClass:"p-button-danger",accept:async()=>{try{if(!o.value?.id)return;await x.deleteIndicatorValue(o.value.id,r.id),C.add({severity:"success",summary:"Succès",detail:"Valeur supprimée",life:3e3})}catch{C.add({severity:"error",summary:"Erreur",detail:"Impossible de supprimer la valeur",life:3e3})}}})},J=()=>u.back(),ue=()=>u.push(`/indicators/${y.params.id}/edit`),se=r=>r?new Date(r).toLocaleDateString():"-",me=r=>r?{daily:"Quotidienne",weekly:"Hebdomadaire",monthly:"Mensuelle",quarterly:"Trimestrielle",yearly:"Annuelle"}[r]||r:"-",ve=r=>r?{positive:"Hausse",negative:"Baisse",neutral:"Stable"}[r]||r:"Stable",pe=(r,a)=>!r||!a||r==="neutral"?"info":a==="maximize"?r==="positive"?"success":"danger":a==="minimize"?r==="positive"?"danger":"success":"info",fe=r=>r&&{positive:"arrow-trend-up",negative:"arrow-trend-down",neutral:"minus"}[r]||"minus",ye=r=>r?{maximize:"Maximiser",minimize:"Minimiser",target:"Cibler"}[r]||r:"-",V=r=>r?{open:"Ouvert",in_progress:"En cours",completed:"Terminé",cancelled:"Annulé"}[r]||r:"-",$=r=>r?{low:"Basse",medium:"Moyenne",high:"Haute",critical:"Critique"}[r]||r:"-",R=r=>r?{low:"info",medium:"warn",high:"danger",critical:"danger"}[r]||"info":"secondary";return Z(()=>{I()}),(r,a)=>{const A=Q("font-awesome-icon");return v(),g("div",Nt,[e("div",Ot,[e("div",Pt,[t(s(z),{text:"",rounded:"",severity:"secondary",onClick:J},{icon:n(()=>[t(A,{icon:"arrow-left"})]),_:1}),e("div",null,[e("div",Ht,[e("h2",null,f(o.value?.name),1),o.value?.indicator_category?(v(),g("div",{key:0,class:"flex items-center gap-2 px-2 py-0.5 rounded text-xs font-medium text-white",style:re({backgroundColor:o.value.indicator_category.color||"#64748B"})},[t(A,{icon:o.value.indicator_category.icon||"folder"},null,8,["icon"]),F(" "+f(o.value.indicator_category.name),1)],4)):E("",!0)])])]),e("div",Qt,[t(s(z),{label:"Modifier",severity:"secondary",outlined:"",onClick:ue},{icon:n(()=>[t(A,{icon:"pencil",class:"mr-2"})]),_:1})])]),j.value?(v(),g("div",Wt,[t(A,{icon:["fas","spinner"],spin:"",size:"2x",class:"text-color-secondary"})])):o.value?(v(),g("div",Gt,[e("div",Zt,[t(s(N),null,{title:n(()=>[...a[8]||(a[8]=[F("Évolution",-1)])]),content:n(()=>[e("div",Kt,[(v(),B(s(Ce),{type:"line",data:w.value,options:T,class:"h-full",key:o.value.id},null,8,["data"]))])]),_:1}),t(s(N),null,{title:n(()=>[...a[9]||(a[9]=[F("Historique des valeurs",-1)])]),content:n(()=>[t(s(je),{value:o.value.values,paginator:"",rows:5,size:"small",stripedRows:""},{default:n(()=>[t(s(M),{field:"date",header:"Date"},{body:n(b=>[F(f(se(b.data.date)),1)]),_:1}),t(s(M),{field:"value",header:"Valeur"},{body:n(b=>[e("span",Jt,f(b.data.value)+" "+f(o.value.unit),1)]),_:1}),t(s(M),{field:"comment",header:"Commentaire"}),t(s(M),{field:"creator.username",header:"Saisi par"}),s(k).userRole==="admin"?(v(),B(s(M),{key:0,header:"Actions",style:{width:"100px"}},{body:n(b=>[e("div",Xt,[t(s(z),{icon:"pi pi-pencil",text:"",rounded:"",severity:"secondary",size:"small",onClick:P=>L(b.data)},{icon:n(()=>[t(A,{icon:"pencil"})]),_:1},8,["onClick"]),t(s(z),{icon:"pi pi-trash",text:"",rounded:"",severity:"danger",size:"small",onClick:P=>D(b.data)},{icon:n(()=>[t(A,{icon:"trash"})]),_:1},8,["onClick"])])]),_:1})):E("",!0)]),_:1},8,["value"])]),_:1})]),e("div",Yt,[t(s(N),null,{content:n(()=>[e("div",ea,[a[10]||(a[10]=e("span",{class:"text-sm text-color-secondary"},"Dernière valeur",-1)),e("div",ta,[e("span",aa,f(q.value?.value??"-"),1),e("span",la,f(o.value.unit),1)]),e("div",oa,[t(s(ee),{severity:pe(o.value.trend_direction,o.value.goal_type),value:ve(o.value.trend_direction)},{icon:n(()=>[t(A,{icon:fe(o.value.trend_direction),class:"mr-2"},null,8,["icon"])]),_:1},8,["severity","value"]),e("span",sa,"Cible: "+f(o.value.target_value)+" "+f(o.value.unit),1)])])]),_:1}),t(s(N),null,{title:n(()=>[...a[11]||(a[11]=[F("Ajouter une valeur",-1)])]),content:n(()=>[e("form",{onSubmit:de(p,["prevent"]),class:"flex flex-col gap-4"},[e("div",ia,[a[12]||(a[12]=e("label",{for:"date",class:"text-sm font-medium text-color-secondary"},"Date",-1)),t(s(ke),{modelValue:d.value.date,"onUpdate:modelValue":a[0]||(a[0]=b=>d.value.date=b),dateFormat:"dd/mm/yy",showIcon:"",fluid:"",inputId:"date"},null,8,["modelValue"])]),e("div",na,[e("label",ra,"Valeur ("+f(o.value.unit)+")",1),t(s(Y),{modelValue:d.value.value,"onUpdate:modelValue":a[1]||(a[1]=b=>d.value.value=b),minFractionDigits:0,maxFractionDigits:2,inputId:"value",fluid:""},null,8,["modelValue"])]),e("div",da,[a[13]||(a[13]=e("label",{for:"comment",class:"text-sm font-medium text-color-secondary"},"Commentaire",-1)),t(s(te),{modelValue:d.value.comment,"onUpdate:modelValue":a[2]||(a[2]=b=>d.value.comment=b),rows:"3",autoResize:""},null,8,["modelValue"])]),t(s(z),{type:"submit",label:"Ajouter",loading:h.value},{icon:n(()=>[t(A,{icon:"plus",class:"mr-2"})]),_:1},8,["loading"])],32)]),_:1}),t(s(N),null,{title:n(()=>[...a[14]||(a[14]=[F("Détails",-1)])]),content:n(()=>[e("div",ca,[e("div",ua,[a[15]||(a[15]=e("span",{class:"text-color-secondary"},"Fréquence",-1)),e("span",ma,f(me(o.value.frequency)),1)]),e("div",va,[a[16]||(a[16]=e("span",{class:"text-color-secondary"},"Objectif",-1)),e("span",pa,f(ye(o.value.goal_type)),1)]),e("div",fa,[a[17]||(a[17]=e("span",{class:"text-color-secondary"},"Source",-1)),e("span",ya,f(o.value.data_source||"-"),1)]),e("div",_a,[a[18]||(a[18]=e("span",{class:"text-color-secondary"},"Méthode de calcul",-1)),e("span",ga,f(o.value.calculation_method||"-"),1)]),o.value.description?(v(),g("div",ba,[a[19]||(a[19]=e("span",{class:"text-color-secondary block mb-1"},"Description",-1)),e("p",xa,f(o.value.description),1)])):E("",!0),o.value.manager?(v(),g("div",ha,[a[20]||(a[20]=e("span",{class:"text-color-secondary block mb-1"},"Responsable",-1)),e("div",wa,[e("div",$a,f(o.value.manager.first_name[0])+f(o.value.manager.last_name[0]),1),e("span",ka,f(o.value.manager.first_name)+" "+f(o.value.manager.last_name),1)])])):E("",!0)])]),_:1}),t(s(N),null,{title:n(()=>[e("div",Va,[t(A,{icon:"tasks"}),a[21]||(a[21]=e("span",null,"Actions Liées",-1))])]),content:n(()=>[o.value.actions&&o.value.actions.length>0?(v(),g("div",Ca,[(v(!0),g(xe,null,he(o.value.actions,b=>(v(),g("div",{key:b.id,class:"p-3 border rounded-lg hover:bg-surface-50 cursor-pointer transition-colors",onClick:P=>s(u).push(`/actions/${b.id}`)},[e("div",Sa,[e("span",Da,f(b.title),1),t(s(ee),{severity:R(b.priority),class:"text-xs",value:$(b.priority).charAt(0)},null,8,["severity","value"])]),e("div",ja,[e("span",null,f(V(b.status)),1),b.due_date?(v(),g("span",za,f(se(b.due_date)),1)):E("",!0)])],8,Ia))),128))])):(v(),g("div",qa,"Aucune action liée."))]),_:1})])])):E("",!0),t(s(Be),{visible:m.value,"onUpdate:visible":a[7]||(a[7]=b=>m.value=b),header:"Modifier la valeur",style:{width:"450px"},modal:""},{footer:n(()=>[t(s(z),{label:"Annuler",text:"",onClick:a[6]||(a[6]=b=>m.value=!1),severity:"secondary"},{icon:n(()=>[t(A,{icon:"times",class:"mr-2"})]),_:1}),t(s(z),{label:"Enregistrer",onClick:K,loading:l.value},{icon:n(()=>[t(A,{icon:"check",class:"mr-2"})]),_:1},8,["loading"])]),default:n(()=>[e("div",Ta,[e("div",Aa,[a[22]||(a[22]=e("label",{for:"edit-date",class:"text-sm font-medium text-color-secondary"},"Date",-1)),t(s(ke),{modelValue:i.value.date,"onUpdate:modelValue":a[3]||(a[3]=b=>i.value.date=b),dateFormat:"dd/mm/yy",showIcon:"",fluid:"",inputId:"edit-date"},null,8,["modelValue"])]),e("div",Ua,[a[23]||(a[23]=e("label",{for:"edit-value",class:"text-sm font-medium text-color-secondary"},"Valeur",-1)),t(s(Y),{modelValue:i.value.value,"onUpdate:modelValue":a[4]||(a[4]=b=>i.value.value=b),minFractionDigits:0,maxFractionDigits:2,inputId:"edit-value",fluid:""},null,8,["modelValue"])]),e("div",La,[a[24]||(a[24]=e("label",{for:"edit-comment",class:"text-sm font-medium text-color-secondary"},"Commentaire",-1)),t(s(te),{modelValue:i.value.comment,"onUpdate:modelValue":a[5]||(a[5]=b=>i.value.comment=b),rows:"3",autoResize:"",id:"edit-comment"},null,8,["modelValue"])])])]),_:1},8,["visible"])])}}}),bl=Object.freeze(Object.defineProperty({__proto__:null,default:Ea},Symbol.toStringTag,{value:"Module"})),Ma={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},Ba={class:"mb-4 col-span-1 md:col-span-2"},Fa={key:0,class:"text-red-500"},Ra={class:"mb-4"},Na={class:"mb-4"},Oa={class:"mb-4"},Pa={class:"mb-4"},Ha={key:0,class:"text-red-500"},Qa={class:"mb-4"},Wa={class:"mb-4"},Ga={key:0,class:"text-red-500"},Za={class:"mb-4"},Ka={class:"mb-4"},Ja={class:"mb-4 col-span-1 md:col-span-2"},Xa={class:"mb-4 col-span-1 md:col-span-2"},Ya={class:"mb-4 col-span-1 md:col-span-2"},el={class:"mb-4 col-span-1 md:col-span-2 flex items-center gap-2"},tl={class:"flex justify-end gap-3 pt-4 border-t border-surface-border"},ze=O({__name:"IndicatorForm",props:{initialData:{default:()=>({name:"",description:"",code:"",indicator_category_id:null,manager_id:null,unit:"",target_value:null,threshold_min:null,threshold_max:null,calculation_method:"",data_source:"",frequency:"monthly",trend_direction:"neutral",goal_type:"maximize",is_active:!0})},submitButtonText:{default:"Enregistrer"},loading:{type:Boolean,default:!1}},emits:["submit","cancel"],setup(_,{emit:y}){const u=_,x=y,k=$e(),C=Le(),c=S({name:u.initialData.name||"",description:u.initialData.description||"",code:u.initialData.code||"",indicator_category_id:u.initialData.indicator_category_id||null,manager_id:u.initialData.manager_id||null,unit:u.initialData.unit||"",target_value:u.initialData.target_value??null,threshold_min:u.initialData.threshold_min??null,threshold_max:u.initialData.threshold_max??null,calculation_method:u.initialData.calculation_method||"",data_source:u.initialData.data_source||"",frequency:u.initialData.frequency||"monthly",trend_direction:u.initialData.trend_direction||"neutral",goal_type:u.initialData.goal_type||"maximize",is_active:u.initialData.is_active??!0}),h=S({}),d=Ne({name:be().min(1,"Le nom est requis").max(255,"Le nom est trop long"),frequency:be().min(1,"La fréquence est requise"),goal_type:be().min(1,"L'objectif est requis")}),o=U(()=>(k.categories||[]).map(m=>({label:m.name,value:m.id}))),j=U(()=>(C.users||[]).map(m=>({label:`${m.first_name} ${m.last_name}`,value:m.id}))),q=[{value:"daily",label:"Quotidienne"},{value:"weekly",label:"Hebdomadaire"},{value:"monthly",label:"Mensuelle"},{value:"quarterly",label:"Trimestrielle"},{value:"yearly",label:"Annuelle"}],w=[{value:"maximize",label:"Maximiser (Mieux si ça monte)"},{value:"minimize",label:"Minimiser (Mieux si ça descend)"},{value:"target",label:"Cibler (Mieux si proche de la cible)"}],T=()=>{h.value={};try{return d.parse(c.value),!0}catch(m){return m instanceof Oe&&m.issues.forEach(l=>{if(l.path&&l.path.length>0){const i=l.path[0];i&&(h.value[i]=l.message)}}),!1}},I=()=>{T()&&(c.value.code||(c.value.code=c.value.name.toUpperCase().replace(/[^A-Z0-9]/g,"_").substring(0,50)),x("submit",{...c.value}))},p=()=>{x("cancel")};return Z(()=>{k.fetchCategories(),C.fetchUsers(1,100)}),ce(()=>u.initialData,m=>{m&&(c.value={name:m.name||"",description:m.description||"",code:m.code||"",indicator_category_id:m.indicator_category_id||null,manager_id:m.manager_id||null,unit:m.unit||"",target_value:m.target_value??null,threshold_min:m.threshold_min??null,threshold_max:m.threshold_max??null,calculation_method:m.calculation_method||"",data_source:m.data_source||"",frequency:m.frequency||"monthly",trend_direction:m.trend_direction||"neutral",goal_type:m.goal_type||"maximize",is_active:m.is_active??!0})},{deep:!0}),(m,l)=>(v(),g("form",{onSubmit:de(I,["prevent"]),class:"flex flex-col gap-6"},[e("div",Ma,[e("div",Ba,[l[13]||(l[13]=e("label",{for:"name",class:"block text-sm font-medium mb-2 text-color-secondary"},"Nom *",-1)),t(s(G),{id:"name",modelValue:c.value.name,"onUpdate:modelValue":l[0]||(l[0]=i=>c.value.name=i),placeholder:"Nom de l'indicateur",class:X(["w-full",{"p-invalid":h.value.name}])},null,8,["modelValue","class"]),h.value.name?(v(),g("small",Fa,f(h.value.name),1)):E("",!0)]),e("div",Ra,[l[14]||(l[14]=e("label",{for:"category",class:"block text-sm font-medium mb-2 text-color-secondary"},"Catégorie",-1)),t(s(H),{id:"category",modelValue:c.value.indicator_category_id,"onUpdate:modelValue":l[1]||(l[1]=i=>c.value.indicator_category_id=i),options:o.value,optionLabel:"label",optionValue:"value",placeholder:"Sélectionnez une catégorie",class:"w-full",showClear:""},null,8,["modelValue","options"])]),e("div",Na,[l[15]||(l[15]=e("label",{for:"manager",class:"block text-sm font-medium mb-2 text-color-secondary"},"Responsable",-1)),t(s(H),{id:"manager",modelValue:c.value.manager_id,"onUpdate:modelValue":l[2]||(l[2]=i=>c.value.manager_id=i),options:j.value,optionLabel:"label",optionValue:"value",placeholder:"Sélectionnez un responsable",class:"w-full",showClear:"",filter:""},null,8,["modelValue","options"])]),e("div",Oa,[l[16]||(l[16]=e("label",{for:"unit",class:"block text-sm font-medium mb-2 text-color-secondary"},"Unité",-1)),t(s(G),{id:"unit",modelValue:c.value.unit,"onUpdate:modelValue":l[3]||(l[3]=i=>c.value.unit=i),placeholder:"Unité de mesure (ex: %, kg, €)",class:"w-full"},null,8,["modelValue"])]),e("div",Pa,[l[17]||(l[17]=e("label",{for:"frequency",class:"block text-sm font-medium mb-2 text-color-secondary"},"Fréquence *",-1)),t(s(H),{id:"frequency",modelValue:c.value.frequency,"onUpdate:modelValue":l[4]||(l[4]=i=>c.value.frequency=i),options:q,optionLabel:"label",optionValue:"value",placeholder:"Sélectionnez une fréquence",class:X(["w-full",{"p-invalid":h.value.frequency}])},null,8,["modelValue","class"]),h.value.frequency?(v(),g("small",Ha,f(h.value.frequency),1)):E("",!0)]),e("div",Qa,[l[18]||(l[18]=e("label",{for:"target_value",class:"block text-sm font-medium mb-2 text-color-secondary"},"Valeur cible",-1)),t(s(Y),{id:"target_value",modelValue:c.value.target_value,"onUpdate:modelValue":l[5]||(l[5]=i=>c.value.target_value=i),placeholder:"Valeur cible",min:0,maxFractionDigits:2,class:"w-full"},null,8,["modelValue"])]),e("div",Wa,[l[19]||(l[19]=e("label",{for:"goal_type",class:"block text-sm font-medium mb-2 text-color-secondary"},"Objectif de l'indicateur *",-1)),t(s(H),{id:"goal_type",modelValue:c.value.goal_type,"onUpdate:modelValue":l[6]||(l[6]=i=>c.value.goal_type=i),options:w,optionLabel:"label",optionValue:"value",placeholder:"Sélectionnez l'objectif",class:X(["w-full",{"p-invalid":h.value.goal_type}])},null,8,["modelValue","class"]),h.value.goal_type?(v(),g("small",Ga,f(h.value.goal_type),1)):E("",!0),l[20]||(l[20]=e("small",{class:"text-xs text-muted-color block mt-1"}," Détermine comment la tendance est calculée automatiquement. ",-1))]),e("div",Za,[l[21]||(l[21]=e("label",{for:"threshold_min",class:"block text-sm font-medium mb-2 text-color-secondary"},"Seuil minimum",-1)),t(s(Y),{id:"threshold_min",modelValue:c.value.threshold_min,"onUpdate:modelValue":l[7]||(l[7]=i=>c.value.threshold_min=i),placeholder:"Seuil minimum",min:0,maxFractionDigits:2,class:"w-full"},null,8,["modelValue"])]),e("div",Ka,[l[22]||(l[22]=e("label",{for:"threshold_max",class:"block text-sm font-medium mb-2 text-color-secondary"},"Seuil maximum",-1)),t(s(Y),{id:"threshold_max",modelValue:c.value.threshold_max,"onUpdate:modelValue":l[8]||(l[8]=i=>c.value.threshold_max=i),placeholder:"Seuil maximum",min:0,maxFractionDigits:2,class:"w-full"},null,8,["modelValue"])]),e("div",Ja,[l[23]||(l[23]=e("label",{for:"data_source",class:"block text-sm font-medium mb-2 text-color-secondary"},"Source des données",-1)),t(s(G),{id:"data_source",modelValue:c.value.data_source,"onUpdate:modelValue":l[9]||(l[9]=i=>c.value.data_source=i),placeholder:"Source des données",class:"w-full"},null,8,["modelValue"])]),e("div",Xa,[l[24]||(l[24]=e("label",{for:"calculation_method",class:"block text-sm font-medium mb-2 text-color-secondary"},"Méthode de calcul",-1)),t(s(te),{id:"calculation_method",modelValue:c.value.calculation_method,"onUpdate:modelValue":l[10]||(l[10]=i=>c.value.calculation_method=i),placeholder:"Description de la méthode de calcul",rows:"3",class:"w-full"},null,8,["modelValue"])]),e("div",Ya,[l[25]||(l[25]=e("label",{for:"description",class:"block text-sm font-medium mb-2 text-color-secondary"},"Description",-1)),t(s(te),{id:"description",modelValue:c.value.description,"onUpdate:modelValue":l[11]||(l[11]=i=>c.value.description=i),placeholder:"Description détaillée de l'indicateur",rows:"4",class:"w-full"},null,8,["modelValue"])]),e("div",el,[t(s(Fe),{modelValue:c.value.is_active,"onUpdate:modelValue":l[12]||(l[12]=i=>c.value.is_active=i),binary:!0,inputId:"is_active"},null,8,["modelValue"]),l[26]||(l[26]=e("label",{for:"is_active",class:"text-sm font-medium text-color-secondary cursor-pointer"},"Indicateur actif",-1))])]),e("div",tl,[t(s(z),{label:"Annuler",icon:"pi pi-times",text:"",severity:"secondary",onClick:p}),t(s(z),{type:"submit",label:_.submitButtonText,icon:"pi pi-save",loading:_.loading},null,8,["label","loading"])])],32))}}),al={class:"p-4 p-4"},ll={class:"flex flex-col md:flex-row md:items-center md:justify-between mb-6"},ol=O({__name:"IndicateurCreate",setup(_){const y=ae(),u=le(),x=oe(),k=S(!1),C=async d=>{k.value=!0;try{await u.createIndicator({...d,target_value:d.target_value,threshold_min:d.threshold_min,threshold_max:d.threshold_max}),x.add({severity:"success",summary:"Succès",detail:"Indicateur créé avec succès",life:3e3}),y.push("/indicators/config")}catch(o){console.error("Erreur lors de la création de l'indicateur:",o),x.add({severity:"error",summary:"Erreur",detail:"Erreur lors de la création de l'indicateur",life:3e3})}finally{k.value=!1}},c=()=>{y.push("/indicators/config")},h=()=>y.back();return(d,o)=>{const j=Q("font-awesome-icon"),q=z,w=N;return v(),g("div",al,[e("div",ll,[o[0]||(o[0]=e("h2",null,"Créer un nouvel indicateur",-1)),t(q,{label:"Retour",onClick:h,severity:"secondary",variant:"outlined"},{icon:n(()=>[t(j,{icon:"arrow-left",class:"mr-2"})]),_:1})]),t(w,null,{content:n(()=>[t(ze,{submitButtonText:"Créer l'indicateur",loading:k.value,onSubmit:C,onCancel:c},null,8,["loading"])]),_:1})])}}}),xl=Object.freeze(Object.defineProperty({__proto__:null,default:ol},Symbol.toStringTag,{value:"Module"})),sl={class:"p-4 p-4"},il={class:"flex flex-col md:flex-row md:items-center md:justify-between mb-6"},nl={key:0,class:"flex justify-center items-center py-12"},rl={key:1,class:"flex justify-center items-center py-12"},dl={key:2,class:"flex justify-center items-center py-12"},cl={class:"text-lg text-red-600"},ul=O({__name:"IndicateurEdit",setup(_){const y=ae(),u=Ve(),x=le(),k=oe(),C=S({name:"",description:"",code:"",indicator_category_id:null,unit:"",target_value:null,threshold_min:null,threshold_max:null,calculation_method:"",data_source:"",frequency:"monthly",trend_direction:"neutral",goal_type:"maximize",is_active:!0}),c=S(!1),h=S(!1),d=S(""),o=async()=>{const I=parseInt(u.params.id);if(isNaN(I)){d.value="ID d'indicateur invalide";return}c.value=!0,d.value="";try{await x.fetchIndicatorById(I);const p=x.currentIndicator;p?C.value={name:p.name,description:p.description||"",code:p.code,indicator_category_id:p.indicator_category_id||null,unit:p.unit||"",target_value:p.target_value||null,threshold_min:p.threshold_min||null,threshold_max:p.threshold_max||null,calculation_method:p.calculation_method||"",data_source:p.data_source||"",frequency:p.frequency,trend_direction:p.trend_direction,goal_type:p.goal_type||"maximize",is_active:p.is_active}:d.value="Indicateur non trouvé"}catch(p){console.error("Erreur lors du chargement de l'indicateur:",p),d.value="Erreur lors du chargement de l'indicateur"}finally{c.value=!1}},j=async I=>{const p=parseInt(u.params.id);if(isNaN(p)){d.value="ID d'indicateur invalide";return}h.value=!0,d.value="";try{await x.updateIndicator(p,{...I,target_value:I.target_value,threshold_min:I.threshold_min,threshold_max:I.threshold_max}),k.add({severity:"success",summary:"Succès",detail:"Indicateur mis à jour avec succès",life:3e3}),y.push("/indicators/config")}catch(m){const l=m.message||"Erreur lors de la mise à jour de l'indicateur";k.add({severity:"error",summary:"Erreur",detail:l,life:3e3}),console.error(m)}finally{h.value=!1}},q=()=>{y.push("/indicators/config")},w=()=>y.back();Z(()=>{o()});const T=U(()=>x.currentIndicator);return(I,p)=>{const m=Q("font-awesome-icon"),l=z,i=N;return v(),g("div",sl,[e("div",il,[p[0]||(p[0]=e("h2",null,"Modifier l'indicateur",-1)),t(l,{label:"Retour",onClick:w,severity:"secondary",variant:"outlined"},{icon:n(()=>[t(m,{icon:"arrow-left",class:"mr-2"})]),_:1})]),c.value?(v(),g("div",nl,[t(m,{icon:["fas","spinner"],spin:"",size:"2x",class:"text-color-secondary"})])):!T.value&&!d.value?(v(),g("div",rl,[...p[1]||(p[1]=[e("p",{class:"text-lg text-color-secondary"},"Indicateur non trouvé",-1)])])):d.value?(v(),g("div",dl,[e("p",cl,f(d.value),1)])):(v(),B(i,{key:3},{content:n(()=>[t(ze,{initialData:C.value,submitButtonText:"Enregistrer les modifications",loading:h.value,onSubmit:j,onCancel:q},null,8,["initialData","loading"])]),_:1}))])}}}),hl=Object.freeze(Object.defineProperty({__proto__:null,default:ul},Symbol.toStringTag,{value:"Module"}));export{_l as I,gl as a,bl as b,xl as c,hl as d};
