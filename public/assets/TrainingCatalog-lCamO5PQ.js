import{d as G,c as m,a as o,x as j,p as k,b as l,r as I,t as h,o as a,g as O,i as $,h as x,j as Q,w as f,u as r,s as y,F as q,I as T,k as M,m as A,y as X}from"./index-oOuEsLBu.js";import{u as Y}from"./training-DGriRGlx.js";import{s as Z,_ as ee}from"./IconPicker.vue_vue_type_script_setup_true_lang-BKN-Qb48.js";import{s as U}from"./index-IzGGsCUm.js";import{s as oe}from"./index-D25kfrV8.js";import{s as B}from"./index-D4NNOuL2.js";import{s as te}from"./index-DHIZNu1f.js";import"./index-CFLhIysZ.js";import"./index-B0RCps1L.js";import"./index-kYhIjE44.js";const le={class:"p-5 pl-7 flex-1 flex flex-col gap-4"},ie={class:"flex items-center justify-between"},se={class:"flex items-center gap-2 text-sm text-color-secondary"},re={class:"font-medium"},ne={class:"font-bold text-color text-lg leading-snug"},ae={key:0,class:"text-sm text-color-secondary line-clamp-2"},de={class:"flex items-center justify-between pt-4 border-t border-surface-border mt-auto"},ue={key:0,class:"flex items-center gap-2 text-sm text-color-secondary"},ce={key:1,class:"flex items-center gap-2 text-sm text-color-secondary"},R=G({__name:"TrainingCard",props:{training:{}},emits:["click"],setup(u){const w=n=>{if(n>=12){const d=Math.floor(n/12),v=n%12;return v>0?`${d} ans ${v} mois`:`${d} ans`}return`${n} mois`};return(n,d)=>{const v=I("font-awesome-icon");return a(),m("div",{class:"surface-card rounded-lg shadow-sm border border-surface-border hover:shadow-md transition-all duration-200 cursor-pointer h-full flex flex-col relative overflow-hidden group",onClick:d[0]||(d[0]=N=>n.$emit("click"))},[o("div",{class:"absolute left-0 top-0 bottom-0 w-1.5",style:j({backgroundColor:u.training.category?.color||"#cbd5e1"})},null,4),o("div",le,[o("div",ie,[o("div",se,[l(v,{icon:["fas",u.training.category?.icon||"book"],style:j({color:u.training.category?.color||"var(--text-color-secondary)"})},null,8,["icon","style"]),o("span",re,h(u.training.category?.name||"Sans catégorie"),1)])]),o("h3",ne,h(u.training.title),1),u.training.description?(a(),m("p",ae,h(u.training.description),1)):k("",!0),o("div",de,[u.training.duration_hours?(a(),m("div",ue,[l(v,{icon:"clock",class:"text-color-secondary"}),o("span",null,h(u.training.duration_hours)+"h",1)])):k("",!0),u.training.validity_months?(a(),m("div",ce,[l(v,{icon:"calendar-check",class:"text-color-secondary"}),o("span",null,"Validité: "+h(w(u.training.validity_months)),1)])):k("",!0)])])])}}}),me={class:"p-4"},ve={class:"flex flex-col md:flex-row md:items-center md:justify-between mb-6"},ge={class:"flex items-center gap-4"},fe={class:"flex gap-2"},ye={key:0,class:"flex justify-center py-12"},pe={key:1,class:"flex flex-col gap-8"},_e={class:"flex items-center gap-3 mb-4 border-b border-gray-200 pb-2"},be={class:"text-xl font-semibold text-gray-800"},xe={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6"},he=["onClick"],Ve={key:0},Ce={class:"flex items-center gap-3 mb-4 border-b border-gray-200 pb-2"},ke={class:"w-8 h-8 rounded bg-gray-400 flex items-center justify-center text-white"},we={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6"},$e={class:"field"},qe={class:"field mt-4"},Te={class:"flex gap-2"},Ue={class:"field mt-4"},Be={class:"field"},je={class:"field mt-4"},Ne={class:"field mt-4"},Se={class:"grid grid-cols-2 gap-4 mt-4"},De={class:"field"},Fe={class:"field"},ze={class:"field mt-4"},Ke=G({__name:"TrainingCatalog",setup(u){const w=X(),n=Y(),d=O(),v=$(()=>n.loading),N=$(()=>n.categories),S=$(()=>n.trainings.filter(i=>!i.training_category_id)),L=i=>n.trainings.filter(e=>e.training_category_id===i),V=x(!1),p=x(null),c=x({name:"",color:"#64748B",icon:"folder"}),P=()=>{p.value=null,c.value={name:"",color:"#64748B",icon:"folder"},V.value=!0},W=i=>{p.value=i,c.value={name:i.name,color:i.color||"#64748B",icon:i.icon||"folder"},V.value=!0},D=()=>{V.value=!1,p.value=null},H=async()=>{try{p.value?(await n.updateCategory(p.value.id,c.value),d.add({severity:"success",summary:"Succès",detail:"Catégorie mise à jour",life:3e3})):(await n.createCategory(c.value),d.add({severity:"success",summary:"Succès",detail:"Catégorie créée",life:3e3})),D()}catch{d.add({severity:"error",summary:"Erreur",detail:"Une erreur est survenue",life:3e3})}},C=x(!1),_=x(null),s=x({training_category_id:null,title:"",description:"",duration_hours:null,validity_months:null,required_frequency_months:null}),F=i=>{_.value=null,s.value={training_category_id:typeof i=="number"?i:null,title:"",description:"",duration_hours:null,validity_months:null,required_frequency_months:null},C.value=!0},z=i=>{_.value=i,s.value={training_category_id:i.training_category_id,title:i.title,description:i.description||"",duration_hours:i.duration_hours,validity_months:i.validity_months,required_frequency_months:i.required_frequency_months},C.value=!0},E=()=>{C.value=!1,_.value=null},J=async()=>{if(!s.value.title||!s.value.training_category_id){d.add({severity:"warn",summary:"Attention",detail:"Veuillez remplir les champs obligatoires",life:3e3});return}try{_.value?(await n.updateTraining(_.value.id,{...s.value,training_category_id:s.value.training_category_id}),d.add({severity:"success",summary:"Succès",detail:"Formation mise à jour",life:3e3})):(await n.createTraining({...s.value,training_category_id:s.value.training_category_id}),d.add({severity:"success",summary:"Succès",detail:"Formation créée",life:3e3})),E()}catch{d.add({severity:"error",summary:"Erreur",detail:"Une erreur est survenue",life:3e3})}},K=()=>{w.back()};return Q(async()=>{await Promise.all([n.fetchCategories(),n.fetchTrainings()])}),(i,e)=>{const g=I("font-awesome-icon");return a(),m("div",me,[o("div",ve,[o("div",ge,[l(r(y),{text:"",rounded:"",severity:"secondary",onClick:K},{icon:f(()=>[l(g,{icon:"arrow-left"})]),_:1}),e[12]||(e[12]=o("h2",null,"Catalogue des formations",-1)),o("div",fe,[l(r(y),{label:"Nouvelle catégorie",severity:"secondary",outlined:"",onClick:P},{icon:f(()=>[l(g,{icon:"folder-plus",class:"mr-2"})]),_:1}),l(r(y),{label:"Nouvelle formation",onClick:F},{icon:f(()=>[l(g,{icon:"plus",class:"mr-2"})]),_:1})])])]),v.value?(a(),m("div",ye,[l(g,{icon:["fas","spinner"],spin:"",size:"2x",class:"text-gray-500"})])):(a(),m("div",pe,[(a(!0),m(q,null,T(N.value,t=>(a(),m("div",{key:t.id},[o("div",_e,[o("div",{class:"w-8 h-8 rounded flex items-center justify-center text-white",style:j({backgroundColor:t.color||"#64748B"})},[l(g,{icon:t.icon||"folder"},null,8,["icon"])],4),o("h2",be,h(t.name),1),l(r(y),{text:"",rounded:"",size:"small",severity:"secondary",onClick:b=>W(t)},{icon:f(()=>[l(g,{icon:"pencil"})]),_:1},8,["onClick"])]),o("div",xe,[(a(!0),m(q,null,T(L(t.id),b=>(a(),A(R,{key:b.id,training:b,onClick:Ee=>z(b)},null,8,["training","onClick"]))),128)),o("div",{class:"border-2 border-dashed border-gray-300 rounded-lg flex flex-col items-center justify-center p-6 cursor-pointer hover:border-blue-500 hover:bg-blue-50 transition-colors min-h-[200px]",onClick:b=>F(t.id)},[l(g,{icon:"plus",class:"text-gray-400 text-3xl mb-2"}),e[13]||(e[13]=o("span",{class:"text-gray-500 font-medium"},"Ajouter une formation",-1))],8,he)])]))),128)),S.value.length>0?(a(),m("div",Ve,[o("div",Ce,[o("div",ke,[l(g,{icon:"question"})]),e[14]||(e[14]=o("h2",{class:"text-xl font-semibold text-gray-800"},"Sans catégorie",-1))]),o("div",we,[(a(!0),m(q,null,T(S.value,t=>(a(),A(R,{key:t.id,training:t,onClick:b=>z(t)},null,8,["training","onClick"]))),128))])])):k("",!0)])),l(r(M),{visible:V.value,"onUpdate:visible":e[4]||(e[4]=t=>V.value=t),header:p.value?"Modifier la catégorie":"Nouvelle catégorie",modal:!0,class:"p-fluid w-full max-w-md"},{footer:f(()=>[l(r(y),{label:"Annuler",text:"",severity:"secondary",onClick:D}),l(r(y),{label:"Enregistrer",onClick:H})]),default:f(()=>[o("div",$e,[e[15]||(e[15]=o("label",{for:"catName"},"Nom",-1)),l(r(U),{id:"catName",modelValue:c.value.name,"onUpdate:modelValue":e[0]||(e[0]=t=>c.value.name=t),required:"",autofocus:""},null,8,["modelValue"])]),o("div",qe,[e[16]||(e[16]=o("label",{for:"catColor"},"Couleur",-1)),o("div",Te,[l(r(Z),{modelValue:c.value.color,"onUpdate:modelValue":e[1]||(e[1]=t=>c.value.color=t)},null,8,["modelValue"]),l(r(U),{modelValue:c.value.color,"onUpdate:modelValue":e[2]||(e[2]=t=>c.value.color=t),placeholder:"#RRGGBB"},null,8,["modelValue"])])]),o("div",Ue,[e[17]||(e[17]=o("label",{for:"catIcon"},"Icône",-1)),l(ee,{modelValue:c.value.icon,"onUpdate:modelValue":e[3]||(e[3]=t=>c.value.icon=t)},null,8,["modelValue"])])]),_:1},8,["visible","header"]),l(r(M),{visible:C.value,"onUpdate:visible":e[11]||(e[11]=t=>C.value=t),header:_.value?"Modifier la formation":"Nouvelle formation",modal:!0,class:"p-fluid w-full max-w-lg"},{footer:f(()=>[l(r(y),{label:"Annuler",text:"",severity:"secondary",onClick:E}),l(r(y),{label:"Enregistrer",onClick:J})]),default:f(()=>[o("div",Be,[e[18]||(e[18]=o("label",{for:"title"},"Titre",-1)),l(r(U),{id:"title",modelValue:s.value.title,"onUpdate:modelValue":e[5]||(e[5]=t=>s.value.title=t),required:"",autofocus:""},null,8,["modelValue"])]),o("div",je,[e[19]||(e[19]=o("label",{for:"category"},"Catégorie",-1)),l(r(te),{id:"category",modelValue:s.value.training_category_id,"onUpdate:modelValue":e[6]||(e[6]=t=>s.value.training_category_id=t),options:r(n).categories,optionLabel:"name",optionValue:"id",placeholder:"Sélectionnez une catégorie"},null,8,["modelValue","options"])]),o("div",Ne,[e[20]||(e[20]=o("label",{for:"description"},"Description",-1)),l(r(oe),{id:"description",modelValue:s.value.description,"onUpdate:modelValue":e[7]||(e[7]=t=>s.value.description=t),rows:"3"},null,8,["modelValue"])]),o("div",Se,[o("div",De,[e[21]||(e[21]=o("label",{for:"duration"},"Durée (heures)",-1)),l(r(B),{id:"duration",modelValue:s.value.duration_hours,"onUpdate:modelValue":e[8]||(e[8]=t=>s.value.duration_hours=t),min:0},null,8,["modelValue"])]),o("div",Fe,[e[22]||(e[22]=o("label",{for:"validity"},"Validité (mois)",-1)),l(r(B),{id:"validity",modelValue:s.value.validity_months,"onUpdate:modelValue":e[9]||(e[9]=t=>s.value.validity_months=t),min:0},null,8,["modelValue"])])]),o("div",ze,[e[23]||(e[23]=o("label",{for:"frequency"},"Fréquence requise (mois)",-1)),l(r(B),{id:"frequency",modelValue:s.value.required_frequency_months,"onUpdate:modelValue":e[10]||(e[10]=t=>s.value.required_frequency_months=t),min:0},null,8,["modelValue"])])]),_:1},8,["visible","header"])])}}});export{Ke as default};
