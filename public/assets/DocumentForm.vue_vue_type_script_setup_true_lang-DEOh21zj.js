import{d as I,J as j,h as Z,i as k,q as J,j as K,c,n as P,a as t,p as d,m as h,b as a,r as R,e as D,w as v,u,t as m,s as V,v as b,o as n}from"./index-oOuEsLBu.js";import{s as z}from"./index-IzGGsCUm.js";import{s as M}from"./index-CFLhIysZ.js";import{s as H}from"./index-D25kfrV8.js";import{s as Q}from"./index-DHPOKPzk.js";import{u as W,a as X}from"./index-XG19fh9S.js";import{s as Y}from"./index-CYWC0yQY.js";import{u as ee}from"./category-B4VxuJds.js";import{o as te,d as oe,s as _,n as C,Z as se}from"./schemas-C8kxHR-7.js";const le={class:"field"},ie={key:0,class:"bg-blue-50 p-4 rounded-md border border-blue-200 mb-2"},ae={class:"flex items-start"},ne={class:"flex items-center justify-center flex-col"},de={key:2,class:"mt-2 flex items-center gap-2 text-sm text-color bg-surface-100 dark:bg-surface-800 p-2 rounded"},re={class:"font-semibold"},ce={key:3,class:"text-red-500"},ue={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},me={class:"field"},pe={key:0,class:"text-red-500"},fe={class:"field"},xe={key:0,class:"text-red-500"},ve={class:"field"},be={key:0,class:"text-red-500"},ye={class:"field"},_e={class:"flex items-center gap-2"},ge={key:0,class:"flex items-center gap-2"},ke={key:0,class:"text-red-500"},he={class:"field"},Ve={key:0,class:"text-red-500"},we={class:"field"},Se={key:0,class:"text-red-500"},Be={class:"field"},Fe={class:"flex justify-end gap-3 pt-4 border-t border-surface-border"},Ne=I({__name:"DocumentForm",props:{initialData:{default:()=>({title:"",description:"",document_folder_id:null,category_id:null,version:"1.0",status:"draft"})},submitButtonText:{default:"Enregistrer"},loading:{type:Boolean,default:!1},isEditMode:{type:Boolean,default:!1}},emits:["submit","cancel"],setup(x,{emit:E}){const g=x,w=E,S=W(),B=ee(),i=j({title:"",description:"",document_folder_id:null,category_id:null,version:"1.0",status:"draft",...g.initialData}),p=Z(void 0),s=j({}),U=te({title:_().min(1,"Le titre est requis").max(255,"Le titre est trop long"),description:_().optional(),document_folder_id:C().nullable(),category_id:C(),version:_().min(1,"La version est requise"),status:_().min(1,"Le statut est requis"),expires_date:oe().nullable().optional()}),L=k(()=>{const o=e=>({key:e.id.toString(),label:e.name,data:e.id,children:e.children?e.children.map(o):[]});return S.folders.map(o)}),y=k(()=>B.categories.map(o=>({value:o.id,text:o.name,icon:o.icon}))),T=[{value:"draft",text:"Brouillon"},{value:"pending_approval",text:"En attente d'approbation"},{value:"approved",text:"Approuvé"},{value:"rejected",text:"Rejeté"},{value:"archived",text:"Archivé"}],N=o=>{const e=Array.isArray(o.files)?o.files[0]:o.files;e&&(p.value=e,delete s.file)},O=()=>{p.value=void 0},F=k({get:()=>i.document_folder_id?{[i.document_folder_id.toString()]:!0}:null,set:o=>{if(o&&typeof o=="object"){const e=Object.keys(o);e.length>0?i.document_folder_id=parseInt(e[0]):i.document_folder_id=null}else i.document_folder_id=null}}),$=o=>{if(o===0)return"0 Bytes";const e=1024,r=["Bytes","KB","MB","GB"],l=Math.floor(Math.log(o)/Math.log(e)),f=r[l]||r[r.length-1];return parseFloat((o/Math.pow(e,l)).toFixed(2))+" "+f},q=()=>{Object.keys(s).forEach(o=>delete s[o]);try{return U.parse(i),!0}catch(o){return o instanceof se&&o.issues.forEach(e=>{e.path&&(s[e.path[0]]=e.message)}),!1}},A=()=>{if(q()){if(!p.value&&!g.initialData.title){s.file="Le fichier est requis pour un nouveau document";return}w("submit",{...i,file:p.value})}},G=()=>{w("cancel")};return J(()=>g.initialData,o=>{o&&Object.assign(i,o)},{deep:!0}),K(()=>{S.fetchFolders(),B.fetchCategories()}),(o,e)=>{const r=R("font-awesome-icon");return n(),c("form",{onSubmit:P(A,["prevent"]),class:"flex flex-col gap-6"},[t("div",le,[e[9]||(e[9]=t("label",{class:"block text-sm font-medium mb-2 text-color-secondary"},"Fichier",-1)),x.isEditMode?(n(),c("div",ie,[t("div",ae,[a(r,{icon:["fas","info-circle"],class:"text-blue-500 mt-1 mr-2"}),e[7]||(e[7]=t("p",{class:"text-sm text-blue-700 m-0"},[D(" Pour modifier le fichier ou créer une nouvelle version, veuillez utiliser le bouton "),t("strong",null,'"Nouvelle Version"'),D(" sur la page de détail du document. ")],-1))])])):d("",!0),x.isEditMode?d("",!0):(n(),h(u(Q),{key:1,name:"file",auto:!0,customUpload:!0,onUploader:N,maxFileSize:1e7,accept:".pdf,.doc,.docx,.xls,.xlsx,.jpg,.jpeg,.png,application/pdf,application/msword,application/vnd.openxmlformats-officedocument.wordprocessingml.document,application/vnd.ms-excel,application/vnd.openxmlformats-officedocument.spreadsheetml.sheet,image/jpeg,image/png"},{empty:v(()=>[t("div",ne,[a(r,{icon:["fas","cloud-upload-alt"],class:"text-6xl text-color-secondary mb-4"}),e[8]||(e[8]=t("p",{class:"mt-4 mb-0 text-color-secondary"}," Glisser-déposer le fichier ici pour le télécharger. ",-1))])]),_:1})),p.value?(n(),c("div",de,[a(r,{icon:["fas","check-circle"],class:"text-green-500"}),t("span",re,m(p.value.name),1),t("span",null,"("+m($(p.value.size))+")",1),a(u(V),{onClick:O,outlined:"",rounded:"",severity:"danger",size:"small",class:"w-8 h-8"},{icon:v(()=>[a(r,{icon:["fas","times"]})]),_:1})])):d("",!0),s.file?(n(),c("small",ce,m(s.file),1)):d("",!0)]),t("div",ue,[t("div",me,[e[10]||(e[10]=t("label",{for:"title",class:"block text-sm font-medium mb-2 text-color-secondary"},"Titre *",-1)),a(u(z),{id:"title",modelValue:i.title,"onUpdate:modelValue":e[0]||(e[0]=l=>i.title=l),placeholder:"Titre du document",class:b(["w-full",{"p-invalid":s.title}])},null,8,["modelValue","class"]),s.title?(n(),c("small",pe,m(s.title),1)):d("",!0)]),t("div",fe,[e[11]||(e[11]=t("label",{for:"version",class:"block text-sm font-medium mb-2 text-color-secondary"},"Version *",-1)),a(u(z),{id:"version",modelValue:i.version,"onUpdate:modelValue":e[1]||(e[1]=l=>i.version=l),placeholder:"1.0",class:b(["w-full",{"p-invalid":s.version}]),disabled:x.isEditMode},null,8,["modelValue","class","disabled"]),s.version?(n(),c("small",xe,m(s.version),1)):d("",!0)]),t("div",ve,[e[12]||(e[12]=t("label",{for:"folder",class:"block text-sm font-medium mb-2 text-color-secondary"},"Dossier",-1)),a(u(X),{modelValue:F.value,"onUpdate:modelValue":e[2]||(e[2]=l=>F.value=l),options:L.value,placeholder:"Sélectionnez un dossier",class:b(["w-full",{"p-invalid":s.document_folder_id}])},null,8,["modelValue","options","class"]),s.document_folder_id?(n(),c("small",be,m(s.document_folder_id),1)):d("",!0)]),t("div",ye,[e[13]||(e[13]=t("label",{for:"category",class:"block text-sm font-medium mb-2 text-color-secondary"},"Type de document *",-1)),a(u(M),{id:"category",modelValue:i.category_id,"onUpdate:modelValue":e[3]||(e[3]=l=>i.category_id=l),options:y.value,optionLabel:"text",optionValue:"value",placeholder:"Sélectionnez un type",class:b(["w-full",{"p-invalid":s.category_id}])},{option:v(({option:l})=>[t("div",_e,[l.icon?(n(),h(r,{key:0,icon:["fas",l.icon]},null,8,["icon"])):d("",!0),t("span",null,m(l.text),1)])]),value:v(({value:l})=>[l?(n(),c("div",ge,[y.value.find(f=>f.value===l)?.icon?(n(),h(r,{key:0,icon:["fas",y.value.find(f=>f.value===l)?.icon]},null,8,["icon"])):d("",!0),t("span",null,m(y.value.find(f=>f.value===l)?.text),1)])):d("",!0)]),_:1},8,["modelValue","options","class"]),s.category_id?(n(),c("small",ke,m(s.category_id),1)):d("",!0)]),t("div",he,[e[14]||(e[14]=t("label",{for:"status",class:"block text-sm font-medium mb-2 text-color-secondary"},"Statut *",-1)),a(u(M),{id:"status",modelValue:i.status,"onUpdate:modelValue":e[4]||(e[4]=l=>i.status=l),options:T,optionLabel:"text",optionValue:"value",placeholder:"Sélectionnez un statut",class:b(["w-full",{"p-invalid":s.status}])},null,8,["modelValue","class"]),s.status?(n(),c("small",Ve,m(s.status),1)):d("",!0)]),t("div",we,[e[15]||(e[15]=t("label",{for:"expires_date",class:"block text-sm font-medium mb-2 text-color-secondary"},"Date d'expiration (optionnel)",-1)),a(u(Y),{id:"expires_date",modelValue:i.expires_date,"onUpdate:modelValue":e[5]||(e[5]=l=>i.expires_date=l),dateFormat:"dd/mm/yy",placeholder:"Sélectionnez une date",class:b(["w-full",{"p-invalid":s.expires_date}]),fluid:"",showIcon:"",iconDisplay:"input"},null,8,["modelValue","class"]),s.expires_date?(n(),c("small",Se,m(s.expires_date),1)):d("",!0)])]),t("div",Be,[e[16]||(e[16]=t("label",{for:"description",class:"block text-sm font-medium mb-2 text-color-secondary"},"Description",-1)),a(u(H),{id:"description",modelValue:i.description,"onUpdate:modelValue":e[6]||(e[6]=l=>i.description=l),placeholder:"Description du document",rows:"4",class:"w-full"},null,8,["modelValue"])]),t("div",Fe,[a(u(V),{label:"Annuler",text:"",severity:"secondary",onClick:G},{icon:v(()=>[a(r,{icon:["fas","times"]})]),_:1}),a(u(V),{type:"submit",label:x.submitButtonText,loading:x.loading},{icon:v(()=>[a(r,{icon:["fas","save"]})]),_:1},8,["label","loading"])])],32)}}});export{Ne as _};
